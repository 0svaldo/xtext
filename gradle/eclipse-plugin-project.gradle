import org.apache.ivy.osgi.core.ManifestParser

buildscript {
	repositories.jcenter()
	dependencies {
		classpath (group: 'org.apache.ivy', name: 'ivy', version: '2.4.0')
	}
}

apply plugin: 'java'
apply from: "${rootDir}/gradle/dependency-mapping.gradle"

dependencies {
	def manifestFile = new File(projectDir, 'META-INF/MANIFEST.MF')
	def manifest = ManifestParser.parseManifest(manifestFile)
	manifest.requires
		.collect{toDependency(it)}
		.findAll {it != null}
		.each {
			add('compile', it)
		}
}


jar {
	from('bin')
	manifest {
		from('META-INF/MANIFEST.MF')
	}
	Properties buildProperties = new Properties()
	File propertiesFile = new File(projectDir, 'build.properties')
	propertiesFile.withInputStream {
			buildProperties.load(it)
	}
	def binIncludes = buildProperties.get("bin.includes").split(',').findAll{it != "."}
	binIncludes.each{ include ->
		if (project.file(include).isDirectory()) {
			from(include) {
				into(include)
			}
		} else {
			from(include)
		}
	}
}

//skip compilation, done by Eclipse/Buckminster
sourceSets*.java*.srcDirs = []
sourceSets*.resources*.srcDirs = []