<html>
  <head>
    <META http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
    <title>Closures</title>
    <link href="book.css" rel="stylesheet" type="text/css">
    <link href="code.css" rel="stylesheet" type="text/css">
    <link href="http://www.eclipse.org/eclipse.org-common/yui/2.6.0/build/reset-fonts-grids/reset-fonts-grids.css" rel="stylesheet" type="text/css" media="screen">
    <link href="http://www.eclipse.org/eclipse.org-common/yui/2.6.0/build/menu/assets/skins/sam/menu.css" rel="stylesheet" type="text/css" media="screen">
    <link href="http://www.eclipse.org/eclipse.org-common/themes/Nova/css/reset.css" rel="stylesheet" type="text/css" media="screen">
    <link href="http://www.eclipse.org/eclipse.org-common/themes/Nova/css/layout.css" rel="stylesheet" type="text/css" media="screen">
    <link href="http://www.eclipse.org/eclipse.org-common/themes/Nova/css/header.css" rel="stylesheet" type="text/css" media="screen">
    <link href="http://www.eclipse.org/eclipse.org-common/themes/Nova/css/footer.css" rel="stylesheet" type="text/css" media="screen">
    <link href="http://www.eclipse.org/eclipse.org-common/themes/Nova/css/visual.css" rel="stylesheet" type="text/css" media="screen">
    <link href="http://www.eclipse.org/eclipse.org-common/themes/Nova/css/print.css" rel="stylesheet" type="text/css" media="print">
    <link rel="stylesheet" type="text/css" href="http://www.eclipse.org/Xtext/style.css"/>
    <link rel="stylesheet" type="text/css" href="http://www.eclipse.org/style2.css"/>
     <script type="text/javascript"> 
    	function initTocMenu(ActiveSubTocElementId){
    		var menu = document.getElementById("leftnav");
    		
    		var chapters = menu.children;
    		addHideSubsectionFunction(chapters);
    		
    		document.getElementById(ActiveSubTocElementId).style.display = "block";
    	}
    
    	function addHideSubsectionFunction(items){
    		for (var i = 0; i < items.length; i++) {
    			if (items[i].firstElementChild ){
    				items[i].firstElementChild.onclick = function(){toc_toggle_subsections(this.parentNode);};
    				items[i].firstElementChild.style.cursor = "pointer";
    			}
    		}
    	}
    	function toc_toggle_subsections(chap){
    		if ( chap.children[1].style.display != "none" ) {
    			chap.children[1].style.display = "none"
    		} else {
    			chap.children[1].style.display = "block"
    			
    		}
    	}
    	
    	function highlightCurrentSection(sec) {
    		document.getElementById(sec).style.backgroundColor= "#D0D0D0"
    	}
    </script>
  </head>

<body onload="initTocMenu('subToc_04-Expressions.html');highlightCurrentSection(document.URL.substring(document.URL.lastIndexOf('/')+1));">
<div id="novaWrapper">		<div id="clearHeader">
		<div id="logo">
				<div id="promotion"><a href="/indigo/friends.php">
	<img src="/home/promotions/indigo/indigo.png" alt="Indigo Is Coming!"/>
</a>

</div>

		</div>
		<div id="otherSites">
			<div id="sites">
			<ul id="sitesUL">
				<li><a href='http://marketplace.eclipse.org'><img alt="Eclipse Marketplace" src="http://dev.eclipse.org/custom_icons/marketplace.png"/>&nbsp;<div>Eclipse Marketplace</div></a></li>
				<li><a href='http://live.eclipse.org'><img alt="Eclipse Live" src="http://dev.eclipse.org/custom_icons/audio-input-microphone-bw.png"/>&nbsp;<div>Eclipse Live</div></a></li>

	    		<li><a href='https://bugs.eclipse.org/bugs/'><img alt="Bugzilla" src="http://dev.eclipse.org/custom_icons/system-search-bw.png"/>&nbsp;<div>Bugzilla</div></a></li>
	    		<li><a href='http://www.eclipse.org/forums/'><img alt="Forums" src="http://dev.eclipse.org/large_icons/apps/internet-group-chat.png"/>&nbsp;<div>Eclipse Forums</div></a></li>
	    		<li><a href='http://www.planeteclipse.org/'><img alt="Planet Eclipse" src="http://dev.eclipse.org/large_icons/devices/audio-card.png"/>&nbsp;<div>Planet Eclipse</div></a></li>
	    		<li><a href='http://wiki.eclipse.org/'><img alt="Eclipse Wiki" src="http://dev.eclipse.org/custom_icons/accessories-text-editor-bw.png"/>&nbsp;<div>Eclipse Wiki</div></a></li>
	    		<li><a href='http://portal.eclipse.org'><img alt="MyFoundation Portal" src="http://dev.eclipse.org/custom_icons/preferences-system-network-proxy-bw.png"/><div>My Foundation Portal</div></a></li>
	    	</ul>

	    	</div>
		</div>		
	</div>

<div id="header">			
	<div id="menu">
		<ul>
		<li><a href="/Xtext" target="_self">Home</a></li> 
		<li><a href="/Xtext/download" target="_self">Download</a></li> 
		<li><a href="index.html" target="_self">Documentation</a></li> 
		<li><a href="/Xtext/support" target="_self">Support</a></li> 
		<li><a href="/Xtext/community" target="_self">Community</a></li> 
		<li><a href="/Xtext/developers" target="_self">Developers</a></li> 
			</ul>

	</div>

	<div id="search">
			<form action="http://www.google.com/cse" id="searchbox_017941334893793413703:sqfrdtd112s">
		 	<input type="hidden" name="cx" value="017941334893793413703:sqfrdtd112s" />
	  		<input id="searchBox" type="text" name="q" size="25" />
	  		<input id="searchButton" type="submit" name="sa" value="Search" />
			</form>
		<script type="text/javascript" src="http://www.google.com/coop/cse/brand?form=searchbox_017941334893793413703%3Asqfrdtd112s&lang=en"></script>			
	</div>

</div>
<div id="novaContent" class="faux">
	<br style="clear:both;height:1em;">
	<div id="leftcol">
		<div class="nav-logo">
			<a href="index.html"><img src="http://wiki.eclipse.org/images/thumb/d/db/Xtext_logo.png/450px-Xtext_logo.png" style="margin-left:30px; width:125px"/></a>
		</div>
		<ul id="leftnav">
		<li class="separator"><div class="separator">Preface</div>
			</li>
		<li class="separator"><div class="separator">Lexical Syntax</div>
			<ul style="display: none;" id="subToc_02-Lexical%20Structure.html">
			<li id="02-Lexical%20Structure-0.html" ><a href="02-Lexical%20Structure-0.html" >Identifiers</a></li>
			<li id="02-Lexical%20Structure-1.html" ><a href="02-Lexical%20Structure-1.html" >String Literals</a></li>
			<li id="02-Lexical%20Structure-2.html" ><a href="02-Lexical%20Structure-2.html" >Integer Literals</a></li>
			<li id="02-Lexical%20Structure-3.html" ><a href="02-Lexical%20Structure-3.html" >Comments</a></li>
			<li id="02-Lexical%20Structure-4.html" ><a href="02-Lexical%20Structure-4.html" >White Space</a></li>
			<li id="02-Lexical%20Structure-5.html" ><a href="02-Lexical%20Structure-5.html" >Reserved Keywords</a></li>
			</ul>
			</li>
		<li class="separator"><div class="separator">Types</div>
			<ul style="display: none;" id="subToc_03-Types.html">
			<li id="03-Types-0.html" ><a href="03-Types-0.html" >Arrays</a></li>
			<li id="03-Types-1.html" ><a href="03-Types-1.html" >Simple Type References</a></li>
			<li id="03-Types-2.html" ><a href="03-Types-2.html" >Function Types</a></li>
			<li id="03-Types-3.html" ><a href="03-Types-3.html" >Parameterized Type References</a></li>
			<li id="03-Types-4.html" ><a href="03-Types-4.html" >Primitives</a></li>
			<li id="03-Types-5.html" ><a href="03-Types-5.html" >Conformance and Conversion</a></li>
			</ul>
			</li>
		<li class="separator"><div class="separator">Expressions</div>
			<ul style="display: none;" id="subToc_04-Expressions.html">
			<li id="04-Expressions-0.html" ><a href="04-Expressions-0.html" >Literals</a></li>
			<li id="04-Expressions-1.html" ><a href="04-Expressions-1.html" >Type Casts</a></li>
			<li id="04-Expressions-2.html" ><a href="04-Expressions-2.html" >Infix Operators / Operator Overloading</a></li>
			<li id="04-Expressions-3.html" ><a href="04-Expressions-3.html" >Feature Calls</a></li>
			<li id="04-Expressions-4.html" ><a href="04-Expressions-4.html" >Constructor Call</a></li>
			<li id="04-Expressions-5.html" ><a href="04-Expressions-5.html" >Closures</a></li>
			<li id="04-Expressions-6.html" ><a href="04-Expressions-6.html" >If Expression</a></li>
			<li id="04-Expressions-7.html" ><a href="04-Expressions-7.html" >Switch Expression</a></li>
			<li id="04-Expressions-8.html" ><a href="04-Expressions-8.html" >Variable Declarations</a></li>
			<li id="04-Expressions-9.html" ><a href="04-Expressions-9.html" >Blocks</a></li>
			<li id="04-Expressions-10.html" ><a href="04-Expressions-10.html" >For Loop</a></li>
			<li id="04-Expressions-11.html" ><a href="04-Expressions-11.html" >While Loop</a></li>
			<li id="04-Expressions-12.html" ><a href="04-Expressions-12.html" >Do-While Loop</a></li>
			<li id="04-Expressions-13.html" ><a href="04-Expressions-13.html" >Return Expression</a></li>
			<li id="04-Expressions-14.html" ><a href="04-Expressions-14.html" >Throwing Exceptions</a></li>
			<li id="04-Expressions-15.html" ><a href="04-Expressions-15.html" >Try, Catch, Finally</a></li>
			</ul>
			</li>
		</ul>
	</div>
	<div id="midcolumn">
		<div class="buttonbar">
		<span class="prev_button">
		<a href="04-Expressions-4.html" >Previous</a>
		</span>
		<a href="04-Expressions.html" >Top</a><span class="next_button">
		<a href="04-Expressions-6.html" >Next</a>
		</span>
		</div>
		<div style="clear:both;margin-bottom:1em"></div>
		
<a name="" ></a>
<h1>Closures</h1>
	<div class="toc">
	  <ul>
	    <li><a href="04-Expressions-5.html#0" >Syntax</a></li>
	    <li><a href="04-Expressions-5.html#1" >Typing</a></li>
	    <li><a href="04-Expressions-5.html#2" >Function Mapping</a></li>
	    <li><a href="04-Expressions-5.html#3" >Examples</a></li>
	  </ul>
	</div>
<p>
A closure is a literal that defines an anonymous function. A closure also captures the current scope,
so that any final variables and parameters visible at construction time can be referred to in the closure's expression. 
</p>
<a name="0" ></a>
<h2>Syntax</h2>
<p>
<div class="literallayout">
<div class="incode">
<p class="code">
XClosure:</br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">&apos;[&apos;</span>&nbsp;(&nbsp;JvmFormalParameter&nbsp;(<span class="string">&apos;,&apos;</span>&nbsp;JvmFormalParameter)*&nbsp;)?&nbsp;</br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">&apos;|&apos;</span>&nbsp;XExpression&nbsp;<span class="string">&apos;]&apos;</span>;
</p>
</div>
</div>
</p>
<p>
The surrounding square brackets are optional if the closure is the single argument of a method invocation.
That is you can write
</p>
<p>
<span class="inlinecode">myList.find(e|e.name==<span class="keyword">null</span>)</span>
</p>
<p>
instead of
</p>
<p>
<span class="inlinecode">myList.find([e|e.name==<span class="keyword">null</span>])</span>
</p>
<p>
But in all other cases the square brackets are mandatory:
</p>
<p>
<span class="inlinecode"><span class="keyword">val</span>&nbsp;func&nbsp;=&nbsp;[String&nbsp;s|&nbsp;s.length&gt;3]</span>
</p>
<a name="1" ></a>
<h2>Typing</h2>
<p>
Closures are expressions which produce function objects. The type is a <a href="03-Types-2.html" title="Go to &quot;Function Types&quot;">function type</a>, consisting of the types of the 
parameters as well as the return type. The return type is never specified explicitly but is always inferred from the expression. 
The parameter types can be inferred if the closure is used in a context where this is possible.
</p>
<p>
For instance, given the following Java method signature:
<span class="inlinecode"><span class="keyword">public</span>&nbsp;T&nbsp;&lt;T&gt;getFirst(List&lt;T&gt;&nbsp;list,&nbsp;Function0&lt;T,Boolean&gt;&nbsp;predicate)</span> 
</p>
<p>
the type of the parameter can be inferred. Which allows users to write:
<span class="inlinecode">arrayList(&nbsp;<span class="string">"Foo"</span>,&nbsp;<span class="string">"Bar"</span>&nbsp;).findFirst(&nbsp;e&nbsp;|&nbsp;e&nbsp;==&nbsp;<span class="string">"Bar"</span>&nbsp;)</span>
instead of 
<span class="inlinecode">arrayList(&nbsp;<span class="string">"Foo"</span>,&nbsp;<span class="string">"Bar"</span>&nbsp;).findFirst(&nbsp;String&nbsp;e&nbsp;|&nbsp;e&nbsp;==&nbsp;<span class="string">"Bar"</span>&nbsp;)</span>
</p>
<a name="2" ></a>
<h2>Function Mapping</h2>
<p>
An Xbase closure is a Java object of one of the <em>Function</em> interfaces shipped with the runtime library of Xbase. There is an interface 
for each number of parameters (current maximum is six parameters). The names of the interfaces are 
<ul>
  <li><em>Function0<ReturnType></em> for zero parameters, </li>
  <li><em>Function1<Param1Type, ReturnType></em> for one parameters, </li>
  <li><em>Function2<Param1Type, Param2Type, ReturnType></em> for two parameters, </li>
  <li>... </li>
  <li><em>Function6<Param1Type, Param2Type, Param3Type, Param4Type, Param5Type, Param6Type, ReturnType></em> for six parameters, </li>
</ul>
</p>
<p>
In order to allow seamless integration with existing Java libraries such as the JDK or Google Guava (formerly known as Google Collect) closures
are auto coerced to expected types if those types declare only one method (methods from java.lang.Object
don't count).
</p>
<p>
As a result given the method <span class="inlinecode">java.util.Collections.sort(List&lt;T&gt;,&nbsp;Comparator&lt;?&nbsp;super&nbsp;T&gt;)</span> is available
as an extension method, it can be invoked like this
</p>
<p>
<div class="literallayout">
<div class="incode">
<p class="code">
newArrayList(&nbsp;<span class="string">&apos;aaa&apos;</span>,&nbsp;<span class="string">&apos;bb&apos;</span>,&nbsp;<span class="string">&apos;c&apos;</span>&nbsp;).sort(</br>
&nbsp;&nbsp;&nbsp;&nbsp;e1,&nbsp;e2&nbsp;|&nbsp;<span class="keyword">if</span>&nbsp;(&nbsp;e1.length&nbsp;&gt;&nbsp;e2.length&nbsp;)&nbsp;{</br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-1&nbsp;</br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<span class="keyword">else</span>&nbsp;<span class="keyword">if</span>&nbsp;(&nbsp;e1.length&nbsp;&lt;&nbsp;e2.length&nbsp;)&nbsp;{&nbsp;</br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1</br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<span class="keyword">else</span>&nbsp;{&nbsp;</br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0</br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;})
</p>
</div>
</div>
</p>
<a name="3" ></a>
<h2>Examples</h2>
<p>
<ul>
  <li><span class="inlinecode">[&nbsp;|&nbsp;<span class="string">"foo"</span>&nbsp;]&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;closure&nbsp;without&nbsp;parameters</span></span></li>
  <li><span class="inlinecode">[&nbsp;String&nbsp;s&nbsp;|&nbsp;s.toUpperCase()&nbsp;]&nbsp;<span class="comment">//&nbsp;explicit&nbsp;argument&nbsp;type</span></span></li>
  <li><span class="inlinecode">[&nbsp;a,b,a&nbsp;|&nbsp;a+b+c&nbsp;]&nbsp;<span class="comment">//&nbsp;inferred&nbsp;argument&nbsp;types</span></span></li>
</ul>
</p>
		<div class="buttonbar">
		<span class="prev_button">
		<a href="04-Expressions-4.html" >Previous</a>
		</span>
		<a href="04-Expressions.html" >Top</a><span class="next_button">
		<a href="04-Expressions-6.html" >Next</a>
		</span>
		</div>
		<div style="clear:both;"></div>
	</div>
	<br style="clear:both;height:1em;">
</div>
<div id="clearFooter"></div>
<div id="footer">
<ul id="footernav">
	<li><a href="/">Home</a></li>

	<li><a href="/legal/privacy.php">Privacy Policy</a></li>
	<li><a href="/legal/termsofuse.php">Terms of Use</a></li>
	<li><a href="/legal/copyright.php">Copyright Agent</a></li>
	<li><a href="/legal/">Legal</a></li>
	<li><a href="/org/foundation/contact.php">Contact Us</a></li>
</ul>

<span id="copyright">Copyright &copy; 2011 The Eclipse Foundation. All Rights Reserved.</span>
</div>
</body>
</html>
