<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Value Converter</title>
<link href="book.css" rel="stylesheet" type="text/css">
<meta content="DocBook XSL Stylesheets V1.75.1" name="generator">
<link rel="home" href="index.html" title="Xtext User Guide">
<link rel="up" href="RuntimeConcepts.html" title="Runtime Concepts">
<link rel="prev" href="scoping.html" title="Scoping">
<link rel="next" href="serialization.html" title="Serialization">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<h1 xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0">Value Converter</h1>
<div class="section" title="Value Converter">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="valueconverter"></a>Value Converter</h2>
</div>
</div>
</div>
<p>Value converters are registered to convert parsed text into a certain data type instance and back.
				The primary hook is called org.eclipse.xtext.conversion.IValueConverterService and the concrete implementation can be registered via the runtime Guice module (TODO reference to framework description).</p>
<div class="section" title="Annotation based value converters">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="Annotationbasedvalueconverters"></a>Annotation based value converters</h3>
</div>
</div>
</div>
<p>The most simple way to register additional value converters is to make use of 
					<code class="code">org.eclipse.xtext.conversion.impl.AbstractAnnotationBasedValueConverterService</code>, which allows to
					declaratively register 
					<code class="code">IValueConverter</code> via annotated methods. 
				</p>
<p>The implementation for the default token grammar looks like </p>
<div class="literallayout">
<p>
<code class="code">public&nbsp;class&nbsp;DefaultTerminalConverters&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;extends&nbsp;AbstractAnnotationBasedValueConverterService&nbsp;{<br>
&nbsp;&nbsp;<br>
&nbsp;&nbsp;private&nbsp;Grammar&nbsp;grammar;<br>
&nbsp;&nbsp;	<br>
&nbsp;&nbsp;@Inject<br>
&nbsp;&nbsp;public&nbsp;void&nbsp;setGrammar(IGrammarAccess&nbsp;grammarAccess)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;this.grammar&nbsp;=&nbsp;grammarAccess.getGrammar();<br>
&nbsp;&nbsp;}<br>
&nbsp;&nbsp;	<br>
&nbsp;&nbsp;protected&nbsp;Grammar&nbsp;getGrammar()&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;grammar;<br>
&nbsp;&nbsp;}<br>

<br>
&nbsp;&nbsp;@ValueConverter(rule&nbsp;=&nbsp;"ID")<br>
&nbsp;&nbsp;public&nbsp;IValueConverter&lt;String&gt;&nbsp;ID()&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;new&nbsp;AbstractNullSafeConverter&lt;String&gt;()&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;protected&nbsp;String&nbsp;internalToValue(String&nbsp;string,&nbsp;AbstractNode&nbsp;node)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;string.startsWith("^")&nbsp;?&nbsp;string.substring(1)&nbsp;:&nbsp;string;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;protected&nbsp;String&nbsp;internalToString(String&nbsp;value)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(GrammarUtil.getAllKeywords(getGrammar()).contains(value))&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;"^"+value;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;value;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;};<br>
&nbsp;&nbsp;}<br>
&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...&nbsp;&nbsp;some&nbsp;other&nbsp;value&nbsp;converter<br>

<br>

</code>
</p>
</div>
<p>If you use the common terminals grammar (
					<code class="code">org.eclipse.xtext.common.Terminals</code>) you should subclass 
					<code class="code">DefaultTerminalConverters</code> and overwrite or add addition value converter by adding the respective methods.
				</p>
<p>Imagine, you would want to add a rule creating BigDecimals:</p>
<div class="literallayout">
<p>
<code class="code">@ValueConverter(rule&nbsp;=&nbsp;"BIG_DECIMAL")<br>
&nbsp;&nbsp;public&nbsp;IValueConverter&lt;String&gt;&nbsp;BIG_DECIMAL()&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;new&nbsp;AbstractToStringConverter&lt;BigDecimal&gt;()&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;protected&nbsp;BigDecimal&nbsp;internalToValue(String&nbsp;string,&nbsp;AbstractNode&nbsp;node)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;BigDecimal.valueOf(string);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;};<br>
&nbsp;&nbsp;}<br>

<br>

<br>

</code>
</p>
</div>
</div>
</div>
</body>
</html>
