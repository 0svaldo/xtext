<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<title>Value Converter</title>
<link href="book.css" rel="stylesheet" type="text/css">
<meta content="DocBook XSL Stylesheets V1.75.1" name="generator">
<link rel="home" href="index.html" title="Xtext User Guide">
<link rel="up" href="RuntimeConcepts.html" title="Runtime Concepts">
<link rel="prev" href="scoping.html" title="Scoping">
<link rel="next" href="serialization.html" title="Serialization">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<h1 xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0">Value Converter</h1>
<p>Value converters are registered to convert the parsed text into a certain data type instance and vice versa.
				The primary hook is called 
				<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/conversion/IValueConverterService.java?root=Modeling_Project&view=co" target="_new">IValueConverterService</a> and the concrete implementation can be registered via the runtime 
				<a class="link" href="">Guice module</a>.
				To do so override the corresponding binding in your runtime module like shown in this example:
			</p>
<div class="literallayout">
<p>
<code class="code">@Override<br>
public&nbsp;Class&lt;?&nbsp;extends&nbsp;IValueConverterService&gt;&nbsp;bindIValueConverterService()&nbsp;{<br>
&nbsp;&nbsp;return&nbsp;MySpecialValueConverterService.class;<br>
}<br>

<br>

</code>
</p>
</div>
<div class="section" title="Annotation based value converters">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="Annotationbasedvalueconverters"></a>Annotation based value converters</h3>
</div>
</div>
</div>
<p>The most simple way to register additional value converters is to make use of 
					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/conversion/impl/AbstractDeclarativeValueConverterService.java?root=Modeling_Project&view=co" target="_new">AbstractDeclarativeValueConverterService</a>, which allows to
					declaratively register an 
					<code class="code">IValueConverter</code> via an annotated method. 
				</p>
<p>The implementation for the default token grammar looks like </p>
<div class="literallayout">
<p>
<code class="code">public&nbsp;class&nbsp;DefaultTerminalConverters&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;extends&nbsp;AbstractDeclarativeValueConverterService&nbsp;{<br>
&nbsp;&nbsp;<br>
&nbsp;&nbsp;(..)<br>
&nbsp;&nbsp;<br>
&nbsp;&nbsp;@ValueConverter(rule&nbsp;=&nbsp;"ID")<br>
&nbsp;&nbsp;public&nbsp;IValueConverter&lt;String&gt;&nbsp;ID()&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;new&nbsp;AbstractNullSafeConverter&lt;String&gt;()&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;protected&nbsp;String&nbsp;internalToValue(String&nbsp;string,&nbsp;AbstractNode&nbsp;node)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;string.startsWith("^")&nbsp;?&nbsp;string.substring(1)&nbsp;:&nbsp;string;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;protected&nbsp;String&nbsp;internalToString(String&nbsp;value)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(GrammarUtil.getAllKeywords(getGrammar()).contains(value))&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;"^"&nbsp;+&nbsp;value;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;value;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;};<br>
&nbsp;&nbsp;}<br>
&nbsp;&nbsp;...&nbsp;&nbsp;some&nbsp;other&nbsp;value&nbsp;converter<br>
}<br>

<br>

</code>
</p>
</div>
<p>If you use the common terminals grammar 
					<code class="code">org.eclipse.xtext.common.Terminals</code> you should subclass 
					<code class="code">DefaultTerminalConverters</code> and override or add additional value converters by adding the respective methods.
				</p>
<p>Imagine, you would want to add a rule BIG_DECIMAL creating BigDecimals, it would look like this one:</p>
<div class="literallayout">
<p>
<code class="code">@ValueConverter(rule&nbsp;=&nbsp;"BIG_DECIMAL")<br>
public&nbsp;IValueConverter&lt;BigDecimal&gt;&nbsp;BIG_DECIMAL()&nbsp;{<br>
&nbsp;&nbsp;return&nbsp;new&nbsp;AbstractToStringConverter&lt;BigDecimal&gt;()&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
&nbsp;&nbsp;&nbsp;&nbsp;protected&nbsp;BigDecimal&nbsp;internalToValue(String&nbsp;string,&nbsp;AbstractNode&nbsp;node)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;BigDecimal.valueOf(string);<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;};<br>
}<br>

<br>

</code>
</p>
</div>
</div>
</body>
</html>
