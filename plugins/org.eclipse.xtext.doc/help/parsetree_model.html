<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<title>Parse tree model</title>
<link href="book.css" rel="stylesheet" type="text/css">
<meta content="DocBook XSL Stylesheets V1.75.1" name="generator">
<link rel="home" href="index.html" title="Xtext User Guide">
<link rel="up" href="concepts.html" title="Xtext and EMF">
<link rel="prev" href="grammar_model.html" title="Grammar model">
<link rel="next" href="grammarLanguage.html" title="The Grammar Language">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<h1 xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0">Parse tree model</h1>
<p>In addition to the AST, the Xtext parser creates another model, the 
				<span class="emphasis"><em>Parse Tree Model</em></span>. This model represents the trace of the parsing process and keeps syntactic information, such as 
				<code class="code">offset</code> and 
				<code class="code">length</code> of the text range describing an element. The parser is the only component modifying the parse tree model. All parse tree models conform to the same meta model, that is shown in the following diagram:    
			</p>
<p>
				
</p>
<div class="mediaobject">
<img src="images/node-model.png"></div>
<p>
			
</p>
<p>There are two concrete types of nodes: 
				<span class="emphasis"><em>CompositeNodes</em></span> act as containers for other nodes, while 
				<span class="emphasis"><em>LeafNodes</em></span> cannot have children, but describe to terminals via the 
				<code class="code">text</code> attribute. A LeafNode is 
				<code class="code">hidden</code> if its terminal is 
				<a class="link" href="">defined as hidden</a> in the grammar, which usually means it is a whitespace or a comment. With exception to the last node, the parser will put hidden terminals as children in the composite node belonging to the following region. 
			</p>
<p>Both concrete node classes inherit from the abstract class 
				<span class="emphasis"><em>AbstractNode</em></span>. Each node knows the text location (
				<code class="code">totalOffset</code>, 
				<code class="code">totalLength</code> , and 
				<code class="code">totalLine</code>) it represents. For CompositeNodes, that includes their children&rsquo;s ranges. As opposed to the total location, the derived operations 
				<code class="code">getOffset()</code>, 
				<code class="code">getLength()</code>, and 
				<code class="code">getLine()</code> describe the location without surrounding hidden terminals. 
				<code class="code">endLine()</code> calculates the last line of the location. 
			</p>
<p>The method 
				<code class="code">serialize()</code> will concatenate all texts of contained leaf nodes as a string, thus yielding the text segment of the node when it was parsed. Note that it will not call the 
				<a class="link" href="serialization.html" title="Serialization">serializer</a>. 
			</p>
<p>Finally, the parser stores 
				<span class="emphasis"><em>SyntaxErrors</em></span> in the parse tree model, which allows error recovery and partially parsed models.  
			</p>
<div class="section" title="Connection of AST, parse tree and grammar">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="node_semantic_grammar"></a>Connection of AST, parse tree and grammar </h3>
</div>
</div>
</div>
<p>A parse tree node directly refers to the AST node it belongs to via the 
					<code class="code">element</code> reference. As stated above, the AST nodes don&rsquo;t offer any syntactical information themselves. Instead, the parser attaches 
					<code class="code">org.eclipse.parsetree.NodeAdapter</code> as EMF adapter to each semantic element it creates. That adapter has a reference to the corresponding parse tree node. The ${org.eclipse.xtext/src/org/eclipse/xtext/parsetree/NodeUtil.java} offers a collection of utility methods to manage node adapters. 
				</p>
<p>By means of the 
					<code class="code">grammarElement</code> reference, a node points to the element of the 
					<a class="link" href="grammar_model.html" title="Grammar model">grammar model</a> that caused the parser to consume its content.
				</p>
<p>Neither the parse tree model nor the grammar model appear in the 
					<code class="code">contents</code> of the resource. As an alternative to the node adapter, you reach the node model by calling 
					<code class="code">XtextResource.getParseResult().getRootNode()</code>.
				</p>
</div>
</body>
</html>
