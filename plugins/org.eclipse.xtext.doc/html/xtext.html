<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<title>Xtext User Guide</title>
<link href="book.css" rel="stylesheet" type="text/css">
<meta content="DocBook XSL Stylesheets V1.75.1" name="generator">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<div class="book" title="Xtext User Guide">
<div class="titlepage">
<div>
<div>
<h1 class="title">
<a name="N10001"></a>Xtext User Guide</h1>
</div>
</div>
<hr>
</div>
<div class="toc">
<p>
<b>Table of Contents</b>
</p>
<dl>
<dt>
<span class="chapter"><a href="#Overview">1. Overview</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="section"><a href="#WhatisXtext">What is Xtext?</a></span>
</dt>
<dt>
<span class="section"><a href="#DSL">What is a domain-specific language</a></span>
</dt>
</dl>
</dd>
<dt>
<span class="chapter"><a href="#getting-started">2. Getting Started</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="section"><a href="#getting-started-xtext">Creating a DSL  </a></span>
</dt>
<dt>
<span class="section"><a href="#getting-started-xpand">Writing a code generator</a></span>
</dt>
<dt>
<span class="section"><a href="#Wherenext">Where next?</a></span>
</dt>
</dl>
</dd>
<dt>
<span class="chapter"><a href="#concepts">3. Xtext and EMF</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="section"><a href="#model_metamodel">Model, AST, Meta Model, and Ecore </a></span>
</dt>
<dt>
<span class="section"><a href="#emf_codegen">EMF code generation</a></span>
</dt>
<dt>
<span class="section"><a href="#emf_resource">EMF Resources</a></span>
</dt>
<dt>
<span class="section"><a href="#grammar_model">Grammar model</a></span>
</dt>
<dt>
<span class="section"><a href="#parsetree_model">Parse tree model</a></span>
</dt>
</dl>
</dd>
<dt>
<span class="chapter"><a href="#grammarLanguage">4. The Grammar Language</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="section"><a href="#Afirstexample">A first example</a></span>
</dt>
<dt>
<span class="section"><a href="#syntax">The Syntax</a></span>
</dt>
<dt>
<span class="section"><a href="#metamodelInference">Ecore model inference</a></span>
</dt>
<dt>
<span class="section"><a href="#grammarImport">Importing existing Ecore models</a></span>
</dt>
<dt>
<span class="section"><a href="#grammarMixins">Grammar Mixins</a></span>
</dt>
<dt>
<span class="section"><a href="#Defaulttokens">Default tokens</a></span>
</dt>
</dl>
</dd>
<dt>
<span class="chapter"><a href="#configuration">5. Configuration</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="section"><a href="#generator">The Generator</a></span>
</dt>
<dt>
<span class="section"><a href="#dependencyInjection">Dependency Injection in Xtext with Google Guice</a></span>
</dt>
</dl>
</dd>
<dt>
<span class="chapter"><a href="#RuntimeConcepts">6. Runtime Concepts</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="section"><a href="#RuntimesetupISetup">Runtime setup (ISetup)</a></span>
</dt>
<dt>
<span class="section"><a href="#SetupwithinEclipseEquinoxOSGi">Setup within Eclipse-Equinox (OSGi)</a></span>
</dt>
<dt>
<span class="section"><a href="#Logging">Logging</a></span>
</dt>
<dt>
<span class="section"><a href="#validation">Validation</a></span>
</dt>
<dt>
<span class="section"><a href="#linking">Linking</a></span>
</dt>
<dt>
<span class="section"><a href="#scoping">Scoping</a></span>
</dt>
<dt>
<span class="section"><a href="#valueconverter">Value Converter</a></span>
</dt>
<dt>
<span class="section"><a href="#serialization">Serialization</a></span>
</dt>
<dt>
<span class="section"><a href="#emf_integration">Integration with EMF</a></span>
</dt>
<dt>
<span class="section"><a href="#encoding">Encoding in Xtext</a></span>
</dt>
</dl>
</dd>
<dt>
<span class="chapter"><a href="#MWE2">7. MWE2</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="section"><a href="#MWE2Exampe">Examples</a></span>
</dt>
<dt>
<span class="section"><a href="#MWE2LanguageReference">Language Reference</a></span>
</dt>
<dt>
<span class="section"><a href="#MWE2SyntaxReference">Syntax Reference</a></span>
</dt>
<dt>
<span class="section"><a href="#MWE2RuntimeAPI">Workflow API</a></span>
</dt>
<dt>
<span class="section"><a href="#MWE2RuntimeSPI">Workflow SPI</a></span>
</dt>
</dl>
</dd>
<dt>
<span class="chapter"><a href="#IDEconcepts">8. IDE concepts</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="section"><a href="#labelProvider">Label Provider</a></span>
</dt>
<dt>
<span class="section"><a href="#contentAssist">Content Assist</a></span>
</dt>
<dt>
<span class="section"><a href="#templates">Template Proposals</a></span>
</dt>
<dt>
<span class="section"><a href="#outline">Outline View</a></span>
</dt>
<dt>
<span class="section"><a href="#hyperlinking">Hyperlinking</a></span>
</dt>
<dt>
<span class="section"><a href="#formatting">Formatting (Pretty Printing)</a></span>
</dt>
<dt>
<span class="section"><a href="#highlighting">Syntax Coloring</a></span>
</dt>
<dt>
<span class="section"><a href="#projectwizard">Project Wizard</a></span>
</dt>
</dl>
</dd>
<dt>
<span class="chapter"><a href="#from_oaw_to_tmf">9. From oAW to TMF</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="section"><a href="#why_rewrite">Why a rewrite?</a></span>
</dt>
<dt>
<span class="section"><a href="#migration_overview">Migration overview</a></span>
</dt>
<dt>
<span class="section"><a href="#Xtend_based_apis">Where are the Xtend-based APIs?</a></span>
</dt>
<dt>
<span class="section"><a href="#differences">Differences</a></span>
</dt>
<dt>
<span class="section"><a href="#NewFeatures">New Features</a></span>
</dt>
<dt>
<span class="section"><a href="#MigrationSupport">Migration Support</a></span>
</dt>
</dl>
</dd>
<dt>
<span class="chapter"><a href="#migrating_from_0_7">10. Migrating from TMF Xtext 0.7.x</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="section"><a href="#TaketheShortcut">Take the Shortcut</a></span>
</dt>
<dt>
<span class="section"><a href="#MigratingStepByStep">Migrating Step By Step</a></span>
</dt>
<dt>
<span class="section"><a href="#Nowgoforthenewfeatures">Now go for the new features</a></span>
</dt>
</dl>
</dd>
<dt>
<span class="chapter"><a href="#antlr_ip_issue">11. The ANTLR IP issue (or which parser to use?)</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="section"><a href="#WhatifIdonotwanttousenonIPapprovedcode">What if I do not want to use non IP-approved code</a></span>
</dt>
</dl>
</dd>
</dl>
</div>
<div class="chapter" title="Chapter&nbsp;1.&nbsp;Overview">
<div class="titlepage">
<div>
<div>
<h2 class="title">
<a name="Overview"></a>Chapter&nbsp;1.&nbsp;Overview</h2>
</div>
</div>
</div>
<div class="section" title="What is Xtext?">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="WhatisXtext"></a>What is Xtext?</h2>
</div>
</div>
</div>
<p>Xtext is a framework for the development of 
				<a class="link" href="#DSL" title="What is a domain-specific language">domain-specific languages</a> and other textual programming languages. It is tightly integrated with the 
				<a class="ulink" href="http://www.eclipse.org/emf" target="_new">Eclipse Modeling Framework (EMF)</a> and leverages the Eclipse Platform in order to provide a language-specific integrated development environment (IDE). 
			</p>
<p>In contrast to common parser generators (like e.g. JavaCC or ANTLR), Xtext derives much more than just a parser and lexical analyzer (lexer) from an input grammar. 
				The grammar language is used to describe and generate:</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>an incremental, ANTLR 3 based parser and lexer to read your models from text,</p>
</li>
<li class="listitem">
<p>Ecore models (optional),</p>
</li>
<li class="listitem">
<p>a serializer to write your models back to text,</p>
</li>
<li class="listitem">
<p>a linker, to establish cross links between model elements,</p>
</li>
<li class="listitem">
<p>an implementation of the EMF Resource interface with full support for loading and saving EMF models, and</p>
</li>
<li class="listitem">
<p>an integration of the language into your Eclipse IDE.</p>
</li>
</ul>
</div>
<p>Some of the IDE features, that are either derived from the grammar or easily implementable, are</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>
						
<a class="link" href="#highlighting" title="Syntax Coloring">syntax coloring</a>,
					</p>
</li>
<li class="listitem">
<p>
						
<a class="link" href="#hyperlinking" title="Hyperlinking">model navigation (F3, etc.)</a>,
					</p>
</li>
<li class="listitem">
<p>
						
<a class="link" href="#contentAssist" title="Content Assist">code completion</a>,
					</p>
</li>
<li class="listitem">
<p>
						
<a class="link" href="#quickfixes" title="Quickfixes">quick fixes</a>
					
</p>
</li>
<li class="listitem">
<p>
						
<a class="link" href="#formatting" title="Formatting (Pretty Printing)">code formatting</a>
					
</p>
</li>
<li class="listitem">
<p>
						
<a class="link" href="#outline" title="Outline View">outline view</a>, and
					</p>
</li>
<li class="listitem">
<p>
						
<a class="link" href="#templates" title="Template Proposals">code templates</a>.
					</p>
</li>
</ul>
</div>
<p>The generated artifacts are wired up through 
				<a class="ulink" href="http://code.google.com/p/google-guice/" target="_new">Google Guice</a>, a dependency injection framework which makes it easy to exchange certain functionality in a non-invasive manner.
			</p>
<p>Although Xtext aims at supporting fast iterative development of domain-specific languages, it can be used to implement IDEs for general purpose programming languages as well.</p>
</div>
<div class="section" title="What is a domain-specific language">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="DSL"></a>What is a domain-specific language</h2>
</div>
</div>
</div>
<p>A domain-specific language (DSL) is a small programming language, which focuses on a particular domain.
				Such a domain can be more or less anything. The idea is that its concepts and notation is as close as possible to
				what you have in mind when you think about a solution in that domain. Of course we are talking about problems which can
				be solved or processed by computers somehow.</p>
<p>The opposite of a DSL is a so called GPL, a General Purpose Language such as Java or any other common programming language.
				With a GPL you can solve every computer problem, but it might not always be the best way to solve it.</p>
<p>Imagine you want to remove the core from an apple. You could of course use a Swiss army knife to cut it out, and this is reasonable if you have to do it just once or twice. But if you need to do that on a regular basis it might be more efficient to use an apple corer.</p>
<p>There are a couple of well-known examples of DSLs. For instance SQL is actually a DSL which focuses on querying relational databases. Other DSLs are regular expressions or even languages provided by tools like MathLab. Also most XML languages are actually domain-specific languages. The whole purpose of XML is to allow for easy creation of new languages. Unfortunately, XML uses a fixed concrete syntax, which is very verbose and yet not adapted to be read by humans. Into the bargain, a generic syntax for everything is a compromise.</p>
<p>Xtext is a sophisticated framework that helps to implement your very own DSL with appropriate IDE support. There is no such limitation as with XML, you are free to define your concrete syntax as you like. It may be as concise and suggestive as possible being a best match for your particular domain. The hard task of reading your model, working with it and writing it back to your syntax is greatly simplified by Xtext.</p>
</div>
</div>
<div class="chapter" title="Chapter&nbsp;2.&nbsp;Getting Started">
<div class="titlepage">
<div>
<div>
<h2 class="title">
<a name="getting-started"></a>Chapter&nbsp;2.&nbsp;Getting Started</h2>
</div>
</div>
</div>
<p>In this mini-tutorial you will implement your first language with Xtext and create an editor from that. Later, we will create a code generator that is capable of reading the models you create with the DSL editor and process them.</p>
<div class="section" title="Creating a DSL">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="getting-started-xtext"></a>Creating a DSL  </h2>
</div>
</div>
</div>
<p>
				
<a class="ulink" href="http://www.eclipse.org/Xtext/download/" target="_new">Download and install the latest version of Xtext</a>, set up a fresh workspace, take a deep breath and follow the instructions.  As soon as you have finished this chapter you will have an editor that understands input files of the following format. We will refer to this snippet as an example of our &bdquo;target syntax&rdquo; later on:
			</p>
<div class="literallayout">
<p>
<code class="code">type&nbsp;String<br>
type&nbsp;Bool<br>

<br>
entity&nbsp;Session&nbsp;{<br>
&nbsp;&nbsp;property&nbsp;Title:&nbsp;String<br>
&nbsp;&nbsp;property&nbsp;IsTutorial&nbsp;:&nbsp;Bool<br>
}<br>

<br>
entity&nbsp;Conference&nbsp;{<br>
&nbsp;&nbsp;property&nbsp;Name&nbsp;:&nbsp;String<br>
&nbsp;&nbsp;property&nbsp;Attendees&nbsp;:&nbsp;Person[]<br>
&nbsp;&nbsp;property&nbsp;Speakers&nbsp;:&nbsp;Speaker[]<br>
}<br>

<br>
entity&nbsp;Person&nbsp;{<br>
&nbsp;&nbsp;property&nbsp;Name&nbsp;:&nbsp;String<br>
}<br>

<br>
entity&nbsp;Speaker&nbsp;extends&nbsp;Person&nbsp;{<br>
&nbsp;&nbsp;property&nbsp;Sessions&nbsp;:&nbsp;Session[]<br>
}<br>

<br>

</code>
</p>
</div>
<div class="section" title="Create an Xtext project">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="CreateanXtextproject"></a>Create an Xtext project</h3>
</div>
</div>
</div>
<p>Use the Xtext wizard to create a new project</p>
<p>	
					
<span class="emphasis"><em>File -&gt; New -&gt; Project...  -&gt; Xtext -&gt; Xtext project</em></span>
				
</p>
<p>Choose a meaningful project name, language name and file extension, e.g.</p>
<table id="N10098">
<tr>
						
<td>
							<span class="bold"><strong>Main project name:</strong></span> 	
						</td>
						<td>org.xtext.example.start	</td>
					
</tr>
<tr>
						
<td>
							<span class="bold"><strong>Language name:</strong></span> 		
						</td>
						<td>org.xtext.example.start.Entities	</td>
					
</tr>
<tr>
						
<td>
							<span class="bold"><strong>DSL-File extension:</strong></span> 	
						</td>
						<td>entity	</td>
					
</tr>
</table>
<p>Keep &bdquo;Create generator project&rdquo; checked, as we will also create a code generator in a second step.</p>
<p>Click on 
					<span class="emphasis"><em>Finish</em></span> to create the projects. 
				</p>
<p>
					
</p>
<div class="mediaobject">
<img src="images/getting-started-wizard.png"></div>
<p>
				
</p>
</div>
<div class="section" title="Project layout">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="Projectlayout"></a>Project layout</h3>
</div>
</div>
</div>
<p>In the Package Explorer you can see three new projects. In 
					<code class="code">org.xtext.example.start</code> you can define the grammar and configure the runtime aspects of your language. The editor, outline view and code completion goes into 
					<code class="code">org.xtext.example.start.ui</code>. Both projects consist of generated classes derived from your grammar and manual code such as the grammar itself or further classes to differentiate from the default behavior.
				</p>
<p>
					
</p>
<div class="mediaobject">
<img src="images/getting-started-project-layout.png"></div>
<p>
				
</p>
<p>It is good to be clear and unambiguous whether the code is generated or is to be manipulated by the developer. Thus, the generated code should be held separately from the manually written code. We follow this pattern by having a folder 
					<span class="emphasis"><em>src/</em></span> and a folder 
					<span class="emphasis"><em>src-gen/</em></span> in each project. Keep in mind not to make changes in the 
					<span class="emphasis"><em>src-gen/</em></span> folder. They will be overwritten by the generator.
				</p>
<p>A third project, 
					<code class="code">org.xtext.example.start.generator</code> will later contain a code generator that leverages the model created with the DSL editor.
				</p>
</div>
<div class="section" title="Build your own grammar">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="Buildyourowngrammar"></a>Build your own grammar</h3>
</div>
</div>
</div>
<p>The wizard will automatically open the example grammar file 
					<code class="code">Entities.xtext</code> from the first project in the editor. A grammar has two purposes: First, it is used to describe the concrete syntax of your language. Second, it contains information about how the parser shall create a model during parsing.
				</p>
<p>Ignore the generated sample grammar, delete everything after "
					<code class="code">Model :</code>" to the end. 
					The entry rule for the parser will be called 
					<code class="code">Model</code>. As a 
					<code class="code">Model</code> consists of one or more 
					<code class="code">Entity</code> entries, this rule delegates to another rule named 
					<code class="code">Entity</code>, which will be defined later on.
					As we can have one ore more entities within a model, the cardinality is &bdquo;+&rdquo;. Each rule is terminated with a semicolon. So our first rule reads as
				</p>
<div class="literallayout">
<p>
<code class="code">Model&nbsp;:<br>
&nbsp;&nbsp;Entity+;&nbsp;<br>

<br>

</code>
</p>
</div>
<p>
					
<span class="italic">
						<span class="bold"><strong>Please note</strong></span>: If you encounter strange errors while copying and pasting these snippets to your Eclipse editor your documentation viewer most likely has inserted characters different from {space} into your clipboard. Reenter these &bdquo;fillers&rdquo; or type the text by hand to be sure everything works fine.
					</span> 
				
</p>
<p>An Xtext grammar does not only describe rules for the parser but also the structure of the resulting abstract syntax tree. Usually, each parser rule will create a new node in that tree. The type of that node can be specified after the rule name using the keyword 
					<code class="code">returns</code>. If the type&rsquo;s name is the same as the rule name, it can be omitted as in our case.
				</p>
<p>The parser will create a new element of type 
					<code class="code">Model</code> when it enters the rule 
					<code class="code">Model</code>, and a new element of type 
					<code class="code">Entity</code> every time it enters the rule 
					<code class="code">Entity</code>. To connect these AST elements, we have to define the name of a reference. In our case, we call that reference 
					<span class="emphasis"><em>entities</em></span>. We specify it using the assignment operator "
					<code class="code">+=</code>", which denotes a multi valued feature. 
				</p>
<p>As a result, we modify the first rule to</p>
<div class="literallayout">
<p>
<code class="code">Model&nbsp;:<br>
&nbsp;&nbsp;(elements&nbsp;+=&nbsp;Entity)+;<br>
	
<br>

</code>
</p>
</div>
<p>The next rule on our list is the rule 
					<code class="code">Entity</code>. Looking at our target syntax, each entity begins with the keyword 
					<code class="code">entity</code> followed by the entity&rsquo;s name and an opening curly brace (we will handle the 
					<code class="code">extends</code> clause in a second step). Then, an entity defines a number of properties and ends with a closing curly brace. 
				</p>
<div class="literallayout">
<p>
<code class="code">Entity&nbsp;returns&nbsp;Entity:<br>
&nbsp;&nbsp;'entity'&nbsp;name=ID&nbsp;'{'<br>
&nbsp;&nbsp;&nbsp;&nbsp;(properties+=Property)*<br>
&nbsp;&nbsp;'}'<br>
;<br>
	
<br>

</code>
</p>
</div>
<p>Instead of creating a new AST node for the name, we rather want the name to be an attribute of the 
					<code class="code">Entity</code> class. Therefore we use the terminal rule 
					<code class="code">ID</code>, which results in a string. The assignment operator "
					<code class="code">=</code>" denotes a single valued feature, and the asterisk a cardinality of 0..n.
					In our target syntax, some entities refer to an existing entity as their super type after the keyword 
					<code class="code">extends</code>. Note that this is a cross-reference, as the super type itself must be defined somewhere else. To define a cross-reference we use square brackets. Optional parts have the cardinality &bdquo;?&rdquo;. The complete rule now reads:
				</p>
<div class="literallayout">
<p>
<code class="code">Entity&nbsp;returns&nbsp;Entity:<br>
&nbsp;&nbsp;'entity'&nbsp;name=ID&nbsp;('extends'&nbsp;extends=[Entity])?&nbsp;'{'<br>
&nbsp;&nbsp;&nbsp;&nbsp;(properties+=Property)*<br>
&nbsp;&nbsp;'}'<br>
;<br>
	
<br>

</code>
</p>
</div>
<p>We have not specified the rule 
					<code class="code">Property</code>, yet. In our target syntax, properties can refer to simple types such as &bdquo;String&rdquo; or &bdquo;Bool&rdquo; as well as entities. To make this easy we will first introduce a common supertype 
					<code class="code">Type</code> each 
					<code class="code">Property</code> can refer to.
				</p>
<p>Change  the rule 
					<code class="code">Model</code> and introduce a new rule 
					<code class="code">Type</code> and 
					<code class="code">SimpleType</code>:
				</p>
<div class="literallayout">
<p>
<code class="code">Model&nbsp;:<br>
&nbsp;&nbsp;(elements+=Type)*;<br>

<br>
Type:<br>
&nbsp;&nbsp;SimpleType&nbsp;|&nbsp;Entity;<br>
	
<br>
SimpleType:<br>
&nbsp;&nbsp;'type'&nbsp;name=ID;<br>
&nbsp;<br>

</code>
</p>
</div>
<p>Models new consist of types where a 
					<code class="code">Type</code> can either be a 
					<code class="code">SimpleType</code>  or the 
					<code class="code">Entity</code> you already know. Our rule 
					<code class="code">Type</code> will just delegate to either of them, using the "
					<code class="code">|</code>" alternatives operator. The combination of simple data types and entites this way introduces a common super type 
					<code class="code">Type</code> both 
					<code class="code">Entity</code> and 
					<code class="code">SimpleType</code> derive from. This allows you to refer to both types of elements with a single cross-reference.
				</p>
<p>A 
					<code class="code">Property</code> consists of a keyword, a name, a colon and a cross-reference to an arbitrary 
					<code class="code">Type</code>. The multiplicity is either many or one. The presence of the postfix &bdquo;[]&rdquo; (technically a keyword) should trigger a boolean flag in the AST model. This is the purpose of the assignment operator "
					<code class="code">?=</code>". Our last parser rule is:
				</p>
<div class="literallayout">
<p>
<code class="code">Property:<br>
&nbsp;&nbsp;'property'&nbsp;name=ID&nbsp;':'&nbsp;type=[Type]&nbsp;(many?='[]')?;<br>
	
<br>

</code>
</p>
</div>
<p>In the end your grammar editor should look like this:</p>
<p>
					
</p>
<div class="mediaobject">
<img src="images/getting-started-grammar.png"></div>
<p>
				
</p>
</div>
<div class="section" title="Generate language artifacts">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="Generatelanguageartifacts"></a>Generate language artifacts</h3>
</div>
</div>
</div>
<p>Save the grammar and make sure that no error markers appear. Then, locate the file GenerateEntities.mwe next to the grammar file in the package explorer view. From its context menu, choose</p>
<p>	
					
<span class="emphasis"><em>Run As -&gt; MWE Workflow</em></span>.
				</p>
<p>That will trigger the Xtext language generator. You will see its logging messages in the Console view.</p>
</div>
<div class="section" title="Run the generated editor">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="Runthegeneratededitor"></a>Run the generated editor</h3>
</div>
</div>
</div>
<p>If code generation succeeded, right-click on the Xtext project and choose</p>
<p>	
					
<span class="emphasis"><em>Run As -&gt; Eclipse Application</em></span>.
				</p>
<p>This will spawn a new Eclipse workbench with your projects as plug-ins installed. 
					In the new workbench, create a new project (
					<span class="emphasis"><em>File -&gt; New -&gt; Project...  -&gt; General -&gt; Project</em></span>) and therein a new file with the file extension you chose in the beginning. This will open the generated entity editor.
				</p>
<p>To get some hands-on experience with your new DSL editor, type in the following model:</p>
<p>
					
</p>
<div class="mediaobject">
<img src="images/getting-started-editor.png"></div>
<p>
				
</p>
</div>
</div>
<div class="section" title="Writing a code generator">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="getting-started-xpand"></a>Writing a code generator</h2>
</div>
</div>
</div>
<p>In this part of the tutorial, we will write a code generator that is capable of processing the models created with the DSL editor you developed  in the previous section.</p>
<div class="section" title="Creating the main template">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="Creatingthemaintemplate"></a>Creating the main template </h3>
</div>
</div>
</div>
<p>One of the major goals of model driven software development is to raise the level of abstraction. The concepts in your meta model usually map to several artifacts in your source code. In our sample, we will generate the following things for each entity:</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>a data access object (DAO), capable of loading and storing the entities</p>
</li>
<li class="listitem">
<p>a class holding all the attributes of the entity, annotated with JPA annotations</p>
</li>
</ul>
</div>
<p>To provide for a better overview and to easier manage our code templates, we will choose the following template structure:</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>Main.xpt &ndash; the main entry point, will dispatch to all other templates</p>
</li>
<li class="listitem">
<p>DAO.xpt &ndash; will generate the 
							<span class="emphasis"><em>DAO</em></span> class
						</p>
</li>
<li class="listitem">
<p>Entity.xpt &ndash; will generate the 
							<span class="emphasis"><em>Entity</em></span> class
						</p>
</li>
</ul>
</div>
<p>In the project navigator, right click on 
					<span class="emphasis"><em>org.xtext.example.start.generator/src/templates</em></span> and select 
					<span class="emphasis"><em>New -&gt; Other... -&gt; Xpand Template</em></span>. Name the new template 
					<code class="code">Main.xpt</code> and click on 
					<span class="emphasis"><em>Finish</em></span>.
				</p>
<p>First, we need to import the meta model, as we&rsquo;re going to be working with the concepts from the meta model:</p>
<div class="literallayout">
<p>
<code class="code">&laquo;IMPORT&nbsp;entities&raquo;<br>

</code>
</p>
</div>
<p>Next, we need to define a main template which will be invoked by the code generator. This template will then dispatch to two sub templates, 
					<code class="code">DAO::dao</code> and 
					<code class="code">Entity::entity</code>: 
				</p>
<div class="literallayout">
<p>
<code class="code">&laquo;DEFINE&nbsp;main&nbsp;FOR&nbsp;Model&raquo;<br>
&nbsp;&nbsp;&laquo;EXPAND&nbsp;DAO::dao&nbsp;FOREACH&nbsp;this.elements.typeSelect(Entity)&raquo;<br>
&nbsp;&nbsp;&laquo;EXPAND&nbsp;Entity::entity&nbsp;FOREACH&nbsp;this.elements.typeSelect(Entity)&raquo;<br>
&laquo;ENDDEFINE&raquo;<br>

<br>

</code>
</p>
</div>
<p>By using the expression 
					<code class="code">this.elements.typeSelect(Entity)</code>, we make sure we only iterate over 
					<code class="code">Entity</code> elements, and skip 
					<code class="code">SimpleType</code> elements.
				</p>
<p>Your template 
					<code class="code">Main.xpt</code> should now look like this: 
				</p>
<div class="literallayout">
<p>
<code class="code">&laquo;IMPORT&nbsp;entities&raquo;<br>
&laquo;DEFINE&nbsp;main&nbsp;FOR&nbsp;Model&raquo;<br>
&nbsp;&nbsp;&laquo;EXPAND&nbsp;DAO::dao&nbsp;FOREACH&nbsp;this.elements.typeSelect(Entity)&raquo;<br>
&nbsp;&nbsp;&laquo;EXPAND&nbsp;Entity::entity&nbsp;FOREACH&nbsp;this.elements.typeSelect(Entity)&raquo;<br>
&laquo;ENDDEFINE&raquo;<br>

<br>

<br>

</code>
</p>
</div>
</div>
<div class="section" title="Creating the template for the entity">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="Creatingthetemplatefortheentity"></a>Creating the template for the entity</h3>
</div>
</div>
</div>
<p>Every data-oriented application needs a bunch of classes to hold the data. Usually referred to as entities, these classes are POJOs in our case. So, let&rsquo;s now create a template which helps us to create POJOs from our model.</p>
<p>Please add another Xpand template to your project by selecting 
					<span class="emphasis"><em>File -&gt; New -&gt; Other ... -&gt; Xpand Template</em></span>. Name the new file 
					<code class="code">Entity.xpt</code>, making sure to save it to the same folder as 
					<code class="code">Main.xpt</code>.
				</p>
<p>Add the following code to 
					<code class="code">Entity.xpt</code>:
				</p>
<div class="literallayout">
<p>
<code class="code">&laquo;IMPORT&nbsp;entities&raquo;<br>

<br>
&laquo;DEFINE&nbsp;entity&nbsp;FOR&nbsp;Entity&raquo;<br>
&nbsp;&nbsp;&laquo;FILE&nbsp;this.name&nbsp;+&nbsp;".java"&raquo;<br>
&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;class&nbsp;&laquo;this.name&raquo;&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&laquo;EXPAND&nbsp;property&nbsp;FOREACH&nbsp;this.properties&raquo;<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&laquo;ENDFILE&raquo;<br>
&laquo;ENDDEFINE&raquo;<br>

<br>
&laquo;DEFINE&nbsp;property&nbsp;FOR&nbsp;Property&raquo;<br>
&nbsp;&nbsp;private&nbsp;&laquo;this.type.name&raquo;&nbsp;&laquo;this.name&raquo;;<br>

<br>
&nbsp;&nbsp;public&nbsp;void&nbsp;set&laquo;this.name.toFirstUpper()&raquo;(&laquo;this.type.name&raquo;&nbsp;&laquo;this.name&raquo;)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;this.&laquo;this.name&raquo;&nbsp;=&nbsp;&laquo;this.name&raquo;;<br>
&nbsp;&nbsp;}<br>

<br>
&nbsp;&nbsp;public&nbsp;&laquo;this.type.name&raquo;&nbsp;get&laquo;this.name.toFirstUpper()&raquo;()&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;this.&laquo;this.name&raquo;;<br>
&nbsp;&nbsp;}<br>
&laquo;ENDDEFINE&raquo;<br>

<br>

</code>
</p>
</div>
</div>
<div class="section" title="Creating the template for the DAO">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="CreatingthetemplatefortheDAO"></a>Creating the template for the DAO</h3>
</div>
</div>
</div>
<p>To load entities from a database and save them back, we will need to write some entities, but again, this is something the generator can do for us.</p>
<p>Create a template 
					<code class="code">DAO.xpt</code> and insert this text:
				</p>
<div class="literallayout">
<p>
<code class="code">&laquo;IMPORT&nbsp;entities&raquo;<br>

<br>
&laquo;DEFINE&nbsp;dao&nbsp;FOR&nbsp;Entity&raquo;<br>
&nbsp;&nbsp;&laquo;FILE&nbsp;this.name&nbsp;+&nbsp;"DAO.java"&raquo;<br>
&nbsp;&nbsp;&nbsp;&nbsp;import&nbsp;java.util.Collection;<br>
&nbsp;&nbsp;&nbsp;&nbsp;import&nbsp;org.springframework.orm.hibernate3.support.HibernateDaoSupport;<br>
&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;class&nbsp;&laquo;this.name&raquo;DAO<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;extends&nbsp;HibernateDaoSupport&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&laquo;EXPAND&nbsp;crud&nbsp;FOR&nbsp;this&raquo;<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&laquo;ENDFILE&raquo;<br>
&laquo;ENDDEFINE&raquo;<br>

<br>
&laquo;DEFINE&nbsp;crud&nbsp;FOR&nbsp;Entity&raquo;<br>
&nbsp;&nbsp;public&nbsp;&laquo;this.name&raquo;&nbsp;load(Long&nbsp;id)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;(&laquo;this.name&raquo;)getHibernateTemplate().get(&laquo;this.name&raquo;.class,&nbsp;id);<br>
&nbsp;&nbsp;}<br>

<br>
&nbsp;&nbsp;@SuppressWarnings("unchecked")<br>
&nbsp;&nbsp;public&nbsp;Collection&lt;&laquo;this.name&raquo;&gt;&nbsp;loadAll()&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;getHibernateTemplate().loadAll(&laquo;this.name&raquo;.class);<br>
&nbsp;&nbsp;}&nbsp;&nbsp;<br>

<br>
&nbsp;&nbsp;public&nbsp;&laquo;this.name&raquo;&nbsp;create(&laquo;this.name&raquo;&nbsp;entity)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;(&laquo;this.name&raquo;)&nbsp;getHibernateTemplate().save(entity);<br>
&nbsp;&nbsp;}<br>

<br>
&nbsp;&nbsp;public&nbsp;void&nbsp;update(&laquo;this.name&raquo;&nbsp;entity)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;getHibernateTemplate().update(entity);<br>
&nbsp;&nbsp;}<br>

<br>
&nbsp;&nbsp;public&nbsp;void&nbsp;remove(&laquo;this.name&raquo;&nbsp;entity)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;getHibernateTemplate().delete(entity);<br>
&nbsp;&nbsp;}<br>
&laquo;ENDDEFINE&raquo;<br>

<br>

</code>
</p>
</div>
</div>
<div class="section" title="Adjusting the generator workflow">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="Adjustingthegeneratorworkflow"></a>Adjusting the generator workflow</h3>
</div>
</div>
</div>
<p>You might have noticed the generator workflow 
					<code class="code">org.xtext.example.start.generator/src/workflow/EntitiesGenerator.mwe2</code> will invoke a template named 
					<code class="code">Template.xpt</code>, so we need to change this to make sure the right templates get invoked. Open 
					<code class="code">/org.xtext.example.start.generator/src/workflow/EntitiesGenerator.mwe</code> and make sure it invokes 
					<code class="code">Main.xpt</code>:
				</p>
<div class="literallayout">
<p>
<code class="code">	component&nbsp;=&nbsp;org.eclipse.xpand2.Generator&nbsp;{<br>
		metaModel&nbsp;=&nbsp;org.eclipse.xtend.typesystem.emf.EmfRegistryMetaModel&nbsp;{}<br>
		expand&nbsp;=&nbsp;"templates::Main::main&nbsp;FOREACH&nbsp;model"<br>
		outlet&nbsp;=&nbsp;{<br>
			path&nbsp;=&nbsp;targetDir<br>
		}<br>
		fileEncoding&nbsp;=&nbsp;fileEncoding<br>
	}<br>

<br>

</code>
</p>
</div>
</div>
<div class="section" title="Running the generator">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="Runningthegenerator"></a>Running the generator</h3>
</div>
</div>
</div>
<p>In order to invoke the generator, select 
					<code class="code">EntitiesGenerator.mwe</code> (in 
					<code class="code">org.xtext.example.start.generator/src/workflow/</code>) and choose 
					<span class="emphasis"><em>Run As -&gt; MWE Workflow</em></span> from the context menu. You&rsquo;ll see a bunch of log messages in the console view, and after a few seconds, you&rsquo;ll find a number of just generated files in 
					<code class="code">org.xtext.example.entity.generator/src-gen</code>.
				</p>
<p>Please note that you&rsquo;ll get a number of compile-time errors now, as the DAO classes depend on Hibernate. To get rid of them, just download Hibernate from http://www.hibernate.org and add it to the build class path of the project.</p>
</div>
</div>
<div class="section" title="Where next?">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="Wherenext"></a>Where next?</h2>
</div>
</div>
</div>
<p>This is the end of the &bdquo;Getting Started&rdquo; chapter of this documentation. The next part of this document is more detailed and compact at he same time. It discusses technical topics not always in an introductory way but acts as a comprehensive reference. You will find more material that introduces Xtext at the 
				<a class="ulink" href="http://www.xtext.org" target="_new">Xtext website</a> .
			</p>
</div>
</div>
<div class="chapter" title="Chapter&nbsp;3.&nbsp;Xtext and EMF">
<div class="titlepage">
<div>
<div>
<h2 class="title">
<a name="concepts"></a>Chapter&nbsp;3.&nbsp;Xtext and EMF</h2>
</div>
</div>
</div>
<p>In this section we try to introduce the basic features of the 
			<a class="link" href="#">Eclipse Modeling Framework (EMF)</a> in the context of Xtext. As EMF provides the base infrastructure for Xtext, it is useful to have a basic understanding of EMF, so we give a rough outline here.  
			If you want to learn more about EMF, we recommend reading the 
			<a class="link" href="#">EMF book</a>.
		</p>
<div class="section" title="Model, AST, Meta Model, and Ecore">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="model_metamodel"></a>Model, AST, Meta Model, and Ecore </h2>
</div>
</div>
</div>
<p>When you run the workflow in your Xtext project, Xtext will generate a bunch of artifacts that make up the infrastructure for your language. Among other useful things, it will create a parser. This parser takes models, i.e. files in your language, as an input and produce a graph of objects as output. This graph is called the 
				<span class="emphasis"><em>Abstract Syntax Tree</em></span> (AST). Given the example model from the 
				<a class="link" href="#">introduction</a>, the AST should look like this
			</p>
<p>
				
</p>
<div class="mediaobject">
<img src="images/ast.png"></div>
<p>
			
</p>
<p>In terms of modeling, we also refer to the AST tree as the 
				<span class="emphasis"><em>semantic model</em></span>, as it does no longer carry any additional syntactical information. Usually it is only the semantic model that is processed by later processing steps, i.e. in the execution by a code generator or interpreter.
			</p>
<p>The structure of the semantic model is defined by the so called 
				<span class="emphasis"><em>meta model</em></span>. You can think of the meta model as the schema for the models. In Xtext, meta models are either inferred from the grammar or predefined by the user (see the section on 
				<a class="link" href="#package_declarations" title="EPackage declarations">package declarations</a> for details). The next diagram shows the meta model of our example:
			</p>
<p>
				
</p>
<div class="mediaobject">
<img src="images/metamodel.png"></div>
<p> 
			
</p>
<p>The language in which the meta model is defined is called 
				<span class="emphasis"><em>Ecore</em></span>. In other words, the meta model is the Ecore model of your language. Ecore an essential part of EMF. Your your models instantiate the meta model, and your meta model instantiates Ecore. To put an end to this recursion, Ecore is defined in itself (an instance of itself). 
			</p>
<p>The meta model defines the types of the semantic nodes as Ecore 
				<span class="emphasis"><em>EClasses</em></span>. EClasses are shown as boxes in the meta mode diagram, so in our example, 
				<span class="emphasis"><em>Model</em></span>, 
				<span class="emphasis"><em>Type</em></span>, 
				<span class="emphasis"><em>SimpleType</em></span>, 
				<span class="emphasis"><em>Entity</em></span>, and 
				<span class="emphasis"><em>Property</em></span> are EClasses. An EClass can inherit from other EClasses. Multiple inheritance is allowed in Ecore, but of course cycles are forbidden.  
			</p>
<p>EClasses can have 
				<span class="emphasis"><em>EAttributes</em></span> for their simple properties. These are shown inside the EClasses nodes. The example contains two EAttributes 
				<span class="emphasis"><em>name</em></span> and one EAttribute 
				<span class="emphasis"><em>isMulti</em></span>. The domain of values for an EAttribute is defined by its 
				<span class="emphasis"><em>EDataType</em></span>. Ecore ships with some predefined 
				<span class="emphasis"><em>EDataTypes</em></span>, which essentially refer to Java primitive types and other immutable classes like String. To make a distinction from the Java types, the EDataTypes are prefixed with an 
				<code class="code">E</code>. In our example, that&rsquo;s 
				<span class="emphasis"><em>EString</em></span> and 
				<span class="emphasis"><em>EBoolean</em></span>.  
			</p>
<p>In contrast to EAttributes, 
				<span class="emphasis"><em>EReferences</em></span> point to other EClasses. The 
				<code class="code">containment</code> flag indicates whether an EReference is a 
				<span class="emphasis"><em>containment reference</em></span> or a 
				<span class="emphasis"><em>cross reference</em></span>. In the diagram, references are edges and containment references are marked with a diamond. At the model level, each element can have at most one container, i.e. another element referring to it with a containment reference. This infers a tree structure to the models, as can be seen in the sample model diagram. On the other hand, 
				<span class="emphasis"><em>cross references</em></span> refer to elements that can be contained anywhere else. In the example, 
				<code class="code">elements</code> and 
				<code class="code">properties</code> are containment references, while 
				<code class="code">type</code> and 
				<code class="code">extends</code> are cross references. For reasons of readability, we skipped the cross references in the sample model diagram. Note that in contrast to other parser generators, Xtext creates ASTs with linked cross references. 
			</p>
<p>Other than associations in UML, EReferences in Ecore are always owned by one EClass and only navigable in the direction form the owner to the type. Bi-directional associations must be modeled as two references, being 
				<code class="code">eOpposite</code> of each other and owned by either end of the associations.
			</p>
<p>The superclass of EAttibutes and EReferences is 
				<span class="emphasis"><em>EStructuralFeature</em></span> and allows to define a name and a cardinality by setting 
				<code class="code">lowerBound</code> and 
				<code class="code">upperBound</code>. Setting the latter to -1 means &sbquo;unbounded&rsquo;. 
			</p>
<p>The common supertype of EDataType and EClass is 
				<span class="emphasis"><em>EClassifier</em></span>. An 
				<span class="emphasis"><em>EPackage</em></span> acts as a namespace and container of EClassifiers. 
			</p>
<p>We have summarized these most relevant concepts of Ecore in the following diagram:  </p>
<p>
				
</p>
<div class="mediaobject">
<img src="images/ecore.png"></div>
<p>
			
</p>
</div>
<div class="section" title="EMF code generation">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="emf_codegen"></a>EMF code generation</h2>
</div>
</div>
</div>
<p>EMF also ships with a code generator that generates Java classes from your Ecore model. The code generators input is the so called 
				<span class="emphasis"><em>EMF generator model</em></span>. It decorates (references) the Ecore model and adds additional information for the Ecore -&gt; Java transformation. Xtext will automatically generate a generator model with reasonable defaults for all generated metamodels, and run the EMF code generator on them. 
			</p>
<p>The generated classes are based on the EMF runtime library, which offers a lot of infrastructure and tools to work with your models, such as persistence, reflection, referential integrity, lazy loading etc.</p>
<p>Among other things, the code generator will generate</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>A Java interface and a Java class for each EClassifier in your ecore model. By default, all classes will implement the interface 
						<code class="code">org.eclipse.emf.ecore.EObject</code>, linking a lot of runtime functionality. 
					</p>
</li>
<li class="listitem">
<p>A Java bean property for each EStructuralFeature (member variable, accessor methods)</p>
</li>
<li class="listitem">
<p>A package interface and class, holding singleton objects for all elements of your Ecore model, allowing reflection. EPackages are also registered to the 
						<code class="code">EPackage.Registry</code> to be usable at runtime.
					</p>
</li>
<li class="listitem">
<p>A factory interface and class for creating instances</p>
</li>
<li class="listitem">
<p>An abstract switch class implementing a visitor pattern to avoid if-instanceof cascades in your code.</p>
</li>
</ul>
</div>
</div>
<div class="section" title="EMF Resources">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="emf_resource"></a>EMF Resources</h2>
</div>
</div>
</div>
<p>EMF offers RESTful (REpresentational State Transfer) persistence of your models. </p>
<p>An 
				<code class="code">org.eclipse.emf.ecore.Resource</code> is a container for a model that adds support for persistence. When working with files, you can assume that a resource is the in-memory representation of a model file. There are different implementations of the resource interface, e.g. for XMI, XML or binary serialization of models. The ${org.eclipse.xtext/src/org/eclipse/xtext/resource/XtextResource} encapsulates the parser and 
				<a class="link" href="#serialization" title="Serialization">serializer</a> of your DSL, thus transparently reading and writing your models in the syntax according to your grammar while offering an EMF view on the semantic model.     
			</p>
<p>Each EMF resource has a 
				<a class="ulink" href="http://www.ietf.org/rfc/rfc2396.txt" target="_new">
					<span class="emphasis"><em>Uniform Resource Identifier (URI)</em></span>
				</a> defining where and how the resource can be accessed. Resource URIs are of the form 
			</p>
<div class="literallayout">
<p>
<code class="code">[scheme]:[authority][path]<br>

</code>
</p>
</div>
<p>where each segment is optional. Authority and path segments are separated by slashes. URIs can be absolute or relative and are represented by the class 
				<code class="code">org.eclipse.emf.common.util.URI</code>. 
			</p>
<p>Resources are usually created by a 
				<code class="code">org.eclipse.emf.ecore.Resource.Factory</code>.  Xtext will register a resource factory that creates an 
				<code class="code">XtextReosurce</code> for your language if the given URI ends with the file extension you provided in the 
				<code class="code">.properties</code> file of your language.
			</p>
<p>In addition to the standard schemes like 
				<code class="code">http:</code> or 
				<code class="code">file:</code>, EMF introduces two new types of URIs, useful when operating inside an Eclipse workbench
			</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>
						
<code class="code">platform:/resource/&lt;project&gt;/&lt;path&gt;</code> refers to files in the workspace
					</p>
</li>
<li class="listitem">
<p>
						
<code class="code">platform:/plugin/&lt;plugin&gt;/path</code> uses the class loader of an installed plug-in&rsquo;s to load a file.
					</p>
</li>
</ul>
</div>
<p>Model elements (EObjects) within a resource are referred to by a so called 
				<span class="emphasis"><em>fragment</em></span>. The fragment must be unique inside the resource. The URI of an EObject consists of the URI of its resource followed by a hash mark &sbquo;#&rsquo; and its fragment. The default EMF strategy for calculating fragments is to build a path expression, similar to XPath. In Xtext, you can override that by binding a new 
				<code class="code">IFragmentProvider</code>.
			</p>
<p>As the name suggests, a 
				<span class="emphasis"><em>ResourceSet</em></span> is a set of resources. The model elements in these resources can have cross references across the resource boundaries. EMF supports lazy loading, i.e. when you navigate a reference to a resource that has not been loaded yet, the resource will be transparently loaded into the same ResourceSet as the referring resource. A ResourceSet also allows to override several global registries and services. 
			</p>
<p>Xtext offers two additional ResourceSet implementations: </p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>${org.eclipse.xtext/src/org/eclipse/xtext/resource/XtextResourceSet.java} supports a new URI scheme 
						<code class="code">classpath:</code> to load resources with a classloader. As there can be multiple classloader inside the same Java process, the XtextResourceSet must be configured with a context.
					</p>
</li>
<li class="listitem">
<p>${org.eclipse.xtext/src/org/eclipse/xtext/resource/SynchronizedXtextResourceSet.java} guards the list of resources for concurrent access.  </p>
</li>
</ul>
</div>
</div>
<div class="section" title="Grammar model">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="grammar_model"></a>Grammar model</h2>
</div>
</div>
</div>
<p>Xtext is bootstrapped: The Xtext grammar language has been built with Xtext. You can find the grammar of the Xtext grammar language is ${org.eclipse.xtext/src/org/eclipse/xtext/Xtext.xtext}. Consequently, there is an Ecore model for Xtext grammars. When you write your own grammars, the Xtext grammar parser will instantiate this Xtext grammar model. If you&rsquo;re curious, you can find this model as an 
				<code class="code">XMI</code> file in the 
				<code class="code">src_gen</code> folder of our language plug-in, but the textual version &ndash; the grammar itself &ndash; is far easier to read. That&rsquo;s why we use Xtext anyway, don&rsquo;t we ;-).
			</p>
</div>
<div class="section" title="Parse tree model">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="parsetree_model"></a>Parse tree model</h2>
</div>
</div>
</div>
<p>In addition to the AST, the Xtext parser creates another model, the 
				<span class="emphasis"><em>Parse Tree Model</em></span>. This model represents the trace of the parsing process and keeps syntactic information, such as 
				<code class="code">offset</code> and 
				<code class="code">length</code> of the text range describing an element. The parser is the only component modifying the parse tree model. All parse tree models conform to the same meta model, that is shown in the following diagram:    
			</p>
<p>
				
</p>
<div class="mediaobject">
<img src="images/node-model.png"></div>
<p>
			
</p>
<p>There are two concrete types of nodes: 
				<span class="emphasis"><em>CompositeNodes</em></span> act as containers for other nodes, while 
				<span class="emphasis"><em>LeafNodes</em></span> cannot have children, but describe to terminals via the 
				<code class="code">text</code> attribute. A LeafNode is 
				<code class="code">hidden</code> if its terminal is 
				<a class="link" href="#">defined as hidden</a> in the grammar, which usually means it is a whitespace or a comment. With exception to the last node, the parser will put hidden terminals as children in the composite node belonging to the following region. 
			</p>
<p>Both concrete node classes inherit from the abstract class 
				<span class="emphasis"><em>AbstractNode</em></span>. Each node knows the text location (
				<code class="code">totalOffset</code>, 
				<code class="code">totalLength</code> , and 
				<code class="code">totalLine</code>) it represents. For CompositeNodes, that includes their children&rsquo;s ranges. As opposed to the total location, the derived operations 
				<code class="code">getOffset()</code>, 
				<code class="code">getLength()</code>, and 
				<code class="code">getLine()</code> describe the location without surrounding hidden terminals. 
				<code class="code">endLine()</code> calculates the last line of the location. 
			</p>
<p>The method 
				<code class="code">serialize()</code> will concatenate all texts of contained leaf nodes as a string, thus yielding the text segment of the node when it was parsed. Note that it will not call the 
				<a class="link" href="#serialization" title="Serialization">serializer</a>. 
			</p>
<p>Finally, the parser stores 
				<span class="emphasis"><em>SyntaxErrors</em></span> in the parse tree model, which allows error recovery and partially parsed models.  
			</p>
<div class="section" title="Connection of AST, parse tree and grammar">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="node_semantic_grammar"></a>Connection of AST, parse tree and grammar </h3>
</div>
</div>
</div>
<p>A parse tree node directly refers to the AST node it belongs to via the 
					<code class="code">element</code> reference. As stated above, the AST nodes don&rsquo;t offer any syntactical information themselves. Instead, the parser attaches 
					<code class="code">org.eclipse.parsetree.NodeAdapter</code> as EMF adapter to each semantic element it creates. That adapter has a reference to the corresponding parse tree node. The ${org.eclipse.xtext/src/org/eclipse/xtext/parsetree/NodeUtil.java} offers a collection of utility methods to manage node adapters. 
				</p>
<p>By means of the 
					<code class="code">grammarElement</code> reference, a node points to the element of the 
					<a class="link" href="#grammar_model" title="Grammar model">grammar model</a> that caused the parser to consume its content.
				</p>
<p>Neither the parse tree model nor the grammar model appear in the 
					<code class="code">contents</code> of the resource. As an alternative to the node adapter, you reach the node model by calling 
					<code class="code">XtextResource.getParseResult().getRootNode()</code>.
				</p>
</div>
</div>
</div>
<div class="chapter" title="Chapter&nbsp;4.&nbsp;The Grammar Language">
<div class="titlepage">
<div>
<div>
<h2 class="title">
<a name="grammarLanguage"></a>Chapter&nbsp;4.&nbsp;The Grammar Language</h2>
</div>
</div>
</div>
<p>The 
			<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/Xtext.xtext?root=Modeling_Project&view=markup" target="_new">grammar language</a> 
			is the corner stone of Xtext and is defined in itself. Actually it is a DSL to create DSLs, so what would be more helpful than developing the Xtext language with Xtext?
		</p>
<p>The grammar language is a domain-specific language, carefully designed for the description of textual languages based on 
			<a class="ulink" href="http://en.wikipedia.org/wiki/LL_parser" target="_new">LL(*)-Parsing</a> that is like 
			<a class="ulink" href="http://www.artima.com/lejava/articles/antlr_3.html" target="_new">ANTLR3&rsquo;s parsing strategy</a>.
			The main idea is to describe the concrete syntax and how an EMF-based in-memory model is created during parsing. 
		</p>
<div class="section" title="A first example">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="Afirstexample"></a>A first example</h2>
</div>
</div>
</div>
<p>To get an idea of how it works we&rsquo;ll start by implementing a 
				<a class="ulink" href="http://martinfowler.com/dslwip/Intro.html" target="_new">simple example</a> introduced by Martin Fowler.
				It&rsquo;s mainly about describing state machines used as the (un)lock mechanism of secret compartments. People who have secret compartments control their access in a very old-school way, e.g. by opening the door first and turning on the light afterwards. Then the secret compartment, for instance a panel, opens up. One of those state machines could look like this:
			</p>
<div class="literallayout">
<p>
<code class="code">events<br>
&nbsp;&nbsp;doorClosed&nbsp;&nbsp;D1CL<br>
&nbsp;&nbsp;drawOpened&nbsp;&nbsp;D2OP<br>
&nbsp;&nbsp;lightOn&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L1ON<br>
&nbsp;&nbsp;doorOpened&nbsp;&nbsp;D1OP<br>
&nbsp;&nbsp;panelClosed&nbsp;PNCL<br>
end<br>
&nbsp;<br>
resetEvents<br>
&nbsp;&nbsp;doorOpened<br>
end<br>
&nbsp;<br>
commands<br>
&nbsp;&nbsp;unlockPanel&nbsp;PNUL<br>
&nbsp;&nbsp;lockPanel&nbsp;&nbsp;&nbsp;PNLK<br>
&nbsp;&nbsp;lockDoor&nbsp;&nbsp;&nbsp;&nbsp;D1LK<br>
&nbsp;&nbsp;unlockDoor&nbsp;&nbsp;D1UL<br>
end<br>
&nbsp;<br>
state&nbsp;idle<br>
&nbsp;&nbsp;actions&nbsp;{unlockDoor&nbsp;lockPanel}<br>
&nbsp;&nbsp;doorClosed&nbsp;=&gt;&nbsp;active<br>
end<br>
&nbsp;<br>
state&nbsp;active<br>
&nbsp;&nbsp;drawOpened&nbsp;=&gt;&nbsp;waitingForLight<br>
&nbsp;&nbsp;lightOn&nbsp;&nbsp;&nbsp;&nbsp;=&gt;&nbsp;waitingForDraw<br>
end<br>
&nbsp;<br>
state&nbsp;waitingForLight<br>
&nbsp;&nbsp;lightOn&nbsp;=&gt;&nbsp;unlockedPanel<br>
end<br>
&nbsp;<br>
state&nbsp;waitingForDraw<br>
&nbsp;&nbsp;drawOpened&nbsp;=&gt;&nbsp;unlockedPanel<br>
end<br>
&nbsp;<br>
state&nbsp;unlockedPanel<br>
&nbsp;&nbsp;actions&nbsp;{unlockPanel&nbsp;lockDoor}<br>
&nbsp;&nbsp;panelClosed&nbsp;=&gt;&nbsp;idle<br>
end<br>

<br>

</code>
</p>
</div>
<p>So, we have a bunch of declared events, commands and states. Within states there are references to declared actions, which should be executed when entering such a state.
				Also there are transitions consisting of a reference to an event and a state. Please read 
				<a class="ulink" href="http://martinfowler.com/dslwip/Intro.html" target="_new">Martin&rsquo;s description</a> if it is not clear enough.
			</p>
<p>In order to get a complete IDE for this little language from Xtext, you need to write the following grammar:</p>
<div class="literallayout">
<p>
<code class="code">grammar&nbsp;my.pack.SecretCompartments&nbsp;<br>
&nbsp;&nbsp;&nbsp;with&nbsp;org.eclipse.xtext.common.Terminals<br>

<br>
generate&nbsp;secretcompartment&nbsp;"http://www.eclipse.org/secretcompartment"<br>
&nbsp;<br>
Statemachine&nbsp;:<br>
&nbsp;&nbsp;'events'<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(events+=Event)+<br>
&nbsp;&nbsp;'end'<br>
&nbsp;&nbsp;('resetEvents'<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(resetEvents+=[Event])+<br>
&nbsp;&nbsp;'end')?<br>
&nbsp;&nbsp;'commands'<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(commands+=Command)+<br>
&nbsp;&nbsp;'end'<br>
&nbsp;&nbsp;(states+=State)+;<br>
&nbsp;<br>
Event&nbsp;:<br>
&nbsp;&nbsp;name=ID&nbsp;code=ID;<br>
&nbsp;<br>
Command&nbsp;:<br>
&nbsp;&nbsp;name=ID&nbsp;code=ID;<br>
&nbsp;<br>
State&nbsp;:<br>
&nbsp;&nbsp;'state'&nbsp;name=ID<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;('actions'&nbsp;'{'&nbsp;(actions+=[Command])+&nbsp;'}')?<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(transitions+=Transition)*<br>
&nbsp;&nbsp;'end';<br>
&nbsp;<br>
Transition&nbsp;:<br>
&nbsp;&nbsp;event=[Event]&nbsp;'=&gt;'&nbsp;state=[State];<br>

<br>

</code>
</p>
</div>
</div>
<div class="section" title="The Syntax">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="syntax"></a>The Syntax</h2>
</div>
</div>
</div>
<p>In the following the different concepts of the grammar language are explained. </p>
<div class="section" title="Language Declaration">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="LanguageDeclaration"></a>Language Declaration</h3>
</div>
</div>
</div>
<p>The first line  </p>
<div class="literallayout">
<p>
<code class="code">grammar&nbsp;my.pack.SecretCompartments&nbsp;with&nbsp;org.eclipse.xtext.common.Terminals<br>

</code>
</p>
</div>
<p>declares the name of the grammar. Xtext leverages Java&rsquo;s class path mechanism. This means that the name can be any valid Java qualifier. The file name needs to correspond to the grammar name and have the file extension &sbquo;xtext&rsquo;. This means that the name has to be 
					<code class="code">SecretCompartments.xtext</code> and must be placed in a package 
					<code class="code">my.pack</code> somewhere on your project&rsquo;s class path.
				</p>
<p>The first line is also used to declare any used language (for mechanism details see 
					<a class="link" href="#grammarMixins" title="Grammar Mixins">Grammar Mixins</a>).
				</p>
</div>
<div class="section" title="EPackage declarations">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="package_declarations"></a>EPackage declarations</h3>
</div>
</div>
</div>
<p>Xtext parsers instantiate Ecore models (aka meta models). An Ecore model basically consists of an EPackage containing EClasses, EDatatypes and EEnums.
					Xtext can infer Ecore models from a grammar (see 
					<a class="link" href="#metamodelInference" title="Ecore model inference">Ecore model inference</a>) but it is also possible to instantiate existing Ecore models. You can even mix this and use multiple existing Ecore models and infer some others from one grammar. 
				</p>
<div class="section" title="EPackage generation">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="EPackagegeneration"></a>EPackage generation</h4>
</div>
</div>
</div>
<p>The easiest way to get started is to let Xtext infer the Ecore model from your grammar. This is what is done in the secret compartment example. To do so just state:</p>
<div class="literallayout">
<p>
<code class="code">generate&nbsp;secretcompartment&nbsp;'http://www.eclipse.org/secretcompartment'<br>

</code>
</p>
</div>
<p>That statement means: generate an EPackage with the name 
						<code class="code">secretcompartment</code> and the nsURI 
						<code class="code">http://www.eclipse.org/secretcompartment</code>. Actually these are the properties that are required to create an EPackage. 
						The whole algorithm used to derive complete Ecore models from Xtext grammars is described in the section 
						<a class="link" href="#metamodelInference" title="Ecore model inference">Ecore model inference</a>.
					</p>
</div>
<div class="section" title="EPackage import">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="EPackageimport"></a>EPackage import</h4>
</div>
</div>
</div>
<p>If you already have an existing EPackage, you can import it using either a namespace URI or a resource URI. An 
						<a class="ulink" href="http://www.ietf.org/rfc/rfc2396.txt" target="_new">URI</a> (Uniform Resource Identifier) provides a simple and extensible means for identifying an abstract or physical resource. For details about the EMF implementation of this concept, please see its 
						<a class="ulink" href="http://help.eclipse.org/help32/topic/org.eclipse.emf.doc/references/javadoc/org/eclipse/emf/common/util/URI.html" target="_new">documentation</a>.
					</p>
<div class="section" title="Using namespace URIs to import existing EPackages">
<div class="titlepage">
<div>
<div>
<h5 class="title">
<a name="UsingnamespaceURIstoimportexistingEPackages"></a>Using namespace URIs to import existing EPackages</h5>
</div>
</div>
</div>
<p>You can import an existing EPackage with the following statement:</p>
<div class="literallayout">
<p>
<code class="code">import&nbsp;'http://www.eclipse.org/secretcompartment'<br>

</code>
</p>
</div>
<p>Note that if you use a namespace URI, the corresponding EPackage needs to be installed into the workbench. Otherwise the editor cannot find it.
							At runtime (i.e. when starting the generator) you need to make sure that the corresponding EPackage is registered in the 
							<code class="code">EPackage.Registry.INSTANCE</code>. If you use MWE to drive your code generator, you need to add the following lines to your workflow file:
						</p>
<div class="literallayout">
<p>
<code class="code">&lt;bean&nbsp;class="org.eclipse.emf.mwe.utils.StandaloneSetup"&nbsp;<br>
&nbsp;&nbsp;platformUri="${runtimeProject}/.."&gt;<br>
&nbsp;&nbsp;&lt;registerGeneratedEPackage&nbsp;value="my.pack.SecretcompartmentPackage"/&gt;<br>
&lt;/bean&gt;<br>

<br>

</code>
</p>
</div>
<p>Using namespace URIs is typically only interesting when common Ecore models are used, such as Ecore itself or the UML meta model. If you&rsquo;re developing the EPackage together with the DSL but don&rsquo;t want to have it derived from the grammar for some reason, we suggest to use a resource URI.</p>
</div>
<div class="section" title="Using resource URIs to import existing EPackages">
<div class="titlepage">
<div>
<div>
<h5 class="title">
<a name="UsingresourceURIstoimportexistingEPackages"></a>Using resource URIs to import existing EPackages</h5>
</div>
</div>
</div>
<p>If the EPackage you want to use is somewhere in your workspace you should refer to it by a 
							<code class="code">platform:/resource/</code>-URI.
							Platform URIs are a special EMF concept, which allow for some kind of transparency between workspace projects and installed bundles. Consult the EMF documentation (we recommend the book) for details.
						</p>
<p>An import statement referring to an Ecore file by a platform:/resource/ URI looks like this: </p>
<div class="literallayout">
<p>
<code class="code">import&nbsp;'platform:/resource/project/src/my/pack/SecretCompartments.ecore'<br>

</code>
</p>
</div>
<p>If you want to mix generated and imported Ecore models you&rsquo;ll have to configure the generator fragment in your MWE file responsible for generating the Ecore classes (
							<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.generator/src/org/eclipse/xtext/generator/ecore/EcoreGeneratorFragment.java?root=Modeling_Project&view=co" target="_new">EcoreGeneratorFragment</a>) with resource URIs that point to the genmodels for the referenced Ecore models.
							Example:
						</p>
<div class="literallayout">
<p>
<code class="code">fragment&nbsp;=&nbsp;org.eclipse.xtext.generator.ecore.EcoreGeneratorFragment&nbsp;{<br>
&nbsp;&nbsp;genModels&nbsp;=<br>
&nbsp;&nbsp;&nbsp;&nbsp;"platform:/resource/project/src/my/pack/SecretCompartments.genmodel"<br>
}<br>

<br>

</code>
</p>
</div>
</div>
</div>
<div class="section" title="Ecore model aliases for packages">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="Ecoremodelaliasesforpackages"></a>Ecore model aliases for packages</h4>
</div>
</div>
</div>
<p>If you want to use multiple EPackages you need to specify aliases in the following way:</p>
<div class="literallayout">
<p>
<code class="code">generate&nbsp;secretcompartment&nbsp;'http://www.eclipse.org/secretcompartment'<br>
import&nbsp;'http://www.eclipse.org/anotherPackage'&nbsp;as&nbsp;another<br>

<br>

</code>
</p>
</div>
<p>When referring to a type somewhere in the grammar you need to qualify the reference using that alias (example 
						<code class="code">another::CoolType</code>). We&rsquo;ll see later where such type references occur.
					</p>
<p>It is also supported to put multiple EPackage imports into one alias. This is no problem as long as there are not any two EClassifiers with the same name. In such cases none of them can be referenced. It is even possible to &sbquo;import&rsquo; multiple and &sbquo;generate&rsquo; one Ecore model and all of them are declared for the same alias. If you do so, for a reference to an EClassifier first the imported EPackages are scanned before it is assumed that a type needs to by generated into the to-be-generated package.</p>
<p>Example:</p>
<div class="literallayout">
<p>
<code class="code">generate&nbsp;toBeGenerated&nbsp;'http://www.eclipse.org/toBeGenerated'<br>
import&nbsp;'http://www.eclipse.org/packContainingClassA'<br>
import&nbsp;'http://www.eclipse.org/packContainingClassB'<br>

<br>

</code>
</p>
</div>
<p>With the declaration above </p>
<div class="orderedlist">
<ol class="orderedlist" type="1">
<li class="listitem">
<p>a reference to type 
								<code class="code">ClassA</code> would be linked to the EClass contained in 
								<code class="code">http://www.eclipse.org/packContainingClassA</code>, 
							</p>
</li>
<li class="listitem">
<p>a reference to type 
								<code class="code">ClassB</code> would be linked to the EClass contained in 
								<code class="code">http://www.eclipse.org/packContainingClassB</code>, 
							</p>
</li>
<li class="listitem">
<p>a reference to type 
								<code class="code">NotYetDefined</code> would be linked to a newly created EClass in 
								<code class="code">http://www.eclipse.org/toBeGenerated</code>.
							</p>
</li>
</ol>
</div>
<p>Note, that using this feature is not recommended, because it might cause problems, which are hard to track down.
						For instance, a reference to 
						<code class="code">classA</code> would as well be linked to a newly created EClass, because the corresponding type in 
						<code class="code">http://www.eclipse.org/packContainingClassA</code> is spelled with a capital letter.
					</p>
</div>
</div>
<div class="section" title="Rules">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="Rules"></a>Rules</h3>
</div>
</div>
</div>
<p>The default parsing is based on a home-grown packrat parser. It is advised to substitute it by an ANTLR parser through the Xtext service mechanism. ANTLR is a sophisticated parser generator framework based on an LL(*) 
					<a class="ulink" href="http://bit.ly/ANTLR_LL_star_algorithm" target="_new">parsing algorithm</a>, that works quite well for Xtext. Please download the plugin de.itemis.xtext.antlr (from update site 
					<code class="code">http://download.itemis.com/updates/</code>) and use the ANTLR Parser instead of the packrat parser (cf. 
					<a class="ulink" href="http://www.eclipse.org/Xtext/developers/workspaceSetup.php" target="_new">Xtext Workspace Setup</a>).
				</p>
<p>Basically parsing can be separated in the following phases. </p>
<div class="orderedlist">
<ol class="orderedlist" type="1">
<li class="listitem">
<p>lexing</p>
</li>
<li class="listitem">
<p>parsing</p>
</li>
<li class="listitem">
<p>linking</p>
</li>
<li class="listitem">
<p>validation</p>
</li>
</ol>
</div>
<div class="section" title="Terminal Rules">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="TerminalRules"></a>Terminal Rules</h4>
</div>
</div>
</div>
<p>In the first stage, i.e. lexing, a sequence of characters (the text input) is transformed into a sequence of so called tokens. In this context, a token is sort of a strongly typed part of the input sequence. It consists of one or more characters and was matched by a particular terminal rule or keyword and therefore represents an atomic symbol.
						Terminal rules are also referred to as token rules or lexer rules. There is an informal naming convention that names of terminal rules are all upper-case.</p>
<p>In the secret compartments example there are no explicitly defined terminal rules, since it only uses the ID rule which is inherited from the grammar 
						<code class="code">org.eclipse.xtext.common.Terminals</code> (cf. 
						<a class="link" href="#grammarMixins" title="Grammar Mixins">Grammar Mixins</a>).
						Therein the ID rule is defined as follows:
					</p>
<div class="literallayout">
<p>
<code class="code">terminal&nbsp;ID&nbsp;:&nbsp;<br>
&nbsp;&nbsp;('^')?('a'..'z'|'A'..'Z'|'_')&nbsp;('a'..'z'|'A'..'Z'|'_'|'0'..'9')*;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>

</code>
</p>
</div>
<p>It says that a Token ID starts with an optional &sbquo;^&rsquo; character (caret), followed by a letter (&sbquo;a&rsquo;..&sbquo;z&rsquo;|&sbquo;A&rsquo;..&sbquo;Z&rsquo;) or underscore (&sbquo;_&rsquo;) followed by any number of letters, underscores and numbers (&sbquo;0&rsquo;..&sbquo;9&rsquo;). </p>
<p>The caret is used to escape an identifier for cases where there are conflicts with keywords. It is removed by the ID rule&rsquo;s 
						<a class="link" href="#valueconverter" title="Value Converter">ValueConverter</a>. 
					</p>
<p>This is the formal definition of terminal rules:</p>
<div class="literallayout">
<p>
<code class="code">TerminalRule&nbsp;:<br>
&nbsp;&nbsp;'terminal'&nbsp;name=ID&nbsp;('returns'&nbsp;type=TypeRef)?&nbsp;':'&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;alternatives=TerminalAlternatives&nbsp;';'<br>
;<br>

<br>

</code>
</p>
</div>
<p>Note, that 
						<span class="emphasis"><em>the order of terminal rules is crucial for your grammar</em></span>, as they may hide each other. This is especially important for newly introduced rules in connection with mixed rules from used grammars. 
					</p>
<p>If you for instance want to add a rule to allow fully qualified names in addition to simple IDs, you should implement it as a 
						<a class="link" href="#datatypeRules" title="Data type rules">data type rule</a>, instead of adding another terminal rule.
					</p>
<div class="section" title="Return types">
<div class="titlepage">
<div>
<div>
<h5 class="title">
<a name="Returntypes"></a>Return types</h5>
</div>
</div>
</div>
<p>A terminal rule returns a value, which is a string (type 
							<code class="code">ecore::EString</code>) by default.
							However, if you want to have a different type you can specify it. For instance, the rule &sbquo;INT&rsquo; is defined as:
						</p>
<div class="literallayout">
<p>
<code class="code">terminal&nbsp;INT&nbsp;returns&nbsp;ecore::EInt&nbsp;:&nbsp;<br>
&nbsp;&nbsp;('0'..'9')+;<br>

<br>

</code>
</p>
</div>
<p>This means that the terminal rule &sbquo;INT&rsquo; returns instances of 
							<code class="code">ecore::EInt</code>. It is possible to define any kind of data type here, which just needs to be an instance of 
							<code class="code">ecore::EDataType</code>.
							In order to tell the parser how to convert the parsed string to a value of the declared data type, you need to provide your own implementation of 
							<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/conversion/IValueConverterService.java?root=Modeling_Project&view=co" target="_new">IValueConverterService</a> (cf. 
							<a class="link" href="#valueconverter" title="Value Converter">value converters</a>). The value converter is also the point where you can remove things like quotes from string literals or the caret (&sbquo;^&rsquo;) from identifiers. Its implementation needs to be registered as a service (cf. 
							<a class="link" href="#dependencyInjection" title="Dependency Injection in Xtext with Google Guice">Service Framework</a>).
						</p>
</div>
</div>
<div class="section" title="Extended Backus-Naur form expressions">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="ExtendedBackusNaurformexpressions"></a>Extended Backus-Naur form expressions</h4>
</div>
</div>
</div>
<p>Token rules are described using &bdquo;Extended Backus-Naur Form&rdquo;-like (EBNF) expressions. The different expressions are described in the following.
						The one thing all of these expressions have in common is the cardinality operator.
						There are four different possible cardinalities</p>
<div class="orderedlist">
<ol class="orderedlist" type="1">
<li class="listitem">
<p>exactly one (the default, no operator)</p>
</li>
<li class="listitem">
<p>one or none (operator &bdquo;?&rdquo;)</p>
</li>
<li class="listitem">
<p>any (zero or more, operator &bdquo;*&rdquo;)</p>
</li>
<li class="listitem">
<p>one or more (operator &bdquo;+&rdquo;)</p>
</li>
</ol>
</div>
<div class="section" title="Keywords / Characters">
<div class="titlepage">
<div>
<div>
<h5 class="title">
<a name="Keywords"></a>Keywords / Characters</h5>
</div>
</div>
</div>
<p>Keywords are a kind of token rule literals. 
							The &sbquo;ID&rsquo; rule in 
							<code class="code">org.eclipse.xtext.common.Terminals</code> for instance starts with a keyword:
						</p>
<div class="literallayout">
<p>
<code class="code">terminal&nbsp;ID&nbsp;:&nbsp;'^'?&nbsp;....&nbsp;;<br>

</code>
</p>
</div>
<p>The question mark sets the cardinality to &bdquo;none or one&rdquo; (i.e. optional) like explained above.</p>
<p>Note that a keyword can have any length and contain arbitrary characters.</p>
</div>
<div class="section" title="Character Ranges">
<div class="titlepage">
<div>
<div>
<h5 class="title">
<a name="CharacterRanges"></a>Character Ranges</h5>
</div>
</div>
</div>
<p>A character range can be declared using the &sbquo;..&rsquo; operator.</p>
<p>Example:</p>
<div class="literallayout">
<p>
<code class="code">terminal&nbsp;INT&nbsp;returns&nbsp;ecore::EInt:&nbsp;('0'..'9')+;<br>

</code>
</p>
</div>
<p>In this case an INT is comprised of one or more (note the &sbquo;+&rsquo; operator) characters between (and including) &sbquo;0&rsquo; and &sbquo;9&rsquo;.</p>
</div>
<div class="section" title="Wildcard">
<div class="titlepage">
<div>
<div>
<h5 class="title">
<a name="Wildcard"></a>Wildcard</h5>
</div>
</div>
</div>
<p>If you want to allow any character you can simple write the wildcard operator &sbquo;.&rsquo; (dot):
							Example:</p>
<div class="literallayout">
<p>
<code class="code">FOO&nbsp;:&nbsp;'f'&nbsp;.&nbsp;'o';<br>

</code>
</p>
</div>
<p>The rule above would allow expressions like &sbquo;foo&rsquo;, &sbquo;f0o&rsquo; or even &sbquo;f\no&rsquo;.</p>
</div>
<div class="section" title="Until Token">
<div class="titlepage">
<div>
<div>
<h5 class="title">
<a name="UntilToken"></a>Until Token</h5>
</div>
</div>
</div>
<p>With the until token it is possible to state that everything should be consumed until a certain token occurs.
							The multiline comment is implemented this way:</p>
<div class="literallayout">
<p>
<code class="code">terminal&nbsp;ML_COMMENT	:&nbsp;'/*'&nbsp;-&gt;&nbsp;'*/';<br>

</code>
</p>
</div>
<p>This is the rule for Java-style comments that begin with &sbquo;/*&rsquo; and end with &sbquo;*/&rsquo;.</p>
</div>
<div class="section" title="Negated Token">
<div class="titlepage">
<div>
<div>
<h5 class="title">
<a name="NegatedToken"></a>Negated Token</h5>
</div>
</div>
</div>
<p>All the tokens explained above can be inverted using a preceding exclamation mark:</p>
<div class="literallayout">
<p>
<code class="code">terminal&nbsp;ML_COMMENT	:&nbsp;'/*'&nbsp;(!'*/')+;<br>

</code>
</p>
</div>
</div>
<div class="section" title="Rule Calls">
<div class="titlepage">
<div>
<div>
<h5 class="title">
<a name="RuleCalls"></a>Rule Calls</h5>
</div>
</div>
</div>
<p>Rules can refer to other rules. This is done by writing the name of the rule to be called.
							We refer to this as rule calls. Rule calls in terminal rules can only point to terminal rules.</p>
<p>Example:</p>
<div class="literallayout">
<p>
<code class="code">terminal&nbsp;QUALIFIED_NAME&nbsp;:&nbsp;ID&nbsp;('.'&nbsp;ID)*;<br>

</code>
</p>
</div>
</div>
<div class="section" title="Alternatives">
<div class="titlepage">
<div>
<div>
<h5 class="title">
<a name="Alternatives"></a>Alternatives </h5>
</div>
</div>
</div>
<p>Using alternatives one can state multiple different alternatives.
							For instance, the whitespace rule uses alternatives like this:</p>
<div class="literallayout">
<p>
<code class="code">terminal&nbsp;WS&nbsp;:&nbsp;('&nbsp;'|'\t'|'\r'|'\n')+;<br>

</code>
</p>
</div>
<p>That is a WS can be made of one or more whitespace characters (including &sbquo; &rsquo;,&sbquo;\t&rsquo;,&sbquo;\r&rsquo;,&sbquo;\n&rsquo;).</p>
</div>
<div class="section" title="Groups">
<div class="titlepage">
<div>
<div>
<h5 class="title">
<a name="Groups"></a>Groups</h5>
</div>
</div>
</div>
<p>Finally, if you put tokens one after another, the whole sequence is referred to as a group.
							Example:</p>
<div class="literallayout">
<p>
<code class="code">terminal&nbsp;ASCII&nbsp;:&nbsp;'0x'&nbsp;('0'..'7')&nbsp;('0'..'9'|'A'..'F');<br>

</code>
</p>
</div>
<p>That is the 2-digit hexadecimal code of ascii characters.</p>
</div>
</div>
</div>
<div class="section" title="Parser Rules">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="parser_rules"></a>Parser Rules</h3>
</div>
</div>
</div>
<p>The parser reads a sequence of terminals and walks through the parser rules. Hence a parser rule &ndash; contrary to a terminal rule &ndash; does not produce a single terminal token but a tree of non-terminal and terminal tokens. They lead to a so called parse tree (in Xtext it is also referred as node model). Furthermore, parser rules are handled as kind of a building plan for the creation of the EObjects that form the semantic model (the linked abstract syntax graph or AST). Due to this fact, parser rules are even called production rules. The different constructs like actions and assignments are used to derive types and initialize the semantic objects accordingly. </p>
<div class="section" title="Extended Backus-Naur Form expressions">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="ExtendedBackusNaurFormexpressions"></a>Extended Backus-Naur Form expressions</h4>
</div>
</div>
</div>
<p>Not all the expressions that are available in terminal rules can be used in parser rules. Character ranges, wildcards, the until token and the negation are only available for terminal rules. </p>
<p>The elements that are available in parser rules as well as in terminal rules are</p>
<div class="orderedlist">
<ol class="orderedlist" type="1">
<li class="listitem">
<p>
								
<a class="link" href="#Groups" title="Groups">groups</a>, 
							</p>
</li>
<li class="listitem">
<p>
								
<a class="link" href="#Alternatives" title="Alternatives">alternatives</a>, 
							</p>
</li>
<li class="listitem">
<p>
								
<a class="link" href="#Keywords" title="Keywords / Characters">keywords</a> and 
							</p>
</li>
<li class="listitem">
<p>
								
<a class="link" href="#RuleCalls" title="Rule Calls">rule calls</a>.
							</p>
</li>
</ol>
</div>
<p>In addition to these elements, there are some expressions used to direct how the AST is constructed, which are listed and explained in the following.</p>
<div class="section" title="Assignments">
<div class="titlepage">
<div>
<div>
<h5 class="title">
<a name="assignments"></a>Assignments </h5>
</div>
</div>
</div>
<p>Assignments are used to assign the parsed information to a feature of the current object. The type of the current object, its EClass, is specified by the return type of the parser rule. If it is not explicitly stated it is implied that the type&rsquo;s name equals the rule&rsquo;s name. The type of the feature is infered from the right hand side of the assignment.</p>
<p>Example:</p>
<div class="literallayout">
<p>
<code class="code">State&nbsp;:<br>
&nbsp;&nbsp;'state'&nbsp;name=ID<br>
&nbsp;&nbsp;&nbsp;&nbsp;('actions'&nbsp;'{'&nbsp;(actions+=[Command])+&nbsp;'}')?<br>
&nbsp;&nbsp;&nbsp;&nbsp;(transitions+=Transition)*<br>
&nbsp;&nbsp;'end'<br>
;<br>

<br>

</code>
</p>
</div>
<p>The syntactic declaration for states in the state machine example starts with a keyword &sbquo;state&rsquo; followed by an assignment:</p>
<div class="literallayout">
<p>
<code class="code">name=ID<br>

</code>
</p>
</div>
<p>The left hand side refers to a feature '
							<code class="code">name</code>' of the current object (which has the EClass &sbquo;State&rsquo; in this case). 
							The right hand side can be a rule call, a keyword, a cross reference (explained later) or even an alternative comprised by the former.
							The type of the feature needs to be compatible with the type of the expression on the right. As ID returns an EString in this case, the feature '
							<code class="code">name</code>' needs to be of type EString as well.
						</p>
<p>
							
<span class="bold"><strong>Assignment Operators</strong></span>
						
</p>
<p>There are three different assignment operators, each with different semantics.</p>
<div class="orderedlist">
<ol class="orderedlist" type="1">
<li class="listitem">
<p>The simple equal sign &bdquo;=&rdquo; is the straight forward assignment, and used for features which take only one element.</p>
</li>
<li class="listitem">
<p>The &bdquo;+=&rdquo; sign (the add operator) expects a multi valued feature and adds the value on the right hand to that feature, which is a list feature.</p>
</li>
<li class="listitem">
<p>The &bdquo;?=&rdquo; sign (boolean assignment operator) expects a feature of type EBoolean and sets it to true if the right hand side was consumed independently from the concrete value of the right hand side.</p>
</li>
</ol>
</div>
<p>The used assignment operator does not effect the cardinality of the expected symbols on the right hand side. </p>
</div>
<div class="section" title="Cross References">
<div class="titlepage">
<div>
<div>
<h5 class="title">
<a name="CrossReferences"></a>Cross References </h5>
</div>
</div>
</div>
<p>A unique feature of Xtext is the ability to declare crosslinks in the grammar. In traditional compiler construction the crosslinks are not established during parsing but in a later linking phase. This is the same in Xtext, but we allow to specify crosslink information in the grammar. This information is used by the linker.
							The syntax for crosslinks is:</p>
<div class="literallayout">
<p>
<code class="code">CrossReference&nbsp;:<br>
&nbsp;&nbsp;'['&nbsp;type=TypeRef&nbsp;('|'&nbsp;^terminal=CrossReferenceableTerminal&nbsp;)?&nbsp;']'<br>
;<br>

<br>

</code>
</p>
</div>
<p>For example, the transition is made up of two cross references, pointing to an event and a state:</p>
<div class="literallayout">
<p>
<code class="code">Transition&nbsp;:<br>
&nbsp;&nbsp;event=[Event]&nbsp;'=&gt;'&nbsp;state=[State]<br>
;<br>

<br>

</code>
</p>
</div>
<p>It is important to understand that the text between the square brackets does not refer to another rule, but to a type!
							This is sometimes confusing, because one usually uses the same name for the rules and the returned types.
							That is if we had named the type for events differently like in the following the cross reference needs to be adapted as well:</p>
<div class="literallayout">
<p>
<code class="code">Transition&nbsp;:<br>
&nbsp;&nbsp;event=[MyEvent]&nbsp;'=&gt;'&nbsp;state=[State]<br>
;<br>
&nbsp;<br>
Event&nbsp;returns&nbsp;MyEvent&nbsp;:&nbsp;....;<br>

<br>

</code>
</p>
</div>
<p>Looking at the syntax definition of cross references, there is an optional part starting with a vertical bar (pipe) followed by &sbquo;CrossReferenceableTerminal&rsquo;. This is the part describing the concrete text, from which the crosslink later should be established.
							If the terminal is omitted, it is expected to be an ID.</p>
<p>You may even use alternatives as the referencable terminal. This way, either an ID or a STRING may be used as the referencable terminal, as it is possible in many SQL dialects.</p>
<div class="literallayout">
<p>
<code class="code">TableRef:&nbsp;table=[Table|(ID|STRING)];<br>

</code>
</p>
</div>
<p>Have a look at the 
							<a class="link" href="#linking" title="Linking">linking section</a> in order to understand how linking is done.
						</p>
</div>
<div class="section" title="Simple Actions">
<div class="titlepage">
<div>
<div>
<h5 class="title">
<a name="SimpleActions"></a>Simple Actions </h5>
</div>
</div>
</div>
<p>By default the object to be returned by a parser rule is created lazily on the first assignment. Then the type of the EObject to be created is determined from the specified return type or the rule name if no explicit return type is specified.
							With Actions however, the creation of returned EObject can be made explicit. Xtext supports two kinds of Actions:</p>
<div class="orderedlist">
<ol class="orderedlist" type="1">
<li class="listitem">
<p>simple actions, and</p>
</li>
<li class="listitem">
<p>assigned actions.</p>
</li>
</ol>
</div>
<p>If at some point you want to enforce the creation of a specific type you can use alternatives or simple actions.
							In the following example TypeB must be a subtype of TypeA. An expression 
							<code class="code">A ident</code> should create an instance of TypeA, whereas 
							<code class="code">B ident</code> should instantiate TypeB.
						</p>
<p>Example with alternatives:</p>
<div class="literallayout">
<p>
<code class="code">MyRule&nbsp;returns&nbsp;TypeA&nbsp;:<br>
&nbsp;&nbsp;"A"&nbsp;name=ID&nbsp;|<br>
&nbsp;&nbsp;MyOtherRule<br>
;&nbsp;<br>
&nbsp;<br>
MyOtherRule&nbsp;returns&nbsp;TypeB&nbsp;:<br>
&nbsp;&nbsp;"B"&nbsp;name&nbsp;=&nbsp;ID<br>
;<br>

<br>

</code>
</p>
</div>
<p>Example with simple actions:  </p>
<div class="literallayout">
<p>
<code class="code">MyRule&nbsp;returns&nbsp;TypeA&nbsp;:<br>
&nbsp;&nbsp;"A"&nbsp;name=ID&nbsp;|<br>
&nbsp;&nbsp;"B"&nbsp;{TypeB}&nbsp;name=ID<br>
;&nbsp;<br>

<br>

</code>
</p>
</div>
<p>Generally speaking, the instance is created as soon as the parser hits the first assignment. However, actions allow to explicitly instantiate any EObject. The notation 
							<code class="code">{TypeB}</code> will create an instance of TypeB and assign it to the result of the parser rule. This allows parser rules without any assignment and object creation without the need to introduce unnecessary rules.
						</p>
</div>
<div class="section" title="Unassigned rule calls">
<div class="titlepage">
<div>
<div>
<h5 class="title">
<a name="Unassignedrulecalls"></a>Unassigned rule calls </h5>
</div>
</div>
</div>
<p>We previously explained, that the EObject to be returned is created lazily when the first assignment occurs or when a simple action is evaluated. There is another way one can set the EObject to be returned, which we call an &bdquo;unassigned rule call&rdquo;.</p>
<p>Unassigned rule calls (the name suggests it) are rule calls to other parser rules, which are not used within an assignment. If there is no feature the returned value shall be assigned to, the value is assigned to the &bdquo;to-be-returned&rdquo; result of the calling rule.</p>
<p>With unassigned rule calls one can, for instance, create rules which just dispatch between several other rules:</p>
<div class="literallayout">
<p>
<code class="code">AbstractToken&nbsp;:<br>
&nbsp;&nbsp;TokenA&nbsp;|<br>
&nbsp;&nbsp;TokenB&nbsp;|<br>
&nbsp;&nbsp;TokenC<br>
;<br>

<br>

</code>
</p>
</div>
<p>As 
							<code class="code">AbstractToken</code> could possibly return an instance of 
							<code class="code">TokenA</code>, 
							<code class="code">TokenB</code> or 
							<code class="code">TokenC</code> its type must by a super type of these types.
							It is now for instance as well possible to further change the state of the AST element by assigning additional things.
						</p>
<p>Example:</p>
<div class="literallayout">
<p>
<code class="code">AbstractToken&nbsp;:<br>
&nbsp;&nbsp;(&nbsp;TokenA&nbsp;|<br>
&nbsp;&nbsp;&nbsp;&nbsp;TokenB&nbsp;|<br>
&nbsp;&nbsp;&nbsp;&nbsp;TokenC&nbsp;)&nbsp;(cardinality=('?'|'+'|'*'))?<br>
;<br>

<br>

</code>
</p>
</div>
<p>This way the &sbquo;cardinality&rsquo; is optional (last question mark) and can be represented by a question mark, a plus, or an asterisk. It will be assigned to either an EObject of type 
							<code class="code">TokenA</code>,  
							<code class="code">TokenB</code>, or 
							<code class="code">TokenC</code> which are all subtypes of 
							<code class="code">AbstractToken</code>. The rule in this example will never create an instance of 
							<code class="code">AbstractToken</code> directly.
						</p>
</div>
<div class="section" title="Assigned Actions">
<div class="titlepage">
<div>
<div>
<h5 class="title">
<a name="grammarActions"></a>Assigned Actions </h5>
</div>
</div>
</div>
<p>LL parsing has some significant advantages over LR algorithms. The most important ones for Xtext are, that the generated code is much simpler to understand and debug and that it is easier to recover from errors. Especially ANTLR has a very nice generic error recovery mechanism. This allows to construct an AST even if there are syntactic errors in the text. You wouldn&rsquo;t get any of the nice IDE features as soon as there is one little error, if we hadn&rsquo;t error recovery.</p>
<p>However, LL also has some drawbacks. The most important one is that it does not allow left recursive grammars.
							For instance, the following is not allowed in LL based grammars, because &bdquo;Expression '+' Expression&rdquo; is left recursive:</p>
<div class="literallayout">
<p>
<code class="code">Expression&nbsp;:<br>
&nbsp;&nbsp;Expression&nbsp;'+'&nbsp;Expression&nbsp;|<br>
&nbsp;&nbsp;'('&nbsp;Expression&nbsp;')'&nbsp;|<br>
&nbsp;&nbsp;INT<br>
;<br>

<br>

</code>
</p>
</div>
<p>Instead one has to rewrite such things by &bdquo;left-factoring&rdquo; it:</p>
<div class="literallayout">
<p>
<code class="code">Expression&nbsp;:<br>
&nbsp;&nbsp;TerminalExpression&nbsp;('+'&nbsp;TerminalExpression)?<br>
;<br>
&nbsp;<br>
TerminalExpression&nbsp;:<br>
&nbsp;&nbsp;'('&nbsp;Expression&nbsp;')'&nbsp;|<br>
&nbsp;&nbsp;INT<br>
;<br>

<br>

</code>
</p>
</div>
<p>In practice this is always the same pattern and therefore not that problematic. 
							However, by simply applying the Xtext AST construction features we&rsquo;ve covered so far, a grammar ...</p>
<div class="literallayout">
<p>
<code class="code">Expression&nbsp;:<br>
&nbsp;&nbsp;{Operation}&nbsp;left=TerminalExpression&nbsp;(op='+'&nbsp;right=TerminalExpression)?<br>
;<br>
&nbsp;<br>
TerminalExpression&nbsp;returns&nbsp;Expression:<br>
&nbsp;&nbsp;'('&nbsp;Expression&nbsp;')'&nbsp;|<br>
&nbsp;&nbsp;{IntLiteral}&nbsp;value=INT<br>
;<br>

<br>

</code>
</p>
</div>
<p>... would result in unwanted elements in the AST.
							For instance the expression &bdquo; ( 42 ) &rdquo; would result in a tree like this:</p>
<div class="literallayout">
<p>
<code class="code">Operation&nbsp;{<br>
&nbsp;&nbsp;left=Operation&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;left=IntLiteral&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;value=42<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;}<br>
}<br>

<br>

</code>
</p>
</div>
<p>Typically one would only want to have one instance of 
							<code class="code">IntLiteral</code> instead.
						</p>
<p>One can solve this problem using a combination of unassigned rule calls and assigned actions:</p>
<div class="literallayout">
<p>
<code class="code">Expression&nbsp;:<br>
&nbsp;&nbsp;TerminalExpression&nbsp;({Operation.left=current}&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;op='+'&nbsp;right=Expression)?<br>
;<br>
&nbsp;<br>
TerminalExpression&nbsp;returns&nbsp;Expression:<br>
&nbsp;&nbsp;'('&nbsp;Expression&nbsp;')'&nbsp;|<br>
&nbsp;&nbsp;{IntLiteral}&nbsp;value=INT<br>
;<br>

<br>

</code>
</p>
</div>
<p>In the example above 
							<code class="code">{Operation.left=current}</code> is a so called tree rewrite action, which creates a new instance of the stated EClass (Operation in this case) and assigns the element currently to-be-returned (
							<code class="code">current</code> variable) to a feature of the newly created object (in this case feature &sbquo;left&rsquo; of the Operation instance).
							In Java these semantics could be expressed as:
						</p>
<div class="literallayout">
<p>
<code class="code">Operation&nbsp;temp&nbsp;=&nbsp;new&nbsp;Operation();<br>
temp.setLeft(current);<br>
current&nbsp;=&nbsp;temp;<br>

<br>
h3.(#hidden_terminals)&nbsp;Hidden&nbsp;terminal&nbsp;symbols<br>

<br>
Because&nbsp;parser&nbsp;rules&nbsp;describe&nbsp;not&nbsp;a&nbsp;single&nbsp;token,&nbsp;but&nbsp;a&nbsp;sequence&nbsp;of&nbsp;patterns&nbsp;in&nbsp;the&nbsp;input,&nbsp;it&nbsp;is&nbsp;necessary&nbsp;to&nbsp;define&nbsp;the&nbsp;interesting&nbsp;parts&nbsp;of&nbsp;the&nbsp;input.&nbsp;Xtext&nbsp;introduces&nbsp;the&nbsp;concept&nbsp;of&nbsp;hidden&nbsp;tokens&nbsp;to&nbsp;handle&nbsp;semantically&nbsp;unimportant&nbsp;things&nbsp;like&nbsp;whitespaces,&nbsp;comments,&nbsp;etc.&nbsp;in&nbsp;the&nbsp;input&nbsp;sequence&nbsp;gracefully.&nbsp;It&nbsp;is&nbsp;possible&nbsp;to&nbsp;define&nbsp;a&nbsp;set&nbsp;of&nbsp;terminal&nbsp;symbols,&nbsp;that&nbsp;are&nbsp;hidden&nbsp;from&nbsp;the&nbsp;parser&nbsp;rules&nbsp;and&nbsp;automatically&nbsp;skipped&nbsp;when&nbsp;they&nbsp;are&nbsp;recognized.&nbsp;Nevertheless,&nbsp;they&nbsp;are&nbsp;transparently&nbsp;woven&nbsp;into&nbsp;the&nbsp;node&nbsp;model,&nbsp;but&nbsp;not&nbsp;relevant&nbsp;for&nbsp;the&nbsp;semantic&nbsp;model.&nbsp;<br>

<br>
Hidden&nbsp;terminals&nbsp;may&nbsp;(or&nbsp;may&nbsp;not)&nbsp;appear&nbsp;between&nbsp;any&nbsp;other&nbsp;terminals&nbsp;in&nbsp;any&nbsp;cardinality.&nbsp;They&nbsp;can&nbsp;be&nbsp;described&nbsp;per&nbsp;rule&nbsp;or&nbsp;for&nbsp;the&nbsp;whole&nbsp;grammar.&nbsp;When&nbsp;"reusing&nbsp;a&nbsp;single&nbsp;grammar":#grammarMixins&nbsp;its&nbsp;definition&nbsp;of&nbsp;hidden&nbsp;tokens&nbsp;is&nbsp;reused&nbsp;as&nbsp;well.&nbsp;The&nbsp;grammar&nbsp;@org.eclipse.xtext.common.Terminals@&nbsp;comes&nbsp;with&nbsp;a&nbsp;reasonable&nbsp;default&nbsp;and&nbsp;hides&nbsp;all&nbsp;comments&nbsp;and&nbsp;whitespace&nbsp;from&nbsp;the&nbsp;parser&nbsp;rules.<br>

<br>
If&nbsp;a&nbsp;rule&nbsp;defines&nbsp;hidden&nbsp;symbols,&nbsp;you&nbsp;can&nbsp;think&nbsp;of&nbsp;a&nbsp;kind&nbsp;of&nbsp;scope&nbsp;that&nbsp;is&nbsp;automatically&nbsp;introduced.&nbsp;Any&nbsp;rule&nbsp;that&nbsp;is&nbsp;called&nbsp;from&nbsp;the&nbsp;declaring&nbsp;rule&nbsp;uses&nbsp;the&nbsp;same&nbsp;hidden&nbsp;terminals&nbsp;as&nbsp;the&nbsp;calling&nbsp;rule,&nbsp;unless&nbsp;it&nbsp;defines&nbsp;other&nbsp;hidden&nbsp;tokens&nbsp;itself.<br>
&nbsp;&nbsp;<br>

</code>
</p>
</div>
<div class="literallayout">
<p>
<code class="code">Person&nbsp;hidden(WS,&nbsp;ML_COMMENT,&nbsp;SL_COMMENT):&nbsp;<br>
&nbsp;&nbsp;name=Fullname&nbsp;age=INT&nbsp;';'<br>
;<br>

<br>
Fullname:&nbsp;<br>
&nbsp;&nbsp;(firstname=ID)?&nbsp;lastname=ID<br>
;<br>

<br>

</code>
</p>
</div>
<p>The sample rule &bdquo;Person&rdquo; defines multiline comments (ML_COMMENT), single-line comments (SL_COMMENT), and whitespace (WS) to be allowed between the &sbquo;Fullname&rsquo; and the &sbquo;age&rsquo;. Because the rule &sbquo;Fullname&rsquo; does not introduce another set of hidden terminals, it allows the same symbols to appear between &sbquo;firstname&rsquo; and &sbquo;lastname&rsquo; as the calling rule &sbquo;Person&rsquo;. Thus, the following input is perfectly valid for the given grammar snippet:</p>
<div class="literallayout">
<p>
<code class="code">John&nbsp;/*&nbsp;comment&nbsp;*/&nbsp;Smith&nbsp;//&nbsp;line&nbsp;comment<br>
/*&nbsp;comment&nbsp;*/<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;42&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;//&nbsp;line&nbsp;comment<br>

<br>

</code>
</p>
</div>
<p>A list of all default terminals like WS can be found in section 
							<a class="link" href="#grammarMixins" title="Grammar Mixins">Grammar Mixins</a>.
						</p>
</div>
</div>
</div>
<div class="section" title="Data type rules">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="datatypeRules"></a>Data type rules</h3>
</div>
</div>
</div>
<p>Data type rules are parsing-phase rules, which create instances of EDataType instead of EClass. Thinking about it, one may discover that they are quite similar to terminal rules.
					However, the nice thing about data type rules is that they are actually parser rules and are therefore </p>
<div class="orderedlist">
<ol class="orderedlist" type="1">
<li class="listitem">
<p>context sensitive and </p>
</li>
<li class="listitem">
<p>allow for use of hidden tokens.</p>
</li>
</ol>
</div>
<p>If you, for instance, want to define a rule to consume Java-like qualified names (e.g. &bdquo;foo.bar.Baz&rdquo;)
					you could write:</p>
<div class="literallayout">
<p>
<code class="code">QualifiedName&nbsp;:<br>
&nbsp;&nbsp;ID&nbsp;('.'&nbsp;ID)*<br>
;<br>

<br>

</code>
</p>
</div>
<p>This looks similar to the terminal rule we&rsquo;ve defined above in order to explain rule calls.
					However, the difference is that because it is a parser rule and therefore only valid in certain contexts, it won&rsquo;t conflict with the rule ID.
					If you had defined it as a terminal rule, it would possibly hide the ID rule.</p>
<p>In addition when this has been defined as a data type rule, it is allowed to use hidden tokens (e.g. &bdquo;/* comment **/&rdquo;) between the IDs and dots (e.g. 
					<code class="code">foo/* comment */. bar . Baz"</code>)
				</p>
<p>Return types can be specified in the same way as in terminal rules:</p>
<div class="literallayout">
<p>
<code class="code">QualifiedName&nbsp;returns&nbsp;ecore::EString&nbsp;:&nbsp;<br>
&nbsp;&nbsp;ID&nbsp;('.'&nbsp;ID)*<br>
;<br>

<br>

</code>
</p>
</div>
<p>Note that if a rule does not call another parser rule and does neither contain any actions nor 
					<a class="link" href="#assignments" title="Assignments">assignments</a>, it is considered to be a data type rule and the data type EString is implied if none has been explicitly declared.
				</p>
<p>For conversion again value converters are responsible (cf. 
					<a class="link" href="#valueconverter" title="Value Converter">value converters</a>).
				</p>
</div>
<div class="section" title="Enum Rules">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="EnumRules"></a>Enum Rules</h3>
</div>
</div>
</div>
<p>Enum rules return enumeration literals from strings. They can be seen as a shortcut for data type rules with specific value converters.
					The main advantage of enum rules is their simplicity, type safety and therefore nice validation. Furthermore it is possible to infer enums and their respective literals during the Ecore model transformation.</p>
<p>If you want to define a ChangeKind 
					<a class="ulink" href="http://help.eclipse.org/stable/index.jsp?topic=/org.eclipse.emf.doc/references/javadoc/org/eclipse/emf/ecore/change/impl/package-summary.html" target="_new">org.eclipse.emf.ecore.change/model/Change.ecore</a> with &sbquo;ADD&rsquo;, &sbquo;MOVE&rsquo; and &sbquo;REMOVE&rsquo; you could write:
				</p>
<div class="literallayout">
<p>
<code class="code">enum&nbsp;ChangeKind&nbsp;:<br>
&nbsp;&nbsp;ADD&nbsp;|&nbsp;MOVE&nbsp;|&nbsp;REMOVE<br>
;<br>

<br>

</code>
</p>
</div>
<p>It is even possible to use alternative literals for your enums or reference an enum value twice:</p>
<div class="literallayout">
<p>
<code class="code">enum&nbsp;ChangeKind&nbsp;:<br>
&nbsp;&nbsp;ADD&nbsp;=&nbsp;'add'&nbsp;|&nbsp;ADD&nbsp;=&nbsp;'+'&nbsp;|&nbsp;<br>
&nbsp;&nbsp;MOVE&nbsp;=&nbsp;'move'&nbsp;|&nbsp;MOVE&nbsp;=&nbsp;'-&gt;'&nbsp;|&nbsp;<br>
&nbsp;&nbsp;REMOVE&nbsp;=&nbsp;'remove'&nbsp;|&nbsp;REMOVE&nbsp;=&nbsp;'-'<br>
;<br>

<br>

</code>
</p>
</div>
<p>Please note, that Ecore does not support unset values for enums. If you formulate a grammar like</p>
<div class="literallayout">
<p>
<code class="code">Element:&nbsp;"element"&nbsp;name=ID&nbsp;(value=SomeEnum)?;<br>

</code>
</p>
</div>
<p>with the input of</p>
<div class="literallayout">
<p>
<code class="code">element&nbsp;Foo<br>

</code>
</p>
</div>
<p>the resulting value of the element 
					<code class="code">Foo</code> will hold the enum value with the internal representation of &sbquo;0&rsquo; (zero). When generating the EPackage from your grammar this will be the first literal you define. As a workaround you could introduce a dedicated none-value or order the enums accordingly. Note that it is not possible to define an enum literal with an empty textual representation.
				</p>
<div class="literallayout">
<p>
<code class="code">enum&nbsp;Visibility:&nbsp;<br>
&nbsp;&nbsp;package&nbsp;|&nbsp;private&nbsp;|&nbsp;protected&nbsp;|&nbsp;public<br>
;<br>
&nbsp;<br>

</code>
</p>
</div>
<p>You can overcome this by modifying the infered Ecore model through a 
					<a class="link" href="#customPostProcessing" title="Customized Post Processing">model to model transformation</a>.
				</p>
</div>
</div>
<div class="section" title="Ecore model inference">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="metamodelInference"></a>Ecore model inference</h2>
</div>
</div>
</div>
<p>The Ecore model (or meta model) of a textual language describes the structure of its abstract syntax trees (AST). </p>
<p>Xtext uses Ecore&rsquo;s EPackages to define Ecore models. Ecore models are declared to be either inferred (generated) from the grammar or imported. 
				By using the &sbquo;generate&rsquo; directive, one tells Xtext to derive an EPackage from the grammar. </p>
<div class="section" title="Type and Package Generation">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="TypeandPackageGeneration"></a>Type and Package Generation</h3>
</div>
</div>
</div>
<p>Xtext creates</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>an EPackage</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="circle">
<li class="listitem">
<p>for each generate-package declaration. After the directive &sbquo;generate&rsquo; a list of parameters follows. The &sbquo;name&rsquo; of the EPackage will be set to the first parameter, its &sbquo;nsURI&rsquo; to the second parameter. An optional alias as the third parameter allows to distinguish generated EPackages later. Only one generated package declaration per alias is allowed.</p>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>an EClass</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="circle">
<li class="listitem">
<p>for each return type of a parser rule. If a parser rule does not define a return type, an implicit one with the same name as the rule itself is assumed. You can specify more than one rule that return the same type but only one EClass will be generated.</p>
</li>
<li class="listitem">
<p>for each type defined in an action or a cross reference.</p>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>an EEnum</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="circle">
<li class="listitem">
<p>for each return type of an enum rule.</p>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>an EDatatype</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="circle">
<li class="listitem">
<p>for each return type of a terminal rule or a data type rule.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<p>All EClasses, EEnums and EDatatypes are added to the EPackage referred to by the alias provided in the type reference they were created from.</p>
</div>
<div class="section" title="Feature and Type Hierarchy Generation">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="FeatureandTypeHierarchyGeneration"></a>Feature and Type Hierarchy Generation</h3>
</div>
</div>
</div>
<p>While walking through the grammar, the algorithm keeps track of a set of the currently possible return types to add features to. </p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>Entering a parser rule the set contains only the return type of the rule. </p>
</li>
<li class="listitem">
<p>Entering a group in an alternative the set is reset to the same state it was in when entering the first group of this alternative. </p>
</li>
<li class="listitem">
<p>Leaving an alternative the set contains the union of all types at the end of each of its groups.</p>
</li>
<li class="listitem">
<p>After an optional element, the set is reset to the same state it was before entering it. </p>
</li>
<li class="listitem">
<p>After a mandatory (non-optional) rule call or mandatory action the set contains only the return type of the called rule or action. </p>
</li>
<li class="listitem">
<p>An optional rule call does not modify the set.</p>
</li>
<li class="listitem">
<p>A rule call is optional, if its cardinality is &sbquo;?&rsquo; or &sbquo;*&rsquo;.</p>
</li>
</ul>
</div>
<p>While iterating the parser rules Xtext creates</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>an EAttribute in each current return type</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="circle">
<li class="listitem">
<p>of type EBoolean for each feature assignment using the &sbquo;?=&rsquo; operator. No further EReferences or EAttributes will be generated from this assignment.</p>
</li>
<li class="listitem">
<p>for each assignment with the &sbquo;=&rsquo; or &sbquo;+=&rsquo; operator calling a terminal rule. Its type will be the return type of the called rule.</p>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>an EReference in each current return type</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="circle">
<li class="listitem">
<p>for each assignment with the &sbquo;=&rsquo; or &sbquo;+=&rsquo; operator in a parser rule calling a parser rule. The EReference&rsquo;s type will be the return type of the called parser rule.</p>
</li>
<li class="listitem">
<p>for each assigned action. The reference&rsquo;s type will be set to the return type of the current calling rule. </p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<p>Each EAttribute or EReference takes its name from the assignment or action that caused it. Multiplicities will be 0...1 for assignments with the &sbquo;=&rsquo; operator and 0...* for assignments with the &sbquo;+=&rsquo; operator. </p>
<p>Furthermore, each type that is added to the currently possible return types automatically extends the current return type of the parser rule. You can specify additional common super types by means of &bdquo;artificial&rdquo; parser rules, that are never called, e.g.</p>
<div class="literallayout">
<p>
<code class="code">CommonSuperType:<br>
&nbsp;&nbsp;SubTypeA&nbsp;|&nbsp;SubTypeB&nbsp;|&nbsp;SubTypeC;<br>

<br>

</code>
</p>
</div>
</div>
<div class="section" title="Enum Literal Generation">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="EnumLiteralGeneration"></a>Enum Literal Generation</h3>
</div>
</div>
</div>
<p>For each alternative defined in an enum rule, the transformer creates an enum literal, when another literal with the same name cannot be found. The &sbquo;literal&rsquo; property of the generated enum literal is set to the right hand side of the declaration. If it is omitted, you will get an enum literal with equal &sbquo;name&rsquo; and &sbquo;literal&rsquo; attributes.</p>
<div class="literallayout">
<p>
<code class="code">enum&nbsp;MyGeneratedEnum:<br>
&nbsp;&nbsp;NAME&nbsp;=&nbsp;'literal'&nbsp;|&nbsp;EQUAL_NAME_AND_LITERAL;<br>

<br>

</code>
</p>
</div>
</div>
<div class="section" title="Feature Normalization">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="FeatureNormalization"></a>Feature Normalization</h3>
</div>
</div>
</div>
<p>In the next step the generator examines all generated EClasses and lifts up similar features to super types if there is more than one subtype and the feature is defined in every subtypes. This does even work for multiple super types.</p>
</div>
<div class="section" title="Customized Post Processing">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="customPostProcessing"></a>Customized Post Processing</h3>
</div>
</div>
</div>
<p>As a last step, the generator invokes the post processor for every generated Ecore model. The post processor expects an Xtend file with name 
					<code class="code">&lt;MyDsl&gt;PostProcessor.ext</code> (if the name of the grammar file is 
					<code class="code">MyDsl.xtext</code>) in the same folder as the grammar file. Further, for a successful invocation, the Xtend file must declare an extension with signature 
					<code class="code">process(xtext::GeneratedMetamodel)</code>. E.g.
				</p>
<div class="literallayout">
<p>
<code class="code">process(xtext::GeneratedMetamodel&nbsp;this)&nbsp;:<br>
&nbsp;&nbsp;process(ePackage)<br>
;<br>
&nbsp;<br>
process(ecore::EPackage&nbsp;this)&nbsp;:<br>
&nbsp;&nbsp;...&nbsp;do&nbsp;something<br>
;<br>

<br>

</code>
</p>
</div>
<p>The invoked extension can then augment the generated Ecore model in place. Some typical use cases are to:</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>set default values for attributes,</p>
</li>
<li class="listitem">
<p>add container references as opposites of existing containment references, or</p>
</li>
<li class="listitem">
<p>add operations with implementation using a body annotation.</p>
</li>
</ul>
</div>
<p>Great care must be taken to not modify the Ecore model in a way preventing the Xtext parser from working correctly (e.g. removing or renaming model elements).</p>
</div>
<div class="section" title="Error Conditions">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="ErrorConditions"></a>Error Conditions</h3>
</div>
</div>
</div>
<p>The following conditions cause an error</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>An EAttribute or EReference has two different types or different cardinality.</p>
</li>
<li class="listitem">
<p>There is an EAttribute and an EReference with the same name in the same EClass.</p>
</li>
<li class="listitem">
<p>There is a cycle in the type hierarchy.</p>
</li>
<li class="listitem">
<p>An new EAttribute, EReference or super type is added to an imported type.</p>
</li>
<li class="listitem">
<p>An EClass is added to an imported EPackage.</p>
</li>
<li class="listitem">
<p>An undeclared alias is used. </p>
</li>
<li class="listitem">
<p>An imported Ecore model cannot be loaded.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="section" title="Importing existing Ecore models">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="grammarImport"></a>Importing existing Ecore models</h2>
</div>
</div>
</div>
<p>With the import directive in Xtext you can refer to existing Ecore models and reuse the types that are declared in an EPackage. Xtext uses this technique itself to leverage Ecore data types.</p>
<div class="literallayout">
<p>
<code class="code">import&nbsp;'http://www.eclipse.org/emf/2002/Ecore'&nbsp;as&nbsp;ecore<br>

</code>
</p>
</div>
<p>Specify an explicit return type to reuse such imported types. Note that this even works for terminal rules.</p>
<div class="literallayout">
<p>
<code class="code">terminal&nbsp;INT&nbsp;returns&nbsp;ecore::EInt&nbsp;:&nbsp;('0'..'9')+;<br>

</code>
</p>
</div>
</div>
<div class="section" title="Grammar Mixins">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="grammarMixins"></a>Grammar Mixins</h2>
</div>
</div>
</div>
<p>Xtext supports the reuse of existing grammars. Grammars that are created via the Xtext wizard use 
				<code class="code">org.eclipse.xtext.common.Terminals</code> by default which introduces a common set of terminal rules and defines reasonable defaults for hidden terminals.
			</p>
<div class="literallayout">
<p>
<code class="code">grammar&nbsp;org.xtext.example.MyDsl&nbsp;with&nbsp;org.eclipse.xtext.common.Terminals<br>
&nbsp;<br>
generate&nbsp;myDsl&nbsp;'http://www.xtext.org/example/MyDsl'<br>
&nbsp;<br>
...&nbsp;some&nbsp;rules<br>

<br>

</code>
</p>
</div>
<p>Mixing in another grammar makes the rules defined in that grammar referable. It is also possible to overwrite rules from the used grammar. </p>
<p>Example :</p>
<div class="literallayout">
<p>
<code class="code">grammar&nbsp;my.SuperGrammar<br>
...<br>
RuleA&nbsp;:&nbsp;"a"&nbsp;stuff=RuleB;<br>
RuleB&nbsp;:&nbsp;"{"&nbsp;name=ID&nbsp;"}";<br>

<br>
grammar&nbsp;my.SubGrammar&nbsp;with&nbsp;my.SuperGrammar<br>

<br>
Model&nbsp;:&nbsp;(ruleAs+=RuleA)*;<br>

<br>
//&nbsp;overrides&nbsp;my.SuperGrammar.RuleB<br>
RuleB&nbsp;:&nbsp;'['&nbsp;name=ID&nbsp;']';<br>

<br>

</code>
</p>
</div>
<p>Note that declared terminal rules always get a higher priority then imported terminal rules.</p>
</div>
<div class="section" title="Default tokens">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="Defaulttokens"></a>Default tokens</h2>
</div>
</div>
</div>
<p>Xtext ships with a default set of predefined, reasonable and often required terminal rules. This grammar is defined as follows:</p>
<div class="literallayout">
<p>
<code class="code">grammar&nbsp;org.eclipse.xtext.common.Terminals&nbsp;<br>
&nbsp;&nbsp;hidden(WS,&nbsp;ML_COMMENT,&nbsp;SL_COMMENT)<br>

<br>
import&nbsp;"http://www.eclipse.org/emf/2002/Ecore"&nbsp;as&nbsp;ecore<br>

<br>
terminal&nbsp;ID&nbsp;:&nbsp;<br>
&nbsp;&nbsp;'^'?('a'..'z'|'A'..'Z'|'_')&nbsp;('a'..'z'|'A'..'Z'|'_'|'0'..'9')*&nbsp;;<br>
terminal&nbsp;INT&nbsp;returns&nbsp;ecore::EInt:&nbsp;('0'..'9')+&nbsp;;<br>
terminal&nbsp;STRING	:&nbsp;<br>
&nbsp;&nbsp;'"'&nbsp;(&nbsp;'\\'&nbsp;('b'|'t'|'n'|'f'|'r'|'"'|"'"|'\\')&nbsp;|&nbsp;!('\\'|'"')&nbsp;)*&nbsp;'"'&nbsp;|<br>
&nbsp;&nbsp;"'"&nbsp;(&nbsp;'\\'&nbsp;('b'|'t'|'n'|'f'|'r'|'"'|"'"|'\\')&nbsp;|&nbsp;!('\\'|"'")&nbsp;)*&nbsp;"'";&nbsp;<br>
terminal&nbsp;ML_COMMENT	:&nbsp;'/*'&nbsp;-&gt;&nbsp;'*/'&nbsp;;<br>
terminal&nbsp;SL_COMMENT&nbsp;	:&nbsp;'//'&nbsp;!('\n'|'\r')*&nbsp;('\r'?&nbsp;'\n')?&nbsp;;<br>
terminal&nbsp;WS		:&nbsp;('&nbsp;'|'\t'|'\r'|'\n')+&nbsp;;<br>
terminal&nbsp;ANY_OTHER:	.&nbsp;;<br>

</code>
</p>
</div>
</div>
</div>
<div class="chapter" title="Chapter&nbsp;5.&nbsp;Configuration">
<div class="titlepage">
<div>
<div>
<h2 class="title">
<a name="configuration"></a>Chapter&nbsp;5.&nbsp;Configuration</h2>
</div>
</div>
</div>
<div class="section" title="The Generator">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="generator"></a>The Generator</h2>
</div>
</div>
</div>
<p>Xtext provides lots of generic implementations for your language&rsquo;s
				infrastructure but also uses code generation to generate some of the 
				components. Those generated components are for instance the parser, the 
				serializer, the inferred Ecore model (if any) and a couple of convenient base classes for 
				content assist, etc.</p>
<p>The generator also contributes to shared project resources such as the 
				plugin.xml, Manifest.MF and the 
				<a class="link" href="#guicemodules" title="Modules">Guice modules</a>.
			</p>
<p>Xtext&rsquo;s generator leverages 
				<a class="ulink" href="http://www.eclipse.org/modeling/emft/?project=mwe" target="_new">MWE2 &ndash; the modeling workflow engine</a> from EMFT to configure the generator.
			</p>
<div class="section" title="A short introduction to MWE2">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="short_intro_to_mwe"></a>A short introduction to MWE2</h3>
</div>
</div>
</div>
<p>MWE2 allows to compose object graphs declaratively in a very compact manner. The nice thing about it is that it just instantiates Java classes and the configuration is done through public setter and adder methods as one is used to from Java Beans encapsulation principles. An in-depth documentation can be found in the chapter &bdquo;MWE2&rdquo;#MWE2.</p>
<p>Given the following simple Java class (POJO):</p>
<div class="literallayout">
<p>
<code class="code">package&nbsp;com.mycompany;<br>
&nbsp;&nbsp;<br>
public&nbsp;class&nbsp;Person&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;private&nbsp;String&nbsp;name;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;public&nbsp;void&nbsp;setName(String&nbsp;name)&nbsp;{&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;this.name&nbsp;=&nbsp;name;<br>
&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;private&nbsp;final&nbsp;List&lt;Person&gt;&nbsp;children&nbsp;=&nbsp;new&nbsp;ArrayList&lt;Person&gt;();<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;public&nbsp;void&nbsp;addChild(Person&nbsp;child)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;this.children.add(child);<br>
&nbsp;&nbsp;}<br>
}<br>
&nbsp;&nbsp;<br>

</code>
</p>
</div>
<p>One can create a family tree with MWE2 easily by describing it in a declarative manner without writing a single line of Java code and without the need to compile classes:</p>
<div class="literallayout">
<p>
<code class="code">module&nbsp;com.mycompany.CreatePersons<br>

<br>
Person&nbsp;{<br>
	name&nbsp;=&nbsp;"Grandpa"<br>
	child&nbsp;=&nbsp;com.mycompany.Person&nbsp;{<br>
		name&nbsp;=&nbsp;"Father"<br>
		child&nbsp;=&nbsp;{<br>
			name&nbsp;=&nbsp;"Son"<br>
		}<br>
	}<br>
}<br>

<br>

</code>
</p>
</div>
<p>These couple of lines will, when interpreted by MWE2, result in an 
					object tree consisting of three instances of 
					<code class="code">com.mycompany.Person</code>.
					The interpreter will basically do the same as the following 
					<code class="code">main</code> method: 
				</p>
<div class="literallayout">
<p>
<code class="code">package&nbsp;com.mycompany;<br>

<br>
public&nbsp;class&nbsp;CreatePersons&nbsp;{<br>
	public&nbsp;static&nbsp;void&nbsp;main(String[]&nbsp;args)&nbsp;{<br>
		Person&nbsp;grandpa&nbsp;=&nbsp;new&nbsp;Person();<br>
		grandpa.setName("Grandpa");<br>
		Person&nbsp;father&nbsp;=&nbsp;new&nbsp;Person();<br>
		father.setName("Father");<br>
		grandpa.addChild(father);<br>
		Person&nbsp;son&nbsp;=&nbsp;new&nbsp;Person();<br>
		son.setName("Son");<br>
		father.addChild(son);<br>
	}<br>
}<br>

<br>

</code>
</p>
</div>
<p>
					
</p>
<div class="mediaobject">
<img src="images/family_tree.png"></div>
<p> 
				
</p>
<p>The root element is a class-name following the Java class-path visibility rules. As the module is a sibling to the class

					<code class="code">com.mycompany.Person</code> it is not necessary to use use fully qualified name. There are other packages implicitly imported
					into this workflow as well to make it convenient to instantiate actual workflows and components, but these ones are covered 
					in depth in the appropriate 
					<a class="link" href="#MWE2" title="Chapter&nbsp;7.&nbsp;MWE2">chapther</a>. The constructed objects are furthermore configured according to the declaration 
					in the module, e.g. a second instance of Person will be created and added to the list of children of &bdquo;Grandpa&rdquo; while the third person 
					- the class is inferred from the assigned feature &ndash; becomes a child of &bdquo;Father&rdquo;. All three instances will have their respective 
					<code class="code">name</code>
					assigned via a reflective invocation 
					<code class="code">setName</code>. If one wants to add another child to &bdquo;Father&rdquo;, she
					can simply repeat the child assignment:
				</p>
<div class="literallayout">
<p>
<code class="code">child&nbsp;=&nbsp;com.mycompany.Person&nbsp;{<br>
	name&nbsp;=&nbsp;"Father"<br>
	child&nbsp;=&nbsp;{<br>
&nbsp;&nbsp;	name&nbsp;=&nbsp;"Son"<br>
	}<br>
	child&nbsp;=&nbsp;{<br>
		name&nbsp;=&nbsp;..<br>
	}<br>
}<br>

<br>

</code>
</p>
</div>
<p>As you can see in the example above MWE2 can be used to instantiate arbitrary Java object models without any depedency or
					limitation to MWE2 specific implementations. This is 
					conceptually very close to the dependency injection mechanism and the XML language 
					in the 
					<a class="ulink" href="http://www.springframework.org" target="_new">Spring Framework</a>. 
				</p>
<p>
					
<span class="bold"><strong>Tip</strong></span>

					<span class="italic">Whenever you are in an *.mwe2 file and wonder what kind of configuration the underlying component may accept: Just use the Content Assist in the MWE2 Editor or navigate directly to the declaration of the underlying Java implemenation by means of F3 (Go To Declaration).</span>
				
</p>
<p>This is the basic idea of the MWE2 language. There are of course a couple of additional concepts and features in the language and we also have not yet talked about the runtime workflow model. Please refer to the dedicated MWE2 
					<a class="link" href="#MWE2" title="Chapter&nbsp;7.&nbsp;MWE2">reference documentation</a> for additional information.
				</p>
</div>
<div class="section" title="General Architecture">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="GeneralArchitecture"></a>General Architecture </h3>
</div>
</div>
</div>
<p>Now that you know a bit about MWE2, you are ready to learn about the concepts and architecture of Xtext&rsquo;s language generator. 
					An instance of Xtext&rsquo;s generator is configured with general information about source folders and projects and consists of any number of language configurations. 
					For each language configuration a URI pointing to its grammar file and the file extensions for the DSL must be provided. 
					In addition, a language is configured with a list of 
					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.generator/src/org/eclipse/xtext/generator/IGeneratorFragment.java?root=Modeling_Project&view=co" target="_new">IGeneratorFragment</a>s.
					The whole generator is composed of theses fragments. We have fragments for generating parsers, the serializer, the EMF code, the outline view, etc.

					</p>
<div class="mediaobject">
<img src="images/generator-structure.png"></div>
<p>
				
</p>
<div class="section" title="Generator Fragments">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="generator_fragment"></a>Generator Fragments</h4>
</div>
</div>
</div>
<p>Each fragment gets the grammar of the language as an EMF model passed in. A fragment is able to generate code in one of the configured locations and contribute to several shared artifacts. The main interface 
						<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.generator/src/org/eclipse/xtext/generator/IGeneratorFragment.java?root=Modeling_Project&view=co" target="_new">IGeneratorFragment</a> is supported by a convenient abstract base class 
						<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.generator/src/org/eclipse/xtext/generator/AbstractGeneratorFragment.java?root=Modeling_Project&view=co" target="_new">AbstractGeneratorFragment</a>, which by default delegates to an Xpand template with the same qualified name as the class and delegates some of the calls to Xpand template definitions.
					</p>
<p>We suggest to have a look at the fragment we have written for label providers (
						<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.generator/src/org/eclipse/xtext/ui/generator/labeling/LabelProviderFragment.java?root=Modeling_Project&view=co" target="_new">LabelProviderFragment</a>). It is pretty trivial and at the same time uses the most important call backs. In addition, the structure is not cluttered with too much extra noise so that the whole package can serve as a template to write your own fragment.
					</p>
</div>
<div class="section" title="Configuration">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="Configuration"></a>Configuration</h4>
</div>
</div>
</div>
<p>As already explained we use MWE2 from EMFT in order to instantiate, configure and execute this structure of components. 
						In the following we see an exemplary Xtext generator configuration written in MWE2 configuration code:  </p>
<div class="literallayout">
<p>
<code class="code">module&nbsp;org.xtext.example.MyDsl<br>

<br>
import&nbsp;org.eclipse.emf.mwe.utils.*<br>
import&nbsp;org.eclipse.xtext.generator.*<br>
import&nbsp;org.eclipse.xtext.ui.generator.*<br>

<br>
var&nbsp;grammarURI&nbsp;=&nbsp;"classpath:/org/xtext/example/MyDsl.xtext"<br>
var&nbsp;file.extensions&nbsp;=&nbsp;"mydsl"<br>
var&nbsp;projectName&nbsp;=&nbsp;"org.xtext.example.mydsl"<br>
var&nbsp;runtimeProject&nbsp;=&nbsp;"../${projectName}"<br>

<br>
Workflow&nbsp;{<br>
	bean&nbsp;=&nbsp;StandaloneSetup&nbsp;{<br>
		platformUri&nbsp;=&nbsp;"${runtimeProject}/.."<br>
	}<br>

<br>
	component&nbsp;=&nbsp;DirectoryCleaner&nbsp;{<br>
		directory&nbsp;=&nbsp;"${runtimeProject}/src-gen"<br>
	}<br>

<br>
	component&nbsp;=&nbsp;DirectoryCleaner&nbsp;{<br>
		directory&nbsp;=&nbsp;"${runtimeProject}.ui/src-gen"<br>
	}<br>

<br>
	component&nbsp;=&nbsp;Generator&nbsp;{<br>
		pathRtProject&nbsp;=&nbsp;runtimeProject<br>
		pathUiProject&nbsp;=&nbsp;"${runtimeProject}.ui"<br>
		projectNameRt&nbsp;=&nbsp;projectName<br>
		projectNameUi&nbsp;=&nbsp;"${projectName}.ui"<br>

<br>
		language&nbsp;=&nbsp;{<br>
			uri&nbsp;=&nbsp;grammarURI<br>
			fileExtensions&nbsp;=&nbsp;file.extensions<br>

<br>
			//&nbsp;Java&nbsp;API&nbsp;to&nbsp;access&nbsp;grammar&nbsp;elements&nbsp;(required&nbsp;by&nbsp;several&nbsp;other&nbsp;fragments)<br>
			fragment&nbsp;=&nbsp;grammarAccess.GrammarAccessFragment&nbsp;{}<br>

<br>
			/*&nbsp;more&nbsp;fragments&nbsp;to&nbsp;configure&nbsp;the&nbsp;language&nbsp;*/<br>
			...<br>
		}<br>
	}<br>
}<br>

<br>

</code>
</p>
</div>
<p>Here the root element is 
						<code class="code">Workflow</code> which accepts 
						<span class="italic">bean</span> s and 
						<span class="italic">component</span> s. The 
						<code class="code">var</code> declaration is a 
						first class concept of MWE2&rsquo;s configuration language and defines the interface of the module. They allow to externalize
						some common configuration parameters. This comes especially handy in String variables where one can easily use 

						<code class="code">${variable}</code> to concatenate values. 
					</p>
<p>The method 
						<code class="code">Workflow.addBean(Object)</code> does nothing but provides a means to apply global side-effects, which 
						unfortunately is required by some projects. In this example we do a so called 
						<span class="italic">EMF stand-alone setup</span>. This class 
						initializes a bunch of things for a non-OSGi environment that are otherwise configured by means of extension points, 
						e.g. it allows to populate EMF&rsquo;s singletons like the 
						<code class="code">EPackage.Registry</code>.
					</p>
<p>Following the 
						<code class="code">bean</code> assignment there are three 
						<code class="code">component</code> elements. The 
						<code class="code">Workflow.addComponent()</code> method 
						accepts instances of 
						<code class="code">IWorkflowComponent</code>, which is the primary concept of MWE2&rsquo;s workflow model. Xtext&rsquo;s generator 
						itself is an instance of 
						<code class="code">IWorkflowComponent</code> and can therefore be used within MWE2 workflows. 
					</p>
</div>
</div>
<div class="section" title="Standard generator fragments">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="Standardgeneratorfragments"></a>Standard generator fragments</h3>
</div>
</div>
</div>
<p>In the following table the most important standard generator fragments are listed. Please refer to the Javadocs for more detailed documentation.</p>
<table id="N10974">
<tr>
						
<th>Class</th>
						<th>Generated Artifacts</th>
						<th>Related Documentation</th>
					
</tr>
<tr>
						
<td>
							<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.generator/src/org/eclipse/xtext/generator/ecore/EcoreGeneratorFragment.java?root=Modeling_Project&view=co" target="_new">EcoreGeneratorFragment</a>
						</td>
						<td>EMF code for generated models</td>
						<td>
							<a class="link" href="#metamodelInference" title="Ecore model inference">Model inference</a>
						</td>
					
</tr>
<tr>
						
<td>XtextAntlrGeneratorFragment</td>
						<td>ANTLR grammar, parser, lexer and related services</td>
					
</tr>
<tr>
						
<td>
							<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.generator/src/org/eclipse/xtext/generator/grammarAccess/GrammarAccessFragment.java?root=Modeling_Project&view=co" target="_new">GrammarAccessFragment</a>
						</td>
						<td>Access to the grammar</td>
					
</tr>
<tr>
						
<td>
							<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.generator/src/org/eclipse/xtext/generator/resourceFactory/ResourceFactoryFragment.java?root=Modeling_Project&view=co" target="_new">ResourceFactoryFragment</a>
						</td>
						<td>EMF resource factory</td>
					
</tr>
<tr>
						
<td>
							<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.generator/src/org/eclipse/xtext/generator/parseTreeConstructor/ParseTreeConstructorFragment.java?root=Modeling_Project&view=co" target="_new">ParseTreeConstructorFragment</a>
						</td>
						<td>Model-to-text serialization</td>
						<td>
							<a class="link" href="#serialization" title="Serialization">Serialization</a>
						</td>
					
</tr>
<tr>
						
<td>
							<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.generator/src/org/eclipse/xtext/generator/scoping/JavaScopingFragment.java?root=Modeling_Project&view=co" target="_new">JavaScopingFragment</a>
						</td>
						<td>Java-based scoping</td>
						<td>
							<a class="link" href="#scoping" title="Scoping">Java-based scoping</a>
						</td>
					
</tr>
<tr>
						
<td>
							<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.generator/src/org/eclipse/xtext/generator/validation/JavaValidatorFragment.java?root=Modeling_Project&view=co" target="_new">JavaValidatorFragment</a>
						</td>
						<td>Java-based model validation</td>
						<td>
							<a class="link" href="#custom_validation" title="Custom Validation">Java-based validation</a>
						</td>
					
</tr>
<tr>
						
<td>
							<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.generator/src/org/eclipse/xtext/generator/validation/CheckFragment.java?root=Modeling_Project&view=co" target="_new">CheckFragment</a>
						</td>
						<td>Xpand/Check-based model validation</td>
						<td>
							<a class="link" href="#check_based_validation" title="Validation with the Check language">Check-based validation</a>
						</td>
					
</tr>
<tr>
						
<td>
							<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.generator/src/org/eclipse/xtext/generator/formatting/FormatterFragment.java?root=Modeling_Project&view=co" target="_new">FormatterFragment</a>
						</td>
						<td>Code formatter</td>
						<td>
							<a class="ulink" href="declarativeformatter" target="_new">Declarative formatter</a>
						</td>
					
</tr>
<tr>
						
<td>
							<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.generator/src/org/eclipse/xtext/ui/generator/labeling/LabelProviderFragment.java?root=Modeling_Project&view=co" target="_new">LabelProviderFragment</a>
						</td>
						<td>Label provider</td>
						<td>
							<a class="link" href="#labelProvider" title="Label Provider">Label provider</a>
						</td>
					
</tr>
<tr>
						
<td>
							<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.generator/src/org/eclipse/xtext/ui/generator/outline/OutlineNodeAdapterFactoryFragment.java?root=Modeling_Project&view=co" target="_new">OutlineNodeAdapterFactoryFragment</a>
						</td>
						<td>Outline view configuration</td>
						<td>
							<a class="link" href="#outline" title="Outline View">Outline</a>
						</td>
					
</tr>
<tr>
						
<td>
							<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.generator/src/org/eclipse/xtext/ui/generator/outline/TransformerFragment.java?root=Modeling_Project&view=co" target="_new">TransformerFragment</a>
						</td>
						<td>Outline view configuration</td>
						<td>
							<a class="link" href="#outline" title="Outline View">Outline</a>
						</td>
					
</tr>
<tr>
						
<td>
							<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.generator/src/org/eclipse/xtext/ui/generator/contentAssist/JavaBasedContentAssistFragment.java?root=Modeling_Project&view=co" target="_new">JavaBasedContentAssistFragment</a>
						</td>
						<td>Java-based content assist</td>
						<td>
							<a class="link" href="#contentAssist" title="Content Assist">Content assist</a>
						</td>
					
</tr>
<tr>
						
<td>XtextAntlrUiGeneratorFragment</td>
						<td>Content assist helper based on ANTLR</td>
						<td>
							<a class="link" href="#contentAssist" title="Content Assist">Content assist</a>
						</td>
					
</tr>
<tr>
						
<td>
							<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.generator/src/org/eclipse/xtext/ui/generator/projectWizard/SimpleProjectWizardFragment.java?root=Modeling_Project&view=co" target="_new">SimpleProjectWizardFragment</a>
						</td>
						<td>New project wizard</td>
						<td>
							<a class="link" href="#projectwizard" title="Project Wizard">Project wizard</a>
						</td>
					
</tr>
</table>
<p>
					
<span class="italic">
						<span class="bold"><strong>Important</strong></span> Due to
					</span> 
					<a class="link" href="#antlr_ip_issue" title="Chapter&nbsp;11.&nbsp;The ANTLR IP issue (or which parser to use?)">IP-Problems</a> 
					<span class="italic">with the code generator shipped with ANTLR 3 we&rsquo;re not allowed to ship this fragment at Eclipse. Therefore you&rsquo;ll have to download it separately from http://download.itemis.com or use the update site at 
						<span class="bold"><strong>http://download.itemis.com/updates/</strong></span>.
					</span>
				
</p>
</div>
</div>
<div class="section" title="Dependency Injection in Xtext with Google Guice">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="dependencyInjection"></a>Dependency Injection in Xtext with Google Guice</h2>
</div>
</div>
</div>
<p>In Xtext, there are many Java classes which implement logic, behavior, or supply configuration. These classes implement Java interfaces and are typically only supposed to be accessed through these interfaces, which makes their implementations interchangeable. This is where Xtext utilizes 
				<a class="ulink" href="http://code.google.com/p/google-guice/" target="_new">Google Guice</a>: 
			</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>Guice manages the instantiation of the classes: instead of constructing a class with 
						<code class="code">new</code>, the <code class="code">@Inject</code> annotation instructs Guice to supply an object for a certain interface. Such an object is called 
						<a class="link" href="#guiceservice" title="Services">Service</a>.
					</p>
</li>
<li class="listitem">
<p>Guice allows to configure which implementations are to be supplied for which interface. This configuration consists of so-called 
						<a class="link" href="#guicemodules" title="Modules">modules</a>.
					</p>
</li>
</ul>
</div>
<div class="section" title="Services">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="guiceservice"></a>Services</h3>
</div>
</div>
</div>
<p>The most parts of Xtext are implemented as 
					<span class="emphasis"><em>services</em></span>. A service is an object which implements a certain interface and which is instantiated and provided by Guice. Nearly every concept of the Xtext framework can be understood as this sort of 
					<span class="emphasis"><em>service</em></span>: The 
					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.ui.core/src/org/eclipse/xtext/ui/core/editor/XtextEditor.java?root=Modeling_Project&view=co" target="_new">XtextEditor</a>, the 
					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/resource/XtextResource.java?root=Modeling_Project&view=co" target="_new">XtextResource</a>, the 
					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/parser/IParser.java?root=Modeling_Project&view=co" target="_new">IParser</a> and even fine grained concepts as the 
					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.ui.core/src/org/eclipse/xtext/ui/core/editor/contentassist/PrefixMatcher.java?root=Modeling_Project&view=co" target="_new">PrefixMatcher</a> for the content assist are configured and provided by Guice.
				</p>
<p>Xtext ships with generic default implementations for most of the services or uses 
					<a class="link" href="#generator" title="The Generator">generator fragments</a> to automatically generate service implementations for a grammar. Thereby, Xtext strives to provide meaningful implementations out of the box and to allow customization wherever needed. Developers are encouraged to subclass existing services and configure them for their languages in their 
					<a class="link" href="#guicemodules" title="Modules">modules</a>.  
				</p>
<p>When Guice instantiates an object, it also supplies this instance with all its dependent services. All a service does is to request &bdquo;some implementation for a certain interface&rdquo; using the <code class="code">@Inject</code>-annotation. Based on the 
					<a class="link" href="#guicemodules" title="Modules">modules configuration</a> Guice decides which class to instantiate or which object to reuse. 
				</p>
<p>For example, Guice can automatically initialize member variables with the needed services. </p>
<div class="literallayout">
<p>
<code class="code">public&nbsp;class&nbsp;MyLanguageLinker&nbsp;extends&nbsp;Linker&nbsp;{<br>

<br>
&nbsp;&nbsp;@Inject<br>
&nbsp;&nbsp;private&nbsp;IScopeProvider&nbsp;scopeProvider;<br>

<br>
&nbsp;&nbsp;@Inject(optional=true)<br>
&nbsp;&nbsp;private&nbsp;IXtext2EcorePostProcessor&nbsp;postProcessor;<br>
&nbsp;&nbsp;<br>
&nbsp;&nbsp;(...)<br>
}<br>

<br>

</code>
</p>
</div>
<p>Furthermore, Guice can pass the needed services as method parameters or event into a constructor call.</p>
<div class="literallayout">
<p>
<code class="code">public&nbsp;class&nbsp;MyLanguageGrammarAccess&nbsp;implements&nbsp;IGrammarAccess&nbsp;{<br>
	
<br>
&nbsp;&nbsp;private&nbsp;final&nbsp;GrammarProvider&nbsp;grammarProvider;<br>

<br>
&nbsp;&nbsp;private&nbsp;TerminalsGrammarAccess&nbsp;gaTerminals;<br>

<br>
&nbsp;&nbsp;@Inject<br>
&nbsp;&nbsp;public&nbsp;MyLanguageGrammarAccess(GrammarProvider&nbsp;grammarProvider,<br>
&nbsp;&nbsp;&nbsp;&nbsp;TerminalsGrammarAccess&nbsp;gaTerminals)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;this.grammarProvider&nbsp;=&nbsp;grammarProvider;<br>
&nbsp;&nbsp;&nbsp;&nbsp;this.gaTerminals&nbsp;=&nbsp;gaTerminals;<br>
&nbsp;&nbsp;}<br>
	
<br>
&nbsp;&nbsp;(...)<br>
}<br>

<br>

</code>
</p>
</div>
<p>For further details, please refer to the 
					<a class="ulink" href="http://code.google.com/docreader/#p=google-guice&s=google-guice&t=UsersGuide" target="_new">Google Guice Documentation</a>
				
</p>
</div>
<div class="section" title="Modules">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="guicemodules"></a>Modules</h3>
</div>
</div>
</div>
<p>The configuration of services for a language built with  Xtext is done via modules:</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>Modules bind arbitrary Java interfaces to their implementation classes or directly to instances of their implementation classes. Such a binding is sort of a configurable mapping.</p>
</li>
<li class="listitem">
<p>A module itself is a plain Java class.</p>
</li>
<li class="listitem">
<p>Modules can inherit from each other and override bindings that are declared in super-modules. This concept is put on top of plain Guice modules by Xtext.</p>
</li>
<li class="listitem">
<p>In Xtext, there is a 
							<a class="link" href="#guicedefaultmodule" title="Default Module">generic default module</a> for all languages, there are automatically 
							<a class="link" href="#guicegeneratedmodule" title="Generated Modules">generated modules</a> and there are modules which are 
							<a class="link" href="#guicemanualmodules" title="Modules intended for customization">intended to be customized manually</a>.  
						</p>
</li>
<li class="listitem">
<p>Furthermore, Xtext distinguishes between modules for runtime-services and modules related to services needed for the user interface. The UI module extends the runtime module.</p>
</li>
</ul>
</div>
<p>In total, this leads to five modules for a typical Xtext Language. They are visualized in the image below. The image is further explained in the following subsections. </p>
<p>
					
</p>
<div class="mediaobject">
<img src="images/modules_hierarchy.png"></div>
<p>
				
</p>
<div class="section" title="Modules intended for customization">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="guicemanualmodules"></a>Modules intended for customization</h4>
</div>
</div>
</div>
<p>When the 
						<a class="link" href="#generator" title="The Generator">generator</a> runs the first time, it creates two modules named 
						<code class="code">&lt;MyLanguage&gt;RuntimeModule</code> and 
						<code class="code">&lt;MyLanguage&gt;UIModule</code>. They are placed in the language&rsquo;s root-package in the 
						<code class="code">src/</code>-folder of the language&rsquo;s runtime-project and the language&rsquo;s UI-project. Both are initially empty and will never be overwritten by the generator. They are 
						<a class="link" href="#guicecustomize" title="Changing Configuration">intended for customization</a>. By default, they extend a 
						<a class="link" href="#guicegeneratedmodule" title="Generated Modules">generated module</a>.  
					</p>
</div>
<div class="section" title="Generated Modules">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="guicegeneratedmodule"></a>Generated Modules</h4>
</div>
</div>
</div>
<p>The fully generated modules are called 
						<code class="code">Abstract&lt;MyLanguage&gt;RuntimeModule</code> and 
						<code class="code">Abstract&lt;MyLanguage&gt;UiModule</code> respectively. They contain all components which have been generated specifically for the language at hand. What goes into these modules depends on the fragments you use in the generator.
					</p>
<p>
						
<span class="bold"><strong>Note</strong></span>: 
						<span class="emphasis"><em>This modules are replaced on every subsequent execution of the generator. Don&rsquo;t put any custom code into them. Manually written code has go into the 
							<a class="link" href="#guicemanualmodules" title="Modules intended for customization">concrete subclasses</a>.
						</em></span>
					
</p>
</div>
<div class="section" title="Default Module">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="guicedefaultmodule"></a>Default Module</h4>
</div>
</div>
</div>
<p>Finally the fully generated modules extend the 
						<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/service/DefaultRuntimeModule.java?root=Modeling_Project&view=co" target="_new">DefaultRuntimeModule</a>, which contains all the default configuration. The default configuration consists of all components for which we have generic default implementations.
					</p>
</div>
<div class="section" title="Changing Configuration">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="guicecustomize"></a>Changing Configuration</h4>
</div>
</div>
</div>
<p>We use the primary modules (
						<code class="code">&lt;MyLanguage&gt;RuntimeModule</code> and 
						<code class="code">&lt;MyLanguage&gt;UiModule</code>) in order to change the configuration. 
						These classes are initially empty and have been generated to allow customization.
					</p>
<p>In order to provide a simple and convenient way, the default module extends the 
						<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/service/AbstractGenericModule.java?root=Modeling_Project&view=co" target="_new">AbstractGenericModule</a>. 
						It does not provide any bindings itself but comes up with a convenient and declarative way to specify mappings. The default API provided by Guice is based on fluent API and a builder pattern.
						This is also very readable but does not allow submodules to change any of the bindings.   
						The 
						<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/service/AbstractGenericModule.java?root=Modeling_Project&view=co" target="_new">AbstractGenericModule</a> allows to declare and override bindings in all subclasses like this:
					</p>
<div class="literallayout">
<p>
<code class="code">public&nbsp;Class&lt;?&nbsp;extends&nbsp;IFooService&gt;&nbsp;bindIFooService()&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;MyFooServiceImpl.class;<br>
}<br>

<br>

</code>
</p>
</div>
<p>Such a method will be interpreted as a binding from 
						<code class="code">IFooService</code> to 
						<code class="code">MyFooServiceImpl.class</code>. Note that you simply have to override a method from a super class (e.g. from the generated or default module) in order to change the respective binding. For example, in the picture above, the 
						<code class="code">DefaultRuntimeModule</code> configures the 
						<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/formatting/IFormatter.java?root=Modeling_Project&view=co" target="_new">IFormatter</a> to be implemented by the 
						<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/formatting/impl/OneWhitespaceFormatter.java?root=Modeling_Project&view=co" target="_new">OneWhitespaceFormatter</a>. The 
						<code class="code">AbstractMyLanguageModule</code> overrides this binding by mapping the 
						<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/formatting/IFormatter.java?root=Modeling_Project&view=co" target="_new">IFormatter</a> to 
						<code class="code">MyLanguageFormatter</code>.
						The type to type binding will create a new instance of the given target type for each dependency. If you want to make it a singleton and thereby ensure only one instance to be created and reused for all dependencies you can add the following annotation:
					</p>
<div class="literallayout">
<p>
<code class="code">@SingletonBinding<br>
public&nbsp;Class&lt;?&nbsp;extends&nbsp;IFooService&gt;&nbsp;bindIFooService()&nbsp;{<br>
&nbsp;&nbsp;return&nbsp;MyFooServiceImpl.class;<br>
}<br>

<br>

</code>
</p>
</div>
<p>In addition if the creation of the type causes any necessary side effects, so you want it to be instantiated eagerly, you can set the 
						<code class="code">eager</code> property to true. This is shown in the following snippet:
					</p>
<div class="literallayout">
<p>
<code class="code">@SingletonBinding(eager=true)<br>
public&nbsp;Class&lt;?&nbsp;extends&nbsp;IFooService&gt;&nbsp;bindIFooService()&nbsp;{<br>
&nbsp;&nbsp;return&nbsp;MyFooServiceImpl.class;<br>
}<br>

<br>

</code>
</p>
</div>
<p>One more way of specify a binding is currently supported: If you need to control the way, the instance is created, you can declare a type to object mapping:</p>
<div class="literallayout">
<p>
<code class="code">public&nbsp;IFooService&nbsp;bindIFooService()&nbsp;{<br>
&nbsp;&nbsp;return&nbsp;new&nbsp;MyFooServiceImpl();<br>
}<br>

<br>

</code>
</p>
</div>
<p>
						
<span class="italic">Note that, although this is a convenient and simple way, you have of course also the full power of Guice, i.e. you can override the Guice method 
							<code class="code">void configure(Binder)</code> and use the afore mentioned fluent API to do whatever you want.
						</span>
					
</p>
</div>
</div>
</div>
</div>
<div class="chapter" title="Chapter&nbsp;6.&nbsp;Runtime Concepts">
<div class="titlepage">
<div>
<div>
<h2 class="title">
<a name="RuntimeConcepts"></a>Chapter&nbsp;6.&nbsp;Runtime Concepts</h2>
</div>
</div>
</div>
<p>TMF Xtext itself and every language infrastructure developed with Xtext is configured and wired-up using 
			<a class="link" href="#dependencyInjection" title="Dependency Injection in Xtext with Google Guice">dependency injection</a>. Xtext may be used in different environments which introduce different constraints. Especially important is the difference between OSGi managed containers and plain vanilla Java programs. To honor these differences Xtext uses the concept of 
			<code class="code">ISetup</code>-implementations in normal mode and uses Eclipse&rsquo;s extension mechanism when it should be configured in an OSGi environment.   
		</p>
<div class="section" title="Runtime setup (ISetup)">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="RuntimesetupISetup"></a>Runtime setup (ISetup)</h2>
</div>
</div>
</div>
<p>For each language there is an implementation of 
				<code class="code">ISetup</code> generated. It implements a method called 
				<code class="code">doSetup()</code>, which can be called to do the initialization of the language infrastructure. This class is intended to be used for runtime and unit testing, only.
			</p>
<p>The setup method returns an 
				<code class="code">Injector</code>, which can further be used to obtain a parser, etc. It also registers the ResourceFactory and generated EPackages at the respective global registries provided by EMF. So basically you can just run the setup and start using EMF API to load and store models of your language.
			</p>
</div>
<div class="section" title="Setup within Eclipse-Equinox (OSGi)">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="SetupwithinEclipseEquinoxOSGi"></a>Setup within Eclipse-Equinox (OSGi)</h2>
</div>
</div>
</div>
<p>Within Eclipse we have a generated 
				<code class="code">Activator</code>, which creates a Guice injector using the 
				<a class="ulink" href="guicemodules" target="_new">modules</a>.
				In addition an 
				<code class="code">IExecutableExtensionFactory</code> is generated for each language, which is used to create 
				<code class="code">ExecutableExtensions</code>.
				This means that everything which is created via extension points is managed by Guice as well, i.e. you can declare dependencies and get them injected upon creation. 
			</p>
<p>The only thing you have to do in order to use this factory is to prefix the class with the factory 
				<code class="code">&lt;MyLanguageName&gt;ExecutableExtensionFactory</code> name followed by a colon.
			</p>
<div class="literallayout">
<p>
<code class="code">&lt;extension<br>
&nbsp;&nbsp;point="org.eclipse.ui.editors"&gt;<br>
&nbsp;&nbsp;&lt;editor<br>
&nbsp;&nbsp;&nbsp;&nbsp;class="&lt;MyLanguageName&gt;ExecutableExtensionFactory:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;org.eclipse.xtext.ui.core.editor.XtextEditor"<br>
&nbsp;&nbsp;&nbsp;&nbsp;contributorClass=<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"org.eclipse.ui.editors.text.TextEditorActionContributor"<br>
&nbsp;&nbsp;&nbsp;&nbsp;default="true"<br>
&nbsp;&nbsp;&nbsp;&nbsp;extensions="ecoredsl"<br>
&nbsp;&nbsp;&nbsp;&nbsp;id="org.eclipse.xtext.example.EcoreDsl"<br>
&nbsp;&nbsp;&nbsp;&nbsp;name="EcoreDsl&nbsp;Editor"&gt;<br>
&nbsp;&nbsp;&lt;/editor&gt;<br>
&lt;/extension&gt;<br>

<br>

</code>
</p>
</div>
</div>
<div class="section" title="Logging">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="Logging"></a>Logging</h2>
</div>
</div>
</div>
<p>Xtext uses Apache&rsquo;s log4j for logging. It is configured using a so called log4j.properties, which is looked up in the root of the Java classpath. If you want to change or provide configuration at runtime (i.e. non-OSGI), all you have to do is putting such a log4j.properties in place and make sure that it is not overridden by other log4j.properties in previous class path entries.</p>
<p>In OSGi you provide configuration by creating a fragment for org.apache.log4j. In this case you need to make sure that there&rsquo;s no second fragment contributing a log4j.properties file.</p>
</div>
<div class="section" title="Validation">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="validation"></a>Validation</h2>
</div>
</div>
</div>
<p>Static analysis or validation is one of the most interesting aspects when developing a programming language. The users of your languages will be grateful
				if they get informative feedback as they type. 
				In Xtext there are basically three different kinds of validation.</p>
<div class="section" title="Syntactical Validation">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="syntactical_validation"></a>Syntactical Validation</h3>
</div>
</div>
</div>
<p>The syntactical correctness of any textual input is validated automatically by the parser. The error messages are generated by the underlying parser technology and cannot be customized using a general hook.
					Any syntax errors can be retrieved from the Resource using the common EMF API:</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>
							
<code class="code">org.eclipse.emf.ecore.resource.Resource.getErrors()</code>
						
</p>
</li>
<li class="listitem">
<p>
							
<code class="code">org.eclipse.emf.ecore.resource.Resource.getWarnings()</code>
						
</p>
</li>
</ul>
</div>
</div>
<div class="section" title="Crosslink Validation">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="linking_validation"></a>Crosslink Validation</h3>
</div>
</div>
</div>
<p>Any broken crosslinks can be checked generically. As crosslink resolution is done lazily (see 
					<a class="link" href="#linking" title="Linking">linking</a>), any broken links are resolved lazily as well.
					If you want to validate whether all links are valid, you will have to navigate through the model so that all installed EMF proxies get resolved. This is done automatically in the editor.
				</p>
<p>Any unresolvable crosslinks will be reported and can be obtained through:</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>
							
<code class="code">org.eclipse.emf.ecore.resource.Resource.getErrors()</code>
						
</p>
</li>
<li class="listitem">
<p>
							
<code class="code">org.eclipse.emf.ecore.resource.Resource.getWarnings()</code>
						
</p>
</li>
</ul>
</div>
</div>
<div class="section" title="Custom Validation">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="custom_validation"></a>Custom Validation</h3>
</div>
</div>
</div>
<p>In addition to the afore mentioned kinds of validation, which are more or less done automatically, you can specify additional constraints specific for your Ecore model.
					We leverage existing EMF API (mainly 
					<code class="code">EValidator</code>) and have put some convenience stuff on top. 
					Basically all you need to do is to make sure that an 
					<code class="code">EValidator</code> is registered for your 
					<code class="code">EPackage</code>. The registry for 
					<code class="code">EValidators</code> (
					<code class="code">EValidator.Registry.INSTANCE</code>) can only be filled programmatically.
					That means contrary to the EPackage and 
					<code class="code">Resource.Factory</code> registries there is no Equinox extension point to populate the validator registry.
				</p>
<p>For Xtext we provide a 
					<a class="link" href="#generator_fragment" title="Generator Fragments">generator fragment</a> for the convenient Java-based 
					<code class="code">EValidator</code> API. Just add the following fragment to your generator configuration and you are good to go:
				</p>
<div class="literallayout">
<p>
<code class="code">&lt;fragment&nbsp;class=<br>
&nbsp;&nbsp;"org.eclipse.xtext.generator.validation.JavaValidatorFragment"/&gt;<br>

<br>

</code>
</p>
</div>
<p>The generator will provide you with two Java classes. An abstract class generated to 
					<code class="code">src-gen/</code> which extends the library class 
					<code class="code">AbstractDeclarativeValidator</code>. This one just registers the EPackages for which this validator introduces constraints.
					The other class is a subclass of that abstract class and is generated to the 
					<code class="code">src/</code> folder in order to be edited by you. That&rsquo;s where you put the constraints in.
				</p>
<p>The purpose of the 
					<code class="code">AbstractDeclarativeValidator</code> is to allow you to write constraints in a declarative way &ndash; as the class name already suggests. That is instead of writing exhaustive if-else constructs or extending the generated EMF switch you just have to add the <code class="code">@Check</code> annotation to any method and it will be invoked automatically when validation takes place.
					Moreover you can state for what type the respective constraint method is, just by declaring a typed parameter. This also lets you avoid any type casts.  
					In addition to the reflective invocation of validation methods the 
					<code class="code">AbstractDeclarativeValidator</code> provides a couple of convenient assertions.
				</p>
<p>All in all this is very similar to how JUnit works. Here is an example:</p>
<div class="literallayout">
<p>
<code class="code">public&nbsp;class&nbsp;DomainmodelJavaValidator&nbsp;<br>
&nbsp;&nbsp;extends&nbsp;AbstractDomainmodelJavaValidator&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;@Check<br>
&nbsp;&nbsp;public&nbsp;void&nbsp;checkTypeNameStartsWithCapital(Type&nbsp;type)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!Character.isUpperCase(type.getName().charAt(0)))<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;warning("Name&nbsp;should&nbsp;start&nbsp;with&nbsp;a&nbsp;capital",&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DomainmodelPackage.TYPE__NAME);<br>
&nbsp;&nbsp;}<br>
}<br>

<br>

</code>
</p>
</div>
</div>
<div class="section" title="Quickfixes">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="quickfixes"></a>Quickfixes</h3>
</div>
</div>
</div>
<p>For validations written using the 
					<code class="code">AbstractDeclarativeValidator</code> it is possible to provide corresponding quickfixes in the editor. To be able to implement a quickfix for a given diagnostic (a warning or error) the underlying 
					<span class="emphasis"><em>cause</em></span> of the diagnostic must be known (i.e. what actual problem does the diagnostic represent?), otherwise the fix doesn&rsquo;t know what needs to be done. As we don&rsquo;t want to deduce this from the diagnostic&rsquo;s error message we associate a problem specific 
					<span class="emphasis"><em>code</em></span> with the diagnostic.
				</p>
<p>In the following example (from 
					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.example.domainmodel/src/org/eclipse/xtext/example/validation/DomainmodelJavaValidator.java?root=Modeling_Project&view=co" target="_new">DomainmodelJavaValidator</a>) the diagnostic&rsquo;s 
					<span class="emphasis"><em>code</em></span> is given by the last argument to the 
					<code class="code">warning()</code> method and it is a reference to the static 
					<code class="code">String</code> field 
					<code class="code">INVALID_TYPE_NAME</code> in the validator class.
				</p>
<div class="literallayout">
<p>
<code class="code">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;warning("Name&nbsp;should&nbsp;start&nbsp;with&nbsp;a&nbsp;capital",&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DomainmodelPackage.TYPE__NAME,&nbsp;INVALID_TYPE_NAME,&nbsp;type.getName());<br>

<br>

</code>
</p>
</div>
<p>Now that the validation has a unique code identifying the problem we can register quickfixes against it. We start by adding the 
					<code class="code">org.eclipse.xtext.ui.generator.quickfix.QuickfixProviderFragment</code> to our workflow and after regenerating the code we should find an empty class 
					<code class="code">MyDslQuickfixProvider</code> in our DSL&rsquo;s UI project.
				</p>
<p>Continuing with the 
					<code class="code">INVALID_TYPE_NAME</code> problem from the Domainmodel example we add a method with which the problem can be fixed (see also 
					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.example.domainmodel.ui/src/org/eclipse/xtext/example/quickfix/DomainmodelQuickfixProvider.java?root=Modeling_Project&view=co" target="_new">DomainmodelQuickfixProvider</a>):
				</p>
<div class="literallayout">
<p>
<code class="code">@Fix(DomainmodelJavaValidator.INVALID_TYPE_NAME)<br>
public&nbsp;void&nbsp;fixName(final&nbsp;Issue&nbsp;issue,&nbsp;IssueResolutionAcceptor&nbsp;acceptor)&nbsp;{<br>
		acceptor.accept(issue,&nbsp;"Capitalize&nbsp;name",&nbsp;"Capitalize&nbsp;name&nbsp;&nbsp;of&nbsp;'"&nbsp;+&nbsp;issue.getData()[0]&nbsp;+&nbsp;"'",&nbsp;"upcase.png",&nbsp;new&nbsp;IModification()&nbsp;{<br>
		public&nbsp;void&nbsp;apply(IModificationContext&nbsp;context)&nbsp;throws&nbsp;BadLocationException&nbsp;{<br>
			IXtextDocument&nbsp;xtextDocument&nbsp;=&nbsp;context.getXtextDocument();<br>
			String&nbsp;firstLetter&nbsp;=&nbsp;xtextDocument.get(issue.getOffset(),&nbsp;1);<br>
			xtextDocument.replace(issue.getOffset(),&nbsp;1,&nbsp;Strings.toFirstUpper(firstLetter));<br>
	}<br>
	});<br>
}<br>

<br>

</code>
</p>
</div>
<p>By using the correct signature (see below) and annotating the method with the 
					<code class="code">Fix</code> annotation referencing the code we specified in the validator, Xtext knows that this method implements a fix for the problem. This also allows us to annotate multiple methods as fixes for the same problem.
				</p>
<p>The first three parameters given to the 
					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.ui/src/org/eclipse/xtext/ui/editor/quickfix/IssueResolutionAcceptor.java?root=Modeling_Project&view=co" target="_new">IssueResolutionAcceptor</a> define the UI representation of the quickfix. As the document is not necessarily loaded when the quickfix is offered, we need to provide any additional data from the model that we want to refer to in the UI when creating the issue in the validator above. In this case, we provided the existing type name.
				</p>
<p>The actual model modification is implemented in the ${org.eclipse.xtext.ui/src/org/eclipse/xtext/ui/editor/model/edit/IModification}. The ${org.eclipse.xtext.ui/src/org/eclipse/xtext/ui/editor/model/edit/IModificationContext} provides access to the erroneous document.  </p>
<p>If you prefer to implement the quickfix in terms of the semantic model use a ${org.eclipse.xtext.ui/src/org/eclipse/xtext/ui/editor/model/edit/ISemanticModification.java} instead. Its 
					<code class="code">apply(EObject, IModificationContext)</code> method will be invoked inside a modification transaction and the first argument will be the erroneous semantic element. This makes it very easy for the fix method to modify the model as necessary. After the method returns the model as well as the Xtext editor&rsquo;s content will be updated accordingly. If the method fails (throws an exception) the change will not be committed.
				</p>
</div>
<div class="section" title="Validation with the Check language">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="check_based_validation"></a>Validation with the Check language</h3>
</div>
</div>
</div>
<p>In addition to the Java-based validation code you can use the language Check (from M2T/Xpand) to implement constraint checks against your model. To do so, you have to configure the 
					<a class="link" href="#generator" title="The Generator">generator</a> with the

					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.generator/src/org/eclipse/xtext/generator/validation/CheckFragment.java?root=Modeling_Project&view=co" target="_new">CheckFragment</a>.
					Please note, that you can combine both types of validation in your project. 
				</p>
<div class="literallayout">
<p>
<code class="code">&lt;fragment&nbsp;class=<br>
&nbsp;&nbsp;"org.eclipse.xtext.generator.validation.CheckFragment"/&gt;<br>
&nbsp;&nbsp;<br>

</code>
</p>
</div>
<p>After regenerating your language artifacts you will find three new files &bdquo;YourLanguageChecks.chk&rdquo;, &bdquo;YourLanguageFastChecks.chk&rdquo; and &bdquo;YourLanguageExpensiveChecks.chk&rdquo; in the 
					<code class="code">src/</code> folder in the sub-package 
					<code class="code">validation</code>.  The checks in these files will be executed when saving a file, while typing (FastChecks) or when triggering the validation explicitly (ExpensiveChecks). When using Check the example of the previous chapter could be written like this.
				</p>
<div class="literallayout">
<p>
<code class="code">context&nbsp;Type#name&nbsp;WARNING&nbsp;"Name&nbsp;should&nbsp;start&nbsp;with&nbsp;a&nbsp;capital":<br>
&nbsp;&nbsp;name.toFirstUpper()&nbsp;==&nbsp;name;&nbsp;&nbsp;<br>

<br>

</code>
</p>
</div>
<p>Each check works in a specific context (here: 
					<code class="code">Type</code>) and can further denote a feature to which a warning or error should be attached to (here: 
					<code class="code">name</code>). Each check could either be a 
					<code class="code">WARNING</code> or an 
					<code class="code">ERROR</code> with a given string to explain the situation. The essential part of each check is an invariant that must hold true for the given context. If it fails the check will produce an issue with the provided explanation.
				</p>Please read more about the Check language as well as the underlying expression language in Xpand&rsquo;s reference documentation which is shipped as Eclipse help. 
			</div>
<div class="section" title="Test Validators">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="test_validators"></a>Test Validators</h3>
</div>
</div>
</div>
<p>If you have implemented your validators by extending 
					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/validation/AbstractDeclarativeValidator.java?root=Modeling_Project&view=co" target="_new">AbstractDeclarativeValidator</a>, there are helper classes which may assist you when testing your validators.
				</p>
<p>Testing validators typicallally works as follows: </p>
<div class="orderedlist">
<ol class="orderedlist" type="1">
<li class="listitem">
<p>The test creates some models which intentionally violate some constraints.</p>
</li>
<li class="listitem">
<p>The test runs some choosen @Check-methods from the validator.</p>
</li>
<li class="listitem">
<p>The test asserts whether the @Check-methods have raised the expected warnings and errors.</p>
</li>
</ol>
</div>
<p>To create models, you can either use EMF&rsquo;s 
					<code class="code">ResourceSet</code> to load models from your hard disk or you can utilize the 
					<code class="code">&lt;MyLanguage&gt;Factory</code> (which EMF generates for each 
					<code class="code">EPackage</code>) to construct the needed model elements manually. While the fist option has the advantages that you can edit your models in your textual concrete syntax, the second option has the advantage that you can create partial models.
				</p>
<p>To run the @Check-methods and ensure they raise the intended errors and warnings, you can utilize 
					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/validation/ValidatorTester.java?root=Modeling_Project&view=co" target="_new">ValidatorTester</a> as shown by the following example:
				</p>
<p>Validator:</p>
<div class="literallayout">
<p>
<code class="code">public&nbsp;class&nbsp;MyLanguageValidator&nbsp;extends&nbsp;AbstractDeclarativeValidator&nbsp;{<br>
&nbsp;&nbsp;@Check<br>
&nbsp;&nbsp;public&nbsp;void&nbsp;checkFooElement(FooElement&nbsp;element)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;if(element.getBarAttribute().contains("foo"))<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;error("Only&nbsp;Foos&nbsp;allowed",&nbsp;element,&nbsp;MyLanguagePackage.FOO_ELEMENT__BAR_ATTRIBUTE,&nbsp;101);<br>
&nbsp;&nbsp;}<br>
}<br>

<br>

</code>
</p>
</div>
<p>JUnit-Test:</p>
<div class="literallayout">
<p>
<code class="code">public&nbsp;class&nbsp;MyLanguageValidatorTest&nbsp;extends&nbsp;TestCase&nbsp;{<br>

<br>
&nbsp;&nbsp;private&nbsp;ValidatorTester&lt;MyLanguageValidator&gt;&nbsp;tester;<br>

<br>
&nbsp;&nbsp;@Override<br>
&nbsp;&nbsp;public&nbsp;void&nbsp;setUp()&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;MyLanguageValidator&nbsp;val&nbsp;=&nbsp;new&nbsp;MyLanguageValidator();<br>
&nbsp;&nbsp;&nbsp;&nbsp;new&nbsp;MyLanguageStandaloneSetup().createInjectorAndDoEMFRegistration().injectMembers(val);<br>
&nbsp;&nbsp;&nbsp;&nbsp;tester&nbsp;=&nbsp;new&nbsp;ValidatorTester&lt;TestingValidator&gt;(val);<br>
&nbsp;&nbsp;}<br>

<br>
&nbsp;&nbsp;public&nbsp;void&nbsp;testError()&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;FooElement&nbsp;model&nbsp;=&nbsp;MyLanguageFactory.eINSTANCE.createFooElement()<br>
&nbsp;&nbsp;&nbsp;&nbsp;model.setBarAttribute("barbarbarbarfoo");<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;tester.validator().checkFooElement(model);<br>
&nbsp;&nbsp;&nbsp;&nbsp;tester.diagnose().assertError(101);<br>
&nbsp;&nbsp;}<br>
&nbsp;&nbsp;<br>
&nbsp;&nbsp;public&nbsp;void&nbsp;testError2()&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;FooElement&nbsp;model&nbsp;=&nbsp;MyLanguageFactory.eINSTANCE.createFooElement()<br>
&nbsp;&nbsp;&nbsp;&nbsp;model.setBarAttribute("barbarbarbarfoo");<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;tester.validate(model).assertError(101);<br>
&nbsp;&nbsp;}<br>
}<br>

<br>

</code>
</p>
</div>
<p>This example uses JUnit 3, but since the involved classes from Xtext have no dependency on JUnit whatsoever, JUnit 4 and other testing frameworks will work as well.  JUnit runs the 
					<code class="code">setUp()</code>-method before each testcase and thereby helps to create some common state. In this example, the validator (
					<code class="code">MyLanguageValidator</code>) is instantiated manually and initialized via Google Guice&rsquo;s dependency injection. Then the 
					<code class="code">ValidatorTester</code> is created. It acts as a wrapper for the validator, ensures that the validator has a valid state and provides convenient access to the validator itself (
					<code class="code">tester.validator()</code>) as well as to the utility classes which assert diagnostics created by the validator (
					<code class="code">tester.diagnose()</code>). Please be aware that you have to call 
					<code class="code">validator()</code> before you can call 
					<code class="code">diagnose()</code>. However, you can call 
					<code class="code">validator()</code> multiple times in a row.
				</p>
<p>While 
					<code class="code">validator()</code> allows to call the validator&rsquo;s @Check-methods directly, 
					<code class="code">validate(model)</code> leaves it to the framework to call the applicable @Check-methods. However, to avoid side-effects between tests, it is recommended to call the @Check-methods directly.
				</p>
<p>
					
<code class="code">diagnose()</code> and 
					<code class="code">validate(model)</code> return an object of type @{org.eclipse.xtext/src/org/eclipse/xtext/validation/AssertableDiagnostics} which provides several 
					<code class="code">assert</code>-methods to verify whether the expected diagnostics are present:
				</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>
							
<code class="code">assertError(int code)</code>: There must be one diagnostic with severity ERROR and the supplied error code.
						</p>
</li>
<li class="listitem">
<p>
							
<code class="code">assertErrorContains(String messageFragment)</code>:  There must be one diagnostic with severity ERROR and its message must contain 
							<code class="code">messageFragment</code>.
						</p>
</li>
<li class="listitem">
<p>
							
<code class="code">assertError(int code, String messageFragment)</code>: Verifies severity, error code and messageFragment.
						</p>
</li>
<li class="listitem">
<p>
							
<code class="code">assertWarning(...)</code>: This method is available for the same combination of parameters as 
							<code class="code">assertError()</code>.
						</p>
</li>
<li class="listitem">
<p>
							
<code class="code">assertOK()</code>: Expects that no diagnostics (errors, warnings etc.) have been raised.   
						</p>
</li>
<li class="listitem">
<p>
							
<code class="code">assertDiagnostics(int severity, int code, String messageFragment)</code>: Verifies severity, error code and messageFragment.
						</p>
</li>
<li class="listitem">
<p>
							
<code class="code">assertAll(DiagnosticPredicate... predicates)</code>: Allows to describe multiple diagnostics at the same time and verifies that all of them are present. Class @{org.eclipse.xtext/src/org/eclipse/xtext/validation/AssertableDiagnostics} contains static 
							<code class="code">error()</code> and 
							<code class="code">warning()</code>-methods which help to create the needed 
							<code class="code">DiagnosticPredicate</code>. Example: 
							<code class="code">assertAll(error(123), warning("some part of the message"))</code>. 
						</p>
</li>
<li class="listitem">
<p>
							
<code class="code">assertAny(DiagnosticPredicate predicate)</code>: Asserts that a diagnostic exists which matches the predicate. 
						</p>
</li>
</ul>
</div>
</div>
</div>
<div class="section" title="Linking">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="linking"></a>Linking</h2>
</div>
</div>
</div>
<p>The linking feature allows for specification of cross references within an Xtext grammar.
				The following things are needed for the linking:</p>
<div class="orderedlist">
<ol class="orderedlist" type="1">
<li class="listitem">
<p>declaration of a crosslink in the grammar (at least in the Ecore model)</p>
</li>
<li class="listitem">
<p>specification of linking semantics (usually provided via the 
						<a class="link" href="#scoping" title="Scoping">scoping API</a>)
					</p>
</li>
</ol>
</div>
<div class="section" title="Declaration of crosslinks">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="Declarationofcrosslinks"></a>Declaration of crosslinks</h3>
</div>
</div>
</div>
<p>In the grammar a cross reference is specified using square brackets.</p>
<div class="literallayout">
<p>
<code class="code">CrossReference&nbsp;:<br>
&nbsp;&nbsp;'['&nbsp;ReferencedEClass&nbsp;('|'&nbsp;terminal=AbstractTerminal)?&nbsp;']'<br>
;<br>

<br>

</code>
</p>
</div>
<p>Example:</p>
<div class="literallayout">
<p>
<code class="code">ReferringType&nbsp;:<br>
&nbsp;&nbsp;'ref'&nbsp;referencedObject=[Entity|(ID|STRING)]<br>
;<br>

<br>

</code>
</p>
</div>
<p>The 
					<a class="link" href="#metamodelInference" title="Ecore model inference">Ecore model inference</a> would create an 
					<code class="code">EClass</code> &sbquo;ReferringType&rsquo; with an 
					<code class="code">EReference</code> &sbquo;referencedObject&rsquo; of type &sbquo;Entity&rsquo; (containment=false). The referenced object would be identified either by an ID or a STRING and the surrounding information in the current context (see 
					<a class="link" href="#scoping" title="Scoping">scoping</a>). If you do not use &bdquo;generate&rdquo; but &bdquo;import&rdquo; an existing ecore model, the class 
					<code class="code">ReferringType</code> (or one of its super types) would need to have an EReference of type Entity (or one of its super types) declared. Also the EReference&rsquo;s containment property needs to be set to 
					<code class="code">false</code>. 
				</p>
</div>
<div class="section" title="Default runtime behavior / lazy linking">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="Defaultruntimebehaviorlazylinking"></a>Default runtime behavior / lazy linking</h3>
</div>
</div>
</div>
<p>Xtext uses lazy linking by default and we encourage users to stick to this, because it provides a lot of advantages. One is improved performance in all scenarios where you don&rsquo;t have to load the whole closure of all transitively referenced resources. Also it automatically solves situation where one link relies on other links. Though cyclic linking dependencies are not supported by Xtext at all. </p>
<p>When parsing a given input string, say</p>
<div class="literallayout">
<p>
<code class="code">ref&nbsp;Entity01<br>

</code>
</p>
</div>
<p>The 
					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/linking/lazy/LazyLinker.java?root=Modeling_Project&view=co" target="_new">LazyLinker</a> first creates an EMF proxy and sets on the corresponding EReference. In EMF a proxy is described by a URI, which points to the real EObject. In the case of lazy linking the stored URI comprises of the context information given at parse time, which is the EObject containing the cross reference, the actual EReference, the index (in case it&rsquo;s a multi-valued cross reference) and the string which represented the cross link in the concrete syntax. The latter usually corresponds to the name of the referenced EObject. 
					In EMF a URI consists of information about the resource the EObject is contained in as well as a so called fragment part, which is used to find the EObject within that resource. When an  EMF proxy is resolved, the current ResourceSet is asked. The resource set uses the first part to obtain (i.e. load if it is not already loaded) the resource. Then the resource is asked to return the EObject based on the fragment in the URI. The actual cross reference resolution is done by 
					<code class="code">LazyLinkingResource.getEObject(String)</code> which receives the fragment and delegates to the implementation of the 
					<code class="code">ILinkingService</code>.  The default implementation in turn delegates to the &bdquo;scopes API&rdquo;#scoping.
				</p>
<p>A simple implementation of the linking service (the 
					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/linking/impl/DefaultLinkingService.java?root=Modeling_Project&view=co" target="_new">DefaultLinkingService</a>) is shipped with Xtext and used for any grammar per default. Usually any necessary customization of the linking behavior can best be described using the &bdquo;scopes API&rdquo;#scoping.
				</p>
</div>
</div>
<div class="section" title="Scoping">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="scoping"></a>Scoping</h2>
</div>
</div>
</div>
<p>Using the scoping API one defines which elements are referable from a certain reference. For instance, using the introductory example (fowler&rsquo;s state machine language)
				a transition contains two cross reference one to a declared event and one to a declared state.</p>
<p>Example:</p>
<div class="literallayout">
<p>
<code class="code">events<br>
&nbsp;&nbsp;nothingImportant&nbsp;&nbsp;MYEV<br>
end<br>
&nbsp;<br>
state&nbsp;idle<br>
&nbsp;&nbsp;nothingImportant&nbsp;=&gt;&nbsp;idle<br>
end<br>
&nbsp;&nbsp;<br>

</code>
</p>
</div>
<p>The grammar rule for transitions looks like this:</p>
<div class="literallayout">
<p>
<code class="code">Transition&nbsp;:<br>
&nbsp;&nbsp;event=[Event]&nbsp;'=&gt;'&nbsp;state=[State];<br>

<br>

</code>
</p>
</div>
<p>The grammar only states that for the reference 
				<code class="code">event</code> only instances of the type 
				<code class="code">Event</code> are allowed and that for the EReference 
				<code class="code">state</code> only instances of type 
				<code class="code">State</code> can be referenced. However, this simple declaration doesn&rsquo;t say anything about where to find the states or events. That is the duty of scopes.  
			</p>
<p>An 
				<code class="code">IScopeProvider</code> is responsible for providing an 
				<code class="code">IScope</code> for a given context 
				<code class="code">EObject</code> and 
				<code class="code">EReference</code>. The returned 
				<code class="code">IScope</code> should contain all target candidates for the given object and cross reference.
			</p>
<div class="literallayout">
<p>
<code class="code">public&nbsp;interface&nbsp;IScopeProvider&nbsp;{<br>

<br>
	/**<br>
	&nbsp;*&nbsp;Returns&nbsp;a&nbsp;scope&nbsp;for&nbsp;the&nbsp;given&nbsp;context.&nbsp;The&nbsp;scope&nbsp;provides&nbsp;access&nbsp;to&nbsp;the&nbsp;compatible<br>
	&nbsp;*&nbsp;visible&nbsp;EObjects&nbsp;for&nbsp;a&nbsp;given&nbsp;reference.<br>
	&nbsp;*<br>
	&nbsp;*&nbsp;@param&nbsp;context&nbsp;the&nbsp;element&nbsp;from&nbsp;which&nbsp;an&nbsp;element&nbsp;shall&nbsp;be&nbsp;referenced<br>
	&nbsp;*&nbsp;@param&nbsp;reference&nbsp;the&nbsp;reference&nbsp;to&nbsp;be&nbsp;used&nbsp;to&nbsp;filter&nbsp;the&nbsp;elements.<br>
	&nbsp;*&nbsp;@return&nbsp;{@link&nbsp;IScope}&nbsp;representing&nbsp;the&nbsp;inner&nbsp;most&nbsp;{@link&nbsp;IScope}&nbsp;for&nbsp;the<br>
	&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;passed&nbsp;context&nbsp;and&nbsp;reference.&nbsp;Note&nbsp;for&nbsp;implementors:&nbsp;The&nbsp;result&nbsp;may&nbsp;not&nbsp;be&nbsp;&lt;code&gt;null&lt;/code&gt;.<br>
	&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Return&nbsp;&lt;code&gt;IScope.NULLSCOPE&lt;/code&gt;&nbsp;instead.<br>
	&nbsp;*/<br>
	IScope&nbsp;getScope(EObject&nbsp;context,&nbsp;EReference&nbsp;reference);<br>

<br>
}<br>

<br>

</code>
</p>
</div>
<p>A single 
				<code class="code">IScope</code> represents an element of a linked list of scopes. That means that a scope can be nested within an outer scope. Each scope works like a symbol table or a map where the keys are strings and the values are so called IEObjectDescription, which is effectively an abstract description of a real EObject. 
			</p>
<div class="section" title="Global Scopes and IResourceDescriptions">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="global_scopes"></a>Global Scopes and IResourceDescriptions</h3>
</div>
</div>
</div>
<p>In the state machine example we don&rsquo;t have cross file references. Also there is no such thing as name spaces or other concepts which make scoping a bit more complicated. Basically every 
					<code class="code">State</code> and every 
					<code class="code">Event</code> declared in the same resource is visible by their name. However in the real world things are most likely not that simple. What if you want to reuse certain declared states and events across different state machines and you want to share those as library between different users? You would want to introduce some kind of cross resource reference. Defining what is visible from outside the current resource is the responsibility of global scopes. Defining what things of the current resource can be seen from outside (i.e. is publicly referenceable) is the duty of the so called 
					<code class="code">IResourceDescriptions.Manager</code>. 
				</p>
<div class="section" title="Resource and EObject Descriptions ( IResourceDescription, IEObjectDescription)">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="resourcedescriptions"></a>
						<code class="code">Resource</code> and 
						<code class="code">EObject</code> Descriptions (
						<code class="code">IResourceDescription</code>, 
						<code class="code">IEObjectDescription</code>)
					</h4>
</div>
</div>
</div>
<p>In order to make states and events of one file referenceable from another file you need to export them as part of a so called 
						<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/resource/IResourceDescription.java?root=Modeling_Project&view=co" target="_new">IResourceDescription</a>. Such a description can be obtained by an implementation of 
						<code class="code">IResourceDescription.Manager</code> which is provided by the 
						<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/resource/IResourceServiceProvider.java?root=Modeling_Project&view=co" target="_new">IResourceServiceProvider</a> for your language. 
					</p>
<p>A 
						<code class="code">IResourceDescription</code> contains information about the resource itself (primarily a 
						<code class="code">URI</code>), a list of exported 
						<code class="code">EObjects</code> (in the form of 
						<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/resource/IEObjectDescription.java?root=Modeling_Project&view=co" target="_new">IEObjectDescription</a>) as well as information about outgoing cross references and qualified names it references. The cross references contain only resolved references, while the list of imported qualified names also contain those names, which couldn&rsquo;t be resolved. This information is important in order to compute the transitive hull of dependent resources, which the shipped index infrastructure automatically does for you.
					</p>
<p>For users and especially in the context of scoping the most important information is the list of exported 
						<code class="code">EObjects</code>. An 
						<code class="code">IEObjectDescription</code> contains information about the 
						<code class="code">URI</code> to the actual 
						<code class="code">EObject</code> and the qualified name of that element as well as the corresponding 
						<code class="code">EClass</code>. In addition one can export arbitrary information using the so called user data map.
					</p>
<p>A language is configured with a default implementation of 
						<code class="code">IResourceDescription.Manager</code> which computes the list of exported 
						<code class="code">IEObjectDescription</code> s by iterating the whole EMF model and applying the 
						<code class="code">getQualifiedName(EObject obj)</code> from 
						<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/naming/IQualifiedNameProvider.java?root=Modeling_Project&view=co" target="_new">IQualifiedNameProvider</a> on each 
						<code class="code">EObject</code>. If it returns a name an 
						<code class="code">IEObjectDescription</code> is created and exported (i.e. added to the list). If an 
						<code class="code">EObject</code> doesn&rsquo;t have a qualified name, the element is considered to be not referenceable from outside the resource. 
					</p>
<p>There are also two different implementations of 
						<code class="code">IQualifiedNameProvider</code>. Both work by looking up an 
						<code class="code">EAttribute</code> with the name &sbquo;name&rsquo;. The 
						<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/naming/SimpleNameProvider.java?root=Modeling_Project&view=co" target="_new">SimpleNameProvider</a> just returns the plain value, while the 
						<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/naming/DefaultDeclarativeQualifiedNameProvider.java?root=Modeling_Project&view=co" target="_new">DefaultDeclarativeQualifiedNameProvider</a> concats the simple name with the qualified name of its parent exported 
						<code class="code">EObject</code>. This effectively simulates the qualified name computation of most name space based languages (like e.g. Java). 
					</p>
<p>As mentioned above, in order to obtain an 
						<code class="code">IResourceDescription</code> for a resource you need to ask the 
						<code class="code">IResourceDescription.Manager</code>. Here&rsquo;s some Java code showing how to do that:
					</p>
<div class="literallayout">
<p>
<code class="code">Manager&nbsp;manager&nbsp;=&nbsp;//&nbsp;obtain&nbsp;an&nbsp;instance&nbsp;of&nbsp;IResourceDescription.Manager.class<br>
&nbsp;&nbsp;IResourceDescription&nbsp;description&nbsp;=&nbsp;manager.getResourceDescription(resource);<br>
&nbsp;&nbsp;for&nbsp;(IEObjectDescription&nbsp;eObjDescription&nbsp;:&nbsp;description.getExportedObjects())&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;System.out.println(eObjDescription.getQualifiedName());<br>
&nbsp;&nbsp;}&nbsp;<br>
&nbsp;&nbsp;<br>

</code>
</p>
</div>
<p>In order to obtain an 
						<code class="code">IResourceDescription.Manager</code> it is best to ask the corresponding 
						<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/resource/IResourceServiceProvider.java?root=Modeling_Project&view=co" target="_new">IResourceServiceProvider</a>. That is because each language might have a totally different implementation and as you might refer to from your language to a different language you can&rsquo;t reuse your language&rsquo;s 
						<code class="code">IResourceDescription.Manager</code>. One basically asks the 
						<code class="code">IResourceServiceProvider.Registry</code> (there is usually one global instance) for an 
						<code class="code">IResourceServiceProvider</code>, which in turn provides an 
						<code class="code">IResourceDescription.Manager</code> along other useful services.
					</p>
<p>If you&rsquo;re running in a Guice enabled scenario, the code looks like this:</p>
<div class="literallayout">
<p>
<code class="code">@Inject&nbsp;private&nbsp;IResourceServiceProvider.Registry&nbsp;resourceServiceProviderRegistry;<br>
	
<br>
&nbsp;&nbsp;private&nbsp;IResourceDescription.Manager&nbsp;getManager(Resource&nbsp;res)&nbsp;{<br>
		IResourceServiceProvider&nbsp;resourceServiceProvider&nbsp;=&nbsp;resourceServiceProviderRegistry.getResourceServiceProvider(res.getURI());<br>
		return&nbsp;resourceServiceProvider.getResourceDescriptionManager();<br>
	}<br>

<br>

</code>
</p>
</div>
<p>If you don&rsquo;t run in a Guice enabled context you will likely have to directly access the singleton:</p>
<div class="literallayout">
<p>
<code class="code">private&nbsp;IResourceServiceProvider.Registry&nbsp;resourceServiceProviderRegistry&nbsp;=&nbsp;IResourceServiceProvider.Registry.INSTANCE;<br>

<br>

</code>
</p>
</div>
<p>However, we strongly encourage you to use dependency injection.
						Now, that we know how to export elements to be referenceable from other resources, we need to learn how those exported 
						<code class="code">IEObjectDescriptions</code> can be made available to the referencing resources. That is the responsibility of global scoping (i.e. 
						<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/scoping/IGlobalScopeProvider.java?root=Modeling_Project&view=co" target="_new">IGlobalScopeProvider</a>) which is described in the following.
					</p>
</div>
<div class="section" title="Global Scopes based on explicit imports (ImportURI mechanism)">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="import_uri"></a>Global Scopes based on explicit imports (ImportURI mechanism)</h4>
</div>
</div>
</div>
<p>A simple and straight forward solution is to have explicit references to other resources in your file by explicitly listing pathes (or 
						<code class="code">URIs</code>) to all referenced resources in your model file. That is for instance what most include mechanisms use. In Xtext we provide a handy implementation of an 
						<code class="code">IGlobalScopeProvider</code> which is based on naming convention and makes this semantics very easy to use. Talking of the introductory example and given you would want to add support for referencing external 
						<code class="code">States</code> and 
						<code class="code">Events</code> from within your state machine, all you&rsquo;ld had to do is add something like the following to the grammar definition:
					</p>
<div class="literallayout">
<p>
<code class="code">Statemachine&nbsp;:<br>
&nbsp;&nbsp;(imports+=Import)*&nbsp;//&nbsp;allow&nbsp;imports<br>
&nbsp;&nbsp;'events'<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(events+=Event)+<br>
&nbsp;&nbsp;'end'<br>
&nbsp;&nbsp;('resetEvents'<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(resetEvents+=[Event])+<br>
&nbsp;&nbsp;'end')?<br>
&nbsp;&nbsp;'commands'<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(commands+=Command)+<br>
&nbsp;&nbsp;'end'<br>
&nbsp;&nbsp;(states+=State)+;<br>

<br>
Import&nbsp;:&nbsp;<br>
&nbsp;&nbsp;'import'&nbsp;importURI=STRING;<br>

<br>

</code>
</p>
</div>
<p>This effectively allows import statements to be declared before the events section. In addition you&rsquo;ll have to make sure that you have bound the 
						<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/scoping/impl/ImportUriGlobalScopeProvider.java?root=Modeling_Project&view=co" target="_new">ImportUriGlobalScopeProvider</a> for the type 
						<code class="code">IGlobalScopeProvider</code> by the means of Guice:#dependencyInjection. That implementation looks up any 
						<code class="code">EAttributes</code> named &sbquo;importURI&rsquo; in your model and interprets their values as imports. That is it adds the corresponding resources to the current resource&rsquo;s resource set. In addition the scope provider uses the 
						<code class="code">IResourceDescription.Manager</code>#resource_descriptions of that imported resource to compute all the 
						<code class="code">IEObjectDescriptions</code> returned by the 
						<code class="code">IScope</code>.  
					</p>
</div>
<div class="section" title="Global Scopes based on external configuration (e.g. classpath-based)">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="index_based"></a>Global Scopes based on external configuration (e.g. classpath-based)</h4>
</div>
</div>
</div>
<p>The other possibility is to have some kind of external configuration in order to define what is visible outside a resource. Java for instances uses the notion of classpaths to define containers (jars and class folders) which contain any referenceable elements. In the case of Java also the order of such entries is important. 
						Since version 1.0.0 Xtext provides support for this kind of global scoping. Actually by default Xtext leverages the classpath mechanism since it is well designed and already understood by most of our users. Also the available tooling provided by JDT and PDE to configure the classpath is of high value. However it is just a default you can reuse the infrastructure without reusing Java and therefore depending on JDT.</p>
<p>In order to know what is available in the &bdquo;world&rdquo; a global scope provider which relies on external configuration needs to read that configuration in and be able to find all candidates for a certain EReference in those containers. If you don&rsquo;t want to force users to have a folder and file name structure reflecting the actual qualified names of the referenceable 
						<code class="code">EObjects</code>, you&rsquo;ll have to load all resources up front and either keep holding them in memory or remembering all information which is needed for reference resolution. In Xtext that information is provided by a so called 
						<code class="code">IEObjectDescription</code>#resource_descriptions. 
					</p>
<p>Xtext ships with an index which remembers all 
						<code class="code">IResourceDescriptions</code> and its 
						<code class="code">IEObjectDescriptions</code>. In the IDE-context (i.e. when running the editor, etc.) the index is updated incrementally by an incremental project builder. At runtime however, you typically do not have to deal with changes so that the infrastructure can be much simpler. In both situations the global index state is hold by an implementation of
						<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/resource/IResourceDescriptions.java?root=Modeling_Project&view=co" target="_new">IResourceDescriptions</a> (Note the plural form!). 
					</p>
<div class="section" title="Of containers and its manager">
<div class="titlepage">
<div>
<div>
<h5 class="title">
<a name="containers"></a>Of containers and its manager </h5>
</div>
</div>
</div>
<p>As mentioned above all this stuff is best explained along Java&rsquo;s class path mechanism, because we assume that you have an idea of its concepts and how it works. At least if not and we haven&rsquo;t written enough information down, there are other resources you could consult. The index is just a flat list of instances of 
							<code class="code">IResourceDescription</code> the index itself doesn&rsquo;t know about containers. That is because we think the notion of containers is something which is defined by the referencing language. The very same resource could be loaded from Java by the means of ClassLoader.loadResource() (i.e. using the classpath mechanism) but could be loaded from some other language by using the file system paths. 
						</p>
<p>This means that the information about to what container a resource belongs depends on the context. Therefore an 
							<code class="code">IResourceServiceProvider</code> provides another interesting service, which is called 
							<code class="code">IContainer.Manager</code>. An 
							<code class="code">IContainer.Manager</code> provides you with the 
							<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/resource/IContainer.java?root=Modeling_Project&view=co" target="_new">IContainer</a> a certain 
							<code class="code">IResourceDescripition</code> belongs to as well as with a list of all 
							<code class="code">IContainers</code> which are visible from a certain 
							<code class="code">IResourceDescription</code>. Note that while the index (
							<code class="code">IResourceDesciptions</code>) is globally shared (between all languages) the 
							<code class="code">IContainer.Manager</code> adds the semantic of containers and its implementation can be very different depending on the language.
						</p>
<p>By default Xtext provides either leveraging the Java class path mechanism, which allows to reuse a lot of nice Java things (jars, OSGi, maven, etc.) or define containers based on Eclipse projects. At runtime the only alternative is configured with a list of pathes to scan. Such pathes can either point to folders or archives.</p>
</div>
<div class="section" title="Java based container manager">
<div class="titlepage">
<div>
<div>
<h5 class="title">
<a name="java_based_containers"></a>Java based container manager </h5>
</div>
</div>
</div>
<p>TODO Explain how to setup Java and project based container state in the ui. 
							TODO Explain how to setup a resourcesetbased IResourceDescriptions for runtime.</p>
</div>
</div>
</div>
<div class="section" title="Local Scoping">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="local_scoping"></a>Local Scoping</h3>
</div>
</div>
</div>
<p>TODO TODO TODO
					We now know how the outer world of referenceable elements can be defined in Xtext. </p>
<p>For instance Java has multiple kinds of scopes (object scope, type scope, etc.).</p>
<p>For Java one would create the scope hierarchy as commented in the following example:</p>
<div class="literallayout">
<p>
<code class="code">//&nbsp;file&nbsp;contents&nbsp;scope<br>
import&nbsp;static&nbsp;my.Constants.STATIC;<br>

<br>
public&nbsp;class&nbsp;ScopeExample&nbsp;{&nbsp;//&nbsp;class&nbsp;body&nbsp;scope<br>
&nbsp;&nbsp;private&nbsp;Object&nbsp;field&nbsp;=&nbsp;STATIC;<br>

<br>
&nbsp;&nbsp;private&nbsp;void&nbsp;method(String&nbsp;param)&nbsp;{&nbsp;//&nbsp;method&nbsp;body&nbsp;scope<br>
&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;localVar&nbsp;=&nbsp;"bar";<br>
&nbsp;&nbsp;&nbsp;&nbsp;innerBlock:&nbsp;{&nbsp;//&nbsp;block&nbsp;scope<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;innerScopeVar&nbsp;=&nbsp;"foo";<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Object&nbsp;field&nbsp;=&nbsp;innerScopeVar;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;the&nbsp;scope&nbsp;hierarchy&nbsp;at&nbsp;this&nbsp;point&nbsp;would&nbsp;look&nbsp;like&nbsp;this:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;&nbsp;blockScope{field,innerScopeVar}-&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;&nbsp;methodScope{localVar,&nbsp;param}-&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;&nbsp;classScope{field}-&gt;&nbsp;('field'&nbsp;is&nbsp;overlayed)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;&nbsp;fileScope{STATIC}-&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;&nbsp;classpathScope{'all&nbsp;qualified&nbsp;names&nbsp;of&nbsp;accessible&nbsp;static&nbsp;fields'}&nbsp;-&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;&nbsp;NULLSCOPE{}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;field.add(localVar);<br>
&nbsp;&nbsp;}<br>
}<br>

<br>

</code>
</p>
</div>
<p>In fact the class path scope should also reflect the order of class path entries.
					For instance:</p>
<div class="literallayout">
<p>
<code class="code">classpathScope{stuff&nbsp;from&nbsp;bin/}<br>
-&gt;&nbsp;classpathScope{stuff&nbsp;from&nbsp;foo.jar/}<br>
-&gt;&nbsp;...<br>
-&gt;&nbsp;classpathScope{stuff&nbsp;from&nbsp;JRE&nbsp;System&nbsp;Library}<br>
-&gt;&nbsp;NULLSCOPE{}<br>

<br>

</code>
</p>
</div>
<p>Please find the motivation behind this and some additional details in 
					<a class="ulink" href="http://blog.efftinge.de/2009/01/xtext-scopes-and-emf-index.html" target="_new">this blog post</a> .
				</p>
<p>The default implementation would produce this hierarchy of scopes for the model from the last example in the 
					<a class="link" href="#defaultImports" title="Default Imports">previous chapter</a>:
				</p>
<div class="literallayout">
<p>
<code class="code">//file&nbsp;model.dsl<br>
import&nbsp;"model1.dsl";<br>
import&nbsp;"model2.dsl";<br>
&nbsp;<br>
ref&nbsp;Foo;<br>
entity&nbsp;Bar;<br>

<br>

</code>
</p>
</div>
<div class="literallayout">
<p>
<code class="code">//file&nbsp;model1.dsl&nbsp;<br>
entity&nbsp;Stuff;<br>

<br>

</code>
</p>
</div>
<div class="literallayout">
<p>
<code class="code">//file&nbsp;model2.dsl<br>
entity&nbsp;Foo;<br>

<br>

</code>
</p>
</div>
<div class="literallayout">
<p>
<code class="code">Scope&nbsp;(model.dsl)&nbsp;{<br>
&nbsp;&nbsp;parent&nbsp;:&nbsp;Scope&nbsp;(model1.dsl)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;parent&nbsp;:&nbsp;Scope&nbsp;(model2.dsl)&nbsp;{}<br>
&nbsp;&nbsp;}<br>
}<br>

<br>

</code>
</p>
</div>
<p>When enumerating the scope&rsquo;s content, the first, most specialized scope would return 
					<code class="code">Bar</code>, its parent would provide 
					<code class="code">Stuff</code> and the outermost scope adds 
					<code class="code">Foo</code>. The linker will iterate the scope in that order and abort when it finds a matching 
					<code class="code">ScopedElement</code>. 
				</p>
</div>
<div class="section" title="Default linking semantics">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="Defaultlinkingsemantics"></a>Default linking semantics</h3>
</div>
</div>
</div>
<p>The default implementation for all languages looks within the current file for an EObject of the respective type. In the example above this would be an &bdquo;Entity&rdquo; which by convention has a 
					<code class="code">name</code> attribute set to &sbquo;Entity01&rsquo;. 
				</p>
<p>Given the grammar :</p>
<div class="literallayout">
<p>
<code class="code">Model&nbsp;:&nbsp;<br>
&nbsp;&nbsp;(stuff+=(Ref|Entity))*<br>
;<br>

<br>
Ref&nbsp;:&nbsp;<br>
&nbsp;&nbsp;'ref'&nbsp;referencedObject=[Entity|ID]&nbsp;';'<br>
;<br>

<br>
Entity&nbsp;:&nbsp;<br>
&nbsp;&nbsp;'entity'&nbsp;name=ID&nbsp;';'<br>
;<br>

<br>

</code>
</p>
</div>
<p>In the following model:</p>
<div class="literallayout">
<p>
<code class="code">ref&nbsp;Entity01;<br>
entity&nbsp;Entity01;<br>

<br>

</code>
</p>
</div>
<p>the 
					<code class="code">ref</code> would be linked to the declared entity (
					<code class="code">entity Entity01;</code>). Nearly any aspect is configurable, especially the name of the identifying attribute may be overridden for a particular type.
				</p>
<div class="section" title="Default Imports">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="defaultImports"></a>Default Imports</h4>
</div>
</div>
</div>
<p>There is a default implementation for inter-resource references, which as well uses convention.
						Each string in a model which is assigned to an EAttribute with the name 
						<code class="code">importURI</code>, will be interpreted as an URI and used to be loaded using the 
						<code class="code">ResourceSet</code> of the current resource.
					</p>
<p>For example, given the following grammar :</p>
<div class="literallayout">
<p>
<code class="code">Model&nbsp;:&nbsp;<br>
&nbsp;&nbsp;(imports+=Import)*<br>
&nbsp;&nbsp;(stuff+=(Ref|Entity))*<br>
;<br>

<br>
Import&nbsp;:<br>
&nbsp;&nbsp;'import'&nbsp;importURI=STRING&nbsp;';'<br>
;<br>

<br>
Ref&nbsp;:&nbsp;<br>
&nbsp;&nbsp;'ref'&nbsp;referencedObject=[Entity|ID]&nbsp;';'<br>
;<br>

<br>
Entity&nbsp;:&nbsp;<br>
&nbsp;&nbsp;'entity'&nbsp;name=ID&nbsp;';'<br>
;<br>

<br>

</code>
</p>
</div>
<p>It would be possible to write three files in that language where the first references the other two, like this:</p>
<div class="literallayout">
<p>
<code class="code">//file&nbsp;model.dsl<br>
import&nbsp;"model1.dsl";<br>
import&nbsp;"model2.dsl";<br>
&nbsp;<br>
ref&nbsp;Foo;<br>
entity&nbsp;Bar;<br>

<br>

</code>
</p>
</div>
<div class="literallayout">
<p>
<code class="code">//file&nbsp;model1.dsl&nbsp;<br>
entity&nbsp;Stuff;<br>

<br>

</code>
</p>
</div>
<div class="literallayout">
<p>
<code class="code">//file&nbsp;model2.dsl<br>
entity&nbsp;Foo;<br>

<br>

</code>
</p>
</div>
<p>The linking candidates for the reference 
						<code class="code">Foo</code> will be 
						<code class="code">Bar</code>, 
						<code class="code">Stuff</code> and 
						<code class="code">Foo</code> in that order. They will be computed by the 
						<a class="link" href="#scoping" title="Scoping">ScopeProvider</a>. 
					</p>
</div>
</div>
<div class="section" title="DeclarativeScopeProvider">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="org.eclipse.xtextsrcorg.eclipse.xtext.scoping.impl.DeclarativeScopeProvider"></a>
					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/scoping/impl/DeclarativeScopeProvider.java?root=Modeling_Project&view=co" target="_new">DeclarativeScopeProvider</a>
				
</h3>
</div>
</div>
</div>
<p>As always there is an implementation that allows to specify scoping in a declarative way. It looks up methods which have either of the following two signatures:</p>
<div class="literallayout">
<p>
<code class="code">IScope&nbsp;scope_&lt;RefDeclaringEClass&gt;_&lt;Reference&gt;(&lt;ContextType&gt;&nbsp;ctx,&nbsp;EReference&nbsp;ref)<br>

</code>
</p>
</div>
<div class="literallayout">
<p>
<code class="code">IScope&nbsp;scope_&lt;TypeToReturn&gt;(&lt;ContextType&gt;&nbsp;ctx,&nbsp;EReference&nbsp;ref)<br>

</code>
</p>
</div>
<p>The former is used when evaluating the scope for a specific cross reference and here 
					<code class="code">&lt;ContextReference&gt;</code> corresponds to the name of this reference (prefixed with the name of the reference&rsquo;s declaring type and separated by an underscore). The 
					<code class="code">ref</code> parameter represents this cross reference.
				</p>
<p>The latter method signature is used when computing the scope for a given element type and is applicable to all cross references of that type. Here 
					<code class="code">&lt;TypeToReturn&gt;</code> is the name of that type which also corresponds to the 
					<code class="code">type</code> parameter. 
				</p>
<p>So if you for example have a state machine with a  
					<span class="emphasis"><em>Transition</em></span> object owned by its source 
					<span class="emphasis"><em>State</em></span> and you want to compute all reachable states (i.e. potential target states), the corresponding method could be declared as follows (assuming the cross reference is declared by the 
					<span class="emphasis"><em>Transition</em></span> type and is called 
					<span class="emphasis"><em>target</em></span>):
				</p>
<div class="literallayout">
<p>
<code class="code">IScope&nbsp;scope_Transition_target(Transition&nbsp;this,&nbsp;EReference&nbsp;ref)<br>

</code>
</p>
</div>
<p>If such a method does not exist, the implementation will try to find one for the context object&rsquo;s container. Thus in the example this would match a method with the same name but 
					<span class="emphasis"><em>State</em></span> as the type of the first parameter. It will keep on walking the containment hierarchy until a matching method is found. This container delegation allows to reuse the same scope definition for elements in different places of the containment hierarchy. Also it may make the method easier to implement as the elements comprising the scope are quite often owned or referenced by a container of the context object. In the example the 
					<span class="emphasis"><em>State</em></span> objects could for instance be owned by a containing 
					<span class="emphasis"><em>StateMachine</em></span> object.
				</p>
<p>If no method specific to the cross reference in question was found for any of the objects in the containment hierarchy, the implementation will start looking for methods matching the other signature (with the 
					<span class="emphasis"><em>EClass</em></span> parameter). Again it will first attempt to match the context object. Thus in the example the signature first matched would be:
				</p>
<div class="literallayout">
<p>
<code class="code">IScope&nbsp;scope_State(Transition&nbsp;this,&nbsp;EReference&nbsp;ref)<br>

</code>
</p>
</div>
<p>If no such method exists, the implementation will again try to find a method matching the context object&rsquo;s container objects. In the case of the state machine example you might want to declare the scope with available states at the state machine level:</p>
<div class="literallayout">
<p>
<code class="code">IScope&nbsp;scope_State(StateMachine&nbsp;this,&nbsp;EReference&nbsp;ref)<br>

</code>
</p>
</div>
<p>This scope can now be used for any cross references of type 
					<span class="emphasis"><em>State</em></span> for context objects owned by the state machine.
				</p>
<p>There are currently two different scope provider implmentations available which support these semantics:</p>
<div class="orderedlist">
<ol class="orderedlist" type="1">
<li class="listitem">
<p> 
							
<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/scoping/impl/AbstractDeclarativeScopeProvider.java?root=Modeling_Project&view=co" target="_new">AbstractDeclarativeScopeProvider</a> 
						
</p>
</li>
<li class="listitem">
<p> 
							
<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/scoping/impl/AbstractDeclarativeQualifiedNameScopeProvider.java?root=Modeling_Project&view=co" target="_new">AbstractDeclarativeQualifiedNameScopeProvider</a>
						
</p>
</li>
</ol>
</div>
</div>
<div class="section" title="QualifiedNameScopeProvider">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="org.eclipse.xtextsrcorg.eclipse.xtext.scoping.impl.QualifiedNameScopeProvider"></a>
					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/scoping/impl/QualifiedNameScopeProvider.java?root=Modeling_Project&view=co" target="_new">QualifiedNameScopeProvider</a>
				
</h3>
</div>
</div>
</div>
<p>The qualified name scoping is based on qualified names and name spaces. It adds name space support to your language, which is comparable and similar to the one in Scala and C#. Scala and C# both allow to have multiple nested packages within one file and you can put imports per namespace, so that imported names are only visible within that namespace. See the domain model example its scope provider extends  
					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/scoping/impl/AbstractDeclarativeQualifiedNameScopeProvider.java?root=Modeling_Project&view=co" target="_new">AbstractDeclarativeQualifiedNameScopeProvider</a>.
				</p>
<div class="section" title="IQualifiedNameProvider">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="org.eclipse.xtextsrcorg.eclipse.xtext.scoping.IQualifiedNameProvider"></a>
						<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/scoping/IQualifiedNameProvider.java?root=Modeling_Project&view=co" target="_new">IQualifiedNameProvider</a>
					
</h4>
</div>
</div>
</div>
<p>The 
						<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/scoping/impl/QualifiedNameScopeProvider.java?root=Modeling_Project&view=co" target="_new">QualifiedNameScopeProvider</a> makes use of the so called 
						<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/scoping/IQualifiedNameProvider.java?root=Modeling_Project&view=co" target="_new">IQualifiedNameProvider</a> service. It computes qualified names for EObjects. The default implementation (
						<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/scoping/impl/DefaultDeclarativeQualifiedNameProvider.java?root=Modeling_Project&view=co" target="_new">DefaultDeclarativeQualifiedNameProvider</a>) uses a simple name look up and concats the result to the qualified name of its parent object. See its JavaDoc and the code for more details.
					</p>
</div>
<div class="section" title="Importing name spaces">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="Importingnamespaces"></a>Importing name spaces</h4>
</div>
</div>
</div>
<p>The QualifiedNameScopeProvider looks up EAttributes with name &sbquo;importNamespace&rsquo; and interprets such as import statements.
						By default qualified names with or without a wildcard at the end are supported. For an import of a qualified name the simple name is made available as we know from e.g. Java, where</p>
<div class="literallayout">
<p>
<code class="code">import&nbsp;java.util.Set;<br>

</code>
</p>
</div>
<p>makes it possible to refer to &sbquo;java.util.Set&rsquo; by its simple name &sbquo;Set&rsquo;.
						Contrary to Java the import is not active for the whole file but only for the namespace it is declared in and its child namespaces. That is why you can write the following in the example DSL:</p>
<div class="literallayout">
<p>
<code class="code">package&nbsp;foo&nbsp;{<br>
&nbsp;&nbsp;import&nbsp;bar.Foo<br>
&nbsp;&nbsp;entity&nbsp;Bar&nbsp;extends&nbsp;Foo&nbsp;{<br>
&nbsp;&nbsp;}<br>
}<br>

<br>
package&nbsp;bar&nbsp;{<br>
&nbsp;&nbsp;entity&nbsp;Foo&nbsp;{}<br>
}<br>

<br>

</code>
</p>
</div>
<p>Of course the declared elements within a package are as well referable by their simple name:</p>
<div class="literallayout">
<p>
<code class="code">package&nbsp;bar&nbsp;{<br>
&nbsp;&nbsp;entity&nbsp;Bar&nbsp;extends&nbsp;Foo&nbsp;{}<br>
&nbsp;&nbsp;entity&nbsp;Foo&nbsp;{}<br>
}<br>

<br>

</code>
</p>
</div>
<p>Of course the following would as well be ok:</p>
<div class="literallayout">
<p>
<code class="code">package&nbsp;bar&nbsp;{<br>
&nbsp;&nbsp;entity&nbsp;Bar&nbsp;extends&nbsp;bar.Foo&nbsp;{}<br>
&nbsp;&nbsp;entity&nbsp;Foo&nbsp;{}<br>
}<br>

<br>

</code>
</p>
</div>
<p>As the name suggests it uses the EMF index to find any EObjects which are not located in the current resource. 
						The 
						<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/index/IndexBasedScopeProvider.java?root=Modeling_Project&view=co" target="_new">IndexBasedScopeProvider</a> supports nested namespaces (similar to C# and Scala) and is used in the Domainmodel example (project org.eclipse.xtext.example.domainmodel). There is support for declarative overwriting of the default semantics if you subclass 
						<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/index/AbstractDeclarativeIndexBasedScopeProvider.java?root=Modeling_Project&view=co" target="_new">AbstractDeclarativeIndexBasedScopeProvider</a>.
					</p>
<p>See the JavaDocs and 
						<a class="ulink" href="http://blog.efftinge.de/2009/07/xtext-scopes-and-emf-index-in-action.html" target="_new">this blog post</a> for details.
					</p>
</div>
</div>
</div>
<div class="section" title="Value Converter">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="valueconverter"></a>Value Converter</h2>
</div>
</div>
</div>
<p>Value converters are registered to convert the parsed text into a certain data type instance and vice versa.
				The primary hook is called 
				<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/conversion/IValueConverterService.java?root=Modeling_Project&view=co" target="_new">IValueConverterService</a> and the concrete implementation can be registered via the runtime 
				<a class="link" href="#guicecustomize" title="Changing Configuration">Guice module</a>.
				To do so override the corresponding binding in your runtime module like shown in this example:
			</p>
<div class="literallayout">
<p>
<code class="code">@Override<br>
public&nbsp;Class&lt;?&nbsp;extends&nbsp;IValueConverterService&gt;&nbsp;bindIValueConverterService()&nbsp;{<br>
&nbsp;&nbsp;return&nbsp;MySpecialValueConverterService.class;<br>
}<br>

<br>

</code>
</p>
</div>
<div class="section" title="Annotation based value converters">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="Annotationbasedvalueconverters"></a>Annotation based value converters</h3>
</div>
</div>
</div>
<p>The most simple way to register additional value converters is to make use of 
					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/conversion/impl/AbstractDeclarativeValueConverterService.java?root=Modeling_Project&view=co" target="_new">AbstractDeclarativeValueConverterService</a>, which allows to
					declaratively register an 
					<code class="code">IValueConverter</code> via an annotated method. 
				</p>
<p>The implementation for the default token grammar looks like </p>
<div class="literallayout">
<p>
<code class="code">public&nbsp;class&nbsp;DefaultTerminalConverters&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;extends&nbsp;AbstractDeclarativeValueConverterService&nbsp;{<br>
&nbsp;&nbsp;<br>
&nbsp;&nbsp;(..)<br>
&nbsp;&nbsp;<br>
&nbsp;&nbsp;@ValueConverter(rule&nbsp;=&nbsp;"ID")<br>
&nbsp;&nbsp;public&nbsp;IValueConverter&lt;String&gt;&nbsp;ID()&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;new&nbsp;AbstractNullSafeConverter&lt;String&gt;()&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;protected&nbsp;String&nbsp;internalToValue(String&nbsp;string,&nbsp;AbstractNode&nbsp;node)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;string.startsWith("^")&nbsp;?&nbsp;string.substring(1)&nbsp;:&nbsp;string;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;protected&nbsp;String&nbsp;internalToString(String&nbsp;value)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(GrammarUtil.getAllKeywords(getGrammar()).contains(value))&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;"^"&nbsp;+&nbsp;value;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;value;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;};<br>
&nbsp;&nbsp;}<br>
&nbsp;&nbsp;...&nbsp;&nbsp;some&nbsp;other&nbsp;value&nbsp;converter<br>
}<br>

<br>

</code>
</p>
</div>
<p>If you use the common terminals grammar 
					<code class="code">org.eclipse.xtext.common.Terminals</code> you should subclass 
					<code class="code">DefaultTerminalConverters</code> and override or add additional value converters by adding the respective methods.
				</p>
<p>Imagine, you would want to add a rule BIG_DECIMAL creating BigDecimals, it would look like this one:</p>
<div class="literallayout">
<p>
<code class="code">@ValueConverter(rule&nbsp;=&nbsp;"BIG_DECIMAL")<br>
public&nbsp;IValueConverter&lt;BigDecimal&gt;&nbsp;BIG_DECIMAL()&nbsp;{<br>
&nbsp;&nbsp;return&nbsp;new&nbsp;AbstractToStringConverter&lt;BigDecimal&gt;()&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
&nbsp;&nbsp;&nbsp;&nbsp;protected&nbsp;BigDecimal&nbsp;internalToValue(String&nbsp;string,&nbsp;AbstractNode&nbsp;node)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;BigDecimal.valueOf(string);<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;};<br>
}<br>

<br>

</code>
</p>
</div>
</div>
</div>
<div class="section" title="Serialization">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="serialization"></a>Serialization</h2>
</div>
</div>
</div>
<p>Serialization is the process of transforming an EMF model into its textual representation. Thereby, serialization complements parsing and lexing.</p>
<p>In Xtext, the process of serialization is split into three steps:</p>
<div class="orderedlist">
<ol class="orderedlist" type="1">
<li class="listitem">
<p>Matching the model elements with the grammar rules and creating a stream of tokens. This is done by the 
						<a class="link" href="#parsetreeconstructor" title="Parse Tree Constructor">parse tree constructor</a>.
					</p>
</li>
<li class="listitem">
<p>Mixing existing hidden tokens (whitespace, comments, etc.) into the token stream. This is done by the 
						<a class="link" href="#hiddentokenmerger" title="Hidden Token Merger">hidden token merger</a>.
					</p>
</li>
<li class="listitem">
<p>Adding needed whitespace or replacing all whitespace using a 
						<a class="link" href="#formatting" title="Formatting (Pretty Printing)">formatter</a>.  
					</p>
</li>
</ol>
</div>
<p>Serialization is invoked when calling 
				<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/resource/XtextResource.java?root=Modeling_Project&view=co" target="_new">XtextResource</a>
				<code class="code">.save(...)</code>. Furthermore, 
				<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/parsetree/reconstr/SerializerUtil.java?root=Modeling_Project&view=co" target="_new">SerializerUtil</a> provides resource-independent support for serialization.
			</p>
<div class="section" title="The Contract">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="serializationcontract"></a>The Contract</h3>
</div>
</div>
</div>
<p>The contract of serialization says that a model that is serialized to its textual representation and then loaded (parsed) again should yield a loaded model that equals the original model. Please be aware that this does 
					<span class="emphasis"><em>not</em></span> imply, that loading a textual representation and serializing it back produces identical textual representations. For example, this is the case when a default value is used in a textual representation and the assignment is optional. Another example is:
				</p>
<div class="literallayout">
<p>
<code class="code">MyRule:<br>
&nbsp;&nbsp;(xval+=ID&nbsp;|&nbsp;yval+=INT)*;<br>
&nbsp;&nbsp;<br>

</code>
</p>
</div>
<p>
					
<code class="code">MyRule</code> in this example reads 
					<code class="code">ID</code>- and 
					<code class="code">INT</code>-elements which may occur in an arbitrary order in the textual representation. However, when serializing the model all 
					<code class="code">ID</code>-elements will be written first and then all 
					<code class="code">INT</code>-elements. If the order is important it can be preserved by storing all elements in the same list &ndash; which may require wrapping the 
					<code class="code">ID</code>- and 
					<code class="code">INT</code>-elements into objects.   
				</p>
</div>
<div class="section" title="Parse Tree Constructor">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="parsetreeconstructor"></a>Parse Tree Constructor</h3>
</div>
</div>
</div>
<p>The parse tree constructor usually does not need to be customized since it is automatically derived from the 
					<a class="link" href="#grammarLanguage" title="Chapter&nbsp;4.&nbsp;The Grammar Language">Xtext Grammar</a>. However, it can be a good idea to look into it to understand its error messages and its runtime performance.
				</p>
<p>For serialization to succeed, the parse tree constructor must be able to 
					<span class="emphasis"><em>consume</em></span> every element of the to-be-serialized EMF model. To 
					<span class="emphasis"><em>consume</em></span> means, in this context, to write the element to the textual representation of the model. This can turn out to be a not-so-easy to fulfill requirement, since a grammar usually introduces implicit constraints to the EMF model. Example:
				</p>
<div class="literallayout">
<p>
<code class="code">MyRule:<br>
&nbsp;&nbsp;(sval+=ID&nbsp;ival+=INT)*;<br>
	
<br>

</code>
</p>
</div>
<p>This example introduces the constraint  
					<code class="code">sval.size() == ival.size()</code>. Models which violate this constraint are sort of valid EMF models, but they can not be serialized. To check whether a model complies with all constraints introduced by the grammar, the only way is currently to invoke the parse tree constructor. If this changes at some day, there will be news in 
					<a class="ulink" href="https://bugs.eclipse.org/bugs/show_bug.cgi?id=239565" target="_new">bugzilla 239565</a>.
				</p>
<p>For the parse tree constructor, this can lead to the scenarios, where</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>a model element can not be consumed. This can have the following reasons/solutions:</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="circle">
<li class="listitem">
<p>The model element should not be stored in the model.</p>
</li>
<li class="listitem">
<p>The grammar needs an assignment which would consume the model element.</p>
</li>
<li class="listitem">
<p>The 
									<a class="link" href="#transientvalues" title="Transient Values">transient value service</a> could be used to indicate that this model element should not be consumed. 
								</p>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>an assignment in the grammar has no corresponding model element. The parse tree constructor considers a model element not to be present if it is 
							<span class="emphasis"><em>unset</em></span> or equals its default value. However, the parse tree constructor may serialize default values if this is required by a grammar constraint to be able to serialize another model element. The following solution may help to solve such a scenario:
						</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="circle">
<li class="listitem">
<p>A model element should be added to the model.</p>
</li>
<li class="listitem">
<p>The assignment in the grammar should be made optional.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<p>To understand error messages and performance issues of the parse tree constructor it is important to know that it implements a backtracking algorithm. This basically means that the grammar is used to specify the structure of a tree in which one path (from the root node to a leaf node) is a valid serialization of a specific model. The parse tree constructor&rsquo;s task is to find this path &ndash; with the condition, that all model elements are consumed while walking this path. The parse tree constructor&rsquo;s strategy is to take the most promising branch first (the one that would consume the most model elements). If the branch leads to a dead end (for example, if a model element needs to be consumed that is not present in the model), the parse tree constructor goes back the path until a different branch can be taken. This behavior has two consequences:</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>In case of an error, the parse tree constructor has found only dead ends but no leaf. It cannot tell which dead end is actually erroneous. Therefore, the error message lists dead ends of the longest paths, a fragment of their serialization and the reason why the path could not be continued at this point. The developer has to judge on his own which reason is the actual error.</p>
</li>
<li class="listitem">
<p> For reasons of performance, it is critical that the parse tree constructor takes the most promising branch first and detects wrong branches early. One way to achieve this is to avoid having many rules which return the same type and which are called from within the same alternative in the grammar.   </p>
</li>
</ul>
</div>
</div>
<div class="section" title="Transient Values">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="transientvalues"></a>Transient Values</h3>
</div>
</div>
</div>
<p>Transient values are values or model elements which are not persisted (written to the textual representation in the serialization phase). If a model contains model elements which can not be serialized with the current grammar, it is critical to mark them transient using the 
					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/parsetree/reconstr/ITransientValueService.java?root=Modeling_Project&view=co" target="_new">ITransientValueService</a>, or serialization will fail. The default implementation marks all model elements transient, that are 
					<span class="emphasis"><em>unset</em></span> or equal to their default value.  
				</p>
</div>
<div class="section" title="Unassigned Text">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="unassignedtext"></a>Unassigned Text</h3>
</div>
</div>
</div>
<p>Unassigned text can be necessary due to data type rule calls or terminal rule calls which do not reside within an assignment. Example:</p>
<div class="literallayout">
<p>
<code class="code">PluralRule:<br>
&nbsp;&nbsp;'contents:'&nbsp;count=INT&nbsp;Plural;<br>
&nbsp;&nbsp;<br>
terminal&nbsp;Plural:&nbsp;<br>
&nbsp;&nbsp;'item'&nbsp;|&nbsp;'items';<br>
&nbsp;&nbsp;<br>

</code>
</p>
</div>
<p>Valid models for this example are 
					<code class="code">contents 1 item</code> or 
					<code class="code">contents 5 items</code>. However, it is not stored in the semantic model whether the keyword 
					<code class="code">item</code> or 
					<code class="code">items</code> has been parsed. This is due to the fact that the rule call 
					<code class="code">Plural</code> is unassigned. However, the 
					<a class="link" href="#parsetreeconstructor" title="Parse Tree Constructor">parse tree constructor</a> needs to decide which value to write during serialization. This decision can be be made by implementing the 
					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/parsetree/reconstr/IUnassignedTextSerializer.java?root=Modeling_Project&view=co" target="_new">IUnassignedTextSerializer</a>.  
				</p>
</div>
<div class="section" title="Cross Reference Serializer">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="crossreferenceserializer"></a>Cross Reference Serializer</h3>
</div>
</div>
</div>
<p>The cross reference serializer specifies which values are to be written to the textual representation for cross references. This behavior can be customized by implementing 
					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/parsetree/reconstr/ICrossReferenceSerializer.java?root=Modeling_Project&view=co" target="_new">ICrossReferenceSerializer</a>. The default implementation delegates to 
					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/linking/ILinkingService.java?root=Modeling_Project&view=co" target="_new">ILinkingService</a>, which may be the better place for customization.
				</p>
</div>
<div class="section" title="Hidden Token Merger">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="hiddentokenmerger"></a>Hidden Token Merger</h3>
</div>
</div>
</div>
<p>After the 
					<a class="link" href="#parsetreeconstructor" title="Parse Tree Constructor">parse tree constructor</a> has done its job to create a stream of tokens which are to be written to the textual representation, the hidden token merger (
					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/parsetree/reconstr/IHiddenTokenMerger.java?root=Modeling_Project&view=co" target="_new">IHiddenTokenMerger</a>) mixes existing hidden tokens into this token stream. The default implementation uses the hidden tokens (whitespace, line breaks, comments) from the node model. The 
					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/parsetree/reconstr/IHiddenTokenMerger.java?root=Modeling_Project&view=co" target="_new">IHiddenTokenMerger</a> is the factory for a 
					<a class="link" href="#tokenstream" title="Token Stream">token stream</a> which is fed by the 
					<a class="link" href="#parsetreeconstructor" title="Parse Tree Constructor">parse tree constructor</a> and which writes to another token stream.  
				</p>
</div>
<div class="section" title="Token Stream">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="tokenstream"></a>Token Stream</h3>
</div>
</div>
</div>
<p>The 
					<a class="link" href="#parsetreeconstructor" title="Parse Tree Constructor">parse tree constructor</a>, the 
					<a class="link" href="#hiddentokenmerger" title="Hidden Token Merger">hidden token merger</a> and the 
					<a class="link" href="#formatting" title="Formatting (Pretty Printing)">formatter</a> use an 
					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/parsetree/reconstr/ITokenStream.java?root=Modeling_Project&view=co" target="_new">ITokenStream</a> for their output, and the latter two for their input as well. This makes them chainable. Token streams can be converted to a 
					<code class="code">String</code> using the 
					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/parsetree/reconstr/impl/TokenStringBuffer.java?root=Modeling_Project&view=co" target="_new">TokenStringBuffer</a> and to an 
					<code class="code">OutputStream</code> using the 
					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/parsetree/reconstr/impl/TokenOutputStream.java?root=Modeling_Project&view=co" target="_new">TokenOutputStream</a>. Maybe there will be an implementation to reconstruct a node model as well at some point in the future. While providing fast output due to the stream pattern, token streams allow easy manipulation of the stream, such as mixing in whitespace or manipulating them.    
				</p>
<div class="literallayout">
<p>
<code class="code">public&nbsp;interface&nbsp;ITokenStream&nbsp;{<br>
&nbsp;&nbsp;public&nbsp;void&nbsp;close()&nbsp;throws&nbsp;IOException;<br>
&nbsp;&nbsp;public&nbsp;void&nbsp;writeHidden(<br>
&nbsp;&nbsp;&nbsp;&nbsp;EObject&nbsp;grammarElement,&nbsp;String&nbsp;value)&nbsp;throws&nbsp;IOException;<br>
&nbsp;&nbsp;public&nbsp;void&nbsp;writeSemantic(<br>
&nbsp;&nbsp;&nbsp;&nbsp;EObject&nbsp;grammarElement,&nbsp;String&nbsp;value)&nbsp;throws&nbsp;IOException;<br>
}<br>

<br>
&nbsp;<br>

</code>
</p>
</div>
</div>
</div>
<div class="section" title="Integration with EMF">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="emf_integration"></a>Integration with EMF</h2>
</div>
</div>
</div>
<p>Xtext relies heavily on EMF internally, but it can also be used as the serialization back-end of other EMF-based tools.</p>
<div class="section" title="XtextResource Implementation">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="XtextResourceImplementation"></a>XtextResource Implementation</h3>
</div>
</div>
</div>
<p>Xtext provides an implementation of EMF&rsquo;s resource, the 
					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/resource/XtextResource.java?root=Modeling_Project&view=co" target="_new">XtextResource</a>. This does not only encapsulate the parser that converts text to an EMF model but also the serializer working the opposite direction. That way, an Xtext model just looks like any other Ecore-based model from the outside, making it amenable for the use by other EMF based tools. In fact, the Xpand templates in the generator plug-in created by the Xtext wizard do not make any assumption on the fact that the model is described in Xtext, and they would work fine with any model based on the same Ecore model of the language. So in the ideal case, you can switch the serialization format of your models to your self-defined DSL by just replacing the resource implementation used by your other modeling tools. 
				</p>
<p>
					
</p>
<div class="mediaobject">
<img src="images/emf-integration.png"></div>
<p>
				
</p>
<p>The generator fragment 
					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.generator/src/org/eclipse/xtext/generator/resourceFactory/ResourceFactoryFragment.java?root=Modeling_Project&view=co" target="_new">ResourceFactoryFragment</a> registers a factory for the 
					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/resource/XtextResource.java?root=Modeling_Project&view=co" target="_new">XtextResource</a> to EMF&rsquo;s resource factory registry, such that all tools using the default mechanism to resolve a resource implementation will automatically get that resource implementation.   
				</p>
<p>Using a self-defined textual syntax as the primary storage format has a number of advantages over the default XMI serialization, e.g.</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>You can use well-known and easy-to-use tools and techniques for manipulation, such as text editors, regular expressions, or stream editors.</p>
</li>
<li class="listitem">
<p>You can use the same tools for version control as you use for source code. Merging and diffing is performed in a syntax the developer is familiar with. </p>
</li>
<li class="listitem">
<p>It is impossible to break the model such that it cannot be reopened in the editor again. </p>
</li>
<li class="listitem">
<p>Models can be fixed using the same tools, even if they have become incompatible with a new version of the Ecore model.</p>
</li>
</ul>
</div>
<p>Xtext targets easy to use and naturally feeling languages. It focuses on the lexical aspects of a language a bit more than on the semantic ones. As a consequence, a referenced Ecore model can contain more concepts than are actually covered by the Xtext grammar. As a result, not everything that is possibly expressed in the EMF model can be serialized back into a textual representation with regards to the grammar. So if you want to use Xtext to serialize your models as described above, it is good to have a couple of things in mind:</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>Prefer optional rule calls (cardinality 
							<code class="code">?</code> or 
							<code class="code">*</code>) to mandatory ones (cardinality 
							<code class="code">+</code> or default), such that missing references will not obstruct serialization. 
						</p>
</li>
<li class="listitem">
<p>You should not use an Xtext-Editor on the same model instance as a self-synchronizing other editor, e.g. a canonical GMF editor (see :#gmf_integration_stage_1 for details). The Xtext parser replaces re-parsed subtrees of the AST rather than modifying it, so elements will become stale. As the Xtext editor continuously re-parses the model on changes, this will happen rather often. It is safer to synchronize editors more loosely, e.g. on file changes. </p>
</li>
<li class="listitem">
<p>Implement an 
							<code class="code">IFragmentProvider</code>:#fragmentProvider to make the XtextResource return stable fragments for its contained elements, e.g. based on composite names rather than order of appearance.
						</p>
</li>
<li class="listitem">
<p>Implement an 
							<code class="code">IQualifiedNameProvider</code> and an 
							<code class="code">IScopeProvider</code>:#scoping to make the names of all linkable elements in cross-references unique. 
						</p>
</li>
<li class="listitem">
<p>Provide an 
							<code class="code">IFormatter</code>:#formatting to improve the readability of the generated textual models.  
						</p>
</li>
<li class="listitem">
<p>Register an 
							<code class="code">IReferableElementsUnloader</code> to turn deleted/replaced model elements into EMF proxies. Design the rest of your application such that it does never keep references to  
							<code class="code">EObjects</code> or to cope with proxies. That will improve the stability of your application drastically.
						</p>
</li>
<li class="listitem">
<p>Xtext will register an EMF 
							<code class="code">ResourceFactory</code>, so resources with the file extension you entered when generating the Xtext plug-ins will be automatically loaded in an 
							<code class="code">XtextResource</code> when you use EMF&rsquo;s 
							<code class="code">ResourceSet</code> API to load it.
						</p>
</li>
</ul>
</div>
</div>
<div class="section" title="Integration with GMF">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="gmf_integration"></a>Integration with GMF</h3>
</div>
</div>
</div>
<p>To illustrate how to build a graphical editor on top of an 
					<code class="code">XtextResource</code> we have provided an example. It consists of a number of plug-ins
				</p>
<table id="N112CC">
<tr>
						
<td>Plug-in</td>
						<td>Framework</td>
						<td>Purpose</td>
						<td>Contents</td>
					
</tr>
<tr>
						
<td>org.eclipse.xtext.example.gmf</td>
						<td>Xtext</td>
						<td>Xtext runtime plug-in</td>
						<td>Grammar, derived metamodel and language infrastructure</td>
					
</tr>
<tr>
						
<td>org.eclipse.xtext.example.gmf.ui</td>
						<td>Xtext</td>
						<td>Xtext UI plug-in</td>
						<td>Xtext editor and services</td>
					
</tr>
<tr>
						
<td>org.eclipse.xtext.example.gmf.edit</td>
						<td>EMF</td>
						<td>EMF.edit plug-in</td>
						<td>UI services generated from the metamodel</td>
					
</tr>
<tr>
						
<td>org.eclipse.xtext.example.gmf.models</td>
						<td>GMF</td>
						<td>GMF design models</td>
						<td>Input for the GMF code generator</td>
					
</tr>
<tr>
						
<td>org.eclipse.xtext.example.gmf.diagram</td>
						<td>GMF</td>
						<td>GMF diagram editor</td>
						<td>Purely generated from the GMF design models</td>
					
</tr>
<tr>
						
<td>org.eclipse.xtext.example.gmf.diagram.extensions</td>
						<td>GMF / Xtext</td>
						<td>Manual extensions to the generated GMF editor for integration with Xtext</td>
					
</tr>
<tr>
						
<td>org.eclipse.xtext.gmf.glue</td>
						<td>Xtext/GMF</td>
						<td>Glue code</td>
						<td>Generic code to integrate Xtext and GMF</td>
					
</tr>
</table>
<div class="section" title="Stage 1: Make GMF read and write the semantic model as text">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="gmf_integration_stage_1"></a>Stage 1: Make GMF read and write the semantic model as text</h4>
</div>
</div>
</div>
<p>A diagram editor in GMF by default manages two resources: One for the semantic model, that is the model we&rsquo;re actually interested in for further processing. In our example it is a model representing entities and datatypes. The second resource holds the notation model. It represents the shapes you see in the diagram and their graphical properties. Notation elements reference their semantic counterparts. An entity&rsquo;s name would be in the semantic model, while the font to draw it in the diagram would be stored the notation model. Note that in the integration example we&rsquo;re only trying to represent the semantic resource as text.</p>
<p>To keep the semantic model and the diagram model in sync, GMF uses a so called 
						<code class="code">CanonicalEditPolicy</code>. This component registers as a listener to the semantic model and automatically updates diagram elements when their semantic counterparts change, are added or are removed. Some notational information can be derived from the semantic model by some default mapping, but usually there is a lot of graphical stuff that the user wants to change to make the diagram look better.   
					</p>
<p>In an Xtext editor, changes in the text are transfered to the underlying 
						<code class="code">XtextResource</code> by a call to the method 
						<code class="code">org.eclipse.xtext.resource.XtextResource.update(int, int, String)</code>, which will trigger a partial parsing of the dirty text region and a replacement of the corresponding subtree in the AST model (semantic model). 
					</p>
<p>Having an Xtext editor and a canonical GMF editor on the same resource can therefore lead to loss of notational information, as a change in the Xtext editor will remove a subtree in the AST, causing the  
						<code class="code">CanonicalEditPolicy</code> to remove all notational elements, even though it was customized by the user. The Xtext rebuilds the AST and the notation model is restored using the default mapping. It is therefore not recommended to let an Xtext editor and a canonical GMF editor work on the same resource.    
					</p>
<p>In this example, we let each editor use its own memory instance of the model and synchronize on file changes only. Both frameworks already synchronize with external changes to the edited files out-of-the-box. In the glue code, a 
						<code class="code">org.eclipse.xtext.gmf.glue.concurrency.ConcurrentModificationObserver</code> warns the user if she tries to edit the same file with two different model editors concurrently.
					</p>
<p>In the example, we started with writing an Xtext grammar for an entity language. As explained above, we preferred optional assignments and rather covered mandatory attributes in a validator. Into the bargain, we added some services to improve the EMF integration, namely a formatter, a fragment provider and an unloader. Then we let Xtext generate the language infrastructure. From the derived Ecore model and its generator model, we generated the edit plug-in (needed by GMF) and added some fancier icons. </p>
<p>From the GMF side, we followed the default procedure and created a gmfgraph model, a gmftool model and a gmfmap model referring to the Ecore model derived form the Xtext grammar. We changed some settings in the gmfgen model derived by GMF from the gmfmap model, namely to enable printing and to enable validation and validation decorators. Then we generated the diagram editor.     </p>
<p>Voil&agrave;, we now have a diagram editor that reads/writes its semantic model as text. Also note that the validator from Xtext is already integrated in the diagram editor via the menu bar. </p>
</div>
<div class="section" title="Stage 2: Calling the Xtext parser to parse GMF labels">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="Stage2CallingtheXtextparsertoparseGMFlabels"></a>Stage 2: Calling the Xtext parser to parse GMF labels</h4>
</div>
</div>
</div>
<p>GMF&rsquo;s generated parser for the labels is a bit poor: It will work on attributes only, and will fail for cross-references, e.g. an attibute&rsquo;s type. So why not use the Xtext parser to process the user&rsquo;s input? </p>
<p>An 
						<code class="code">XtextResource</code> keeps track of it&rsquo;s concrete syntax representation by means of a so called node model (see :#parser_rules for a more detailed description). The node model represents the parse tree and provides information on the offset, length and text that has been parsed to create a semantic model element. The nodes are attached to their semantic elements by means of a node adapter.    
					</p>
<p>We can use the node adapter to access the text block that represents an attribute, and call the Xtext parser to parse the user input. The example code is contained in  
						<code class="code">org.eclipse.xtext.gmf.glue.edit.part.AntlrParserWrapper</code>. 
						<code class="code">org.eclipse.xtext.example.gmf.diagram.edit.part.SimplePropertyWrapperEditPartOverride</code> shows how this is integrated into the generated GMF editor. Use the 
						<code class="code">EntitiesEditPartFactoryOverride</code> to instantiate it and the 
						<code class="code">EntitiesEditPartProviderOverride</code> to create the overridden factory, and register the latter to the extension point. Note that this is a non-invasive way to extend generated GMF editors.
					</p>
<p>When you test the editor, you will note that the node model will be corrupt after editing a few labels. This is because the node model is only updated by the Xtext parser and not by the serializer. So we need a way to automatically call the (partial) parser every time the semantic model is changed. You will find the required classes in the package ${org.eclipse.xtext.gmf.glue/src/org.eclipse.xtext.gmf.glue.editingdomain}. To activate node model reconciling, you have to add a line </p>
<div class="literallayout">
<p>
<code class="code">org.eclipse.xtext.gmf.glue.editingdomain.XtextNodeModelReconciler.adapt(editingDomain);<br>

<br>

</code>
</p>
</div>
<p>in the method 
						<code class="code">createEditingDomain()</code> of the generated 
						<code class="code">EntitiesDocumentProvider</code>. To avoid changing the generated code, you can modify the code generation template for that class by setting
					</p>
<div class="literallayout">
<p>
<code class="code">Dynamic&nbsp;Templates&nbsp;-&gt;&nbsp;true<br>
	&nbsp;&nbsp;&nbsp;Template&nbsp;Directory&nbsp;-&gt;&nbsp;"org.eclipse.xtext.example.gmf.models/templates"<br>
	&nbsp;&nbsp;&nbsp;<br>

</code>
</p>
</div>
<p>in the 
						<code class="code">GenEditorGenerator</code> and 
					</p>
<div class="literallayout">
<p>
<code class="code">Required&nbsp;Plugins&nbsp;-&gt;&nbsp;"org.eclipse.xtext.gmf.glue"&nbsp;<br>

<br>

</code>
</p>
</div>
<p>in the 
						<code class="code">GenPlugin</code> element of the gmfgen before generating the diagram editor anew.
					</p>
</div>
<div class="section" title="Stage 3: A Popup Xtext Editor (experimental)">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="Stage3APopupXtextEditorexperimental"></a>Stage 3: A Popup Xtext Editor (experimental)</h4>
</div>
</div>
</div>
<p>
						
<code class="code">SimplePropertyPopupXtextEditorEditPartOverride</code> demonstrates how to spawn an Xtext editor to edit a model element. The editor pops up in its control and shows only the section of the selected element. It is a fully fledged Xtext editor, with support of validation, code assist and syntax highlighting. The edited text is only transfered back to the model if it does not have any errors.   
					</p>
<p>Note that there still are synchronization issues, that&rsquo;s why we keep this one marked as experimental.</p>
</div>
</div>
<div class="section" title="Fragment Provider (referencing Xtext models from other EMF artifacts)">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="fragmentProvider"></a>Fragment Provider (referencing Xtext models from other EMF artifacts)</h3>
</div>
</div>
</div>
<p>Although inter-Xtext linking is not done by URIs, you may want to be able to reference your 
					<code class="code">EObject</code> from non-Xtext models.
					In those cases URIs are used, which are made up of a part identifying the resource. Each 
					<code class="code">EObject</code> contained in a resource can be identified by a so called 
					<span class="emphasis"><em>fragment</em></span>.
				</p>
<p>A fragment is a part of an EMF URI and needs to be unique per resource.</p>
<p>The generic XMI resource shipped with EMF provides a generic path-like computation of fragments. With an XMI or other binary-like serialization it is also common and possible to use UUIDs.</p>
<p>However with a textual concrete syntax we want to be able to compute fragments out of the given information. We don&rsquo;t want to force people to use UUIDs (i.e. synthetic identifiers) or relative generic paths (very fragile), in order to refer to 
					<code class="code">EObjects</code>.
				</p>
<p>Therefore one can contribute a so called 
					<code class="code">IFragmentProvider</code> per language.
				</p>
<div class="literallayout">
<p>
<code class="code">public&nbsp;interface&nbsp;IFragmentProvider&nbsp;extends&nbsp;ILanguageService&nbsp;{<br>
&nbsp;<br>
&nbsp;&nbsp;/**<br>
&nbsp;&nbsp;&nbsp;*&nbsp;Computes&nbsp;the&nbsp;local&nbsp;ID&nbsp;of&nbsp;the&nbsp;given&nbsp;object.&nbsp;<br>
&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;obj<br>
&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;EObject&nbsp;to&nbsp;compute&nbsp;the&nbsp;fragment&nbsp;for<br>
&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;the&nbsp;fragment,&nbsp;which&nbsp;can&nbsp;be&nbsp;an&nbsp;arbitrary&nbsp;string&nbsp;but&nbsp;must&nbsp;be&nbsp;<br>
&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unique&nbsp;within&nbsp;a&nbsp;resource.&nbsp;Return&nbsp;null&nbsp;to&nbsp;use&nbsp;default&nbsp;<br>
&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;implementation<br>
&nbsp;&nbsp;&nbsp;*/<br>
&nbsp;&nbsp;String&nbsp;getFragment(EObject&nbsp;obj);<br>
&nbsp;&nbsp;<br>
&nbsp;&nbsp;/**<br>
&nbsp;&nbsp;&nbsp;*&nbsp;Locates&nbsp;an&nbsp;EObject&nbsp;in&nbsp;a&nbsp;resource&nbsp;by&nbsp;its&nbsp;fragment.&nbsp;<br>
&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;the&nbsp;EObject&nbsp;<br>
&nbsp;&nbsp;&nbsp;*/<br>
&nbsp;&nbsp;EObject&nbsp;getEObject(Resource&nbsp;resource,&nbsp;String&nbsp;fragment);<br>
}<br>

<br>

</code>
</p>
</div>
<p>Note that the currently available default fragment provider does nothing (i.e. falls back to the default behavior of EMF).</p>
</div>
</div>
<div class="section" title="Encoding in Xtext">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="encoding"></a>Encoding in Xtext</h2>
</div>
</div>
</div>
<p>
				
<span class="emphasis"><em>Encoding</em></span>, AKA 
				<span class="emphasis"><em>character set</em></span>, describes the way characters are encoded into bytes and vice versa. 
				Famous standard encodings are &bdquo;UTF-8&rdquo; or &bdquo;ISO-8859-1&rdquo;. The list of available encodings can be determined
				by calling 
				<code class="code">java.nio.Charset.availableCharsets()</code>. There is also a list of encodings and their 
				canonical Java names in the 
				<a class="ulink" href="http://java.sun.com/j2se/1.5.0/docs/guide/intl/encoding.doc.html" target="_new">API docs</a>.
			</p>
<p>Unfortunately, each platform and/or spoken language tends to define its own native encoding, 
				e.g. 
				<code class="code">Cp1258</code> on Windows in Vietnamese or 
				<code class="code">MacIceland</code> on Mac OS X in Icelandic. 
			</p>
<p>In an Eclipse workspace, files, folders, projects can have individual encodings, which are stored
				in the file 
				<code class="code">.settings/org.eclipse.core.resources.prefs</code> in each project. If a resource does not have an 
				explicit encoding, it inherits the one from its parent recursively. Eclipse chooses the native
				platform encoding as the default for the workspace root. You can change the default workspace 
				encoding in the Eclipse preferences 
				<span class="emphasis"><em>Preferences-&gt;Workspace-&gt;Default text encoding</em></span>. If you develop on
				different platforms, you should consider choosing an explicit common encoding for your text or code
				files, especially if you use special characters. 
			</p>
<p>While Eclipse allows to define and inspect the encoding of a file, your file system usually doesn&rsquo;t. 
				Given an arbitrary text file there is no general strategy to tell how it was encoded. If you deploy 
				an Eclipse project as a jar (even a plug-in), any encoding information not stored in the file itself 
				is lost, too. Some languages define the encoding of a file explicitly, as in the first processing 
				instruction of an XML file. Most languages don&rsquo;t. Others imply a fixed encoding or offer enhanced 
				syntax for character literals, e.g. 
				<code class="code">\uXXXX</code> in Java. 
			</p>
<p>As Xtext is about textual modeling, it allows to tweak the encoding in various places.</p>
<div class="section" title="Encoding at Language Design Time">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="EncodingatLanguageDesignTime"></a>Encoding at Language Design Time</h3>
</div>
</div>
</div>
<p>The plug-ins created by the 
					<span class="emphasis"><em>New Xtext Project</em></span> wizard are by default encoded in the workspace&rsquo;s standard
					encoding. The same holds for all files that Xtext generates in there.
					If you want to change that, e.g. because your grammar uses/allows special characters, you should manually 
					set the encoding in the properties of these projects after their creation. Do this before 
					adding special characters to your grammar or at least make sure the grammar reads correctly after the 
					encoding change. To tell the Xtext generator to generate files in the same encoding, set the encoding 
					property in the workflow next to your grammar, e.g.
				</p>
<div class="literallayout">
<p>
<code class="code">Generator&nbsp;{<br>
	encoding&nbsp;="UTF-8"<br>
	...<br>

<br>

</code>
</p>
</div>
</div>
<div class="section" title="Encoding at Language Runtime">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="EncodingatLanguageRuntime"></a>Encoding at Language Runtime</h3>
</div>
</div>
</div>
<p>As each language could handle the encoding problem differently, Xtext offers a service here. 
					The ${org.eclipse.xtext/src/org/eclipse/xtext/parser/IEncodingProvider} has a single method 

					<code class="code">getEncoding(URI)</code> to define the encoding of the resource with the given URI. Users can implement 
					their own strategy but keep in mind that this is not intended to be a long running method. If the 
					encoding is stored within the model file itself, it should be extractable in an easy way, like from 
					then first line in an XML file. The default implementation returns the default Java character set 
					in the runtime scenario. 
				</p>
<p>In the UI scenario, when there is a workspace, users will expect the encoding of the model files 
					to be settable the same way as for other files in the workspace. The default implementation 
					of the 
					<code class="code">IEncodingProvider</code> in the UI scenario Xtext therefore returns the file&rsquo;s workspace encoding 
					for files in the workspace and delegates to the runtime implementation for all other resources, 
					e.g. models in a jar or from a deployed plug-in. Keep in mind that you are going to loose the 
					workspace encoding information as soon as you leave this workspace, e.g. deploy your project.
				</p>
<p>Unless you want to enforce a uniform encoding for all models of your language, we advise to 
					override the runtime service only. It is bound in the runtime module using the binding annotation 

					<code class="code">Runtime</code>. For the uniform encoding, bind the plain 
					<code class="code">IEncodingProvider</code> to the same implementation 
					in both modules.
				</p>
</div>
<div class="section" title="Encoding of an XtextResource">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="EncodingofanXtextResource"></a>Encoding of an XtextResource</h3>
</div>
</div>
</div>
<p>An ${org.eclipse.xtext/src/org/eclipse/xtext/resource/XtextResource} uses the 
					<code class="code">IEncodingProvider</code> 
					of your language by default. You can override that by passing an option on load and save, e.g.
				</p>
<div class="literallayout">
<p>
<code class="code">Map&lt;?,?&gt;&nbsp;options&nbsp;=&nbsp;new&nbsp;HashMap();<br>
options.put(XtextResource.OPTION_ENCODING,&nbsp;"UTF-8");<br>
myXtextResource.load(options);<br>
options.put(XtextResource.OPTION_ENCODING,&nbsp;"ISO-8859-1");<br>
myXtextResource.save(options);<br>

<br>

</code>
</p>
</div>
</div>
<div class="section" title="Encoding in New Model Projects">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="EncodinginNewModelProjects"></a>Encoding in New Model Projects</h3>
</div>
</div>
</div>
<p>The ${org.eclipse.xtext.generator/src/org/eclipse/xtext/ui/generator/projectWizard/SimpleProjectWizardFragment} 
					generates a wizard that clients of your language can use to create model 
					projects. This wizard expects its templates to be in the encoding of the Generator that created it 
					(see above). As every new project wizard, its output will be encoded in the default encoding of the 
					target workspace. </p>
</div>
<div class="section" title="Encoding of Xtext source code">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="EncodingofXtextsourcecode"></a>Encoding of Xtext source code</h3>
</div>
</div>
</div>
<p>The source code of the Xtext framework itself is completely encoded in &bdquo;ISO 8859-1&rdquo;, which is necessary 
					to make the Xpand templates work everywhere (they use french quotation markup). That encoding is hard 
					coded into the Xtext generator code. You are likely never going to change that. </p>
</div>
</div>
</div>
<div class="chapter" title="Chapter&nbsp;7.&nbsp;MWE2">
<div class="titlepage">
<div>
<div>
<h2 class="title">
<a name="MWE2"></a>Chapter&nbsp;7.&nbsp;MWE2</h2>
</div>
</div>
</div>
<p>The Modeling Workflow Engine 2 (MWE2) is a rewritten backwards 
			compatible implementation of the Modeling Workflow Engine (MWE). It 
			is a declarative, externally configurable generator engine. Users 
			can describe arbitrary objects compositions by means of a simple, 
			concise syntax that allows to declare object instances, attribute 
			values and references. One use case &ndash; that&rsquo;s where the name had its 
			origins &ndash; is the definition of workflows. Such a workflow consists 
			usually of a number of components that interact with each other. 
			There are components available, that read EMF resources, perform 
			operations (transformations) on them and write them back or generate 
			any number of other artifacts out of the information. Workflows are 
			typically executed in a single JVM. However there are no constraints 
			the prevent implementors to provide components that spawn multiple 
			threads or new processes.</p>
<div class="section" title="Examples">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="MWE2Exampe"></a>Examples</h2>
</div>
</div>
</div>
<p>Let&rsquo;s start with a couple of examples to demonstrate some usage 
				scenarios for MWE2. The first examples is a simple 
				<code class="code">HelloWorld</code> 
				module that does nothing but print a message to standard out. The 
				second module is assembled of three components that read an ecore 
				file, transform the contained classifier-names to upper-case and 
				serialize the resource back to a new file. The last examples uses 
				the life-cycle methods to print the execution time of the workflow.
			</p>
<div class="section" title="The simplest Workflow">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="MWE2HelloWorld"></a>The simplest Workflow</h3>
</div>
</div>
</div>
<p>The arguably shortest MWE2 module may look like the following 
					snippet.</p>
<div class="literallayout">
<p>
<code class="code">module&nbsp;HelloWorld&nbsp;<br>

<br>
SayHello&nbsp;{<br>
&nbsp;&nbsp;message&nbsp;=&nbsp;"Hello&nbsp;World!"<br>
}<br>

</code>
</p>
</div>
<p>It configures a very simple workflow component with a message 
					that should be printed to 
					<code class="code">System.out</code> when the workflow is 
					executed. The module begins with a declaration of its name. It must 
					fulfill the Java conventions for fully qualified class-names. That&rsquo;s 
					why the module 
					<code class="code">HelloWorld</code> has to be placed into the default 
					package of a Java source folder. The second element in the module is 
					the class-name 
					<code class="code">SayHello</code> which introduces the root element of the 
					module. The interpreter will create an instance of the referenced 
					type and configure it as declared between the curly braces. E.g. the 
					assignment 
					<code class="code">message = "Hello World!"</code> in the module will be 
					interpreted as an invocation of the 
					<code class="code">setMessage(String)</code> on the 
					instantiated object. As one can easily imagine, the implementation 
					of the class 
					<code class="code">SayHello</code> looks straight forward:
				</p>
<div class="literallayout">
<p>
<code class="code">import&nbsp;org.eclipse.emf.mwe2.runtime.workflow.IWorkflowComponent;<br>
import&nbsp;org.eclipse.emf.mwe2.runtime.workflow.IWorkflowContext;<br>

<br>
public&nbsp;class&nbsp;SayHello&nbsp;implements&nbsp;IWorkflowComponent&nbsp;{<br>

<br>
&nbsp;&nbsp;private&nbsp;String&nbsp;message&nbsp;=&nbsp;"Hello&nbsp;World!";<br>
&nbsp;&nbsp;public&nbsp;void&nbsp;setMessage(String&nbsp;message)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;this.message&nbsp;=&nbsp;message;<br>
&nbsp;&nbsp;}<br>
&nbsp;&nbsp;public&nbsp;String&nbsp;getMessage()&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;message;<br>
&nbsp;&nbsp;}<br>

<br>
&nbsp;&nbsp;public&nbsp;void&nbsp;invoke(IWorkflowContext&nbsp;ctx)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;System.out.println(getMessage());<br>
&nbsp;&nbsp;}<br>

<br>
&nbsp;&nbsp;public&nbsp;void&nbsp;postInvoke()&nbsp;{}<br>
&nbsp;&nbsp;public&nbsp;void&nbsp;preInvoke()&nbsp;{}<br>
}<br>

</code>
</p>
</div>
<p>It looks like a simple POJO and that&rsquo;s the philosophy behind MWE2. 
					It is easily possible to assemble completely independent objects in 
					a declarative manner. To make the workflow executable with the 

					<code class="code">WorkflowRunner</code>, the component 
					<code class="code">SayHello</code> must be nested in a root 
					workflow:
				</p>
<div class="literallayout">
<p>
<code class="code">module&nbsp;HelloWorld&nbsp;<br>

<br>
Workflow&nbsp;{<br>
	component&nbsp;=&nbsp;SayHello&nbsp;{<br>
		message&nbsp;=&nbsp;"Hello&nbsp;World!"<br>
	}<br>
}<br>

</code>
</p>
</div>
<p>The class 
					<code class="code">Workflow</code> is actually 

					<code class="code">org.eclipse.emf.mwe2.runtime.workflow.Workflow</code> but its package is 
					implicitly imported in MWE2 modules to make the the modules more 
					concise. The execution result of this workflow will be revealed 
					after a quick 
					<code class="code">Run As .. -&gt; MWE2 Workflow</code> in the console as 
				</p>
<div class="literallayout">
<p>
<code class="code">Hello&nbsp;World!<br>

</code>
</p>
</div>
</div>
<div class="section" title="A simple Transformation">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="MWE2SimpleTransformation"></a>A simple Transformation</h3>
</div>
</div>
</div>
</div>
<div class="section" title="A Stop-watch">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="MWE2Stopwatch"></a>A Stop-watch</h3>
</div>
</div>
</div>
</div>
</div>
<div class="section" title="Language Reference">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="MWE2LanguageReference"></a>Language Reference</h2>
</div>
</div>
</div>
<p>MWE2 has a few well defined concepts which can be combined to 
				assemble arbitrary object graphs in a compact and declarative 
				manner.</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>A MWE2 file defines a 
						<span class="emphasis"><em>module</em></span> which exposes its root 
						<span class="emphasis"><em>component</em></span> as reusable artifact.
					</p>
</li>
<li class="listitem">
<p>
						
<span class="emphasis"><em>Properties</em></span> can be used to extract reusable, configurable parts of the workflow.
					</p>
</li>
<li class="listitem">
<p>Components are mapped to plain vanilla 
						<span class="emphasis"><em>Java objects</em></span>. Arbitrary 
						<span class="emphasis"><em>set- and add-methods</em></span> are used to configure them.
					</p>
</li>
</ul>
</div>
<p>Let&rsquo;s consider the follow short example module and 
				<code class="code">SampleClass</code> to 
				explain these concepts.
			</p>
<div class="literallayout">
<p>
<code class="code">module&nbsp;com.mycompany.Example<br>

<br>
import&nbsp;java.util.*<br>

<br>
SampleClass&nbsp;{<br>
&nbsp;&nbsp;singleValue&nbsp;=&nbsp;'a&nbsp;string'<br>
&nbsp;&nbsp;multiValue&nbsp;=&nbsp;ArrayList&nbsp;{}<br>
&nbsp;&nbsp;child&nbsp;=&nbsp;{}<br>
}&nbsp;<br>

</code>
</p>
</div>
<div class="literallayout">
<p>
<code class="code">package&nbsp;com.mycompany;<br>

<br>
import&nbsp;java.util.List;<br>

<br>
public&nbsp;class&nbsp;SampleClass&nbsp;{<br>
&nbsp;&nbsp;public&nbsp;void&nbsp;setSingleValue(String&nbsp;value)&nbsp;{..}<br>
&nbsp;&nbsp;public&nbsp;void&nbsp;addMultiValue(List&lt;?&gt;&nbsp;value)&nbsp;{..}<br>
&nbsp;&nbsp;public&nbsp;void&nbsp;addChild(SampleClass&nbsp;value)&nbsp;{..}<br>
}<br>

</code>
</p>
</div>
<div class="section" title="Mapping to Java Classes">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="MWE2JavaReferences"></a>Mapping to Java Classes</h3>
</div>
</div>
</div>
<p>The module 
					<code class="code">com.mycompany.Example</code> defines a root component of 
					type 
					<code class="code">com.mycompany.SampleClass</code>. It is possible to use the simple 
					class-name because MWE2 uses the very same visibility rules as the 
					Java compiler. Classes that are in the same package as the module 
					can be referenced by their simple name. The same rule applies for 
					classes from the 
					<code class="code">java.lang</code> package. For convenience reasons is the 
					package 
					<code class="code">org.eclipse.emf.mwe2.runtime.workflow</code> implicitly imported 
					as well as it exposes some library workflow components. However, the
					imports are more flexible since MWE2-imports can be relative, e.g. 
					the 
					<code class="code">import java.*</code> resolves the reference 
					<code class="code">util.ArrayList</code> to 

					<code class="code">java.util.ArrayList</code>.  
				</p>
<p>The root instance of type 
					<code class="code">SampleClass</code> has to be configured 
					after it has been created. Therefore the method 
					<code class="code">setSingleValue</code> 
					will be called at first. The parameter given parameter is 

					<code class="code">'a string'</code>. The method is identified by its name which starts with 

					<code class="code">set</code>. To allow to assign multi-value properties, MWE provides 
					access to methods call 
					<code class="code">add*</code> as well. 
				</p>
<p>If the right side of the assignment in the workflow file does not 
					define an explicit class, its type is inferred from the method 
					parameter. The line 
					<code class="code">child = {}</code> is equivalent to 

					<code class="code">child = SampleClass {}</code> and creates a new instance of 
					<code class="code">SampleClass</code>.
				</p>
<p>MWE2 ships with a nice tool support. The editor will provide 
					content assist for the allowed types and highlight incompatible 
					assignments. The available properties for Java classes will be 
					proposed as well.</p>
</div>
<div class="section" title="Module">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="MWE2Module"></a>Module </h3>
</div>
</div>
</div>
<p>As MWE2 modules have a fully qualified name, it is possible to refer
					to them from other modules. The type of the module is derived from
					the type of its root component. The 
					<code class="code">com.mycompany.Example</code> can be
					assigned at any place where a 
					<code class="code">com.mycompany.SampleClass</code> is expected.
				</p>
<p>Let&rsquo;s create a second module 
					<code class="code">com.mycompany.Second</code> like this:
				</p>
<div class="literallayout">
<p>
<code class="code">module&nbsp;com.mycompany.sub.Second<br>

<br>
import&nbsp;com.mycompany.*<br>

<br>
SampleClass&nbsp;{<br>
&nbsp;&nbsp;child&nbsp;=&nbsp;@Example&nbsp;{}<br>
}&nbsp;<br>

</code>
</p>
</div>
<p>The 
					<code class="code">child</code> value will be assigned to an instance of 
					<code class="code">SampleClass</code> 
					that is configured as in the first example workflow. This enables
					nice composition and a very focused, reusable component design. 
				</p>
<p>As the same rules apply in MWE2 like in Java, the module 

					<code class="code">com.mycompany.sub.Second</code> has to be defined in a file called 

					<code class="code">Second.mwe2</code> in the package 
					<code class="code">com.mycompany.sub</code>. The import semantic
					for other modules is the same as for classes. The import statement
					allows to refer to 
					<code class="code">com.mycompany.Example</code> with a shortened name.
				</p>
</div>
<div class="section" title="Properties">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="MWE2Properties"></a>Properties</h3>
</div>
</div>
</div>
<p>MWE2 allows to extract arbitrary information into properties to 
					ensure that these pieces are not cluttered around the workflow and 
					to allow for easier external customization. The exemplary component 
					definition was only changed slightly by introducing a property 

					<code class="code">value</code>.
				</p>
<div class="literallayout">
<p>
<code class="code">module&nbsp;com.mycompany.Example<br>

<br>
var&nbsp;value&nbsp;=&nbsp;'a&nbsp;string'<br>

<br>
SampleClass&nbsp;{<br>
&nbsp;&nbsp;singleValue&nbsp;=&nbsp;value<br>
}<br>

</code>
</p>
</div>
<p>The type of the property will be derived from the default value 
					similar to the mechanism that is already known from 
					<code class="code">set</code>- and 

					<code class="code">add</code>-methods. If no default value is given, 
					<code class="code">java.lang.String</code> will
					be assumed. However, properties are not limited to strings. The 
					second built in type is boolean via the familiar literals 
					<code class="code">true</code> and

					<code class="code">false</code>. More flexibility is available via actual component literals.
				</p>
<div class="literallayout">
<p>
<code class="code">module&nbsp;com.mycompany.Example<br>

<br>
var&nbsp;childInstance&nbsp;=&nbsp;SampleClass&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;singleValue&nbsp;=&nbsp;"child"<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>

<br>
SampleClass&nbsp;{<br>
&nbsp;&nbsp;child&nbsp;=&nbsp;childInstance<br>
}<br>

</code>
</p>
</div>
<p>If one wants to define string properties that are actual reusable
					parts for other properties, she may use defined variables inside other
					literals like this: </p>
<div class="literallayout">
<p>
<code class="code">var&nbsp;aString&nbsp;=&nbsp;"part"<br>
var&nbsp;anotherString&nbsp;=&nbsp;"reuse&nbsp;the&nbsp;${part}&nbsp;here"<br>

</code>
</p>
</div>
<p>This is especially useful for file paths in workflows as one would
					usually want to define some common root directories only ones in the
					workflow and reuse this fragment across certain other file locations.</p>
</div>
<div class="section" title="Mandatory Properties">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="MWE2Mandatory"></a>Mandatory Properties</h3>
</div>
</div>
</div>
<p>It is not always feasible to define default values for properties. 
					That is where mandatory properties come into play. Modules define their
					interface not only via their fully qualified name and the type of the
					root component but also by means of the defined properties.    </p>
<div class="literallayout">
<p>
<code class="code">module&nbsp;com.mycompany.Example<br>

<br>
var&nbsp;optional&nbsp;=&nbsp;'a&nbsp;string'<br>
var&nbsp;mandatory<br>

<br>
SampleClass&nbsp;{<br>
&nbsp;&nbsp;singleValue&nbsp;=&nbsp;optional<br>
&nbsp;&nbsp;child&nbsp;=&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;singleValue&nbsp;=&nbsp;mandatory<br>
&nbsp;&nbsp;}<br>
}<br>

</code>
</p>
</div>
<p>This version of the example module exposes two externally assignable
					properties. The second one has no default value assigned and is 
					thereby considered to be mandatory. The mandatory value must be assigned
					if we reuse 
					<code class="code">org.mycompany.Example</code> in another module like this:
				</p>
<div class="literallayout">
<p>
<code class="code">module&nbsp;com.mycompany.Second<br>

<br>
var&nbsp;newMandatory<br>

<br>
@Example&nbsp;{<br>
&nbsp;&nbsp;mandatory&nbsp;=&nbsp;"mandatoryValue"<br>
&nbsp;&nbsp;optional&nbsp;=&nbsp;newMandatory<br>
}&nbsp;<br>

</code>
</p>
</div>
<p>Note that it is even possible to reuse another module as the root
					component of a new module. In this case we set the mandatory 
					property of 
					<code class="code">Example</code> to a specific constant value while the previously
					optional value is now redefined as mandatory by means of a new property
					without a default value.
				</p>
<p>It is not only possible to define mandatory properties for MWE2 
					modules but for classes as well. Therefore MWE2 ships with the 

					<code class="code">Mandatory</code> annotation. If a 
					<code class="code">set</code>- or 
					<code class="code">add</code>-method is marked as

					<code class="code">mandatory</code>, the module validation will fail if no value was assigned
					to that feature.
				</p>
</div>
<div class="section" title="Named Components">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="MWE2NamedComponents"></a>Named Components</h3>
</div>
</div>
</div>
<p>Properties are not the only way to define something that can be reused.
					It is possible to assign a name to any instantiated component being
					it created from a class literal or from another component. This allows
					to refer to previously created and configured instances. Named instances
					can come handy for notification and call-back mechanisms or more general
					in terms of defined life-cylce events. </p>
<p>If we wanted to assign the created instance to a property of itself,
					we could use the following syntax:</p>
<div class="literallayout">
<p>
<code class="code">module&nbsp;com.mycompany.Example<br>

<br>
SampleClass&nbsp;:&nbsp;self&nbsp;{<br>
&nbsp;&nbsp;child&nbsp;=&nbsp;self<br>
}<br>

</code>
</p>
</div>
<p>A named component can be referenced immediately after its creation but
					it is not possible to define forward references in a MWE2 file.</p>
</div>
<div class="section" title="Auto Injection">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="MWE2AutoInject"></a>Auto Injection</h3>
</div>
</div>
</div>
<p>Existing modules or classes often expose a set of properties that 
					will be assigned to features of its root component or set- and add- 
					methods respectively. In many cases its quite hard to come up with 
					yet another name for the very same concept which leads to the situation
					where the properties itself have the very same name as the component&rsquo;s
					feature. To avoid the overall repetition of assignments, MWE2 offers
					the possibility to use the 
					<code class="code">auto-inject</code> modifier on the component 
					literal:
				</p>
<div class="literallayout">
<p>
<code class="code">module&nbsp;com.mycompany.Example<br>

<br>
var&nbsp;child&nbsp;=&nbsp;SampleClass&nbsp;{}<br>

<br>
SampleClass&nbsp;auto-inject&nbsp;{<br>
}<br>

</code>
</p>
</div>
<p>This example will implicitly assign the value of the property

					<code class="code">child</code> to the feature 
					<code class="code">child</code> of the root component. This is especially
					useful for highly configurable workflows that expose dozens of optional
					parameters each of which can be assigned to one or more components.
				</p>
<p>The 
					<code class="code">auto-inject</code> modifier can be used for a subset of the available
					features as well. It will suppressed for the explicitly set values
					of a component.        
				</p>
</div>
<div class="section" title="Factory Support">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="MWE2Factories"></a>Factory Support</h3>
</div>
</div>
</div>
</div>
</div>
<div class="section" title="Syntax Reference">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="MWE2SyntaxReference"></a>Syntax Reference</h2>
</div>
</div>
</div>
<p>The following chapter serves as a reference for the concrete syntax of 
				MWE2. The building blocks of a module will be described in a few words.</p>
<p>MWE2 is not sensitive to white-space and allows to define line-comments
				and block comments everywhere. The syntax is the same as one is used 
				to from the Java language:</p>
<div class="literallayout">
<p>
<code class="code">//&nbsp;This&nbsp;is&nbsp;a&nbsp;comment<br>
/*&nbsp;<br>
&nbsp;&nbsp;This&nbsp;is&nbsp;another&nbsp;one.<br>
*/<br>

</code>
</p>
</div>
<p>Every name in MWE2 can be a fully qualified identifier and must follow 
				the Java conventions. However, in contrast to Java identifiers it is 
				not allowed to use German umlauts or Unicode escape sequences in 
				identifiers. A valid id-segment in MWE2 starts with a letter or an 
				underscore and is followed by any number of letters, numbers or underscores.
				An identifier is composed from one or more segments which are delimited
				by a &sbquo;.&rsquo; dot.</p>
<div class="literallayout">
<p>
<code class="code">Name:&nbsp;ID&nbsp;('.'&nbsp;ID)*;<br>
ID:&nbsp;('a'..'z'|'A'..'Z'|'_')&nbsp;('a'..'z'|'A'..'Z'|'_'|'0'..'9')*;&nbsp;<br>

</code>
</p>
</div>
<p>MWE2 does not use a semicolon as statement delimiter at any place.</p>
<div class="section" title="Module">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="MWE2ModuleSyntax"></a>Module</h3>
</div>
</div>
</div>
<p>
					
</p>
<div class="mediaobject">
<img src="images/mwe2/module.png"></div>
<p>
				
</p>
<p>A 
					<code class="code">module</code> consists of four parts. The very first statement in a 

					<code class="code">*.mwe2</code> file is the module declaration. The name of the module must 
					follow the naming convention for Java classes. That MWE2 file&rsquo;s name 
					must therefore be the same as the last segment of the module-name 
					and it has to be placed in the appropriate package of a Java source 
					path.
				</p>
<p>It is allowed to define any number of import statements in a module.
					Imports are either suffixed by a wild-card or concrete for a class 
					or module. MWE2 can handle relative imports in case one uses the 
					wild-card notation:</p>
<div class="literallayout">
<p>
<code class="code">'import'&nbsp;name&nbsp;'.*'?&nbsp;&nbsp;&nbsp;<br>

<br>

</code>
</p>
</div>
</div>
<div class="section" title="Property">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="MWE2PropertySyntax"></a>Property</h3>
</div>
</div>
</div>
<p>The list of declared properties follows the optional import section.
					It is allowed to define modules without any properties. </p>
<p>
					
</p>
<div class="mediaobject">
<img src="images/mwe2/property.png"></div>
<p>
				
</p>
<p>Each declared property is locally visible in the module. It 
					furthermore defines an assignable feature of the module in case one 
					refers to it from another module. Properties may either have a 
					default value or they are considered to be mandatory. If the type
					of property is omitted it will be inferred from the default value. The
					default type of a property is 
					<code class="code">java.lang.String</code> so if no default
					value is available, the property is mandatory and of type 
					<code class="code">String</code>.
				</p>
<p>There are four types of values available in MWE2. One may either
					define a string, boolean or component literal or a reference to a
					previously defined property. </p>
</div>
<div class="section" title="Component">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="MWE2ComponentSyntax"></a>Component</h3>
</div>
</div>
</div>
<p>The last part of a module is the root component. It defines the externally
					visible type of the module and may either be created from a Java 
					type or from another module.</p>
<p>
					
</p>
<div class="mediaobject">
<img src="images/mwe2/component.png"></div>
<p>
				
</p>
<p>The type of the component can be derived in many cases except for 
					the root component. That&rsquo;s why it&rsquo;s optional in the component literal.
					If no type is given, it will be inferred from the left side of the
					assignment. The assigned feature can either be a declared property
					of the module or a 
					<code class="code">set</code>- or 
					<code class="code">add</code>-method of a Java class.
				</p>
<p>Components can be named to make them referable in subsequent assignments.
					Following the &sbquo;:&rsquo; keyword, one can define an identifier for the 
					instantiated component. The identifier is locally visible in the module
					and any assignment that is defined after the named component can refer
					to this identifier and thereby point to exactly the instantiated object.</p>
<p>The next option for a component is 
					<code class="code">auto-inject</code>. If this modifier
					is set on a component, any available feature of the component that has
					the same name as a property or previously created named component will
					be automatically assigned.
				</p>
<p>The core of a component is the list of assignments between the curly 
					braces. An arbitrary number of values can be set on the component by
					means of feature-to-value pairs. </p>
<p>
					
</p>
<div class="mediaobject">
<img src="images/mwe2/assignment.png"></div>
<p> 
				
</p>
<p>The available constructs on the right hand side of the assignment
					are the same as for default values for properties. </p>
</div>
<div class="section" title="String Literals">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="MWE2StringLiteralsSyntax"></a>String Literals</h3>
</div>
</div>
</div>
<p>String values are likely to be the most used literals in MWE2. There 
					is a convenient syntax for string concatenation available due to
					the high relevance in a description object composition and configuration 
					language. MWE2 strings are multi-line strings and can be composed of
					several parts.</p>
<div class="literallayout">
<p>
<code class="code">var&nbsp;aString&nbsp;=&nbsp;'a&nbsp;value'<br>
var&nbsp;anotherString&nbsp;=&nbsp;'It&nbsp;is&nbsp;possible&nbsp;to&nbsp;embed&nbsp;${aString}&nbsp;into<br>
&nbsp;a&nbsp;multi-line&nbsp;string'<br>

</code>
</p>
</div>
<p>This is especially convenient for path-substitution if one defines
					e.g. a common root directory and wants to specify other paths relative
					to the base. </p>
<p>There are two different delimiters available for strings. Users 
					are free to either use single- or double-quotes to start and end strings. 
					If a certain string contains a lot of single-quotes one would better
					choose double-quotes as delimiter and vice versa. There is no semantic 
					difference between both notations.</p>
<p>The escape character in MWE2 is the back-slash 
					<code class="code">"\"</code>. It can be used
					to write line-breaks or tabular characters explicitly and to escape
					the beginning of substitution variables 
					<code class="code">${</code> and the quotes itself. Allowed
					escape sequences are:
				</p>
<div class="literallayout">
<p>
<code class="code">\n&nbsp;&nbsp;..&nbsp;line&nbsp;break<br>
\r&nbsp;&nbsp;..&nbsp;carriage&nbsp;return<br>
\t&nbsp;&nbsp;..&nbsp;tabular&nbsp;character<br>
\'&nbsp;&nbsp;..&nbsp;single-quote&nbsp;(can&nbsp;be&nbsp;omitted&nbsp;in&nbsp;double-quoted&nbsp;strings)<br>
\"&nbsp;&nbsp;..&nbsp;double-quote&nbsp;(can&nbsp;be&nbsp;omitted&nbsp;in&nbsp;single-quoted&nbsp;strings)<br>
\${&nbsp;..&nbsp;escape&nbsp;the&nbsp;substitution&nbsp;variable&nbsp;start&nbsp;${<br>
\\&nbsp;&nbsp;..&nbsp;the&nbsp;back-slash&nbsp;itself<br>

</code>
</p>
</div>
<p>Other escape sequence are illegal in MWE2 strings.</p>
</div>
<div class="section" title="Boolean Literals">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="MWE2BooleanLiterals"></a>Boolean Literals</h3>
</div>
</div>
</div>
<p>MWE2 has native support for the boolean type. The literals are 
					<code class="code">true</code> and 
					<code class="code">false</code>.
				</p>
</div>
<div class="section" title="References">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="MWE2References"></a>References</h3>
</div>
</div>
</div>
<p>Each assigned value in MWE2 either as default for properties or in a
					component assignment can be a reference to a previously declared property
					or named component. The can be referenced intuitively by their name.</p>
</div>
</div>
<div class="section" title="Workflow API">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="MWE2RuntimeAPI"></a>Workflow API</h2>
</div>
</div>
</div>
</div>
<div class="section" title="Workflow SPI">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="MWE2RuntimeSPI"></a>Workflow SPI</h2>
</div>
</div>
</div>
</div>
</div>
<div class="chapter" title="Chapter&nbsp;8.&nbsp;IDE concepts">
<div class="titlepage">
<div>
<div>
<h2 class="title">
<a name="IDEconcepts"></a>Chapter&nbsp;8.&nbsp;IDE concepts</h2>
</div>
</div>
</div>
<p>For the following part we will refer to a concrete example grammar in order to explain certain aspect of the UI more clearly. The used example grammar is as follows:</p>
<div class="literallayout">
<p>
<code class="code">grammar&nbsp;org.eclipse.text.documentation.Sample&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;with&nbsp;org.eclipse.xtext.common.Terminals<br>

<br>
generate&nbsp;gen&nbsp;'http://www.eclipse.org/xtext/documentation/Sample'&nbsp;as&nbsp;gen<br>

<br>
Model&nbsp;:<br>
&nbsp;&nbsp;"model"&nbsp;intAttribute=INT&nbsp;(stringDescription=STRING)?&nbsp;"{"&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rules&nbsp;+=&nbsp;AbstractRule)*&nbsp;<br>
&nbsp;&nbsp;"}"&nbsp;<br>
;<br>

<br>
AbstractRule:<br>
&nbsp;&nbsp;RuleA&nbsp;|&nbsp;RuleB<br>
;<br>

<br>
RuleA&nbsp;:<br>
&nbsp;&nbsp;&nbsp;"RuleA"&nbsp;"("&nbsp;name&nbsp;=&nbsp;ID&nbsp;")"&nbsp;;<br>

<br>
RuleB&nbsp;return&nbsp;gen::CustomType:<br>
&nbsp;&nbsp;&nbsp;"RuleB"&nbsp;"("&nbsp;ruleA&nbsp;=&nbsp;[RuleA]&nbsp;")"&nbsp;;<br>

<br>

</code>
</p>
</div>
<p></p>
<div class="section" title="Label Provider">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="labelProvider"></a>Label Provider</h2>
</div>
</div>
</div>
<p>A nice part of the Eclipse tooling that comes with Xtext is the outline view. It shows the structure of your model as a tree and allows quick navigation to model elements. Thus it helps to get an overview on the current state in the editor at a glance. To make the appearance of the outline more appealing it is very easy possible to provide customization for the label and the image that is used for an element. Actually this customization will be used at various places in your IDE, for example in the window that displays completion proposals when content assist was invoked. (Customizing the structure of the outline is described in a separate 
				<a class="link" href="#outline" title="Outline View">chapter</a>).
			</p>
<p>The LabelProvider is the service which is used to compute the image for model elements and &ndash; as its name suggests &ndash; the label that represents an element. What you basically have to do is to provide an implementation for two methods which read 
				<code class="code">Image getImage(Object)</code> and 
				<code class="code">String getText(Object)</code> respectively. As this tends to be cumbersome due to 
				<code class="code">instanceof</code> and cast orgies, Xtext ships with a reasonable and convenient default implementation.
			</p>
<div class="section" title="DefaultLabelProvider">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="DefaultLabelProvider"></a>DefaultLabelProvider</h3>
</div>
</div>
</div>
<p>The default implementation of the 
					<code class="code">LabelProvider</code> interface utilizes the polymorphic dispatcher idiom to implement an external visitor as the requirements of the LabelProvider are kind of a best match for this pattern. It comes down to the fact that the only thing you need to do is to implement a method that matches a specific signature. It either provides a image filename or the text to be used to represent your model element. Have a look at following example to get a more detailed idea about the 
					<code class="code">DefaultLabelProvider</code>.
				</p>
<div class="literallayout">
<p>
<code class="code">public&nbsp;class&nbsp;SampleLabelProvider&nbsp;extends&nbsp;DefaultLabelProvider&nbsp;{<br>

<br>
&nbsp;&nbsp;String&nbsp;text(RuleA&nbsp;rule)&nbsp;{<br>
		return&nbsp;"Rule:&nbsp;"&nbsp;+&nbsp;rule.getName();<br>
	}<br>
	
<br>
	String&nbsp;image(RuleA&nbsp;rule)&nbsp;{<br>
		return&nbsp;"ruleA.gif";<br>
	}<br>
	
<br>
	String&nbsp;image(RuleB&nbsp;rule)&nbsp;{<br>
		return&nbsp;"ruleB.gif";<br>
	}<br>
	
<br>
}<br>
	
<br>

</code>
</p>
</div>
<p></p>
<p>The declarative implementation of the label itself is pretty straightforward. The image in turn is expected to be found in a file named 
					<code class="code">icons/&lt;result of image-method&gt;</code> in your plugin. This path is actually configurable by google guice. Have a look at the 
					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.ui.core/src/org/eclipse/xtext/ui/core/PluginImageHelper.java?root=Modeling_Project&view=co" target="_new">PluginImageHelper</a> to learn about the customizing possibilities.
				</p>
<p>What is especially nice about the default implementation is the actual reason for its class name: It provides very reasonable defaults. To compute the label for a certain model element, it will at first have a look for an EAttribute that is called 
					<code class="code">name</code> and try to use this one. If it cannot find a feature like this, it will try to use the first feature, that can be used best as a label. At worst it will return the class name of the model element, which is kind of unlikely to happen.
				</p>
<p>More advanced usage patterns of the 
					<code class="code">DefaultLabelProvider</code> include a dispatching to an error handler called 
					<code class="code">String error_text(Object, Exception)</code> and 
					<code class="code">String error_image(Object, Exception)</code> respectively.  
				</p>
</div>
</div>
<div class="section" title="Content Assist">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="contentAssist"></a>Content Assist</h2>
</div>
</div>
</div>
<p>The Xtext generator, amongst other things, generates the following two content assist (CA) related artifacts:</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>an abstract proposal provider class named 
						<code class="code">'Abstract[Language]ProposalProvider'</code> generated into the 
						<code class="code">src-gen</code> folder within the 
						<code class="code">ui</code> project
					</p>
</li>
<li class="listitem">
<p>a concrete descendent in the 
						<code class="code">src</code>-folder of the 
						<code class="code">ui</code> project 
						<code class="code">ProposalProvider</code>
					
</p>
</li>
</ul>
</div>
<p>First we will investigate the generated 
				<code class="code">Abstract[Language]ProposalProvider</code> with methods that look like this:
			</p>
<div class="section" title="ProposalProvider">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="ProposalProvider"></a>ProposalProvider</h3>
</div>
</div>
</div>
<div class="literallayout">
<p>
<code class="code">public&nbsp;void&nbsp;complete[TypeName]_[FeatureName](<br>
&nbsp;&nbsp;EObject&nbsp;model,&nbsp;<br>
&nbsp;&nbsp;Assignment&nbsp;assignment,&nbsp;<br>
&nbsp;&nbsp;ContentAssistContext&nbsp;context,&nbsp;<br>
&nbsp;&nbsp;ICompletionProposalAcceptor&nbsp;acceptor)&nbsp;{<br>
&nbsp;&nbsp;//&nbsp;clients&nbsp;may&nbsp;override<br>
}<br>

<br>
public&nbsp;void&nbsp;complete_[RuleName](<br>
&nbsp;&nbsp;EObject&nbsp;model,&nbsp;<br>
&nbsp;&nbsp;RuleCall&nbsp;ruleCall,&nbsp;<br>
&nbsp;&nbsp;ContentAssistContext&nbsp;context,&nbsp;<br>
&nbsp;&nbsp;ICompletionProposalAcceptor&nbsp;acceptor)&nbsp;{<br>
&nbsp;&nbsp;//&nbsp;clients&nbsp;may&nbsp;override<br>
}<br>

<br>

</code>
</p>
</div>
<p>The snippet above indicates that the generated ProposalProvider class contains a 
					<code class="code">complete*</code>-method for each assigned feature in the grammar and for each rule. The brackets are place-holders that should give a clue about the naming scheme used to create the various entry points for clients. The generated proposal provider falls back to some default behavior for cross references. Furthermore it inherits the logic that was introduced in reused grammars. 
				</p>
<p>Clients who want to customize the behavior may override the methods from the 
					<code class="code">AbstractProposalProvider</code> or introduce new methods with specialized parameters. The framework dispatches method calls according to the current context to the most concrete implementation, that can be found.
				</p>
<p>It is important to know, that for a given offset in a model file, many possible grammar elements exist. The framework dispatches to the method declarations for any valid element. That means, that a bunch of '&sbquo;complete.*&rsquo;' methods may be called.</p>
</div>
<div class="section" title="Sample Implementation">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="SampleImplementation"></a>Sample Implementation</h3>
</div>
</div>
</div>
<p>To provide a dummy proposal for the description of a model object, you may introduce a specialization of the generated method and implement it as follows. This will give &sbquo;Description for model #7&rsquo; for a model with the intAttribute '7'</p>
<div class="literallayout">
<p>
<code class="code">public&nbsp;void&nbsp;completeModel_StringDescription&nbsp;(<br>
&nbsp;&nbsp;Model&nbsp;model,&nbsp;<br>
&nbsp;&nbsp;Assignment&nbsp;assignment,&nbsp;<br>
&nbsp;&nbsp;ContentAssistContext&nbsp;context,&nbsp;<br>
&nbsp;&nbsp;ICompletionProposalAcceptor&nbsp;acceptor)&nbsp;{<br>
&nbsp;&nbsp;//&nbsp;call&nbsp;implementation&nbsp;in&nbsp;superclass<br>
&nbsp;&nbsp;super.completeModel_StringDescription(<br>
&nbsp;&nbsp;&nbsp;&nbsp;model,&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;assignment,&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;context,&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;acceptor);<br>

<br>
&nbsp;&nbsp;//&nbsp;compute&nbsp;the&nbsp;plain&nbsp;proposal<br>
&nbsp;&nbsp;String&nbsp;proposal&nbsp;=&nbsp;"Description&nbsp;for&nbsp;model&nbsp;#"&nbsp;+&nbsp;model.getIntAttribute();<br>

<br>
&nbsp;&nbsp;//&nbsp;convert&nbsp;it&nbsp;to&nbsp;a&nbsp;valid&nbsp;STRING-terminal<br>
&nbsp;&nbsp;proposal&nbsp;=&nbsp;getValueConverter().toString(proposal,&nbsp;"STRING");<br>

<br>
&nbsp;&nbsp;//&nbsp;create&nbsp;the&nbsp;completion&nbsp;proposal<br>
&nbsp;&nbsp;//&nbsp;the&nbsp;result&nbsp;may&nbsp;be&nbsp;null&nbsp;as&nbsp;the&nbsp;createCompletionProposal(..)&nbsp;methods&nbsp;<br>
&nbsp;&nbsp;//&nbsp;check&nbsp;for&nbsp;valid&nbsp;prefixes<br>
&nbsp;&nbsp;//&nbsp;and&nbsp;terminal&nbsp;token&nbsp;conflicts<br>
&nbsp;&nbsp;ICompletionProposal&nbsp;completionProposal&nbsp;=&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;createCompletionProposal(proposal,&nbsp;context);<br>

<br>
&nbsp;&nbsp;//&nbsp;register&nbsp;the&nbsp;proposal,&nbsp;the&nbsp;acceptor&nbsp;handles&nbsp;null-values&nbsp;gracefully<br>
&nbsp;&nbsp;acceptor.accept(completionProposal);<br>
}<br>

<br>

</code>
</p>
</div>
</div>
</div>
<div class="section" title="Template Proposals">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="templates"></a>Template Proposals</h2>
</div>
</div>
</div>
<p>Xtext-based editors automatically support code templates. That means that you get the corresponding preference page where users can add and change template proposals. If you want to ship a couple of default templates, you have to put a file named 
				<code class="code">templates.xml</code> inside the 
				<code class="code">templates</code> directory of the generated ui-plugin. This file contains templates in a format as described in the 
				<a class="ulink" href="http://help.eclipse.org/ganymede/topic/org.eclipse.cdt.doc.user/tasks/cdt_t_imp_code_temp.htm" target="_new">Eclipse online help</a> .
			</p>
<p>
				
</p>
<div class="mediaobject">
<img src="images/preferences_templates.png"></div>
<p>
			
</p>
<p>By default Xtext registers ContextTypes for each Rule (
				<code class="code">.[RuleName]</code>) and for each keyword (
				<code class="code">.kw_[keyword]</code>), as long as the keywords are valid identifiers. If you don&rsquo;t like these defaults you&rsquo;ll have to subclass 
				<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.ui.common/src/org/eclipse/xtext/ui/common/editor/templates/XtextTemplateContextTypeRegistry.java?root=Modeling_Project&view=co" target="_new">XtextTemplateContextTypeRegistry</a> and configure it via 
				<a class="link" href="#guicemanualmodules" title="Modules intended for customization">Guice</a>. 
			</p>
<p>In addition to the standard template proposal extension mechanism, Xtext ships with a predefined set of TemplateVariableResolvers to resolve special variable types inside a given template (i.e. TemplateContext). Besides the standard template variables available in 
				<code class="code">org.eclipse.jface.text.templates.GlobalTemplateVariables</code> like ${user}, ${date}, ${time}, ${cursor}, etc., these TemplateVariableResolver support the automatic resolving of CrossReferences (type 
				<code class="code">CrossReferences</code>) and Enumerations (type 
				<code class="code">Enum</code>) like it is explained in the following sections.
			</p>
<p>It is best practice to edit the templates in the preferences page, export them into the 
				<code class="code">templates.xml</code>-file and put this one into the 
				<code class="code">templates</code> folder of your ui-plugin. However, these templates will not be visible by default. To fix it, you have to manually edit the xml-file and insert an ID attribute for each template element.
			</p>
<div class="section" title="CrossReference TemplateVariableResolver">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="CrossReferenceTemplateVariableResolver"></a>CrossReference TemplateVariableResolver</h3>
</div>
</div>
</div>
<p>Xtext comes with a specific template variable resolver 
					<code class="code">org.eclipse.jface.text.templates.TemplateVariableResolver</code>) called 
					<code class="code">CrossReferenceResolver</code>, which can be used to place cross references within a template.
				</p>
<p>The syntax is as follows:</p>
<div class="literallayout">
<p>
<code class="code">${displayText:CrossReference('MyType.myRef')}<br>

</code>
</p>
</div>
<p>For example the following template:</p>
<div class="literallayout">
<p>
<code class="code">&lt;template&nbsp;name="transition"&nbsp;description="event&nbsp;transition"&nbsp;id="transition"<br>
&nbsp;&nbsp;&nbsp;&nbsp;context="org.eclipse.xtext.example.FowlerDsl.Transition"&nbsp;enabled="true"&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;${event:CrossReference('Transition.event')}&nbsp;=&gt;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;	${state:CrossReference('Transition.state')<br>
&lt;/template&gt;<br>

<br>

</code>
</p>
</div>
<p>yields the text 
					<code class="code">event =&gt; state</code> and allows selecting any events and states using a drop down.
				</p>
<p>
					
</p>
<div class="mediaobject">
<img src="images/templates_crossref.png"></div>
<p>
				
</p>
</div>
<div class="section" title="Enumeration TemplateVariableResolver">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="EnumerationTemplateVariableResolver"></a>Enumeration TemplateVariableResolver</h3>
</div>
</div>
</div>
<p>The 
					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.ui.common/src/org/eclipse/xtext/ui/common/editor/templates/EnumTemplateVariableResolver.java?root=Modeling_Project&view=co" target="_new">EnumTemplateVariableResolver</a> resolves a template variable to 
					<code class="code">EEnumLiteral</code> literals
					which are assignment-compatible to the enumeration type declared as the first parameter of the the 
					<code class="code">Enum</code> 
					<code class="code">TemplateVariable</code>. 
				</p>The syntax is as follows:   
				<div class="literallayout">
<p>
<code class="code">${displayText:Enum('Visibility')<br>

</code>
</p>
</div>
<p>For example the following template (taken from the domainmodel example):</p>
<div class="literallayout">
<p>
<code class="code">&lt;template&nbsp;name="Operation"&nbsp;description="template&nbsp;for&nbsp;an&nbsp;Operation"<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;id="org.eclipse.xtext.example.Domainmodel.Operation"<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;context="org.eclipse.xtext.example.Domainmodel.Operation"&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;	enabled="true"&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;${visibility:Enum('Visibility')}&nbsp;op&nbsp;${name}(${cursor}):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;${type:CrossReference('Operation.type')}<br>
&lt;/template&gt;<br>

<br>

</code>
</p>
</div>
<p>yields the text 
					<code class="code">public op name(): type</code> where the display text &sbquo;public&rsquo; is replaced with a drop down filled with the literal values as defined in the Visibility 
					<code class="code">EENumeration</code>. Also, &sbquo;name&rsquo; and &sbquo;type&rsquo; are placeholders.
				</p>
<p>
					
</p>
<div class="mediaobject">
<img src="images/templates_enum.png"></div>
<p>
				
</p>
</div>
</div>
<div class="section" title="Outline View">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="outline"></a>Outline View</h2>
</div>
</div>
</div>
<p>Xtext provides an outline view to help you navigate your models. By default, it provides a hierarchical view on your model and allows you to sort tree elements alphabetically. Selecting an element in the outline will highlight the corresponding element in the text editor. Users can choose to synchronize the outline with the editor selection by clicking the 
				<span class="emphasis"><em>Link with Editor</em></span> button.
			</p>
<p>
				
</p>
<div class="mediaobject">
<img src="images/sample_outline.png"></div>
<p>
			
</p>
<p>You can customize various aspects of the outline by providing implementation for its various interfaces. The following sections show how to do this.</p>
<div class="section" title="Influencing the outline structure">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="Influencingtheoutlinestructure"></a>Influencing the outline structure</h3>
</div>
</div>
</div>
<p>In its default implementation, the outline view shows the containment hierarchy of your model. This should be sufficient in most cases. If you want to adjust the structure of the outline, i.e., by omitting a certain kind of node or by introducing additional even virtual nodes, you customize the outline by implementing 
					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.ui.common/src/org/eclipse/xtext/ui/common/editor/outline/transformer/ISemanticModelTransformer.java?root=Modeling_Project&view=co" target="_new">ISemanticModelTransformer</a>.
				</p>
<p>The Xtext wizard creates an empty transformer class (
					<code class="code">MyDslTransformer</code>) for your convenience. To transform the semantic model delivered by the Xtext parser, you need to provide transformation methods for each of the EClasses that are of interest:
				</p>
<div class="literallayout">
<p>
<code class="code">public&nbsp;class&nbsp;MyDslTransformer&nbsp;extends&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;AbstractDeclarativeSemanticModelTransformer&nbsp;{&nbsp;<br>
&nbsp;&nbsp;/**<br>
&nbsp;&nbsp;&nbsp;*&nbsp;This&nbsp;method&nbsp;will&nbsp;be&nbsp;called&nbsp;by&nbsp;naming&nbsp;convention:<br>
&nbsp;&nbsp;&nbsp;*&nbsp;-&nbsp;method&nbsp;name&nbsp;must&nbsp;be&nbsp;createNode<br>
&nbsp;&nbsp;&nbsp;*&nbsp;-&nbsp;first&nbsp;param:&nbsp;subclass&nbsp;of&nbsp;EObject<br>
&nbsp;&nbsp;&nbsp;*&nbsp;-&nbsp;second&nbsp;param:&nbsp;ContentOutlineNode&nbsp;<br>
&nbsp;&nbsp;&nbsp;*/<br>
&nbsp;&nbsp;public&nbsp;ContentOutlineNode&nbsp;createNode(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Attribute&nbsp;semanticNode,&nbsp;ContentOutlineNode&nbsp;parentNode)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;ContentOutlineNode&nbsp;node&nbsp;=&nbsp;super.newOutlineNode(semanticNode,&nbsp;parentNode);<br>
&nbsp;&nbsp;&nbsp;&nbsp;node.setLabel("special&nbsp;"&nbsp;+&nbsp;node.getLabel());<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;node;<br>
&nbsp;&nbsp;}<br>
&nbsp;&nbsp;<br>
&nbsp;&nbsp;public&nbsp;ContentOutlineNode&nbsp;createNode(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Property&nbsp;semanticNode,&nbsp;ContentOutlineNode&nbsp;parentNode)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;ContentOutlineNode&nbsp;node&nbsp;=&nbsp;super.newOutlineNode(semanticNode,&nbsp;parentNode);<br>
&nbsp;&nbsp;&nbsp;&nbsp;node.setLabel("pimped&nbsp;"&nbsp;+&nbsp;node.getLabel());<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;node;<br>
&nbsp;&nbsp;}<br>

<br>
&nbsp;&nbsp;/**<br>
&nbsp;&nbsp;&nbsp;*&nbsp;This&nbsp;method&nbsp;will&nbsp;be&nbsp;called&nbsp;by&nbsp;naming&nbsp;convention:<br>
&nbsp;&nbsp;&nbsp;*&nbsp;-&nbsp;method&nbsp;name&nbsp;must&nbsp;be&nbsp;getChildren<br>
&nbsp;&nbsp;&nbsp;*&nbsp;-&nbsp;first&nbsp;param:&nbsp;subclass&nbsp;of&nbsp;EObject<br>
&nbsp;&nbsp;&nbsp;*/<br>
&nbsp;&nbsp;public&nbsp;List&lt;EObject&gt;&nbsp;getChildren(Attribute&nbsp;attribute)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;attribute.eContents();<br>
&nbsp;&nbsp;}<br>

<br>
&nbsp;&nbsp;public&nbsp;List&lt;EObject&gt;&nbsp;getChildren(Property&nbsp;property)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;NO_CHILDREN;<br>
&nbsp;&nbsp;}<br>
}<br>

<br>

</code>
</p>
</div>
<p>To make sure Xtext picks up your new outline transformer, you have to register your implementation with your UI module: </p>
<div class="literallayout">
<p>
<code class="code">public&nbsp;class&nbsp;MyDslUiModule&nbsp;extends&nbsp;AbstractMyDslUiModule&nbsp;{<br>

<br>
&nbsp;&nbsp;@Override<br>
&nbsp;&nbsp;public&nbsp;Class&lt;?&nbsp;extends&nbsp;ISemanticModelTransformer&gt;&nbsp;<br>
&nbsp;&nbsp;		bindISemanticModelTransformer()&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;MyDslTransformer.class;<br>
&nbsp;&nbsp;}<br>
&nbsp;&nbsp;...<br>
}<br>

<br>

</code>
</p>
</div>
</div>
<div class="section" title="Filtering">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="Filtering"></a>Filtering</h3>
</div>
</div>
</div>
<p>Often, you want to allow users to filter the contents of the outline to make it easier to concentrate on the relevant aspects of the model. To add filtering capabilities to your outline, you need to add 
					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.ui.common/src/org/eclipse/xtext/ui/common/editor/outline/actions/AbstractFilterAction.java?root=Modeling_Project&view=co" target="_new">AbstractFilterAction</a>s to the outline. Actions can be contributed by implementing and registering a 
					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.ui.common/src/org/eclipse/xtext/ui/common/editor/outline/actions/DeclarativeActionBarContributor.java?root=Modeling_Project&view=co" target="_new">DeclarativeActionBarContributor</a>.
				</p>
<p>To register a 
					<code class="code">DeclarativeActionBarContributor</code>, add the following lines to your 
					<code class="code">MyDslUiModule</code> class:
				</p>
<div class="literallayout">
<p>
<code class="code">public&nbsp;class&nbsp;MyDslUiModule&nbsp;extends&nbsp;AbstractMyDslUiModule&nbsp;{<br>

<br>
&nbsp;&nbsp;@Override<br>
&nbsp;&nbsp;public&nbsp;Class&lt;?&nbsp;extends&nbsp;IActionBarContributor&gt;&nbsp;bindIActionBarContributor()&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;MyDslActionBarContributor.class;<br>
&nbsp;&nbsp;}<br>
&nbsp;&nbsp;...<br>
}<br>

<br>

</code>
</p>
</div>
<p>The action bar contributor will look like this:</p>
<div class="literallayout">
<p>
<code class="code">public&nbsp;class&nbsp;MyDslActionBarContributor&nbsp;extends<br>
&nbsp;&nbsp;&nbsp;&nbsp;DeclarativeActionBarContributor&nbsp;{<br>
&nbsp;&nbsp;public&nbsp;Action&nbsp;addFilterParserRulesToolbarAction(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;XtextContentOutlinePage&nbsp;page)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;new&nbsp;FilterFooAction(page);<br>
&nbsp;&nbsp;}<br>
}<br>

<br>

</code>
</p>
</div>
<p>Filter actions must extend 
					<code class="code">AbstractFilterAction</code> (this ensures that the action toggle state is handled correctly):
				</p>
<div class="literallayout">
<p>
<code class="code">public&nbsp;class&nbsp;FilterFooAction&nbsp;extends&nbsp;AbstractFilterAction&nbsp;{<br>

<br>
&nbsp;&nbsp;public&nbsp;FilterFooAction(XtextContentOutlinePage&nbsp;outlinePage)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;super("Filter&nbsp;Foo",&nbsp;outlinePage);<br>
&nbsp;&nbsp;&nbsp;&nbsp;setToolTipText("Show&nbsp;/&nbsp;hide&nbsp;foo");<br>
&nbsp;&nbsp;&nbsp;&nbsp;setDescription("Show&nbsp;/&nbsp;hide&nbsp;foo");<br>
&nbsp;&nbsp;&nbsp;&nbsp;setImageDescriptor(Activator.getImageDescriptor("icons/foo.gif"));<br>
&nbsp;&nbsp;&nbsp;&nbsp;setDisabledImageDescriptor(<br>
&nbsp;&nbsp;&nbsp;&nbsp;	Activator.getImageDescriptor("icons/foo.gif"));<br>
&nbsp;&nbsp;}<br>

<br>
&nbsp;&nbsp;@Override<br>
&nbsp;&nbsp;protected&nbsp;String&nbsp;getToggleId()&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;"FilterFooAction.isChecked";<br>
&nbsp;&nbsp;}<br>
	
<br>
&nbsp;&nbsp;@Override<br>
&nbsp;&nbsp;protected&nbsp;ViewerFilter&nbsp;createFilter()&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;new&nbsp;FooOutlineFilter();<br>
&nbsp;&nbsp;}<br>

<br>
}<br>

<br>

</code>
</p>
</div>
<p>The filtering itself will be performed by 
					<code class="code">FooOutlineFilter</code>:
				</p>
<div class="literallayout">
<p>
<code class="code">public&nbsp;class&nbsp;FooOutlineFilter&nbsp;extends&nbsp;ViewerFilter&nbsp;{<br>

<br>
&nbsp;&nbsp;@Override<br>
&nbsp;&nbsp;public&nbsp;boolean&nbsp;select(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Viewer&nbsp;viewer,&nbsp;Object&nbsp;parentElement,&nbsp;Object&nbsp;element)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;((parentElement&nbsp;!=&nbsp;null)&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;&amp;&nbsp;(parentElement&nbsp;instanceof&nbsp;ContentOutlineNode))&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ContentOutlineNode&nbsp;parentNode&nbsp;=&nbsp;(ContentOutlineNode)&nbsp;parentElement;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EClass&nbsp;clazz&nbsp;=&nbsp;parentNode.getClazz();<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(clazz.equals(MyDslPackage.Literals.ATTRIBUTE))&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;false;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;true;<br>
&nbsp;&nbsp;}<br>

<br>
}<br>

<br>

</code>
</p>
</div>
</div>
<div class="section" title="Context menus">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="Contextmenus"></a>Context menus</h3>
</div>
</div>
</div>
<p>You might want to register context menu actions for specific elements in the outline, e.g. to allow users of your DSL to invoke a generator or to validate the selected element. As all elements in the outline are 
					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.ui.common/src/org/eclipse/xtext/ui/common/editor/outline/ContentOutlineNode.java?root=Modeling_Project&view=co" target="_new">ContentOutlineNode</a>s, you cannot easily register an 
					<a class="ulink" href="http://help.eclipse.org/stable/index.jsp?topic=/org.eclipse.platform.doc.isv/guide/workbench_basicext_popupMenus.htm" target="_new">Object contribution</a>. (Besides, using the extension point 
					<code class="code">org.eclipse.ui.popupMenus</code> is regarded somewhat old school &ndash; you should rather use the new command and expression framework, as depicted below).
				</p>
<p>To register context menus for specific node types of your Ecore model, we need to:</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>implement 
							<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.ui.common/src/org/eclipse/xtext/ui/common/editor/outline/actions/IContentOutlineNodeAdapterFactory.java?root=Modeling_Project&view=co" target="_new">IContentOutlineNodeAdapterFactory</a> which will translate 
							<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.ui.common/src/org/eclipse/xtext/ui/common/editor/outline/ContentOutlineNode.java?root=Modeling_Project&view=co" target="_new">ContentOutlineNode</a>s to their underlying node type
						</p>
</li>
<li class="listitem">
<p>register a menu contribution to add a command / handler pair to the context menu for the specific node types you&rsquo;re interested in.</p>
</li>
</ul>
</div>
<div class="section" title="Registering an IContentOutlineNodeAdapterFactory">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="RegisteringanIContentOutlineNodeAdapterFactory"></a>Registering an 
						<code class="code">IContentOutlineNodeAdapterFactory</code>
					
</h4>
</div>
</div>
</div>
<p>The Xtext code generator creates a subclass of 
						<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.ui.common/src/org/eclipse/xtext/ui/common/editor/outline/actions/DefaultContentOutlineNodeAdapterFactory.java?root=Modeling_Project&view=co" target="_new">DefaultContentOutlineNodeAdapterFactory</a>. All we need to do is specify a list of types that we later want to bind context menu contributions to. 
					</p>
<div class="literallayout">
<p>
<code class="code">public&nbsp;class&nbsp;MyDslContentOutlineNodeAdapterFactory&nbsp;extends&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;DefaultContentOutlineNodeAdapterFactory&nbsp;{<br>
&nbsp;&nbsp;@SuppressWarnings("unchecked")<br>
&nbsp;&nbsp;private&nbsp;static&nbsp;final&nbsp;Class[]&nbsp;types&nbsp;=&nbsp;{&nbsp;Attribute.class&nbsp;};<br>

<br>
&nbsp;&nbsp;@SuppressWarnings("unchecked")<br>
&nbsp;&nbsp;public&nbsp;Class[]&nbsp;getAdapterList()&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;types;<br>
&nbsp;&nbsp;}<br>
}<br>

<br>

</code>
</p>
</div>
<p>If you want to bind context menu actions to nodes representing 
						<code class="code">Attribute</code> and 
						<code class="code">Entity</code>, you need to change the declaration of 
						<code class="code">type</code> as follows:
					</p>
<div class="literallayout">
<p>
<code class="code">private&nbsp;static&nbsp;final&nbsp;Class[]&nbsp;types&nbsp;=&nbsp;{&nbsp;Attribute.class,&nbsp;Entity.class&nbsp;};<br>

</code>
</p>
</div>
</div>
<div class="section" title="Registering a menu contribution">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="Registeringamenucontribution"></a>Registering a menu contribution</h4>
</div>
</div>
</div>
<p>You can now add command / handler pairs to the context menu.</p>
<p>First, you need to define a command &ndash; it will serve as a handle to glue together the handler and the menu contribution:</p>
<div class="literallayout">
<p>
<code class="code">&lt;extension<br>
&nbsp;&nbsp;point="org.eclipse.ui.commands"&gt;<br>
&nbsp;&nbsp;&lt;command<br>
&nbsp;&nbsp;&nbsp;&nbsp;id="org.example.mydsl.ui.editor.outline.SampleOutlineCommand"<br>
&nbsp;&nbsp;&nbsp;&nbsp;name="Sample&nbsp;Command"<br>
&nbsp;&nbsp;&nbsp;&nbsp;description="Just&nbsp;a&nbsp;sample&nbsp;command"&gt;<br>
&nbsp;&nbsp;&lt;/command&gt;<br>
&lt;/extension&gt;<br>

<br>

</code>
</p>
</div>
<p>Next, you need to define a handler which will eventually execute the code to operate on the selected node. Please pay special attention to the attribute 
						<code class="code">commandId</code> - it must match the 
						<code class="code">id</code> attribute of your command. 
					</p>
<div class="literallayout">
<p>
<code class="code">&lt;extension<br>
&nbsp;&nbsp;point="org.eclipse.ui.handlers"&gt;<br>
&nbsp;&nbsp;&lt;handler<br>
&nbsp;&nbsp;&nbsp;&nbsp;class="org.example.mydsl.ui.editor.outline.SampleOutlineNodeHandler"<br>
&nbsp;&nbsp;&nbsp;&nbsp;commandId="org.example.mydsl.ui.editor.outline.SampleOutlineCommand"&gt;<br>
&nbsp;&nbsp;&lt;/handler&gt;<br>
&lt;/extension&gt;<br>

<br>

</code>
</p>
</div>
<p>Finally, define a 
						<code class="code">menuContribution</code> to add the command to the context menu:
					</p>
<div class="literallayout">
<p>
<code class="code">&lt;extension<br>
&nbsp;&nbsp;point="org.eclipse.ui.menus"&gt;<br>
&nbsp;&nbsp;&lt;menuContribution<br>
&nbsp;&nbsp;&nbsp;&nbsp;locationURI="popup:org.eclipse.xtext.ui.common.outline?after=additions"&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;command<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;commandId="org.example.mydsl.ui.editor.outline.SampleOutlineCommand"<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;label="Sample&nbsp;action&nbsp;registered&nbsp;for&nbsp;Attributes"&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;visibleWhen&nbsp;checkEnabled="false"&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;iterate&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;adapt&nbsp;type="org.example.mydsl.Attribute"&nbsp;/&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/iterate&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/visibleWhen&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/command&gt;<br>
&nbsp;&nbsp;&lt;/menuContribution&gt;<br>
&lt;/extension&gt;<br>

<br>

</code>
</p>
</div>
<p>Again, pay attention to the 
						<code class="code">commandId</code> attribute. The connection between your node type(s) and the menu contribution is made by the part 
						<code class="code">&lt;adapt type="org.example.mydsl.Attribute" /&gt;</code>. 
					</p>
</div>
</div>
</div>
<div class="section" title="Hyperlinking">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="hyperlinking"></a>Hyperlinking</h2>
</div>
</div>
</div>
<p>The Xtext editor provides hyperlinking support for any tokens corresponding to cross references in your grammar definition. This means that you can either control-click on any of these tokens or hit F3 while the cursor position is at the token in question and this will take you to the referenced model element. As you&rsquo;d expect this works for references to elements in the same resource as well as for references to elements in other resources. In the latter case the referenced resource will first be opened using the corresponding editor.</p>
<div class="section" title="Location Provider">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="locationProvider"></a>Location Provider</h3>
</div>
</div>
</div>
<p>When navigating a hyperlink Xtext will also select the text region corresponding to the referenced model element. Determining this text region is the responsibility of the 
					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.ui.core/src/org/eclipse/xtext/ui/core/ILocationInFileProvider.java?root=Modeling_Project&view=co" target="_new">ILocationInFileProvider</a>. The default implementation (
					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.ui.core/src/org/eclipse/xtext/ui/core/DefaultLocationInFileProvider.java?root=Modeling_Project&view=co" target="_new">DefaultLocationInFileProvider</a>) implements a best effort strategy which can be summarized as:
				</p>
<div class="orderedlist">
<ol class="orderedlist" type="1">
<li class="listitem">
<p>If the model element&rsquo;s type (i.e. EClass) declares a feature 
							<span class="emphasis"><em>name</em></span> then return the region of the corresponding token(s). As a fallback also check for a feature 
							<span class="emphasis"><em>id</em></span>.
						</p>
</li>
<li class="listitem">
<p>If the model element&rsquo;s parse tree contains any top-level tokens corresponding to 
							<span class="emphasis"><em>ID</em></span> rule calls in the grammar then return a region spanning all those tokens.
						</p>
</li>
<li class="listitem">
<p>As a last resort return the region corresponding to the first keyword token of the referenced model element.</p>
</li>
</ol>
</div>
<div class="section" title="Customized Location Provider">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="CustomizedLocationProvider"></a>Customized Location Provider</h4>
</div>
</div>
</div>
<p>As the default strategy is a best effort it may not always result in the selection you want. If that&rsquo;s the case you can 
						<a class="link" href="#guicecustomize" title="Changing Configuration">override</a> the 
						<code class="code">ILocationInFileProvider</code> binding in the UI module as in the following example:
					</p>
<div class="literallayout">
<p>
<code class="code">public&nbsp;class&nbsp;MyDslUiModule&nbsp;extends&nbsp;AbstractMyDslUiModule&nbsp;{<br>

<br>
&nbsp;&nbsp;@Override<br>
&nbsp;&nbsp;public&nbsp;Class&lt;?&nbsp;extends&nbsp;ILocationInFileProvider&gt;&nbsp;<br>
&nbsp;&nbsp;		bindILocationInFileProvider()&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;MyDslLocationInFileProvider.class;<br>
&nbsp;&nbsp;}<br>
&nbsp;&nbsp;...<br>
}<br>

<br>

</code>
</p>
</div>
<p>Often the default strategy only needs some guidance (e.g. selecting the text corresponding to another feature than 
						<span class="emphasis"><em>name</em></span>). In that case you can simply subclass 
						<code class="code">DefaultLocationInFileProvider</code> and override the methods 
						<code class="code">getIdentifierFeature</code> and / or 
						<code class="code">useKeyword</code> to guide the first and last steps of the strategy as described above (see 
						<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.xtext.ui/src/org/eclipse/xtext/xtext/ui/XtextLocationInFileProvider.java?root=Modeling_Project&view=co" target="_new">XtextLocationInFileProvider</a> for an example).
					</p>
</div>
</div>
</div>
<div class="section" title="Formatting (Pretty Printing)">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="formatting"></a>Formatting (Pretty Printing)</h2>
</div>
</div>
</div>
<p>A formatter can be implemented via the 
				<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/formatting/IFormatter.java?root=Modeling_Project&view=co" target="_new">IFormatter</a> service. Technically speaking, a formatter is a 
				<a class="link" href="#tokenstream" title="Token Stream">Token Stream</a> which inserts/removes/modifies hidden tokens (whitespace, line-breaks, comments).
			</p>
<p>The formatter is invoked during the 
				<a class="link" href="#serialization" title="Serialization">serialization phase</a> and when the user triggers formatting in the editor (for example, using the CTRL+SHIFT+F shortcut).
			</p>
<p>Xtext ships with two formatters:</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>The 
						<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/formatting/impl/OneWhitespaceFormatter.java?root=Modeling_Project&view=co" target="_new">OneWhitespaceFormatter</a> simply writes one whitespace between all tokens.
					</p>
</li>
<li class="listitem">
<p>The 
						<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/formatting/impl/AbstractDeclarativeFormatter.java?root=Modeling_Project&view=co" target="_new">AbstractDeclarativeFormatter</a> allows advanced configuration using a 
						<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/formatting/impl/FormattingConfig.java?root=Modeling_Project&view=co" target="_new">FormattingConfig</a>. Both are explained in the 
						<a class="link" href="#declarativeformatter" title="Declarative Formatter">next chapter</a>.
					</p>
</li>
</ul>
</div>
<div class="section" title="Declarative Formatter">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="declarativeformatter"></a>Declarative Formatter   </h3>
</div>
</div>
</div>
<p>A declarative formatter can be implemented by sub-classing {org.eclipse.xtext/src/org.eclipse.xtext.formatting.impl.AbstractDeclarativeFormatter}, as shown in the following example:</p>
<div class="literallayout">
<p>
<code class="code">public&nbsp;class&nbsp;ExampleFormatter&nbsp;extends&nbsp;AbstractDeclarativeFormatter&nbsp;{<br>

<br>
&nbsp;&nbsp;@Override<br>
&nbsp;&nbsp;protected&nbsp;void&nbsp;configureFormatting(FormattingConfig&nbsp;c)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;ExampleLanguageGrammarAccess&nbsp;f&nbsp;=&nbsp;getGrammarAccess();<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;c.setAutoLinewrap(120);<br>

<br>
&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Line<br>
&nbsp;&nbsp;&nbsp;&nbsp;c.setLinewrap(2).after(f.getLineAccess().getSemicolonKeyword_1());<br>
&nbsp;&nbsp;&nbsp;&nbsp;c.setNoSpace().before(f.getLineAccess().getSemicolonKeyword_1());<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;TestIndentation<br>
&nbsp;&nbsp;&nbsp;&nbsp;c.setIndentation(<br>
&nbsp;&nbsp;&nbsp;&nbsp;		f.getTestIndentationAccess().getLeftCurlyBracketKeyword_1(),<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;f.getTestIndentationAccess().getRightCurlyBracketKeyword_3());<br>
&nbsp;&nbsp;&nbsp;&nbsp;c.setLinewrap().after(<br>
&nbsp;&nbsp;&nbsp;&nbsp;		f.getTestIndentationAccess().getLeftCurlyBracketKeyword_1());<br>
&nbsp;&nbsp;&nbsp;&nbsp;c.setLinewrap().after(<br>
&nbsp;&nbsp;&nbsp;&nbsp;		f.getTestIndentationAccess().getRightCurlyBracketKeyword_3());<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Param<br>
&nbsp;&nbsp;&nbsp;&nbsp;c.setNoLinewrap().around(f.getParamAccess().getColonKeyword_1());<br>
&nbsp;&nbsp;&nbsp;&nbsp;c.setNoSpace().around(f.getParamAccess().getColonKeyword_1());<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;comments<br>
&nbsp;&nbsp;&nbsp;&nbsp;c.setNoLinewrap().before(f.getSL_COMMENTRule());<br>
&nbsp;&nbsp;}<br>
}<br>

<br>

</code>
</p>
</div>
<p>The formatter has to implement the method 
					<code class="code">configureFormatting(...)</code> which is supposed to declaratively set up a 
					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/formatting/impl/FormattingConfig.java?root=Modeling_Project&view=co" target="_new">FormattingConfig</a>.
				</p>
<p>The 
					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/formatting/impl/FormattingConfig.java?root=Modeling_Project&view=co" target="_new">FormattingConfig</a> consist general settings and a set of rules:
				</p>
<div class="section" title="General FormattingConfig Settings">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="GeneralFormattingConfigSettings"></a>General FormattingConfig Settings</h4>
</div>
</div>
</div>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>
								
<code class="code">setAutoLinewrap(int)</code>  defines the amount of characters after which a line-break should be dynamically inserted between two tokens. The rule 
								<code class="code">setNoLinewrap()</code> can be used to suppress this behavior locally. The default is 80.
							</p>
</li>
<li class="listitem">
<p>
								
<code class="code">setIndentationSpace(String)</code> defines the string which is used for a single degree of indentation. The default is two whitespace.
							</p>
</li>
<li class="listitem">
<p>
								
<code class="code">setWhitespaceRule(AbstractRule)</code> defines the grammar rule which is used to match whitespace. This is needed by the formatter to identify whitespace and to insert whitespace. The default is the rule named 
								<code class="code">WS</code>.
							</p>
</li>
<li class="listitem">
<p>
								
<code class="code">setIndentation(start, end)</code> increases the level of indentation when the element 
								<code class="code">start</code> is matched and decreases the level when element 
								<code class="code">end</code> is matched. The matching of elements happens in the same way as it does for formatting rules.
							</p>
</li>
</ul>
</div>
</div>
<div class="section" title="FormattingConfig Rules">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="FormattingConfigRules"></a>FormattingConfig Rules</h4>
</div>
</div>
</div>
<p>Per default, the 
						<a class="link" href="#declarativeformatter" title="Declarative Formatter">Declarative Formatter</a> inserts one whitespace between two tokens. Rules can be used to specify a different behavior. They consist of two parts: 
						<span class="emphasis"><em>When</em></span> to apply the rule and 
						<span class="emphasis"><em>what</em></span> to do.
					</p>
<p>To understand 
						<span class="emphasis"><em>when</em></span> a rule is applied think of a stream of tokens whereas each token is associated with the corresponding grammar element. The rules are matched against these grammar elements. The following matching criteria exist.
					</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>
								
<code class="code">after(ele)</code>: The rule is executed after the grammar element 
								<code class="code">ele</code> has been matched. For example, if your grammar uses the keyword &bdquo;;&rdquo; to end lines, this can instruct the formatter to insert a line-break after the semicolon.  
							</p>
</li>
<li class="listitem">
<p>
								
<code class="code">before(ele)</code>: The rule is executed before the matched element. For example, if your grammar contains lists which separate its values with keyword &bdquo;,&rdquo;, you can instruct the formatter to suppress the whitespace before the comma.
							</p>
</li>
<li class="listitem">
<p>
								
<code class="code">around(ele)</code>: This is the same as 
								<code class="code">before(ele)</code> combined with  
								<code class="code">after(ele)</code>.  
							</p>
</li>
<li class="listitem">
<p>
								
<code class="code">between(ele1, ele2)</code>: This matches if 
								<code class="code">ele2</code> directly follows 
								<code class="code">ele1</code>. There may be no other elements in between.
							</p>
</li>
<li class="listitem">
<p>
								
<code class="code">bounds(ele1, ele2)</code>: This is the same as 
								<code class="code">before(ele1)</code> combined with  
								<code class="code">after(ele2)</code>.
							</p>
</li>
<li class="listitem">
<p>
								
<code class="code">range(ele1, ele2)</code>: The rule is enabled when 
								<code class="code">ele1</code> is matched, and disabled when 
								<code class="code">ele2</code> is matched. Thereby, the rule is active for the complete region which is surrounded by 
								<code class="code">ele1</code> and 
								<code class="code">ele2</code>. 
							</p>
</li>
</ul>
</div>
<p>The parameter 
						<code class="code">ele</code> can be a grammar&rsquo;s 
						<code class="code">AbstractElement</code> or a grammar&rsquo;s 
						<code class="code">AbstractRule</code>. However, only elements which represent a token in the textual representation can be matched. This are:
					</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>terminal rules for comments.</p>
</li>
<li class="listitem">
<p>keywords, assignments, call to terminal or data-type rules.</p>
</li>
</ul>
</div>
<p>After having explained how rules can be activated, this is what they can do:</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>
								
<code class="code">setLinewrap()</code>: Inserts a line-break at this position.
							</p>
</li>
<li class="listitem">
<p>
								
<code class="code">setLinewrap(int)</code>: Inserts the specified number of line-breaks at this position.
							</p>
</li>
<li class="listitem">
<p>
								
<code class="code">setNoLinewrap()</code>: Suppresses automatic line wrap, which may occur when the line&rsquo;s length exceeds the defined limit.
							</p>
</li>
<li class="listitem">
<p>
								
<code class="code">setNoSpace()</code>: Suppresses the whitespace between tokens at this position. Be aware that between some tokens a whitespace is required to maintain a valid concrete syntax. 
							</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="section" title="Syntax Coloring">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="highlighting"></a>Syntax Coloring</h2>
</div>
</div>
</div>
<p>Besides the already mentioned advanced features like content assist and code formatting the powerful editor for your DSL is capable to mark-up your model-code to improve the overall readability. It is possible to use different colors and fonts according to the meaning of the different parts of your input file. One may want to use some decent colors for large blocks of comment while identifiers, keywords and strings should be colored differently to make it easier to distinguish between them. This kind of text decorating mark-up does not influence the semantics of the various sections but helps to understand the meaning and to find errors in the source code.</p>
<p>
				
</p>
<div class="mediaobject">
<img src="images/highlighting.png"></div>
<p>
			
</p>
<p>The highlighting is done in two stages. This allows for sophisticated algorithms that are executed asynchronously to provide advanced coloring while simple pattern matching may be used to highlight parts of the text instantaneously. The latter is called lexical highlighting while the first is based on the meaning of your different model elements and therefore called semantic highlighting.</p>
<p>When you introduce new highlighting styles, the preference page for your DSL is automatically configured and allows the customization of any registered highlighting setting. They are automatically persisted and reloaded on startup.</p>
<p>
				
</p>
<div class="mediaobject">
<img src="images/preferences_syntax.png"></div>
<p>
			
</p>
<div class="section" title="Lexical Highlighting">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="LexicalHighlighting"></a>Lexical Highlighting</h3>
</div>
</div>
</div>
<p>The lexical highlighting can be customized by providing implementations of the interface 
					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.ui.common/src/org/eclipse/xtext/ui/common/editor/syntaxcoloring/ILexicalHighlightingConfiguration.java?root=Modeling_Project&view=co" target="_new">ILexicalHighlightingConfiguration</a> and the abstract class 
					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.ui.common/src/org/eclipse/xtext/ui/common/editor/syntaxcoloring/AbstractTokenScanner.java?root=Modeling_Project&view=co" target="_new">AbstractTokenScanner</a>. The latter fulfills the interface 
					<code class="code">ITokenScanner</code> from the underlying JFace Framework, which may be implemented by clients directly.
				</p>
<p>The 
					<code class="code">ILexicalHighlightingConfiguration</code> is used to register any default style without a specific binding to a pattern in the model file. It is used to populate the preferences page and to initialize the 
					<code class="code">ITextAttributeProvider</code>, which in turn is the component that is used to obtain the actual settings for a style&rsquo;s id. An implementation will usually be very similar to the 
					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.ui.common/src/org/eclipse/xtext/ui/common/editor/syntaxcoloring/DefaultLexicalHighlightingConfiguration.java?root=Modeling_Project&view=co" target="_new">DefaultLexicalHighlightingConfiguration</a> and read like this: 
				</p>
<div class="literallayout">
<p>
<code class="code">public&nbsp;class&nbsp;DefaultLexicalHighlightingConfiguration&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;implements&nbsp;ILexicalHighlightingConfiguration&nbsp;{<br>

<br>
	public&nbsp;static&nbsp;final&nbsp;String&nbsp;KEYWORD_ID&nbsp;=&nbsp;"keyword";<br>
	public&nbsp;static&nbsp;final&nbsp;String&nbsp;COMMENT_ID&nbsp;=&nbsp;"comment";<br>

<br>
	public&nbsp;void&nbsp;configure(IHighlightingConfigurationAcceptor&nbsp;acceptor)&nbsp;{<br>
		acceptor.acceptDefaultHighlighting(KEYWORD_ID,&nbsp;"Keyword",&nbsp;<br>
				keywordTextStyle());<br>
		acceptor.acceptDefaultHighlighting(COMMENT_ID,&nbsp;"Comment",&nbsp;//&nbsp;...<br>
		//&nbsp;...<br>
	}<br>
	
<br>
	public&nbsp;TextStyle&nbsp;keywordTextStyle()&nbsp;{<br>
		TextStyle&nbsp;textStyle&nbsp;=&nbsp;new&nbsp;TextStyle();<br>
		textStyle.setColor(new&nbsp;RGB(127,&nbsp;0,&nbsp;85));<br>
		textStyle.setStyle(SWT.BOLD);<br>
		return&nbsp;textStyle;<br>
	}<br>
	
<br>
	//&nbsp;...<br>
}<br>

<br>

</code>
</p>
</div>
<p>Implementations of the 
					<code class="code">ITokenScanner</code> are responsible for splitting the content of a document into various parts, the so called tokens, and return the highlighting information for each identified range. It is critical that this is done very efficiently because this component is used on each keystroke. Xtext ships with a default implementation that is based on the lexer that is generated by ANTLR which is very lightweight and fast. This default implementation can be customized by clients easily. They simply have to bind another implementation of the 

					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.ui.common/src/org/eclipse/xtext/ui/common/editor/syntaxcoloring/antlr/AbstractAntlrTokenToAttributeIdMapper.java?root=Modeling_Project&view=co" target="_new">AbstractAntlrTokenToAttributeIdMapper</a>. To get an idea about it, have a look at the 
					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.ui.common/src/org/eclipse/xtext/ui/common/editor/syntaxcoloring/antlr/DefaultAntlrTokenToAttributeIdMapper.java?root=Modeling_Project&view=co" target="_new">DefaultAntlrTokenToAttributeIdMapper</a>.
				</p>
</div>
<div class="section" title="Semantic Highlighting">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="SemanticHighlighting"></a>Semantic Highlighting</h3>
</div>
</div>
</div>
<p>The semantic highlighting stage is executed asynchronously in the background and can be used to calculated highlighting states based on the meaning of the different model elements. Users of the editor will notice a very short delay after they have edited the text until the styles are actually applied to the document. This keeps the editor responsive while providing aid when reading and writing your model.</p>
<p>As for the lexical highlighting there exist two interfaces whose implementations work closely together and allow the customization of the semantic highlighting. Namely these are the 

					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.ui.common/src/org/eclipse/xtext/ui/common/editor/syntaxcoloring/ISemanticHighlightingConfiguration.java?root=Modeling_Project&view=co" target="_new">ISemanticHighlightingConfiguration</a> and 
					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.ui.common/src/org/eclipse/xtext/ui/common/editor/syntaxcoloring/ISemanticHighlightingCalculator.java?root=Modeling_Project&view=co" target="_new">ISemanticHighlightingCalculator</a>. While the configuration for the semantic highlighting works the same way as the 
					<code class="code">ILexicalHighlightingConfiguration</code>, the 
					<code class="code">ISemanticHighlightingCalculator</code> is the primary hook to implement the logic that will compute to-be-highlighted ranges based on the model elements. 
				</p>
<p>The framework will pass the XtextResource and an 
					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.ui.common/src/org/eclipse/xtext/ui/common/editor/syntaxcoloring/IHighlightedPositionAcceptor.java?root=Modeling_Project&view=co" target="_new">IHighlightedPositionAcceptor</a> to the calculator. It is ensured, that the resource will not be altered externally until the called method 
					<code class="code">provideHighlightingsFor</code> returns. The task is to navigate your semantic model and compute various ranges based on the node information and associate styles with them. This may read similar to the following snippet:
				</p>
<div class="literallayout">
<p>
<code class="code">public&nbsp;void&nbsp;provideHighlightingFor(XtextResource&nbsp;resource,&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;IHighlightedPositionAcceptor&nbsp;acceptor)&nbsp;{<br>
	if&nbsp;(resource&nbsp;==&nbsp;null)<br>
		return;<br>
		
<br>
	Iterable&lt;AbstractNode&gt;&nbsp;allNodes&nbsp;=&nbsp;NodeUtil.getAllContents(<br>
	&nbsp;&nbsp;resource.getParseResult().getRootNode());<br>
	for&nbsp;(AbstractNode&nbsp;abstractNode&nbsp;:&nbsp;allNodes)&nbsp;{<br>
		if&nbsp;(abstractNode.getGrammarElement()&nbsp;instanceof&nbsp;CrossReference)&nbsp;{<br>
		&nbsp;&nbsp;acceptor.addPosition(node.getOffset(),&nbsp;node.getLength(),&nbsp;<br>
		&nbsp;&nbsp;&nbsp;&nbsp;SemanticHighlightingConfiguration.CROSS_REF);<br>
		}<br>
	}<br>
}<br>

<br>

</code>
</p>
</div>
<p>This example refers to an implementation of the 
					<code class="code">ISemanticHighlightingConfiguration</code> that registers a style for a cross reference. It is pretty much the same implementation as for the previously mentioned sample of an 
					<code class="code">ILexicalHighlightingConfiguration</code>.
				</p>
<div class="literallayout">
<p>
<code class="code">public&nbsp;class&nbsp;SemanticHighlightingConfiguration&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;implements&nbsp;ISemanticHighlightingConfiguration&nbsp;{<br>
	
<br>
	public&nbsp;final&nbsp;static&nbsp;String&nbsp;CROSS_REF&nbsp;=&nbsp;"CrossReference";&nbsp;<br>

<br>
	public&nbsp;void&nbsp;configure(IHighlightingConfigurationAcceptor&nbsp;acceptor)&nbsp;{<br>
		acceptor.acceptDefaultHighlighting(CROSS_REF,&nbsp;<br>
		&nbsp;&nbsp;"Cross&nbsp;References",&nbsp;crossReferenceTextStyle());<br>
	}<br>
	
<br>
	public&nbsp;TextStyle&nbsp;crossReferenceTextStyle()&nbsp;{<br>
		TextStyle&nbsp;textStyle&nbsp;=&nbsp;new&nbsp;TextStyle();<br>
		textStyle.setStyle(SWT.ITALIC);<br>
		return&nbsp;textStyle;<br>
	}<br>
}<br>

<br>

</code>
</p>
</div>
<p>The implementor of an 
					<code class="code">ISemanticHighlightingCalculator</code> should be aware of performance to ensure a good user experience. It is probably not a good idea to traverse everything of your model when you will only register a few highlighted ranges that can be found easier with some typed method calls. It is strongly advised to use purposeful ways to navigate your model. The parts of Xtext&rsquo;s core that are responsible for the semantic highlighting are pretty optimized in this regard as well. The framework will only update the ranges that actually have been altered, for example. This optimizes the redraw process. It will even move, shrink or enlarge previously announced regions based on a best guess before the next semantic highlighting pass has been triggered after the user has changed the document.
				</p>
</div>
</div>
<div class="section" title="Project Wizard">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="projectwizard"></a>Project Wizard</h2>
</div>
</div>
</div>
<p>Optionally Xtext can also generate a project wizard for your DSL. Using this wizard a user can then with only a few clicks create a new project containing a sample model file and workflow. You enable the project wizard generation by adding the 
				<code class="code">SimpleProjectWizardFragment</code> fragment to the 
				<a class="link" href="#generator_fragment" title="Generator Fragments">workflow</a>:
			</p>
<div class="literallayout">
<p>
<code class="code">&lt;!--&nbsp;project&nbsp;wizard&nbsp;fragment&nbsp;--&gt;<br>
&lt;fragment&nbsp;class="org.eclipse.xtext.ui.generator.projectWizard.SimpleProjectWizardFragment"<br>
	generatorProjectName="${projectName}.generator"<br>
	modelFileExtension="mydsl"/&gt;<br>

<br>

</code>
</p>
</div>
<p>Here:</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>the 
						<code class="code">generatorProjectName</code> attribute is used to specify the generator project containing the workflows and templates used to generate artifacts from your DSL. The generated project wizard uses this to add a corresponding dependency to the created project.
					</p>
</li>
<li class="listitem">
<p>and the 
						<code class="code">modelFileExtension</code> specifies the default file extension associated with your DSL. When the user clicks the 
						<span class="emphasis"><em>Finish</em></span> button the project wizard will look for a file with the given extension in the created project and open it in the DSL editor. 
					</p>
</li>
</ul>
</div>
<p>After running the Xtext generator the DSL&rsquo;s UI project will contain a new Xpand template 
				<code class="code">MyDslNewProject.xpt</code> inside the 
				<code class="code">src</code> folder (under the package 
				<code class="code">&lt;base-package&gt;.ui.wizard</code>). This workflow will be run by the project wizard when the user clicks the 
				<span class="emphasis"><em>Finish</em></span> button and it is responsible for initializing the project with some sample content. The default Xpand template generated by the fragment will when executed by the wizard create a sample model file and a simple workflow to run the model through the generator project&rsquo;s 
				<code class="code">MyDslGenerator.mwe</code> workflow. As the Xpand template is in the 
				<code class="code">src</code> source folder you may of course modify it to generate whatever files you want. Just make sure to leave the top-level 
				<code class="code">main</code> definition in place, as that is the interface for the project wizard.
			</p>
<p>
				
<span class="bold"><strong>Note:</strong></span> To edit the generated Xpand template you shoud check that the JavaBeans meta model contributor is enabled under 
				<span class="emphasis"><em>Preferences &gt; Xtend/Xpand</em></span>. Further you should also configure the UI project with the Xpand/Xtend nature using 
				<span class="emphasis"><em>Configure &gt; Add Xpand/Xtend Nature</em></span> in the context menu.
			</p>
<div class="section" title="Customizing the project wizard">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="Customizingtheprojectwizard"></a>Customizing the project wizard</h3>
</div>
</div>
</div>
<p>To further customize the creation of the project (e.g. add a nature and a builder or some additional dependencies) you can implement your own 
					<span class="emphasis"><em>project creator</em></span>. The default project creator is represented by the generated class 
					<code class="code">MyDslProjectCreator</code> (suitable for subclassing) and will simply create a new project with Java and plug-in natures and execute the 
					<code class="code">main</code> definition of the Xpand template as described above.
				</p>
<p>To add more pages or input fields to the project wizard you should subclass the class 
					<code class="code">MyDslNewProjectWizard</code> as appropriate. Don&rsquo;t forget to register the subclass in the UI project&rsquo;s 
					<code class="code">plugin.xml</code>. You may also want to make this additional project info available to the Xpand template, in which case you should create a subclass for 
					<code class="code">MyDslProjectInfo</code> to hold that information, as this is the context object which gets passed to the template when it&rsquo;s executed.
				</p>
</div>
</div>
</div>
<div class="chapter" title="Chapter&nbsp;9.&nbsp;From oAW to TMF">
<div class="titlepage">
<div>
<div>
<h2 class="title">
<a name="from_oaw_to_tmf"></a>Chapter&nbsp;9.&nbsp;From oAW to TMF</h2>
</div>
</div>
</div>
<p>TMF Xtext is a complete rewrite of the Xtext framework previously released with openArchitectureWare 4.3.1 (oAW). We refer to the version from oAW as oAW Xtext whereas the current Xtext version that is hosted at Eclipse.org will be called TMF Xtext to avoid confusion.
			oAW Xtext has been around for about 2 years before TMF Xtext was released in June 2009 and has been used by many people to develop little languages and corresponding Eclipse-based IDE support.</p>
<p>TMF Xtext has been improved in many aspects compared to the former version. While it integrates far better into EMF, it offers new fundamental features as well. The overhauled architecture leads to better performance when working with large models and since the whole framework is wired via dependency injection it is highly customizable. 
			Last not least a test coverage of more than 2.000 unit tests provide confidence in the overall quality of TMF Xtext. We have been using the framework in production environments since one of the earlier milestones.</p>
<p>In this document we want to share the experience we made when migrating existing Xtext projects. The document describes the differences between oAW Xtext and TMF Xtext and is intended to be used as a guide to migrate from oAW Xtext to TMF Xtext.
			For people already familiar with the concepts of oAW Xtext it should also serve as a shortcut to learn TMF Xtext.  </p>
<div class="section" title="Why a rewrite?">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="why_rewrite"></a>Why a rewrite?</h2>
</div>
</div>
</div>
<p>The first thing you might wonder about is why we decided to reimplement the framework from scratch as opposed to use the existing code base and enhance it further on. 
				We decided so because we had learned a lot of lessons from oAW Xtext. Although we wanted to stick with many proven concepts 
				we found the implementation was lacking a solid foundation (the author of these lines is the original author of that non-solid code btw. :-)). The first version of oAW Xtext was basically a proof of concept which was so well received that it had been extended with all kinds of features (some were good, some were bad). Unfortunately code quality, clean and orthogonal concepts and test coverage did not receive the necessary focus.</p>
<p>In addition to this aspects of quality, oAW Xtext suffers from some severe performance problems. The extensive and naive use of Xtend (see next section) prevented many users to use oAW Xtext for growing real-world models.</p>
</div>
<div class="section" title="Migration overview">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="migration_overview"></a>Migration overview</h2>
</div>
</div>
</div>
<p>Although a couple of things have changed we tried to keep good ideas and left many things unchanged. At the same time we wanted to clean up poor concepts and solve the main problems we and you had with oAW Xtext.
				From a bird&rsquo;s eye view if you want to migrate an existing oAW Xtext project to TMF Xtext, you mainly just need to rename the old grammar from *.xtxt to *.xtext and add two lines to the beginning of that document (see below for details). You might also have to change a few keywords, but all in all this is pretty easy and we&rsquo;ve migrated a couple of oAW Xtext projects this way without problems.
				The other aspect where lots of code might have been written for is validation. In oAW Xtext we used Xpand&rsquo;s Check language to define constraints on the Ecore model. Even though this has been one major reason for the lack of scalability in Xtext we decided to keep the Check language as an option for compatibility reasons. Therefore, you do not need to translate your existing checks to a different language. Even better, you can overcome some performance issues by leveraging the newly introduced hooks to control the time of validation (while you type, on save, or on triggering an explicit action). 
				Anyway, if you want to provide a slick user experience validation should run fast while you type. Therefore, we strongly encourage you to implement validation using our 
				<a class="link" href="#custom_validation" title="Custom Validation">declarative Java approach</a>.
			</p>
<p>We&rsquo;ve developed and reviewed a lot of oAW Xtext projects and saw that most of the work was done in the grammar and in the validation view point. 
				Other aspects such as outline view, label provider or content assist have been customized too, but they usually do not contain complicated Xtend code.
				In some projects the exception was linking and content assist which in oAW Xtext usually forces one to write a lot of duplicated code. While working on this we came up with a new concept called &bdquo;scopes&rdquo; that not only streamlines implementation in terms of redundancy. Scopes also increase the overall performance of Xtext.
				But since the concept of scopes was not carved out in oAW Xtext one usually implemented a cluttered and duplicated poor copy through linking and content assist. For obvious reasons, we didn&rsquo;t manage to come up with a good compatibility layer.
				So this is where most of the migration effort will go into if implemented customized linking. But we think the notion of scopes is such a valuable addition that it is worth the refactoring. Also, when looking at existing oAW Xtext projects we found that most projects either didn&rsquo;t change the default linking that much or they came up with their own linking framework anyway.</p>
<p>However, if we have completely misunderstood the situation and your oAW Xtext project cannot be migrated in a reasonable amount of time, please tell us. We want to help you!</p>
</div>
<div class="section" title="Where are the Xtend-based APIs?">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="Xtend_based_apis"></a>Where are the Xtend-based APIs?</h2>
</div>
</div>
</div>
<p>One of the nice things with oAW Xtext was the use of Xtend to allow customizing different aspects of the generated language infrastructure.
				Xtend is a part of the template language Xpand, which is shipped with oAW (and now is included in M2T Xpand). It provides a nicer expression syntax than Java.
				Especially the existence of higher-order functions for collections is extremely handy when working with models.
				In addition to the nice syntax, it provides dynamic polymorphic dispatch, which means that declaring e.g. label computation for an Ecore model is very convenient and type safe at the same time.
				In Java one usually has to write instanceof and cast orgies. </p>
<div class="section" title="Xtend is hard to debug">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="Xtend_is_hard_to_debug"></a>Xtend is hard to debug</h3>
</div>
</div>
</div>
<p>While the aforementioned features allow the convenient specification of label and icon providers, outline views, content assist and linking, Xtend is interpreted and therefore hard to debug. Because of that Xpand is shipped with a special debugger facility. Unfortunately, this debugger cannot be used in the context of Xtext since it implies that the Xtend functions have to be called from a workflow. This is not and cannot be the case for Xtext Editors.
					As a result one has to debug his way through the interpreter, which is hard and inconvenient (even for us, who have written that interpreter).</p>
</div>
<div class="section" title="Xtend is slow">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="Xtend_is_slow"></a>Xtend is slow</h3>
</div>
</div>
</div>
<p>But the problematic debugging in the context of Xtext was not the main reason why there are no Xtend-based APIs beside Check in TMF Xtext. The main reason is that Xtend is too slow to be evaluated &bdquo;inside&rdquo; the editor again and again while you type. 
					While Xtend&rsquo;s performance is sufficient when run in a code generator, it is just too slow to be executed on keystroke (or 500ms after the last keystroke, which is when the reconciler reparses, links and validates the model). Xtend is relatively slow, because it supports polymorphic dispatch (the cool feature mentioned above), which means that for each invocation it matches at runtime which function is the best match and it has to do so on each call. Also Xtend supports a pluggable typesystem, where you can adapt to other existing type systems such as JavaBeans or Ecore. This is very powerful and flexible but introduces another indirection layer. Last but not least the code is interpreted and not compiled. The price we pay for all these nice features is reduced performance.</p>
<p>In addition to these scalability problems we have designed some core APIs (e.g. scopes) around the idea of Iterables, which allows for lazy resolution of elements. As Xtend does not know the concept of Iterators you would have to work with lists all the time. Copying collections over and over again is far more expensive than chaining Iterables through filters and transformers like we do with Google Collections in TMF Xtext.</p>
</div>
<div class="section" title="Convenient Java">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="Convenient_Java"></a>Convenient Java</h3>
</div>
</div>
</div>
<p>To summarize the dilemma we had to find a way to allow for convenient, scalable and debuggable APIs. Ultimately we wanted to provide neat DSLs for every view point, which provide all these things. However, we had to prioritize our efforts with the available resources in mind. 
					As a result we found ways and means to tweak Java as good as possible to allow for relatively convenient, high performing implementations. </p>
<p>Java is fast and can easily be debugged but ranks behind Xtend regarding convenience. We address this with different approaches to make Java development in the context of Xtext as comfortable as possible.</p>
<p>Most of the APIs in TMF Xtext use polymorphic dispatching, which mimics the behavior known from Xtend. Another valuable feature of Xtend while working with oAW Xtext is static type checking while working with the inferred Ecore model whereas in Java the work with dynamic Ecore classes was rather cumbersome. Since TMF Xtext generates static Ecore classes per default you get static typing in Java as well. Additionally, the use of 
					<a class="ulink" href="http://code.google.com/p/google-collections" target="_new">Google Collections</a> reduces the pain when navigating over your model to extract information. 
				</p>
<p>With these techniques an ILabelProvider that handles your own EClasses 
					<code class="code">Property</code> and 
					<code class="code">Entity</code> can be written like this:
				</p>
<div class="literallayout">
<p>
<code class="code">public&nbsp;class&nbsp;DomainModelLabelProvider&nbsp;extends&nbsp;DefaultLabelProvider&nbsp;{<br>

<br>
&nbsp;&nbsp;String&nbsp;label(Entity&nbsp;e)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;e.getName();<br>
&nbsp;&nbsp;}<br>

<br>
&nbsp;&nbsp;String&nbsp;image(Property&nbsp;p)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;p.isMultiValue()&nbsp;?&nbsp;"complexProperty.gif":&nbsp;"simpleProperty.gif";<br>
&nbsp;&nbsp;}<br>

<br>
&nbsp;&nbsp;String&nbsp;image(Entity&nbsp;e)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;"entity.gif";<br>
&nbsp;&nbsp;}<br>

<br>
}<br>
&nbsp;&nbsp;<br>

</code>
</p>
</div>
<p>As you can see this is very similar to the way one describes labels and icons in oAW Xtext, but has the advantage that it is easier to test and to debug, faster and can be used everywhere an ILabelProvider is expected in Eclipse.</p>
</div>
<div class="section" title="Conclusion">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="conclusion"></a>Conclusion</h3>
</div>
</div>
</div>
<p>Just to get it right, Xtend is a very powerful language and we still use it for its main purpose: code generation and model transformation. The whole generator in TMF Xtext is written in Xpand and Xtend and its performance is at least in our experience sufficient for that use case. Actually we were able to increase the runtime performance of Xpand by about 60% for the Galileo release of M2T Xpand. But still, live execution in the IDE and on typing is very critical and one has to think about every millisecond in this area. </p>
<p>As an alternative to the Java APIs we also considered other JVM languages. We like static typing and think it is especially important when processing typed models (which evolve heavily). That&rsquo;s why Groovy or JRuby were no alternatives. Using Scala would have been a very good match, but we didn&rsquo;t want to require knowledge of Scala so we didn&rsquo;t use it and stuck to Java. </p>
</div>
</div>
<div class="section" title="Differences">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="differences"></a>Differences</h2>
</div>
</div>
</div>
<p>In this section differences between oAW Xtext and TMF Xtext are outlined and explained. We&rsquo;ll start from the APIs such as the grammar language and the validation and finish with the different hooks for customizing linking and several UI aspects, such as outline view and content assist. We&rsquo;ll also try to map some of the oAW Xtext concepts to their counterparts in TMF Xtext.</p>
<div class="section" title="Differences in the grammar language">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="differenced_grammar_language"></a>Differences in the grammar language</h3>
</div>
</div>
</div>
<p>When looking at a TMF Xtext grammar the first time it looks like one has to provide additional information which was not necessary in oAW Xtext. In oAW Xtext *.xtxt files started with the first production rule where in TMF Xtext one has to declare the name of the language followed by declaration of one or more used/generated Ecore models:</p>
<p>TMF Xtext heading information</p>
<div class="literallayout">
<p>
<code class="code">&nbsp;&nbsp;grammar&nbsp;my.namespace.Language&nbsp;with&nbsp;org.eclipse.xtext.common.Terminals<br>
&nbsp;&nbsp;generate&nbsp;myDsl&nbsp;"http://www.namespace.my/2009/MyDSL"<br>
&nbsp;<br>
&nbsp;&nbsp;FirstRule&nbsp;:&nbsp;...<br>

<br>

</code>
</p>
</div>
<p>In oAW Xtext this information was provided through the generator (actually it is contained in the *.properties file) but we found that these things are very important for a complete description of a grammar. Therefore we made that information becoming a part of the grammar language in order to have self-describing grammars and allow for sophisticated static analysis, etc.. </p>
<p>Apart from the first two lines the grammar languages of both versions are more or less compatible. The syntax for all the different EBNF concepts (alternatives, groups, cardinalities) is similar.
					Also assignments are syntactically and semantically identical in both versions. 
					However in TMF Xtext some concepts have been generalized and improved:</p>
<div class="section" title="String rules become Datatype rules">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="differences_datatype_rules"></a>String rules become Datatype rules</h4>
</div>
</div>
</div>
<p>The very handy String rules are still present in TMF Xtext but we generalized them so that you don&rsquo;t need to write the &sbquo;String&rsquo; keyword in front of them and at the same time these rules can not only produce EStrings but (as the name suggests) any kind of EDataType. Every parser rule that neither includes assignments nor calls any other that does, returns an EDataType containing the consumed data. Per default this is an EString but you can now simply create a parser rule returning other EDataTypes as well (see 
						<a class="link" href="#datatypeRules" title="Data type rules">Datatype rules</a>).
					</p>
<div class="literallayout">
<p>
<code class="code">&nbsp;&nbsp;Float&nbsp;returns&nbsp;ecore::EDouble&nbsp;:&nbsp;INT&nbsp;('.'&nbsp;INT)?;<br>

</code>
</p>
</div>
</div>
<div class="section" title="Enum rules">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="differences_enum_rules"></a>Enum rules</h4>
</div>
</div>
</div>
<p>Enum rules have not changed significantly. The keyword has changed to be all lower case (&sbquo;enum&rsquo; instead of &sbquo;Enum&rsquo;).
						Also the right-hand side of the assignment is now optional. That is in oAW Xtext:</p>
<div class="literallayout">
<p>
<code class="code">&nbsp;&nbsp;Enum&nbsp;MyEnum&nbsp;:&nbsp;foo='foo'&nbsp;|&nbsp;bar='bar';<br>
&nbsp;&nbsp;<br>

</code>
</p>
</div>
<p>becomes</p>
<div class="literallayout">
<p>
<code class="code">&nbsp;&nbsp;enum&nbsp;MyEnum&nbsp;:&nbsp;foo='foo'&nbsp;|&nbsp;bar='bar';<br>
&nbsp;&nbsp;&nbsp;<br>

</code>
</p>
</div>
<p>and because the name of the literal equals the literal value one can omit the right-hand side in this case and write:</p>
<div class="literallayout">
<p>
<code class="code">&nbsp;&nbsp;enum&nbsp;MyEnum&nbsp;:&nbsp;foo&nbsp;|&nbsp;bar;<br>

<br>

</code>
</p>
</div>
</div>
<div class="section" title="Native rules">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="differences_native_rules"></a>Native rules</h4>
</div>
</div>
</div>
<p>Another improvement is that we could replace the blackbox native rules with full-blown EBNF syntax. 
						That is native rules become terminal rules and are no longer written as a string literal containing ANTLR syntax.</p>
<p>Example :</p>
<div class="literallayout">
<p>
<code class="code">&nbsp;&nbsp;Native&nbsp;FOO&nbsp;:&nbsp;"'f'&nbsp;'o'&nbsp;'o'";<br>

</code>
</p>
</div>
<p>becomes</p>
<div class="literallayout">
<p>
<code class="code">&nbsp;&nbsp;terminal&nbsp;FOO&nbsp;:&nbsp;'f'&nbsp;'o'&nbsp;'o';<br>

</code>
</p>
</div>
<p>See the 
						<a class="link" href="#TerminalRules" title="Terminal Rules">reference documentation</a> for all the different expressions possible in terminal rules.
					</p>
</div>
<div class="section" title="No URI terminal rule anymore">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="differences_no_URI_token"></a>No URI terminal rule anymore</h4>
</div>
</div>
</div>
<p>We decided to remove the URI terminal. The only reason for the existence was to mark the model somehow so that the framework knows what information to use in order to load referenced models. Instead we decided to solve this similar to how we imply other defaults: by convention.</p>
<p>So instead of using a special token which is syntactically a STRING token, the default import mechanism now looks for EAttributes of type EString with the name &sbquo;importURI&rsquo;.
						That is if you&rsquo;ve used the URI token like this:</p>
<div class="literallayout">
<p>
<code class="code">&nbsp;&nbsp;Import&nbsp;:&nbsp;'import'&nbsp;myReference=URI;<br>

</code>
</p>
</div>
<p>you&rsquo;ll have to rewrite it that way</p>
<div class="literallayout">
<p>
<code class="code">&nbsp;&nbsp;Import&nbsp;:&nbsp;'import'&nbsp;importURI=STRING;<br>

</code>
</p>
</div>
<p>Although this changes your Ecore model, one usually never used this reference explicitly as it was only there to be used by the default import mechanism. So we assume and hope that changing the reference is not a big deal for you. </p>
</div>
<div class="section" title="Return types">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="differences_return_types"></a>Return types</h4>
</div>
</div>
</div>
<p>The syntax to explicitly declare the return type of a rule has changed. In oAW Xtext (where this was marked as &sbquo;experimental&rsquo;) the syntax was:</p>
<div class="literallayout">
<p>
<code class="code">&nbsp;&nbsp;MyRule&nbsp;[MyType]&nbsp;:&nbsp;foo=ID;&nbsp;&nbsp;<br>

</code>
</p>
</div>
<p>in TMF Xtext we have a keyword for this :</p>
<div class="literallayout">
<p>
<code class="code">&nbsp;&nbsp;MyRule&nbsp;returns&nbsp;MyType&nbsp;:&nbsp;foo=ID;<br>

</code>
</p>
</div>
<p>This is a bit more verbose, but at the same time more readable. And as you don&rsquo;t have to write the return type in most situations, it&rsquo;s good to have a more explicit, readable syntax.</p>
</div>
</div>
<div class="section" title="Differences in Linking">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="differences_linking"></a>Differences in Linking</h3>
</div>
</div>
</div>
<p>The linking has been completely redesigned. In oAW Xtext linking was done in a very naive way: To find an element one queries a list of all &sbquo;visible&rsquo; EObjects, then filters out what is not needed and tries to find a match by comparing the text written for the crosslink with the value returned by the 
					<code class="code">id()</code> extension. As a side-effect of 
					<code class="code">link_feature()</code> the reference is set.
				</p>
<p>The code about selecting and filtering 
					<code class="code">allElements()</code> usually has been duplicated in the corresponding content assist function, so that linking and content assist are semantically in sync. If you&rsquo;re good (we usually were not) you externalized that piece of code and reused the same extension in content assist and linking. 
				</p>
<p>To put it bluntly this approach could be summarized in two steps:</p>
<div class="orderedlist">
<ol class="orderedlist" type="1">
<li class="listitem">
<p>Give me the whole universe including every unregarded object in the uncharted backwaters of the unfashionable end of the western spiral arm of the galaxy and squeeze it into an Arraylist </p>
</li>
<li class="listitem">
<p>From this, select the one I need</p>
</li>
</ol>
</div>
<p>This was not only very expensive but also lacks an important abstraction: the notion of scopes.</p>
<div class="section" title="The idea of scopes">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="differences_linking_sopes"></a>The idea of scopes</h4>
</div>
</div>
</div>
<p>In TMF Xtext we&rsquo;ve introduced scopes and scope providers that are responsible for creating scopes. A scope is basically a set of name-&gt;value pairs. Scopes are implemented upon Iterables and are nested to build a hierarchy. With scopes we declare &bdquo;visible&rdquo; objects in a lazy and cost-saving way where the linker only navigates as far as necessary to find matching objects. The content assist reuses this set of visible objects to offer only reachable objects. </p>
<p>When the linking has to be customized scoping is where most of the semantics typically goes into. By implementing an 
						<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/scoping/IScopeProvider.java?root=Modeling_Project&view=co" target="_new">IScopeProvider</a> for your language linking and content assist will automatically be kept in sync since both use the scope provider.
					</p>
<p>The provided default implementation is semantically mostly identical to how the default linking worked in oAW Xtext: </p>
<div class="orderedlist">
<ol class="orderedlist" type="1">
<li class="listitem">
<p>Elements which have an attribute &sbquo;name&rsquo; will be made visible by their name</p>
</li>
<li class="listitem">
<p>Referenced resources will be put on the (outer) scope by using the &sbquo;importURI&rsquo;- naming convention and will only be loaded if necessary</p>
</li>
<li class="listitem">
<p>The available elements are filtered by the expected type (i.e. the type of the reference to be linked)</p>
</li>
</ol>
</div>
</div>
<div class="section" title="Migration">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="differences_linking_migration"></a>Migration</h4>
</div>
</div>
</div>
<p>We expect the migration of linking to be very simple if you&rsquo;ve not changed the default semantics that much. We&rsquo;ve already migrated a couple of projects and it wasn&rsquo;t too hard to do so.
						If you have changed linking (and also content assist) a lot, you&rsquo;ll have to translate the semantics to the IScopeProvider concept. This might be a bit of work, but it is worth the effort as this will clean up your code base and better separate concerns.</p>
</div>
</div>
<div class="section" title="Differences in UI customizing">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="differences_ui"></a>Differences in UI customizing</h3>
</div>
</div>
</div>
<p>In oAW Xtext several UI services such as content assist, outline view or the label provider have been customized using Xtend. In TMF Xtext there is no Xtend API for these aspects. Extensive model computations for the content assist is most probably not necessary anymore- it reuses scopes. And since we provide a declarative Java API that mimics the polymorphic dispatch and relies on static Ecore classes you will gain nearly the same expressiveness as before while increasing maintainability and performance.</p>
<p>Beside the API change in favor of Java we have to mention that in TMF Xtext the outline view does not support multiple view points so far. This is just because we didn&rsquo;t manage to get this included. We don&rsquo;t think that view points are a bad idea in general, but we decided that other things were more important.</p>
</div>
</div>
<div class="section" title="New Features">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="NewFeatures"></a>New Features</h2>
</div>
</div>
</div>
<p>This section provides an overview of new possibilities with TMF Xtext compared to oAW Xtext. Please note that this list is neither complete nor does it explain every aspect in detail to keep this document tight.</p>
<div class="section" title="Dependency Injection with Google Guice">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="DependencyInjectionwithGoogleGuice"></a>Dependency Injection with Google Guice</h3>
</div>
</div>
</div>
<p>Beyond the mentioned architectural overhaul that carve out separate concerns in a meaningful way these different classes of TMF Xtext are wired using 
					<a class="ulink" href="http://code.google.com/p/google-guice" target="_new">Google Guice</a>  and can easily be replaced by or combined with your own implementation. We could have foreseen some common needs for adaption but with this mechanism you can virtually change every aspect of Xtext without duplicating an unmanageable amount of code.
				</p>
</div>
<div class="section" title="Improvements on Grammar Level">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="ImprovementsonGrammarLevel"></a>Improvements on Grammar Level</h3>
</div>
</div>
</div>
<p>The Xtext grammar language introduces some new features, too. Read the chapter 
					<a class="link" href="#grammarLanguage" title="Chapter&nbsp;4.&nbsp;The Grammar Language">grammar language</a> to understand the details about all the improvements that have been implemented.
				</p>
<p>
					
<a class="link" href="#grammarMixins" title="Grammar Mixins">Grammar mixins</a> allow you to extend existing languages and change their concrete and abstract syntax. However the abstract syntax (i.e. the Ecore model) can only be extended. This allows you to reuse existing validations, code generators, interpreters or other code which has been written against those types.
				</p>
<p>In oAW Xtext common terminals like ID, INT, STRING, ML_COMMENT, SL_COMMENT and WS (whitespace) were hard coded into the grammar language and couldn&rsquo;t be removed and hardly overridden. In TMF Xtext these terminals are imported through the newly introduced grammar mixin mechanism from the shipped grammar 
					<code class="code">org.eclipse.xtext.common.Terminals</code> per default. This means that they are still there but reside in a library now. You don&rsquo;t have to use them and you can come up with your own set of reusable rules. 
				</p>
<p>
					
<a class="link" href="#grammarImport" title="Importing existing Ecore models">Reusing existing Ecore models</a> in oAW Xtext didn&rsquo;t work well and we communicated this by flagging this feature as &sbquo;experimental&rsquo;. In TMF Xtext importing existing Ecore models is fully supported. Moreover, it is possible to import a couple of different EPackages and generate some at the same time, so that the generated Ecore models extend or refer to the existing Ecore models.
				</p>
<p>The grammar language gained one new concept that is of great value when writing left-factored grammars (e.g. expressions). With actions one can do minor AST rewritings within a rule to overcome degenerated ASTs. You will find an 
					<a class="link" href="#grammarActions" title="Assigned Actions">in-depth explanation of actions</a> in the dedicated chapter in the reference documentation.
				</p>
</div>
<div class="section" title="Fine-grained control for validation">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="differences_validation"></a>Fine-grained control for validation</h3>
</div>
</div>
</div>
<p>In order to make more expensive validations possible without slowing down the editor, TMF Xtext supports three different validation hooks.  </p>
<div class="orderedlist">
<ol class="orderedlist" type="1">
<li class="listitem">
<p>FAST constraints are triggered by the reconciler (i.e. 500 ms after the last keystroke) and on save.</p>
</li>
<li class="listitem">
<p>NORMAL constraints are executed on save only.</p>
</li>
<li class="listitem">
<p>EXPENSIVE constraints are executed through an action which is available through the context menu.</p>
</li>
</ol>
</div>
<p>Please note that when using Xtext models for code generation the checks of all three categories will be performed. </p>
<p>Beside this it is now possible to add information about the feature which is validated.</p>
<div class="literallayout">
<p>
<code class="code">&nbsp;&nbsp;context&nbsp;Entity#name&nbsp;ERROR&nbsp;"Name&nbsp;should&nbsp;start&nbsp;with&nbsp;a&nbsp;capital&nbsp;"+this.name+"."&nbsp;:<br>
&nbsp;&nbsp;&nbsp;&nbsp;this.name.toFirstUpper()&nbsp;==&nbsp;this.name;<br>

</code>
</p>
</div>
<p>If you add the name of a feature prepended by a hash (&sbquo;#&rsquo;) in Check, the editor will only mark the value of the feature (name), not the whole object (Entity). Both concepts, control over validation time as well as pointing to a specific feature, complement one another in Check and Java based validation.</p>
</div>
</div>
<div class="section" title="Migration Support">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="MigrationSupport"></a>Migration Support</h2>
</div>
</div>
</div>
<p>In this document we tried to explain why we decided to change some aspects of Xtext&rsquo;s architecture. We consider most changes as minor but when it comes to scopes you will face a conceptual enhancement that did not exist in oAW Xtext. We tried to explain why it is not easily possible to come up with an adapter for scoping.</p>
<p>That said you might not have the time to do the migration and wished to have advice for migrating, especially from oAW linking to TMF linking. You&rsquo;re welcome to ask any questions in the newsgroup and we&rsquo;ll try to help you as much as possible in order to get your projects migrated. Also, if you don&rsquo;t want to do the migration yourself we (itemis AG) can do the work for you or help you with that. </p>
</div>
</div>
<div class="chapter" title="Chapter&nbsp;10.&nbsp;Migrating from TMF Xtext 0.7.x">
<div class="titlepage">
<div>
<div>
<h2 class="title">
<a name="migrating_from_0_7"></a>Chapter&nbsp;10.&nbsp;Migrating from TMF Xtext 0.7.x</h2>
</div>
</div>
</div>
<p>Most of the tasks when migrating to Xtext 1.0 can be automated. Some changes will be necessary in the manually written code where you have to carefully
			verify that your implemention is still working with Xtext 1.0. A relyable test-suite helps a lot. </p>
<p>The grammar language is fully backward compatible. You should not have to apply any changes in the primary artifact. However, we introduced some additional
			validation rules that mark inconsistencies in your grammar. If you get any warnings in the grammar editor, it should be straight forward to fix them.</p>
<p>
			
<span class="emphasis"><em>Tip: You&rsquo;ll learn something about the new features if you compare a freshly created Xtext project based on 0.7.x with a new Xtext project based on 1.0. Especially the new fragments in the workflow are a good indicator for useful new features.</em></span> 
		
</p>
<div class="section" title="Take the Shortcut">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="TaketheShortcut"></a>Take the Shortcut</h2>
</div>
</div>
</div>
<p>If you haven&rsquo;t made too many customizations to the generated defaults and if you&rsquo;re not referencing many classes of your Xtext language from the outside, you might consider starting with a new Xtext project, copying your grammar and then manually restoring your changes step by step. If that does not work for you, go on reading!</p>
</div>
<div class="section" title="Migrating Step By Step">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="MigratingStepByStep"></a>Migrating Step By Step</h2>
</div>
</div>
</div>
<p>Before you start the migration to Xtext 1.0, you should make sure that no old plug-ins are in your target platform. Some plug-ins from Xtext 0.7.x have been merged and 
				do no longer exist. </p>
<p>
				
<span class="emphasis"><em>Tip: The following steps try to use the Eclipse compiler to spot any source-incompatible changes while fixing them with only a few well described user actions. Doing these steps in another order causes most likely a higher effort.</em></span>
			
</p>
<div class="section" title="Update the Plug-in Dependencies and Import Statements">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="UpdatethePluginDependenciesandImportStatements"></a>Update the Plug-in Dependencies and Import Statements</h3>
</div>
</div>
</div>
<p>You should update the constraints from version 
					<code class="code">0.7.x</code> to 
					<code class="code">[1.0.0,2.0.0)</code> in your manifest files if you specified any concrete versions.
					Make sure that your 
					<code class="code">dsl.ui</code>-projects do not refer to the plug-in 
					<code class="code">org.eclipse.xtext.ui.common</code> or 
					<code class="code">org.eclipse.xtext.ui.core</code> but to 
					<code class="code">org.eclipse.xtext.ui</code> instead. The arguably easiest way is a global text-based search and replace across the manifest files. The bundle 
					<code class="code">org.eclipse.xtext.log4j</code> is obsolete as well. The generator will create 
					<code class="code">import-package</code> entries in the manifests later on.
				</p>
<p>The next step is to fix the import statements in your classes to match the refactored naming scheme in Xtext. Perform a global search for "
					<code class="code">import org.eclipse.xtext.ui.common.</code>" and 
					"
					<code class="code">import org.eclipse.xtext.ui.core.</code>" and replace the matches with "
					<code class="code">import org.eclipse.xtext.ui.</code>". This fixes most of the problems in the manually written code. 
				</p>
</div>
<div class="section" title="Rename the Packages in the dsl.ui-Plug-in">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="RenamethePackagesinthedsl.uiPlugin"></a>Rename the Packages in the dsl.ui-Plug-in</h3>
</div>
</div>
</div>
<p>We changed the naming pattern for artifacts in the 
					<code class="code">dsl.ui</code>-plug-in to match the OSGI conventions. The easiest way to update your existing projects is to apply a 
&bdquo;					Rename Package&rdquo; refactoring on the packages in the 
					<code class="code">src</code>- and 
					<code class="code">src-gen</code> folder 
					<span class="bold"><strong>before</strong></span> you re-run the workflow that regenerates your language. Make sure you ticked &bdquo;Rename sub-packages&rdquo; in the dialog. It is error-prone to enable the search in non-java files as this will perform incompatible changes in the manifest files. Furthermore, it is important to perform the rename operation in the 
					<code class="code">src-gen</code> folder, too. This ensures that the references in your manually written code are properly updated.
				</p>
</div>
<div class="section" title="Update the Workflow">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="UpdatetheWorkflow"></a>Update the Workflow</h3>
</div>
</div>
</div>
<p>The 
					<code class="code">JavaScopingFragment</code> does no longer exist. It has been superseded by the 
					<code class="code">ImportURIScopingFragment</code> in combination with the 
					<code class="code">SimpleNamesFragment</code>.
					Please replace  
				</p>
<div class="literallayout">
<p>
<code class="code">&lt;fragment&nbsp;class="org.eclipse.xtext.generator.scoping.JavaScopingFragment"/&gt;<br>

</code>
</p>
</div>
<p>with</p>
<div class="literallayout">
<p>
<code class="code">&lt;fragment&nbsp;class="org.eclipse.xtext.generator.scoping.ImportURIScopingFragment"/&gt;<br>
&lt;fragment&nbsp;class="org.eclipse.xtext.generator.exporting.SimpleNamesFragment"/&gt;<br>

<br>

</code>
</p>
</div>
<p>The 
					<code class="code">PackratParserFragment</code> has been abandoned as well. It is save to remove the reference to that one if it is activated in your workflow. After you&rsquo;ve changed your workflow, it should be possible to regenerate your language without any errors in the console. It is ok to have compilation errors prior to executing the workflow.
				</p>
</div>
<div class="section" title="MANIFEST.MF and plugin.xml">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="MANIFEST.MFandplugin.xml"></a>MANIFEST.MF and plugin.xml</h3>
</div>
</div>
</div>
<p>The previous rename package refactoring updated most of the entries in the 
					<code class="code">MANIFEST.MF</code> and and some entries in the 
					<code class="code">plugin.xml</code>. Others have to be fixed manually. The Eclipse compiler will point to many of the remaining problems in the manifest files but it is unlikely that it will spot the erroneous references in the 
					<code class="code">plugin.xml</code>.
				</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>In the generated UI plug-in&rsquo;s 
							<code class="code">MANIFEST.MF</code>, remove the package exports of no longer existing packages and make sure the bundle activator points to the newly generated one (with 
							<code class="code">.ui.</code> in its package name).  
						</p>
</li>
<li class="listitem">
<p>It was already mentioned that the plug-ins 
							<code class="code">org.eclipse.xtext.ui.core</code> and 
							<code class="code">org.eclipse.xtext.ui.common</code> have been merged into a new single plug-in 
							<code class="code">org.eclipse.xtext.ui</code>. The same happened to the respective Java packages. Change eventually remaining bundle-dependencies in all manifests. 
						</p>
</li>
<li class="listitem">
<p>The plug-in 
							<code class="code">org.eclipse.xtext.log4j</code> no longer exists. We use a package import of 
							<code class="code">org.apache.log4j</code> instead. Also remove the buddy registration. 
						</p>
</li>
<li class="listitem">
<p>Due to renamed packages, you have to fix all references to classes therein in the 
							<code class="code">plugin.xml</code>. A diff with the 
							<code class="code">plugin.xml_gen</code> will be a great help. If you haven&rsquo;t added a lot manually, consider merging these into the generated version instead of going the other way around. Note that warnings in the 
							<code class="code">plugin.xml</code> can be considered to be real errors most of the time. Make sure
						</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="circle">
<li class="listitem">
<p>the 
									<code class="code">&lt;MyDsl&gt;ExecutableExtensionFactory</code> has the 
									<code class="code">.ui.</code> package prefix
								</p>
</li>
<li class="listitem">
<p>classes from 
									<code class="code">org.eclipse.xtext.ui.common</code> and 
									<code class="code">org.eclipse.xtext.ui.core</code> are now usually somewhere in 
									<code class="code">org.eclipse.xtext.ui</code>. They are also referenced by the 
									<code class="code">&lt;MyDsl&gt;ExecutableExtensionFactory</code> and thus not covered by the editor&rsquo;s validation. 
								</p>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>A number of new features are being registered in the 
							<code class="code">plugin.xml</code>, e.g. 
							<span class="emphasis"><em>Find references</em></span>, 
							<span class="emphasis"><em>Quick Outline</em></span>, and 
							<span class="emphasis"><em>Quickfixes</em></span>. You can enable them by manually copying the respective entries from 
							<code class="code">plugin.xml_gen</code> to  
							<code class="code">plugin.xml</code>.
						</p>
</li>
<li class="listitem">
<p>To run MWE2 workflows later on, you must change the plug-in dependencies from 
							<code class="code">org.eclipse.emf.mwe.core</code> to 
							<code class="code">org.eclipse.emf.mwe2.launch</code> in your manifest. Optional resolution is fine.
						</p>
</li>
</ul>
</div>
</div>
<div class="section" title="Noteworthy API changes">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="NoteworthyAPIchanges"></a>Noteworthy API changes </h3>
</div>
</div>
</div>
<p>The 
					<code class="code">src</code> folders are generated once, so existing code will not be overwritten but has to be updated manually. At least one new class has appeared in your 
					<code class="code">src</code>-folder of the 
					<code class="code">ui</code> plug-in. there will now be a 
					<code class="code">&lt;MyDsl&gt;StandaloneSetup</code> inheriting form the generated 
					<code class="code">&lt;MyDsl&gt;StandaloneSetupGenerated</code> to allow customization.
				</p>
<p>You will face a couple of compilation problems due to changes in the API. Here&rsquo;s a list of the most prominent changes. It is usually only necessary to change your code, if you face any compilation problems.</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>The method 
							<code class="code">IScopeProvider.getScope(EObject,EClass)</code> has been removed. Use  
							<code class="code">IScopeProvider.getScope(EObject,EReference)</code> instead. 
						</p>
</li>
<li class="listitem">
<p>Renamed 
							<code class="code">DefaultScopeProvider</code> to 
							<code class="code">SimpleNameScopeProvider</code>. There have been further significant changes in the scoping API that allow for optimized implementations. Consult the 
							<a class="link" href="#scoping" title="Scoping">section on scoping</a> for details.
						</p>
</li>
<li class="listitem">
<p>The return type of 
							<code class="code">AbstractInjectableValidator.getEPackages()</code> was changed from 
							<code class="code">List&lt;? extends EPackage&gt;</code> to 
							<code class="code">List&lt;EPackage&gt;</code>.
						</p>
</li>
<li class="listitem">
<p>The parser interfaces now use 
							<code class="code">java.io.Reader</code> instead of 
							<code class="code">java.io.InputStream</code> to explicitly address encoding. Have a look at the 
							<code class="code">IEncodingProvider</code> for details.
						</p>
</li>
<li class="listitem">
<p>The handling of 
							<code class="code">ILabelProvider</code> in various contexts has been refactored. The former base class 
							<code class="code">DefaultLabelProvider</code> no longer exists. Use the 
							<code class="code">DefaultEObjectLabelProvider</code> instead. See the 
							<a class="link" href="#labelProvider" title="Label Provider">section on label providers</a> for details. 
						</p>
</li>
<li class="listitem">
<p>We have introduced a couple of new packages to better separate concerns. Most classes should be easy to relocate. </p>
</li>
<li class="listitem">
<p>The runtime and UI modules have separate base classes 
							<code class="code">DefaultRuntimeModule</code> and 
							<code class="code">DefaultUiModule</code> now. We use Guice&rsquo;s module overrides to combine them with the newly introduced 
							<code class="code">SharedModule</code>.  You have to add a constructor the your 
							<code class="code">&lt;MyDsl&gt;UiModule</code> that takes an 
							<code class="code">AbstractUiPlugin</code> as argument and pass that one to the super constructor. 
							<span class="emphasis"><em>Tip: There is an Eclipse quick-fix available for that one.</em></span>
						
</p>
</li>
<li class="listitem">
<p>The interfaces 
							<code class="code">ILexicalHighlightigConfiguration</code> and 
							<code class="code">ISemanticHighlightingConfiguration</code> have been merged into 
							<code class="code">IHighlightingConfiguration</code>.
						</p>
</li>
<li class="listitem">
<p>The 
							<code class="code">DefaultTemplateProposalProvider</code> takes an additional, injectable constructor parameter of type 
							<code class="code">ContextTypeIdHelper</code>.
						</p>
</li>
<li class="listitem">
<p>The 
							<code class="code">HyperlinkHelper</code> uses field injection instead of constructor injection. The method 
							<code class="code">createHyperlinksByOffset</code> should be overridden instead of the former 
							<code class="code">findCrossLinkedEObject</code>.
						</p>
</li>
<li class="listitem">
<p>The API to skip a node in the outline has changed. Instead of returning the 
							<code class="code">HIDDEN_NODE</code> you&rsquo;ll have to implement 
							<code class="code">boolean consumeNode(MyType)</code> and return 
							<code class="code">false</code>.
						</p>
</li>
<li class="listitem">
<p>The 
							<code class="code">Readonly*Storage</code> implementations have been removed. There is a new API to open editors for objects with a given URI. Please use the 
							<code class="code">IURIEditorOpener</code> to create an editor or the 
							<code class="code">IStorage2UriMapper</code> to obtain an 
							<code class="code">IStorage</code> for a given URI.
						</p>
</li>
<li class="listitem">
<p>The interfaces 
							<code class="code">IStateAccess</code> and 
							<code class="code">IEObjectHandle</code> have been moved along with the 
							<code class="code">IUnitOfWork</code> to the package 
							<code class="code">org.eclipse.xtext.util.concurrent</code>.
						</p>
</li>
<li class="listitem">
<p>The 
							<code class="code">ValidationJobFactory</code> is gone. Please implement a custom 
							<code class="code">IResourceValidator</code> instead.
						</p>
</li>
<li class="listitem">
<p>The grammar elements 
							<code class="code">Alternatives</code> and 
							<code class="code">Group</code> have a new common super type 
							<code class="code">CompoundElement</code>. The methods 
							<code class="code">getGroups</code> and 
							<code class="code">getTokens</code> have been refactored to 
							<code class="code">getElements</code>.
						</p>
</li>
<li class="listitem">
<p>Completion proposals take a 
							<code class="code">StyledString</code> instead of a plain string as display string.
						</p>
</li>
<li class="listitem">
<p>The AbstractLabelProvider does no longer expose its 
							<code class="code">IImageHelper</code>. Use 
							<code class="code">convertToImage</code> instead or inject your own 
							<code class="code">IImageHelper</code>.
						</p>
</li>
<li class="listitem">
<p>The implementation-classes from 
							<code class="code">org.eclipse.xtext.index</code> were superseded by the builder infrastructure. Use the 
							<code class="code">QualifiedNamesFragment</code> and the 
							<code class="code">ImportNamespacesScopingFragment</code> instead of the 
							<code class="code">ImportedNamespacesScopingFragment</code>. Please refer to the section about the builder infrastructure for details.
						</p>
</li>
<li class="listitem">
<p>All the Xtend based fragments were removed. </p>
</li>
<li class="listitem">
<p>
							
<code class="code">ILinkingService.getLinkText</code> was removed. Have a look at the 
							<code class="code">LinkingHelper</code> and the 
							<code class="code">CrossReferenceSerializer</code> if you relied on this method.
						</p>
</li>
<li class="listitem">
<p>The 
							<code class="code">SerializerUtil</code> was renamed to 
							<code class="code">Serializer</code>. There were other heavy refactorings that involved the serializer and its components (like e.g. the 
							<code class="code">ITransientValueService</code>) but it should be pretty straight forward to migrate existing client code.
						</p>
</li>
<li class="listitem">
<p>The method-signatures of the 
							<code class="code">IFragmentProvider</code> have changed. The documentation will give a clue on how to update existing implementations.
						</p>
</li>
<li class="listitem">
<p>Some static methods were removed from utility classes such as 
							<code class="code">EcoreUtil2</code> and 
							<code class="code">ParsetreeUtil</code> in favor of more sophisticated implementations.
						</p>
</li>
</ul>
</div>
</div>
</div>
<div class="section" title="Now go for the new features">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="Nowgoforthenewfeatures"></a>Now go for the new features</h2>
</div>
</div>
</div>
<p>After migrating, some of the new features in Xtext 1.0 will be automatically available. Others require further configuration.
				We recommend reading the sections about</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>qualified names and namespace imports</p>
</li>
<li class="listitem">
<p>the builder infrastructure</p>
</li>
<li class="listitem">
<p>quick fixes</p>
</li>
<li class="listitem">
<p>unordered groups</p>
</li>
<li class="listitem">
<p>quick outline</p>
</li>
<li class="listitem">
<p>MWE2</p>
</li>
<li class="listitem">
<p>referencing Java elements</p>
</li>
</ul>
</div>
<p>For an overview over the new features consult our 
				<a class="ulink" href="http://www.eclipse.org/Xtext/documentation/helios/new_and_noteworthy.php" target="_new">New and Noteworthy</a> online. 
			</p>
</div>
</div>
<div class="chapter" title="Chapter&nbsp;11.&nbsp;The ANTLR IP issue (or which parser to use?)">
<div class="titlepage">
<div>
<div>
<h2 class="title">
<a name="antlr_ip_issue"></a>Chapter&nbsp;11.&nbsp;The ANTLR IP issue (or which parser to use?)</h2>
</div>
</div>
</div>
<p>In order to be able to parse models written in your language, Xtext needs to provide a special parser for it.
			The parser is generated from the language grammar. </p>
<p>Currently it is recommended to use the 
			<a class="ulink" href="http://www.antlr.org" target="_new">ANTLR-based</a> parser.
			ANTLR is a very sophisticated parser generator framework based on a so called LL(*) algorithm.
			It is fast, simple and at the same time has some very nice and sophisticated features. Especially its 
			support for error recovery is much better than what other parser generators provide.
		</p>
<p>ANTLR comes in two parts: the runtime and the generator.
			Both are shipped under the BSD license and have a clean intellectual property history. 
			However the generator is still implemented in an older version of ANTLR (v 2.x), where it was not possible for the Eclipse Foundation 
			to be sure where exactly every line of code originated. Therefore ANTLR v 2.x didn&rsquo;t get the required approval.
			Eclipse has a strict IP policy, which makes sure that everything provided by Eclipse can be consumed under the terms of the Eclipse Public License.
			The details are described in 
			<a class="ulink" href="http://www.eclipse.org/org/documents/Eclipse_IP_Policy.pdf" target="_new">this document</a>.
		</p>
<p>Unfortunately as the generator of ANTLR V3 needs ANTLR V2 it is as well not yet IP approved.
			That is why we are not allowed to ship Xtext with the ANTLR generator (the runtime is IP approved), but have to provide it separately via update-site at:</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>
					
<a class="ulink" href="http://download.itemis.com/updates/" target="_new">http://download.itemis.com/updates/</a>
				
</p>
</li>
</ul>
</div>
<p>
			
<span class="bold"><strong>IMPORTANT</strong></span> :

			<span class="italic">Although if you use the non-IP approved ANTLR generator, you can still ship any languages and the IDEs you&rsquo;ve developed with Xtext without any worrying, because the 
				<span class="bold"><strong>ANTLR runtime is IP approved</strong></span>
			</span>
		
</p>
<div class="section" title="What if I do not want to use non IP-approved code">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="WhatifIdonotwanttousenonIPapprovedcode"></a>What if I do not want to use non IP-approved code</h2>
</div>
</div>
</div>
<p>If you, against all recommendations, need to stick to a fully IP approved generator, you can use the parser generator we&rsquo;ve developed.
				But be warned, although it&rsquo;s fully functional and equally fast, it does not have any error recovery.
				This makes the editing experience in the editor more or less unacceptable.</p>
</div>
</div>
</div>
</body>
</html>
