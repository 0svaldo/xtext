<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<title>Xtext User Guide</title>
<link href="book.css" rel="stylesheet" type="text/css">
<meta content="DocBook XSL Stylesheets V1.75.1" name="generator">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<div class="book" title="Xtext User Guide">
<div class="titlepage">
<div>
<div>
<h1 class="title">
<a name="N10001"></a>Xtext User Guide</h1>
</div>
</div>
<hr>
</div>
<div class="toc">
<p>
<b>Table of Contents</b>
</p>
<dl>
<dt>
<span class="chapter"><a href="#Overview">1. Overview</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="section"><a href="#WhatisXtext">What is Xtext?</a></span>
</dt>
<dt>
<span class="section"><a href="#concepts">Xtext concepts from a bird&rsquo;s eye view</a></span>
</dt>
</dl>
</dd>
<dt>
<span class="chapter"><a href="#grammarLanguage">2. The Grammar Language</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="section"><a href="#Firstanexample">First an example</a></span>
</dt>
<dt>
<span class="section"><a href="#syntax">The Syntax</a></span>
</dt>
<dt>
<span class="section"><a href="#metamodelInference">Meta-Model inference</a></span>
</dt>
<dt>
<span class="section"><a href="#grammarImport">Importing existing Meta Models</a></span>
</dt>
<dt>
<span class="section"><a href="#grammarMixins">Grammar Mixins</a></span>
</dt>
<dt>
<span class="section"><a href="#Defaulttokens">Default tokens</a></span>
</dt>
</dl>
</dd>
<dt>
<span class="chapter"><a href="#configuration">3. Configuration</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="section"><a href="#generator">The Generator</a></span>
</dt>
<dt>
<span class="section"><a href="#dependencyInjection">Dependency Injection in Xtext with Google Guice</a></span>
</dt>
</dl>
</dd>
<dt>
<span class="chapter"><a href="#RuntimeConcepts">4. Runtime Concepts</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="section"><a href="#RuntimesetupISetup">Runtime setup (ISetup)</a></span>
</dt>
<dt>
<span class="section"><a href="#SetupwithinEclipseEquinox">Setup within Eclipse / Equinox</a></span>
</dt>
<dt>
<span class="section"><a href="#validation">Validation</a></span>
</dt>
<dt>
<span class="section"><a href="#linking">Linking</a></span>
</dt>
<dt>
<span class="section"><a href="#scoping">Scoping</a></span>
</dt>
<dt>
<span class="section"><a href="#valueconverter">Value Converter</a></span>
</dt>
<dt>
<span class="section"><a href="#serialization">Serialization</a></span>
</dt>
<dt>
<span class="section"><a href="#fragmentProvider">Fragment Provider (referencing Xtext models from other EMF artifacts)</a></span>
</dt>
</dl>
</dd>
<dt>
<span class="chapter"><a href="#IDEconcepts">5. IDE concepts</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="section"><a href="#concurrency">Managing Concurrency</a></span>
</dt>
<dt>
<span class="section"><a href="#labelProvider">Label Provider</a></span>
</dt>
<dt>
<span class="section"><a href="#contentAssist">Content Assist</a></span>
</dt>
<dt>
<span class="section"><a href="#templates">Template Proposals</a></span>
</dt>
<dt>
<span class="section"><a href="#outline">Outline View</a></span>
</dt>
<dt>
<span class="section"><a href="#navigation">Navigation and Hyperlinking</a></span>
</dt>
<dt>
<span class="section"><a href="#formatting">Formatting (Pretty Printing)</a></span>
</dt>
</dl>
</dd>
<dt>
<span class="chapter"><a href="#from_oaw_to_tmf">6. From oAW to TMF</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="section"><a href="#why_rewrite">Why a rewrite?</a></span>
</dt>
<dt>
<span class="section"><a href="#migration_overview">Migration overview</a></span>
</dt>
<dt>
<span class="section"><a href="#Xtend_based_apis">Where are the Xtend-based APIs?</a></span>
</dt>
<dt>
<span class="section"><a href="#differences">Differences</a></span>
</dt>
<dt>
<span class="section"><a href="#NewFeatures">New Features</a></span>
</dt>
<dt>
<span class="section"><a href="#MigrationSupport">Migration Support</a></span>
</dt>
</dl>
</dd>
<dt>
<span class="chapter"><a href="#antlr_ip_issue">7. The Antlr IP issue (or which parser to use?)</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="section"><a href="#WhatifIdontwanttousenonIPapprovedcode">What if I don&rsquo;t want to use non IP-approved code</a></span>
</dt>
</dl>
</dd>
</dl>
</div>
<div class="chapter" title="Chapter&nbsp;1.&nbsp;Overview">
<div class="titlepage">
<div>
<div>
<h2 class="title">
<a name="Overview"></a>Chapter&nbsp;1.&nbsp;Overview</h2>
</div>
</div>
</div>
<div class="section" title="What is Xtext?">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="WhatisXtext"></a>What is Xtext?</h2>
</div>
</div>
</div>
<p>Xtext is a framework for development of 
				<a class="link" href="#DSL" title="What is a domain-specific language (DSL)">domain-specific language</a>. It is tightly integrated with the 
				<a class="ulink" href="http://www.eclipse.org/EMF" target="_new">Eclipse Modeling Framework (EMF)</a> and leverages the Eclipse Platform in order to provide a language-specific integrated development environment (IDE). 
			</p>
<p>In contrast to common parser generators (like e.g. JavaCC or ANTLR), the grammar language is used to derive much more than just a parser and lexer (lexical analyzer). </p>
<p>From a grammar the following is derived:</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>incremental, ANTLR 3 based parser and lexer</p>
</li>
<li class="listitem">
<p>Ecore-based meta models (optional)</p>
</li>
<li class="listitem">
<p>a serializer, used to serialize instances of such meta models back to a parseable textual representation</p>
</li>
<li class="listitem">
<p>a linker</p>
</li>
<li class="listitem">
<p>an implementation of the EMF Resource interface (based on the parser and the serializer)</p>
</li>
<li class="listitem">
<p>a full-fledged integration of the language into Eclipse IDE</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="circle">
<li class="listitem">
<p>syntax coloring</p>
</li>
<li class="listitem">
<p>navigation (F3, etc.) </p>
</li>
<li class="listitem">
<p>code completion</p>
</li>
<li class="listitem">
<p>outline views</p>
</li>
<li class="listitem">
<p>code templates</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<p>The generated artifacts are wired up through 
				<a class="ulink" href="http://code.google.com/p/google-guice/" target="_new">Google Guice</a>, a dependency injection framework which makes it easy to exchange certain functionality in a non-invasive manner. For example if you do not like the default code assistant implementation, all you need to do is to come up with an alternative implementation of the corresponding service and configure it via 
				<a class="link" href="#dependencyInjection" title="Dependency Injection in Xtext with Google Guice">dependency injection</a>.
			</p>
<div class="section" title="What is a domain-specific language (DSL)">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="DSL"></a>What is a domain-specific language (DSL)</h3>
</div>
</div>
</div>
<p>A DSL is a small programming language, which focuses on a particular domain.
					Such a domain can be more or less anything. The idea is that its concepts and notation is as close as possible to
					what you have in mind when you think about a solution in that domain. Of course we are talking about problems which can
					be solved or processed by computers somehow.</p>
<p>The opposite of a DSL is a so called GPL a General Purpose Language such as Java or any other common programming language.
					With a GPL you can solve every computer problem, but it might not always be the best way to solve it.</p>
<p>Imagine you want to remove the core from an apple. You could of course use a swiss army knife to cut it out, and this is reasonable if you have to do it just once or twice. But if you need to do that on a regular basis it might be more efficient to use an apple corer.</p>
<p>There are a couple of well-known examples of DSLs. For instance SQL is actually a DSL which focuses on querying relational databases. Other DSLs are regular expressions or even languages provided by tools like MathLab. Also most XML languages are actually domain-specific languages. The whole purpose of XML is to allow for easy creation of new languages. Unfortunately with XML you are not able to change the concrete syntax, which is the major problem with it. The concrete syntax of XML is way too verbose. Also a generic syntax for everything is a compromise.</p>
</div>
</div>
<div class="section" title="Xtext concepts from a bird&rsquo;s eye view">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="concepts"></a>Xtext concepts from a bird&rsquo;s eye view</h2>
</div>
</div>
</div>
<p>text</p>
</div>
</div>
<div class="chapter" title="Chapter&nbsp;2.&nbsp;The Grammar Language">
<div class="titlepage">
<div>
<div>
<h2 class="title">
<a name="grammarLanguage"></a>Chapter&nbsp;2.&nbsp;The Grammar Language</h2>
</div>
</div>
</div>
<p>The 
			<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/Xtext.xtext?root=Modeling_Project&view=markup" target="_new">grammar language</a> 
			is the corner stone of Xtext and is defined in itself &ndash; of course.
		</p>
<p>It is a DSL carefully designed for description of textual languages, based on 
			<a class="ulink" href="http://en.wikipedia.org/wiki/LL_parser" target="_new">LL(*)-Parsing</a> that is like 
			<a class="ulink" href="http://www.artima.com/lejava/articles/antlr_3.html" target="_new">Antlr3's parsing strategy</a> and supported by 
			<a class="ulink" href="http://pdos.csail.mit.edu/~baford/packrat/" target="_new">packrat parsers</a>.
			The main idea is to describe the concrete syntax and how an EMF-based in-memory model is created during parsing. 
		</p>
<div class="section" title="First an example">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="Firstanexample"></a>First an example</h2>
</div>
</div>
</div>
<p>To get an idea of how it works we&rsquo;ll start by implementing a 
				<a class="ulink" href="http://martinfowler.com/dslwip/Intro.html" target="_new">simple example</a> introduced by Martin Fowler.
				It&rsquo;s mainly about describing state machines used as the (un)lock mechanism of secret compartments. 
				People who have secret compartments control their access in a very old-school way, e.g. by opening the door first and turning on the light afterwards.  
			</p>
<p>Then the secret compartment, for instance a panel, opens up.</p>
<p>One of those state machines could look like this:</p>
<div class="literallayout">
<p>
<code class="code">
<br>
&nbsp;events<br>
&nbsp;&nbsp;doorClosed&nbsp;&nbsp;D1CL<br>
&nbsp;&nbsp;drawOpened&nbsp;&nbsp;D2OP<br>
&nbsp;&nbsp;lightOn&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L1ON<br>
&nbsp;&nbsp;doorOpened&nbsp;&nbsp;D1OP<br>
&nbsp;&nbsp;panelClosed&nbsp;PNCL<br>
&nbsp;end<br>
&nbsp;<br>
&nbsp;resetEvents<br>
&nbsp;&nbsp;doorOpened<br>
&nbsp;end<br>
&nbsp;<br>
&nbsp;commands<br>
&nbsp;&nbsp;unlockPanel&nbsp;PNUL<br>
&nbsp;&nbsp;lockPanel&nbsp;&nbsp;&nbsp;PNLK<br>
&nbsp;&nbsp;lockDoor&nbsp;&nbsp;&nbsp;&nbsp;D1LK<br>
&nbsp;&nbsp;unlockDoor&nbsp;&nbsp;D1UL<br>
&nbsp;end<br>
&nbsp;<br>
&nbsp;state&nbsp;idle<br>
&nbsp;&nbsp;actions&nbsp;{unlockDoor&nbsp;lockPanel}<br>
&nbsp;&nbsp;doorClosed&nbsp;=&gt;&nbsp;active<br>
&nbsp;end<br>
&nbsp;<br>
&nbsp;state&nbsp;active<br>
&nbsp;&nbsp;drawOpened&nbsp;=&gt;&nbsp;waitingForLight<br>
&nbsp;&nbsp;lightOn&nbsp;&nbsp;&nbsp;&nbsp;=&gt;&nbsp;waitingForDraw<br>
&nbsp;end<br>
&nbsp;<br>
&nbsp;state&nbsp;waitingForLight<br>
&nbsp;&nbsp;lightOn&nbsp;=&gt;&nbsp;unlockedPanel<br>
&nbsp;end<br>
&nbsp;<br>
&nbsp;state&nbsp;waitingForDraw<br>
&nbsp;&nbsp;drawOpened&nbsp;=&gt;&nbsp;unlockedPanel<br>
&nbsp;end<br>
&nbsp;<br>
&nbsp;state&nbsp;unlockedPanel<br>
&nbsp;&nbsp;actions&nbsp;{unlockPanel&nbsp;lockDoor}<br>
&nbsp;&nbsp;panelClosed&nbsp;=&gt;&nbsp;idle<br>
&nbsp;end<br>

<br>

</code>
</p>
</div>
<p>So, we have a bunch of declared events, commands and states. Within states there are references to declared actions, which should be executed when entering such a state.
				Also there are transitions consisting of a reference to an event and a state. Please read 
				<a class="ulink" href="http://martinfowler.com/dslwip/Intro.html" target="_new">Martin's description</a>  if it is not clear enough.
			</p>
<p>In order to get a complete IDE for this little language from Xtext, you need to write the following grammar:</p>
<div class="literallayout">
<p>
<code class="code">grammar&nbsp;my.pack.SecretCompartments&nbsp;<br>
&nbsp;&nbsp;&nbsp;with&nbsp;org.eclipse.xtext.common.Terminals<br>
&nbsp;generate&nbsp;secretcompartment&nbsp;"http://www.eclipse.org/secretcompartment"<br>
&nbsp;<br>
&nbsp;Statemachine&nbsp;:<br>
&nbsp;&nbsp;'events'<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(events+=Event)+<br>
&nbsp;&nbsp;'end'<br>
&nbsp;&nbsp;('resetEvents'<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(resetEvents+=[Event])+<br>
&nbsp;&nbsp;'end')?<br>
&nbsp;&nbsp;'commands'<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(commands+=Command)+<br>
&nbsp;&nbsp;'end'<br>
&nbsp;&nbsp;(states+=State)+;<br>
&nbsp;<br>
&nbsp;Event&nbsp;:<br>
&nbsp;&nbsp;name=ID&nbsp;code=ID;<br>
&nbsp;<br>
&nbsp;Command&nbsp;:<br>
&nbsp;&nbsp;name=ID&nbsp;code=ID;<br>
&nbsp;<br>
&nbsp;State&nbsp;:<br>
&nbsp;&nbsp;'state'&nbsp;name=ID<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;('actions'&nbsp;'{'&nbsp;(actions+=[Command])+&nbsp;'}')?<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(transitions+=Transition)*<br>
&nbsp;&nbsp;'end';<br>
&nbsp;<br>
&nbsp;Transition&nbsp;:<br>
&nbsp;&nbsp;event=[Event]&nbsp;'=&gt;'&nbsp;state=[State];<br>

<br>

</code>
</p>
</div>
</div>
<div class="section" title="The Syntax">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="syntax"></a>The Syntax</h2>
</div>
</div>
</div>
<p>In the following the different concepts of the grammar language are explained. </p>
<div class="section" title="Language Declaration">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="LanguageDeclaration"></a>Language Declaration</h3>
</div>
</div>
</div>
<p>The first line  </p>
<div class="literallayout">
<p>
<code class="code">grammar&nbsp;my.pack.SecretCompartments&nbsp;with&nbsp;org.eclipse.xtext.common.Terminals<br>

</code>
</p>
</div>
<p>declares the name of the grammar. Xtext leverages Java&rsquo;s classpath mechanism. This means that the name can be any valid Java qualifier. The file name needs to correspond and have the file extension '&lsquo;xtext&rsquo;'. This means that the name needs to be 
					<code class="code">SecretCompartments.xtext</code> and must be placed in package 
					<code class="code">my.pack</code> somewhere on your project&rsquo;s class path.
				</p>
<p>The first line is also used to declare any used language (for mechanism details cf. 
					<a class="link" href="#grammarMixins" title="Grammar Mixins">Grammar Mixins</a>).
				</p>
</div>
<div class="section" title="EPackage declarations">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="EPackagedeclarations"></a>EPackage declarations</h3>
</div>
</div>
</div>
<p>Xtext parsers instantiate Ecore models (aka meta model). An Ecore model basically consists of an EPackage containing EClasses, EDatatypes and EEnums.
					Xtext can infer Ecore models from a grammar (see 
					<a class="link" href="#metamodelInference" title="Meta-Model inference">Meta-Model Inference</a>) but it is also possible to instantiate existing Ecore models. You can even mix this, use multiple existing Ecore models and infer some others from one grammar. 
				</p>
<div class="section" title="EPackage generation">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="EPackagegeneration"></a>EPackage generation</h4>
</div>
</div>
</div>
<p>The easiest way to get started is to let Xtext infer the meta model from your grammar. This is what is done in the secret compartment example. To do so just state:</p>
<div class="literallayout">
<p>
<code class="code">generate&nbsp;secretcompartment&nbsp;http://www.eclipse.org/secretcompartment<br>

</code>
</p>
</div>
<p>Which means: generate an EPackage with name 
						<code class="code">secretcompartment</code> and nsURI 
						<code class="code">http://www.eclipse.org/secretcompartment</code> (these are the properties needed to create an EPackage). 
						The whole algorithm used to derive complete Ecore models from Xtext grammars is described in section 
						<a class="link" href="#metamodelInference" title="Meta-Model inference">Meta-Model Inference</a>.
					</p>
</div>
<div class="section" title="EPackage import">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="EPackageimport"></a>EPackage import</h4>
</div>
</div>
</div>
<p>If you already have an existing EPackage, you can import it using either a namespace URI or a resource URI (URIs are an EMF concept).</p>
<div class="section" title="Using namespace URIs to import existing EPackages">
<div class="titlepage">
<div>
<div>
<h5 class="title">
<a name="UsingnamespaceURIstoimportexistingEPackages"></a>Using namespace URIs to import existing EPackages</h5>
</div>
</div>
</div>
<p>You can import existing EPackages using the following syntax:</p>
<div class="literallayout">
<p>
<code class="code">import&nbsp;"http://www.eclipse.org/secretcompartment"<br>

</code>
</p>
</div>
<p>Note that if you use a namespace URI, the corresponding EPackage needs to be installed into the workbench, so that the editor can find it.
							At runtime (i.e. when starting the generator) you need to make sure that the corresponding EPackage is registered in 
							<code class="code">EPackage.Registry.INSTANCE</code>. If you use MWE to drive your code generator, you need to add the following lines to your workflow file:
						</p>
<div class="literallayout">
<p>
<code class="code">&lt;bean&nbsp;class="org.eclipse.emf.mwe.utils.StandaloneSetup"&nbsp;<br>
&nbsp;&nbsp;platformUri="${runtimeProject}/.."&gt;<br>
&nbsp;&nbsp;&lt;registerGeneratedEPackage&nbsp;value="foo.bar.MyPackage"/&gt;<br>
&lt;/bean&gt;<br>

<br>

</code>
</p>
</div>
<p>using namespace URIs is typically only interesting when using common Ecore models, such as Ecore itself or the UML metamodel. If you&rsquo;re developing the EPackage together with the DSL but don&rsquo;t want to have it derived from the grammar for some reason, we suggest to use a resource URI.</p>
</div>
<div class="section" title="Using resource URIs to import existing EPackages">
<div class="titlepage">
<div>
<div>
<h5 class="title">
<a name="UsingresourceURIstoimportexistingEPackages"></a>Using resource URIs to import existing EPackages</h5>
</div>
</div>
</div>
<p>If the EPackage you want to use is somewhere in your workspace you should refer to it using a platform:/resource/ URI.
							Platform URIs are a special EMF construct, which allow for some kind of transparency between workspace projects and installed bundles. Consult the EMF documentation (we recomend the book) for details.</p>
<p>An import statement referring to an Ecore file by a platform:/resource/ URI looks like this: </p>
<div class="literallayout">
<p>
<code class="code">import&nbsp;"platform:/resource/my.project/modelFolder/MyEcore.ecore"<br>

</code>
</p>
</div>
<p>If you want to mix generated and imported Ecore models you&rsquo;ll have to configure the generator fragment in your MWE file responsible for generating the Ecore classes (
							<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.generator/src/org/eclipse/xtext/generator/ecore/EcoreGeneratorFragment.java?root=Modeling_Project&view=co" target="_new">EcoreGeneratorFragment</a>) with resource URIs to the genmodels for the referenced Ecore models.
							Example:
						</p>
<div class="literallayout">
<p>
<code class="code">&lt;fragment&nbsp;class="org.eclipse.xtext.generator.ecore.EcoreGeneratorFragment"<br>
&nbsp;&nbsp;genModels="platform:/resource/my.project/model/myEcore.genmodel"/&gt;<br>

</code>
</p>
</div>
</div>
</div>
<div class="section" title="Using multiple packages / meta model aliases">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="Usingmultiplepackagesmetamodelaliases"></a>Using multiple packages / meta model aliases</h4>
</div>
</div>
</div>
<p>If you want to use multiple EPackages you need to specify aliases in the following way:</p>
<div class="literallayout">
<p>
<code class="code">
<br>
&nbsp;&nbsp;generate&nbsp;secretcompartment&nbsp;http://www.eclipse.org/secretcompartment<br>
&nbsp;&nbsp;import&nbsp;http://www.eclipse.org/anotherPackage&nbsp;as&nbsp;another<br>

<br>

</code>
</p>
</div>
<p>When referring to a type somewhere in the grammar you need to qualify the reference using that alias (example '&lsquo;another::CoolType&rsquo;'). We&rsquo;ll see later where such type references occur.</p>
<p>It is also supported to put multiple EPackage imports into one alias. This is no problem as long as there are no two EClassifiers with the same name. In such cases none of them are referable. It is even possible to have multiple '&lsquo;import&rsquo;&lsquo;s and one &rsquo;&lsquo;generate&rsquo;' declared for the same alias. If you do so, for a reference to an EClassifier first the imported EPackages are scanned before it is assumed that a type needs to by generated into the to-be-generated package.</p>
<p>Example:</p>
<div class="literallayout">
<p>
<code class="code">
<br>
&nbsp;&nbsp;generate&nbsp;toBeGenerated&nbsp;http://www.eclipse.org/toBeGenerated<br>
&nbsp;&nbsp;import&nbsp;http://www.eclipse.org/packContainingClassA<br>
&nbsp;&nbsp;import&nbsp;http://www.eclipse.org/packContainingClassB<br>

<br>

</code>
</p>
</div>
<p>With the declaration from above </p>
<div class="orderedlist">
<ol class="orderedlist" type="1">
<li class="listitem">
<p>a reference to type 
								<code class="code">ClassA</code> would be linked to the EClass contained in 
								<code class="code">http://www.eclipse.org/packContainingClassA</code>, 
							</p>
</li>
<li class="listitem">
<p>a reference to type 
								<code class="code">ClassB</code> would be linked to the EClass contained in 
								<code class="code">http://www.eclipse.org/packContainingClassB</code>, 
							</p>
</li>
<li class="listitem">
<p>a reference to type 
								<code class="code">NotYetDefined</code> would be linked to a newly created EClass in 
								<code class="code">http://www.eclipse.org/toBeGenerated</code>
							
</p>
</li>
</ol>
</div>
<p>Note, that using this feature is not recommended, because it might cause problems, which are hard to track down.
						For instance, a reference to ''
						<code class="code">classA</code>'' would as well be linked to a newly created EClass, because the corresponding type in 
						<code class="code">http://www.eclipse.org/packContainingClassA</code> is spelled with a capital letter.
					</p>
</div>
</div>
<div class="section" title="Rules">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="Rules"></a>Rules</h3>
</div>
</div>
</div>
<p>The default parsing is based on a homegrown packrat parser. It can be substituted by an Anltr parser through the Xtext service mechanism. Antlr is a sophisticated parser generator framework based on an LL(*) 
					<a class="ulink" href="http://bit.ly/ANTLR_LL_star_algorithm" target="_new">parsing algorithm</a>, that works quite well for Xtext. At the moment it is advised to download the plugin de.itemis.xtext.antlr (from update site 
					<code class="code">http://www.itemis.com/xtext/updatesite/milestones</code>) and use the Antlr Parser instead of the packrat parser (cf. 
					<a class="ulink" href="Xtext_Workspace_Setup" target="_new">Xtext Workspace Setup</a>).
				</p>
<p>Basically parsing can be separated in the following phases. </p>
<div class="orderedlist">
<ol class="orderedlist" type="1">
<li class="listitem">
<p>lexing</p>
</li>
<li class="listitem">
<p>parsing</p>
</li>
<li class="listitem">
<p>linking</p>
</li>
<li class="listitem">
<p>validation</p>
</li>
</ol>
</div>
<div class="section" title="Terminal Rules">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="TerminalRules"></a>Terminal Rules</h4>
</div>
</div>
</div>
<p>In the first phase, i.e. lexing, a sequence of characters (the text input) is transformed into a sequence of so called tokens. 
						Each token consists of one or more characters and was matched by a particular terminal rule and represents an atomic symbol.
						In the secret compartments example there are no explicitly defined terminal rules, since it only uses the ID rule which is inherited from the grammar org.eclipse.xtext.common.Terminals (cf. 
						<a class="link" href="#grammarMixins" title="Grammar Mixins">Grammar Mixins</a>).
						Terminal rules are also referred to as token rules or lexer rules. There is an informal naming convention that terminal-rule names are all uppercase.
					</p>
<p>Therein the ID rule is defined as follows:</p>
<div class="literallayout">
<p>
<code class="code">
<br>
&nbsp;terminal&nbsp;ID&nbsp;:&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;('^')?('a'..'z'|'A'..'Z'|'_')&nbsp;('a'..'z'|'A'..'Z'|'_'|'0'..'9')*;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>

</code>
</p>
</div>
<p>It says that a Token ID starts with an optional &lsquo;^&rsquo; character, which is called caret, followed by a letter (&lsquo;a&rsquo;..&lsquo;z&rsquo;|&lsquo;A&rsquo;..&lsquo;Z&rsquo;) or underscore (&lsquo;_&rsquo;) followed by any number of letters, underscores and numbers (&lsquo;0&rsquo;..&lsquo;9&rsquo;). </p>
<p>The caret is used to escape an identifier for cases where there are conflicts with keywords. It is removed by the ID rule&rsquo;s 
						<a class="link" href="#valueconverter" title="Value Converter">ValueConverter</a>. 
					</p>
<p>This is the formal definition of terminal rules:</p>
<div class="literallayout">
<p>
<code class="code">
<br>
&nbsp;TerminalRule&nbsp;:<br>
&nbsp;&nbsp;&nbsp;'terminal'&nbsp;name=ID&nbsp;('returns'&nbsp;type=TypeRef)?&nbsp;':'&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;alternatives=TerminalAlternatives&nbsp;';'<br>
&nbsp;;<br>

<br>

</code>
</p>
</div>
<p>Note, that the order of terminal rules is crucial for your grammar, as they may hide each other. This is especially important for newly introduced rules in connection with mixed rules from used grammars. </p>
<p>If you for instance want to add a rule to allow fully qualified names in addition to simple IDs, you should implement it as a 
						<a class="link" href="#datatypeRules" title="Datatype rules">datatype rule</a>, instead of adding another terminal rule.
					</p>
<div class="section" title="Return types">
<div class="titlepage">
<div>
<div>
<h5 class="title">
<a name="Returntypes"></a>Return types</h5>
</div>
</div>
</div>
<p>A terminal rule returns a value, which is a string (type ecore::EString) by default.
							However, if you want to have a different type you can specify it. For instance, the rule &lsquo;INT&rsquo; is defined as:</p>
<div class="literallayout">
<p>
<code class="code">
<br>
&nbsp;terminal&nbsp;INT&nbsp;returns&nbsp;ecore::EInt&nbsp;:&nbsp;<br>
&nbsp;&nbsp;&nbsp;('0'..'9')+;<br>

<br>

</code>
</p>
</div>
<p>This means that the terminal rule INT returns instances of ecore::EInt. It is possible to define any kind of data type here, which just needs to be an instance of ecore::EDataType.
							In order to tell the parser how to convert the parsed string to a value of the declared data type, you need to provide your own implementation of &lsquo;IValueConverterService&rsquo; (cf. 
							<a class="link" href="#valueconverter" title="Value Converter">value converters</a>).
						</p>
<p>The implementation needs to be registered as a service (cf. 
							<a class="link" href="#">Service Framework</a>).
						</p>
<p>This is also the point where you can remove things like quotes from string literals or the caret (&lsquo;^&rsquo;) from identifiers.</p>
</div>
</div>
<div class="section" title="Extended Backus-Naur form expressions">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="ExtendedBackusNaurformexpressions"></a>Extended Backus-Naur form expressions</h4>
</div>
</div>
</div>
<p>Token rules are described using &ldquo;Extended Backus-Naur Form&rdquo;-like (EBNF) expressions. The different expressions are described in the following.
						The one thing all of these expressions have in common is the quantifier operator.
						There are four different quantities</p>
<div class="orderedlist">
<ol class="orderedlist" type="1">
<li class="listitem">
<p>exactly one (the default no operator)</p>
</li>
<li class="listitem">
<p>one or none (operator &ldquo;?&rdquo;)</p>
</li>
<li class="listitem">
<p>any (operator &ldquo;*&rdquo;)</p>
</li>
<li class="listitem">
<p>one or more (operator &ldquo;+&rdquo;)</p>
</li>
</ol>
</div>
<div class="section" title="Keywords / Characters">
<div class="titlepage">
<div>
<div>
<h5 class="title">
<a name="Keywords"></a>Keywords / Characters</h5>
</div>
</div>
</div>
<p>Keywords are a kind of token rule literals. 
							The ID rule in org.eclipse.xtext.common.Terminals for instance starts with a keyword :</p>
<div class="literallayout">
<p>
<code class="code">
<br>
&nbsp;terminal&nbsp;ID&nbsp;:&nbsp;'^'?&nbsp;....&nbsp;;<br>

</code>
</p>
</div>
<p>The question mark sets the cardinality to &ldquo;none or one&rdquo; (i.e. optional) like explained above.</p>
<p>Note that a keyword can have any length and contain arbitrary characters.</p>
</div>
<div class="section" title="Character Ranges">
<div class="titlepage">
<div>
<div>
<h5 class="title">
<a name="CharacterRanges"></a>Character Ranges</h5>
</div>
</div>
</div>
<p>A character range can be declared using the &lsquo;..&rsquo; operator.</p>
<p>Example:</p>
<div class="literallayout">
<p>
<code class="code">terminal&nbsp;INT&nbsp;returns&nbsp;ecore::EInt:&nbsp;('0'..'9')+&nbsp;;<br>

</code>
</p>
</div>
<p>In this case an INT is comprised of one or more (note the &lsquo;+&rsquo; operator) characters between (and including) &lsquo;0&rsquo; and &lsquo;9&rsquo;.</p>
</div>
<div class="section" title="Wildcard">
<div class="titlepage">
<div>
<div>
<h5 class="title">
<a name="Wildcard"></a>Wildcard</h5>
</div>
</div>
</div>
<p>If you want to allow any character you can simple write a dot:
							Example:</p>
<div class="literallayout">
<p>
<code class="code">FOO&nbsp;:&nbsp;'f'&nbsp;.&nbsp;'o';<br>

</code>
</p>
</div>
<p>The rule above would allow expressions like &lsquo;foo&rsquo;, &lsquo;f0o&rsquo; or even &lsquo;f\no&rsquo;.</p>
</div>
<div class="section" title="Until Token">
<div class="titlepage">
<div>
<div>
<h5 class="title">
<a name="UntilToken"></a>Until Token</h5>
</div>
</div>
</div>
<p>With the until token it is possible to state that everything should be consumed until a certain token occurs.
							The multi line comment is implemented using it:</p>
<div class="literallayout">
<p>
<code class="code">terminal&nbsp;ML_COMMENT	:&nbsp;'/*'&nbsp;-&gt;&nbsp;'*/'&nbsp;;<br>

</code>
</p>
</div>
<p>This is the rule for Java-style comments that begin with &lsquo;/*&rsquo; and end with &lsquo;*/&rsquo;.</p>
</div>
<div class="section" title="Negated Token">
<div class="titlepage">
<div>
<div>
<h5 class="title">
<a name="NegatedToken"></a>Negated Token</h5>
</div>
</div>
</div>
<p>All the tokens explained above can be inverted using a preceding explanation mark:</p>
<div class="literallayout">
<p>
<code class="code">terminal&nbsp;ML_COMMENT	:&nbsp;'/*'&nbsp;(!'*/')+&nbsp;;<br>

</code>
</p>
</div>
</div>
<div class="section" title="Rule Calls">
<div class="titlepage">
<div>
<div>
<h5 class="title">
<a name="RuleCalls"></a>Rule Calls</h5>
</div>
</div>
</div>
<p>Rules can refer to other rules. This is done by writing the name of the rule to be called.
							We refer to this as rule calls. Rule calls in terminal rules can only point to terminal rules.</p>
<p>Example:</p>
<div class="literallayout">
<p>
<code class="code">terminal&nbsp;QUALIFIED_NAME&nbsp;:&nbsp;ID&nbsp;('.'&nbsp;ID)*;<br>

</code>
</p>
</div>
</div>
<div class="section" title="Alternatives">
<div class="titlepage">
<div>
<div>
<h5 class="title">
<a name="Alternatives"></a>Alternatives </h5>
</div>
</div>
</div>
<p>Using alternatives one can state multiple different alternatives.
							For instance, the whitespace rule uses alternatives like this:</p>
<div class="literallayout">
<p>
<code class="code">terminal&nbsp;WS&nbsp;:&nbsp;('&nbsp;'|'\t'|'\r'|'\n')+&nbsp;;<br>

</code>
</p>
</div>
<p>That is a WS can be made of one or more whitespace characters (including &lsquo; &rsquo;,&lsquo;\t&rsquo;,&lsquo;\r&rsquo;,&lsquo;\n&rsquo;)</p>
</div>
<div class="section" title="Groups">
<div class="titlepage">
<div>
<div>
<h5 class="title">
<a name="Groups"></a>Groups</h5>
</div>
</div>
</div>
<p>Finally, if you put tokens one after another, the whole sequence is referred to as a group.
							Example:</p>
<div class="literallayout">
<p>
<code class="code">terminal&nbsp;FOO&nbsp;:&nbsp;'0x'&nbsp;('0'..'7')&nbsp;('0'..'9'|'A'..'F')&nbsp;;<br>

</code>
</p>
</div>
<p>That is the 4-digit hexadecimal code of ascii characters.</p>
</div>
</div>
</div>
<div class="section" title="Parser Rules">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="ParserRules"></a>Parser Rules</h3>
</div>
</div>
</div>
<p>The parser reads in a sequence of terminals and walks through the parser rules. That&rsquo;s why a parser rule &ndash; contrary to a terminal rule &ndash; does not produce a single terminal token but a tree of non-terminal and terminal tokens that lead to a so called parse tree (in Xtext it is a.k.a node model). Furthermore, parser rules are handled a as kind of a building plan for how to create EObjects that form the semantic model (the linked! AST). The different constructs like actions and assignments are used to derive types and initialize the semantic objects accordingly. </p>
<div class="section" title="Extended Backus-Naur Form expressions">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="ExtendedBackusNaurFormexpressions"></a>Extended Backus-Naur Form expressions</h4>
</div>
</div>
</div>
<p>In parser rules (as well as in datatype rules) not all the expressions available for terminal rules can be used. Character ranges, wildcards, the until token and the negation are currently only available for terminal rules. 
						Available in parser rules as well as in terminal rules are</p>
<div class="orderedlist">
<ol class="orderedlist" type="1">
<li class="listitem">
<p>
								
<a class="link" href="#Groups" title="Groups">groups</a>, 
							</p>
</li>
<li class="listitem">
<p>
								
<a class="link" href="#Alternatives" title="Alternatives">alternatives</a>, 
							</p>
</li>
<li class="listitem">
<p>
								
<a class="link" href="#Keywords" title="Keywords / Characters">keywords</a> and 
							</p>
</li>
<li class="listitem">
<p>
								
<a class="link" href="#RuleCalls" title="Rule Calls">rule calls</a>.
							</p>
</li>
</ol>
</div>
<p>In addition to these elements, there are some expressions used to direct how the AST is constructed, which are listed and explained in the following.</p>
<div class="section" title="Assignments">
<div class="titlepage">
<div>
<div>
<h5 class="title">
<a name="Assignments"></a>Assignments </h5>
</div>
</div>
</div>
<p>Assignments are used to assign parsed information to a feature of the current EClass. The current EClass is specified by the return type resp. if not explicitly stated it is implied that the type&rsquo;s name equals the rule&rsquo;s name.</p>
<p>Example:</p>
<div class="literallayout">
<p>
<code class="code">
<br>
&nbsp;State&nbsp;:<br>
&nbsp;&nbsp;'state'&nbsp;name=ID<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;('actions'&nbsp;'{'&nbsp;(actions+=[Command])+&nbsp;'}')?<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(transitions+=Transition)*<br>
&nbsp;&nbsp;'end';<br>

<br>

</code>
</p>
</div>
<p>The syntactic declaration for states in the state machine example starts with a keyword &lsquo;state&rsquo; followed by an assignment :</p>
<div class="literallayout">
<p>
<code class="code">name=ID<br>

</code>
</p>
</div>
<p>Where the left hand side refers to a feature of the current EClass (in this case EClass &lsquo;State&rsquo;). 
							The right hand side can be a rule call, a keyword, a cross reference (explained later) or even an alternative comprised by the former.
							The type of the feature needs to be compatible with the type of the expression on the right. As ID returns an EString the feature name needs to be of type EString as well.</p>
</div>
</div>
<div class="section" title="Assignment Operators">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="AssignmentOperators"></a>Assignment Operators</h4>
</div>
</div>
</div>
<p>There are three different assignment operators, each with different semantics</p>
<div class="orderedlist">
<ol class="orderedlist" type="1">
<li class="listitem">
<p>the simple equal sign &ldquo;=&rdquo; is the straight forward assignment, and used for features which take only one element</p>
</li>
<li class="listitem">
<p>the &ldquo;+=&rdquo; sign (the add operator) expects a multi valued feature and adds the value on the right hand to that feature, which is, of course, a list feature</p>
</li>
<li class="listitem">
<p>the &ldquo;?=&rdquo; sign (boolean add operator) expects a feature of type EBoolean and sets it to true if the right hand side was consumed (no matter with what values)</p>
</li>
</ol>
</div>
<div class="section" title="Cross References">
<div class="titlepage">
<div>
<div>
<h5 class="title">
<a name="CrossReferences"></a>Cross References </h5>
</div>
</div>
</div>
<p>A unique feature of Xtext is the ability to declare cross links in the grammar. In traditional compiler construction the cross links are not established during parsing but in a later linking phase. This is the same in Xtext, but we allow to specify cross link information in the grammar, which is used during the linking phase.
							The syntax for cross links is:</p>
<div class="literallayout">
<p>
<code class="code">
<br>
&nbsp;CrossReference&nbsp;:<br>
&nbsp;&nbsp;&nbsp;'['&nbsp;type=TypeRef&nbsp;('|'&nbsp;^terminal=CrossReferenceableTerminal&nbsp;)?&nbsp;']'<br>
&nbsp;;<br>

<br>

</code>
</p>
</div>
<p>For example, the transition is made up of two cross references, pointing to an event and a state:</p>
<div class="literallayout">
<p>
<code class="code">
<br>
&nbsp;Transition&nbsp;:<br>
&nbsp;&nbsp;event=[Event]&nbsp;'=&gt;'&nbsp;state=[State];<br>

<br>

</code>
</p>
</div>
<p>It is important to understand that the text between the square brackets does not refer to another rule, but to the type!
							This is sometimes confusing, because one usually uses the same name for the rules and the types.
							That is if we had named the type for events differently like in the following the cross references needs to be adapted as well:</p>
<div class="literallayout">
<p>
<code class="code">
<br>
&nbsp;Transition&nbsp;:<br>
&nbsp;&nbsp;event=[MyEvent]&nbsp;'=&gt;'&nbsp;state=[State];<br>
&nbsp;<br>
&nbsp;Event&nbsp;returns&nbsp;MyEvent&nbsp;:&nbsp;....;<br>

<br>

</code>
</p>
</div>
<p>Looking at the syntax definition of cross references, there is an optional part starting with a vertical bar followed by &lsquo;CrossReferenceableTerminal&rsquo;. This is the part describing the concrete text, from which the crosslink later should be established.
							By default (that&rsquo;s why it&rsquo;s optional) it is &ldquo;|ID&rdquo;.</p>
<p>You may even use alternatives as the referencable terminal. This way, either an ID or a STRING may be used as the referencable terminal, as it is possible in many SQL dialects.</p>
<div class="literallayout">
<p>
<code class="code">TableRef:&nbsp;table=[Table|(ID|STRING)];<br>

</code>
</p>
</div>
<p>Have a look at the 
							<a class="link" href="#linking" title="Linking">linking section</a> in order to understand how linking is done.
						</p>
</div>
<div class="section" title="Simple Actions">
<div class="titlepage">
<div>
<div>
<h5 class="title">
<a name="SimpleActions"></a>Simple Actions </h5>
</div>
</div>
</div>
<p>By default the object to be returned by a parser rule is created lazily on the first assignment. Then the type of the EObject to be created is determined from the specified return type (or the rule name if not explicit return type is specified).
							With Actions however, creation of EObject can be made explicit. Xtext supports two kinds of Actions:</p>
<div class="orderedlist">
<ol class="orderedlist" type="1">
<li class="listitem">
<p>simple actions</p>
</li>
<li class="listitem">
<p>assigned actions.</p>
</li>
</ol>
</div>
<p>If at some point you want to enforce creation of a specific type you can use alternatives or simple actions.
							In the following example TypeB must be a subtype of TypeA. An expression 
							<code class="code">A ident</code> should create an instance of TypeA, whereas 
							<code class="code">B ident</code> should instantiate TypeB.
						</p>
<p>Example with alternatives:</p>
<div class="literallayout">
<p>
<code class="code">
<br>
&nbsp;MyRule&nbsp;returns&nbsp;TypeA&nbsp;:<br>
&nbsp;&nbsp;&nbsp;"A"&nbsp;name=ID&nbsp;|<br>
&nbsp;&nbsp;&nbsp;MyOtherRule;&nbsp;<br>
&nbsp;<br>
&nbsp;MyOtherRule&nbsp;returns&nbsp;TypeB&nbsp;:<br>
&nbsp;&nbsp;&nbsp;"B"&nbsp;name&nbsp;=&nbsp;ID;<br>

<br>

</code>
</p>
</div>
<p>Example with simple actions:  </p>
<div class="literallayout">
<p>
<code class="code">
<br>
&nbsp;MyRule&nbsp;returns&nbsp;TypeA&nbsp;:<br>
&nbsp;&nbsp;&nbsp;"A"&nbsp;name=ID&nbsp;|<br>
&nbsp;&nbsp;&nbsp;"B"&nbsp;{TypeB}&nbsp;name=ID;&nbsp;<br>

<br>

</code>
</p>
</div>
<p>Generally speaking, the instance is created as soon as the parser hits the first assignment. However, Actions allow to explicitly instantiate any EClass. The notation 
							<code class="code">{TypeB}</code> will create an instance of TypeB and assign it to the result of the parser rule. This allows parser rules without any assignment and object creation without the need to introduce stub-rules.
						</p>
</div>
<div class="section" title="Unassigned rule calls">
<div class="titlepage">
<div>
<div>
<h5 class="title">
<a name="Unassignedrulecalls"></a>Unassigned rule calls </h5>
</div>
</div>
</div>
<p>We previously explained, that the EObject to be returned is created lazily when the first assignment occurs or when a simple action is evaluated. There is another way one can set the EObject to be returned, which we call an &ldquo;unassigned rule call&rdquo;.</p>
<p>Unassigned rule calls (the name suggests it) are rule calls to other parser rules, which are not used within an assignment. If there is no feature the returned value shall be assigned to, the value is assigned to the &ldquo;to-be-returned&rdquo; reference.</p>
<p>With unassigned rule calls one can, for instance, create rules which just dispatch between several other rules:</p>
<div class="literallayout">
<p>
<code class="code">
<br>
&nbsp;AbstractToken&nbsp;:<br>
&nbsp;&nbsp;&nbsp;&nbsp;TokenA&nbsp;|<br>
&nbsp;&nbsp;&nbsp;&nbsp;TokenB&nbsp;|<br>
&nbsp;&nbsp;&nbsp;&nbsp;TokenC;<br>

<br>

</code>
</p>
</div>
<p>As 
							<code class="code">AbstractToken</code> could possibly return an instance of 
							<code class="code">TokenA</code>, 
							<code class="code">TokenB</code> or 
							<code class="code">TokenC</code> its type must by a super type to these types.
						</p>
<p>It is now for instance as well possible to further change the state of the AST element by assigning additional things.</p>
<p>Example:</p>
<div class="literallayout">
<p>
<code class="code">
<br>
&nbsp;AbstractToken&nbsp;:<br>
&nbsp;&nbsp;&nbsp;(TokenA&nbsp;|<br>
&nbsp;&nbsp;&nbsp;&nbsp;TokenB&nbsp;|<br>
&nbsp;&nbsp;&nbsp;&nbsp;TokenC&nbsp;)&nbsp;(cardinality=('?'|'+'|'*'))?;<br>

<br>

</code>
</p>
</div>
<p>Thus, to state the cardinality is optional (last question mark) and can be represented by a question mark, a plus, or an asterisk.</p>
</div>
<div class="section" title="Tree Rewrite Actions">
<div class="titlepage">
<div>
<div>
<h5 class="title">
<a name="grammarActions"></a>Tree Rewrite Actions </h5>
</div>
</div>
</div>
<p>LL parsing has some significant advantages over LR algorithms. The most important ones for Xtext are, that the generated code is much simpler to understand and debug and that it is easier to recover from errors and especially Antlr has a very nice generic error recovery mechanism. This allows to have AST constructed even if there are syntactic errors in the text. You wouldn&rsquo;t get any of the nice IDE features as soon as there is one little error, if we hadn&rsquo;t error recovery.</p>
<p>However, LL also has some drawbacks. The most important is, that it does not allow left recursive grammars.
							For instance, the following is not allowed in LL based grammars, because &ldquo;Expression '+' Expression&rdquo; is left recursive:</p>
<div class="literallayout">
<p>
<code class="code">Expression&nbsp;:<br>
&nbsp;&nbsp;Expression&nbsp;'+'&nbsp;Expression&nbsp;|<br>
&nbsp;&nbsp;'('&nbsp;Expression&nbsp;')'<br>
&nbsp;&nbsp;INT;<br>

<br>

</code>
</p>
</div>
<p>Instead one has to rewrite such things by &ldquo;left-factoring&rdquo; it:</p>
<div class="literallayout">
<p>
<code class="code">Expression&nbsp;:<br>
&nbsp;&nbsp;TerminalExpression&nbsp;('+'&nbsp;TerminalExpression)?;<br>
&nbsp;<br>
TerminalExpression&nbsp;:<br>
&nbsp;&nbsp;'('&nbsp;Expression&nbsp;')'&nbsp;|<br>
&nbsp;&nbsp;&nbsp;INT&nbsp;<br>

<br>

</code>
</p>
</div>
<p>In practice this is always the same pattern and therefore not that problematic. 
							However, by simply applying the Xtext AST construction features we&rsquo;ve covered so far, a grammar ...</p>
<div class="literallayout">
<p>
<code class="code">Expression&nbsp;:<br>
&nbsp;&nbsp;{Operation}&nbsp;left=TerminalExpression&nbsp;(op='+'&nbsp;right=TerminalExpression)?;<br>
&nbsp;<br>
TerminalExpression&nbsp;returns&nbsp;Expression:<br>
&nbsp;&nbsp;'('&nbsp;Expression&nbsp;')'&nbsp;|<br>
&nbsp;&nbsp;{IntLiteral}&nbsp;value=INT;<br>

<br>

</code>
</p>
</div>
<p>... would result in unwanted elements in the AST.
							For instance the expression &ldquo; ( 42 ) &rdquo; would result in a tree like this:</p>
<div class="literallayout">
<p>
<code class="code">Operation&nbsp;{<br>
&nbsp;&nbsp;left=Operation&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;left=IntLiteral&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;value=42<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;}<br>
}<br>

<br>

</code>
</p>
</div>
<p>Typically one would only want to have one instance of IntLiteral instead.</p>
<p>One can solve this problem using a combination of unassigned rule calls and actions:</p>
<div class="literallayout">
<p>
<code class="code">Expression&nbsp;:<br>
&nbsp;&nbsp;TerminalExpression&nbsp;({Operation.left=current}&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;op='+'&nbsp;right=TerminalExpression)?;<br>
&nbsp;<br>
TerminalExpression&nbsp;returns&nbsp;Expression:<br>
&nbsp;&nbsp;'('&nbsp;Expression&nbsp;')'&nbsp;|<br>
&nbsp;&nbsp;{IntLiteral}&nbsp;value=INT;<br>

<br>

</code>
</p>
</div>
<p>In the example above 
							<code class="code">{Operation.left=current}</code> is a so called tree rewrite action, which creates a new instance of the stated EClass (Operation in this case) and assigns the element currently to-be-returned (
							<code class="code">current</code> variable) to a feature of the newly created Object (in this case &lsquo;left&rsquo;).
							In Java these semantics could be expressed as:
						</p>
<div class="literallayout">
<p>
<code class="code">Operation&nbsp;temp&nbsp;=&nbsp;new&nbsp;Operation();<br>
temp.setLeft(current);<br>
current&nbsp;=&nbsp;temp;<br>

<br>

</code>
</p>
</div>
</div>
</div>
</div>
<div class="section" title="Hidden terminal symbols">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="Hiddenterminalsymbols"></a>Hidden terminal symbols</h3>
</div>
</div>
</div>
<p>Because parser rules describe not a single token, but a sequence of patterns in the input, it is necessary to define the interesting parts of the input. Xtext introduces the concept of hidden tokens to handle semantically unimportant things like whitespaces, comments, etc. in the input sequence gracefully. It is possible to define a set of terminal symbols, that are hidden from the parser rules and automatically skipped when they are recognized. Nevertheless, they are transparently woven into the node model, but not relevant for the semantic model. </p>
<p>Hidden terminals may (or may not) appear between any other terminals in any cardinality. They can be described per rule or for the whole grammar. When 
					<a class="link" href="#grammarMixins" title="Grammar Mixins">reusing a single grammar</a> its definition of hidden tokens is reused as well. The grammar org.eclipse.xtext.common.Terminals comes with a reasonable default and hides all comments and whitespace from the parser rules.
				</p>
<p>If a rule defines hidden symbols, you can think of a kind of scope that is automatically introduced. Any rule that is called from the declaring rule uses the same hidden terminals as the calling rule, unless it defines other hidden tokens itself.</p>
<div class="literallayout">
<p>
<code class="code">
<br>
&nbsp;Person&nbsp;hidden(WS,&nbsp;ML_COMMENT,&nbsp;SL_COMMENT):&nbsp;<br>
&nbsp;&nbsp;&nbsp;name=fullname&nbsp;age=INT&nbsp;';';<br>

<br>
&nbsp;Fullname:&nbsp;<br>
&nbsp;&nbsp;&nbsp;(firstname=ID)?&nbsp;lastname=ID;<br>

<br>

</code>
</p>
</div>
<p>The sample rule &ldquo;Person&rdquo; defines multiple-line comments (ML_COMMENT), single-line comments (SL_COMMENT), and whitespaces (WS) to be allowed between the &lsquo;Fullname&rsquo; and the &lsquo;age&rsquo;. Because &lsquo;Fullname&rsquo; does not introduce another set of hidden terminals, it allows the same symbols to appear between &lsquo;firstname&rsquo; and &lsquo;lastname&rsquo; as the calling rule &lsquo;Person&rsquo;. Thus, the following input is perfectly valid for the given grammar snippet:</p>
<div class="literallayout">
<p>
<code class="code">
<br>
&nbsp;John&nbsp;/*&nbsp;comment&nbsp;*/&nbsp;Smith&nbsp;//&nbsp;line&nbsp;comment<br>
&nbsp;&nbsp;&nbsp;/*&nbsp;comment&nbsp;*/<br>
&nbsp;&nbsp;&nbsp;42&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;<br>

<br>

</code>
</p>
</div>
<p>A list of all default terminals like WS can be found in section 
					<a class="link" href="#grammarMixins" title="Grammar Mixins">Grammar Mixins</a>.
				</p>
</div>
<div class="section" title="Datatype rules">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="datatypeRules"></a>Datatype rules</h3>
</div>
</div>
</div>
<p>Datatype rules are parsing-phase rules, which create instances of EDataType as terminal rules do.
					The nice thing about datatype rules is that they are actually parser rules and are therefore </p>
<div class="orderedlist">
<ol class="orderedlist" type="1">
<li class="listitem">
<p>context sensitive and </p>
</li>
<li class="listitem">
<p>allow for use of hidden tokens</p>
</li>
</ol>
</div>
<p>If you, for instance, want to define a rule to consume Java-like qualified names (e.g. &ldquo;foo.bar.Baz&rdquo;)
					you could write:</p>
<div class="literallayout">
<p>
<code class="code">
<br>
&nbsp;QualifiedName&nbsp;:<br>
&nbsp;&nbsp;&nbsp;ID&nbsp;('.'&nbsp;ID)*;<br>

<br>

</code>
</p>
</div>
<p>Which looks similar to the terminal rule we&rsquo;ve defined above in order to explain rule calls.
					However, the difference is that because it is a parser rule and therefore only valid in certain contexts, it won&rsquo;t conflict with the rule ID.
					If you had defined it as a terminal rule, it would hide the ID rule.</p>
<p>In addition having this defined as a datatype rule, it is allowed to use hidden tokens (e.g. "/* comment 
					<span class="bold"><strong>/") between the IDs and dots (e.g. @foo/</strong></span> comment */. bar . Baz"@)
				</p>
<p>Return types can be specified like in terminal rules:</p>
<div class="literallayout">
<p>
<code class="code">QualifiedName&nbsp;returns&nbsp;ecore::EString&nbsp;:&nbsp;ID&nbsp;('.'&nbsp;ID)*;<br>

</code>
</p>
</div>
<p>Note that if a rule does not call another parser rule and does not contain any actions nor assignments (see parser rules), it is considered a datatype rule and the datatype EString is implied if not explicitly declared differently.</p>
<p>For conversion again value converters are responsible (cf. 
					<a class="link" href="#valueconverter" title="Value Converter">value converters</a>).
				</p>
</div>
<div class="section" title="Enum Rules">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="EnumRules"></a>Enum Rules</h3>
</div>
</div>
</div>
<p>Enum rules return enumeration literals from strings. They can be seen as a shortcut for datatype rules with specific value converters.
					The main advantage of enum rules is their simplicity, typesafety and therefore nice validation. Furthermore it is possible to infer enums and their respective literals during the metamodel transformation.</p>
<p>If you want to define a ChangeKind 
					<a class="ulink" href="http://help.eclipse.org/stable/index.jsp?topic=/org.eclipse.emf.doc/references/javadoc/org/eclipse/emf/ecore/change/impl/package-summary.html" target="_new">org.eclipse.emf.ecore.change/model/Change.ecore</a> with &lsquo;ADD&rsquo;, &lsquo;MOVE&rsquo; and &lsquo;REMOVE&rsquo; you could write:
				</p>
<div class="literallayout">
<p>
<code class="code">
<br>
&nbsp;enum&nbsp;ChangeKind&nbsp;:<br>
&nbsp;&nbsp;&nbsp;ADD&nbsp;|&nbsp;MOVE&nbsp;|&nbsp;REMOVE;<br>

<br>

</code>
</p>
</div>
<p>It is even possible to use alternative literals for your enums or reference an enum value twice:</p>
<div class="literallayout">
<p>
<code class="code">
<br>
&nbsp;enum&nbsp;ChangeKind&nbsp;:<br>
&nbsp;&nbsp;&nbsp;ADD&nbsp;=&nbsp;'add'&nbsp;|&nbsp;ADD&nbsp;=&nbsp;'+'&nbsp;|&nbsp;<br>
&nbsp;&nbsp;&nbsp;MOVE&nbsp;=&nbsp;'move'&nbsp;|&nbsp;MOVE&nbsp;=&nbsp;'-&gt;'&nbsp;|&nbsp;<br>
&nbsp;&nbsp;&nbsp;REMOVE&nbsp;=&nbsp;'remove'&nbsp;|&nbsp;REMOVE&nbsp;=&nbsp;'-';<br>

<br>

</code>
</p>
</div>
<p>Please note, that Ecore does not support unset values for enums. If you formulate a grammar like</p>
<div class="literallayout">
<p>
<code class="code">
<br>
&nbsp;Element:&nbsp;"element"&nbsp;name=ID&nbsp;(value=SomeEnum)?;<br>

</code>
</p>
</div>
<p>with the input of</p>
<div class="literallayout">
<p>
<code class="code">
<br>
&nbsp;element&nbsp;Foo<br>

</code>
</p>
</div>
<p>the resulting value of the element 
					<code class="code">Foo</code> will hold the enum value with the internal representation of 0. When generating the EPackage from your grammar this will be the first literal you define. As a workaround you could introduce a dedicated none-value or order the enums accordingly. Note that it is not possible to define an enum literal with an empty textual representation.
				</p>
<div class="literallayout">
<p>
<code class="code">
<br>
&nbsp;enum&nbsp;Visibility:&nbsp;package&nbsp;|&nbsp;private&nbsp;|&nbsp;protected&nbsp;|&nbsp;public;<br>

</code>
</p>
</div>
</div>
</div>
<div class="section" title="Meta-Model inference">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="metamodelInference"></a>Meta-Model inference</h2>
</div>
</div>
</div>
<p>The meta model of a textual language describes the structure of its abstract syntax trees (AST). </p>
<p>Xtext uses Ecore EPackages to define meta models. Meta models are declared to be either inferred (generated) from the grammar or imported. 
				By using the &lsquo;generate&rsquo; directive, one tells Xtext to derive an EPackage from the grammar. </p>
<div class="section" title="Type and Package Generation">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="TypeandPackageGeneration"></a>Type and Package Generation</h3>
</div>
</div>
</div>
<p>Xtext creates</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>an EPackage</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="circle">
<li class="listitem">
<p>for each generated package declaration. After the directive '&lsquo;generate&rsquo;&lsquo; a list of parameters follows. The &rsquo;&lsquo;name&rsquo;&lsquo; of the EPackage will be set to the first parameter, its &rsquo;&lsquo;nsURI&rsquo;' to the second parameter. An optional alias as the third parameter allows to distinguish generated EPackages later. Only one generated package declaration per alias is allowed.</p>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>an EClass</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="circle">
<li class="listitem">
<p>for each return type of a parser rule. If a parser rule does not define a return type, an implicit one with the same name is assumed. You can specify more than one rule that return the same type but only one EClass will be generated.</p>
</li>
<li class="listitem">
<p>for each type defined in an action or a cross-reference.</p>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>an EEnum</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="circle">
<li class="listitem">
<p>for each return type of an enum rule.</p>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>an EDatatype</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="circle">
<li class="listitem">
<p>for each return type of a terminal rule or a datatype rule.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<p>All EClasses, EEnums and EDatatypes are added to the EPackage referred to by the alias provided in the type reference they were created from.</p>
</div>
<div class="section" title="Feature and Type Hierarchy Generation">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="FeatureandTypeHierarchyGeneration"></a>Feature and Type Hierarchy Generation</h3>
</div>
</div>
</div>
<p>While walking through the grammar, the algorithm keeps track of a set of the currently possible return types to add features to. </p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>Entering a parser rule the set contains only the return type of the rule. </p>
</li>
<li class="listitem">
<p>Entering a group in an alternative the set is reset to the same state it was in when entering the first group of this alternative. </p>
</li>
<li class="listitem">
<p>Leaving an alternative the set contains the union of all types at the end of each of its groups.</p>
</li>
<li class="listitem">
<p>After an optional element, the set is reset to the same state it was before entering it. </p>
</li>
<li class="listitem">
<p>After a mandatory (non-optional) rule call or mandatory action the set contains only the return type of the called rule or action. </p>
</li>
<li class="listitem">
<p>An optional rule call does not modify the set.</p>
</li>
<li class="listitem">
<p>A rule call is optional, if its cardinality is &lsquo;?&rsquo; or &lsquo;*&rsquo;.</p>
</li>
</ul>
</div>
<p>While iterating the parser rules Xtext creates</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>an EAttribute in each current return type</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="circle">
<li class="listitem">
<p>of type EBoolean for each feature assignment using the &lsquo;?=&rsquo; operator. No further EReferences or EAttributes will be generated from this assignment.</p>
</li>
<li class="listitem">
<p>for each assignment with the &lsquo;=&rsquo; or &lsquo;+=&rsquo; operator calling a terminal rule. Its type will be the return type of the called rule.</p>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>an EReference in each current return type</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="circle">
<li class="listitem">
<p>for each assignment with the &lsquo;=&rsquo; or &lsquo;+=&rsquo; operator in a parser rule calling a parser rule. The EReference type will be the return type of the called parser rule.</p>
</li>
<li class="listitem">
<p>for each action. The reference&rsquo;s type will be set to the return type of the current calling rule. </p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<p>Each EAttribute or EReference takes its name from the assignment/action that caused it. Multiplicities will be 0...1 for assignments with the &lsquo;=&rsquo; operator and 0...* for assignments with the &lsquo;+=&rsquo; operator. </p>
<p>Furthermore, each type that is added to the currently possible return types automatically inherits from the current return type of the parser rule. You can specify additional common supertypes by means of &ldquo;artificial&rdquo; parser rules, that are never called, e.g.</p>
<div class="literallayout">
<p>
<code class="code">
<br>
&nbsp;CommonSuperType:<br>
&nbsp;&nbsp;&nbsp;SubTypeA&nbsp;|&nbsp;SubTypeB&nbsp;|&nbsp;SubTypeC;<br>

<br>

</code>
</p>
</div>
</div>
<div class="section" title="Enum Literal Generation">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="EnumLiteralGeneration"></a>Enum Literal Generation</h3>
</div>
</div>
</div>
<p>For each alternative defined in an enum rule, the transformer creates an enum literal, when another with the same name cannot be found. The &lsquo;literal&rsquo; property of the generated enum literal is set to the right hand side of the declaration. If it is ommitted, you&rsquo;ll get an enum literal with equal &lsquo;name&rsquo; and &lsquo;literal&rsquo; attributes.</p>
<div class="literallayout">
<p>
<code class="code">
<br>
&nbsp;enum&nbsp;MyGeneratedEnum:<br>
&nbsp;&nbsp;&nbsp;NAME&nbsp;=&nbsp;'literal'&nbsp;|&nbsp;EQUAL_NAME_AND_LITERAL;<br>

<br>

</code>
</p>
</div>
</div>
<div class="section" title="Feature Normalization">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="FeatureNormalization"></a>Feature Normalization</h3>
</div>
</div>
</div>
<p>Next the generator examines all generated EClasses and lifts up similar features to supertypes if there is more than one subtype and the feature is defined in every subtypes. This does even work for multiple supertypes.</p>
</div>
<div class="section" title="Customized Post Processing">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="CustomizedPostProcessing"></a>Customized Post Processing</h3>
</div>
</div>
</div>
<p>As a last step, the generator invokes the post processor for every generated meta model. The post processor expects an Xtend file with name 
					<code class="code">MyDslPostProcessor.ext</code> (if the name of the grammar file is 
					<code class="code">MyDsl.xtext</code>) in the same folder as the grammar file. Further, for a successful invocation, the Xtend file must declare an extension with signature 
					<code class="code">process(xtext::GeneratedMetamodel)</code>. E.g.
				</p>
<div class="literallayout">
<p>
<code class="code">
<br>
&nbsp;process(xtext::GeneratedMetamodel&nbsp;this)&nbsp;:<br>
&nbsp;&nbsp;&nbsp;process(ePackage)<br>
&nbsp;;<br>
&nbsp;<br>
&nbsp;process(ecore::EPackage&nbsp;this)&nbsp;:<br>
&nbsp;&nbsp;&nbsp;...<br>
&nbsp;;<br>

<br>

</code>
</p>
</div>
<p>The invoked extension can then augment the generated Ecore model in place. Some typical use cases are to:</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>set default values for attributes</p>
</li>
<li class="listitem">
<p>add container references as opposites of existing containment references</p>
</li>
<li class="listitem">
<p>add operations with implementation (using a body annotation)</p>
</li>
</ul>
</div>
<p>Great care must be taken not to modify the meta model in a way preventing the Xtext parser from working correctly (e.g. removing or renaming model elements).</p>
</div>
<div class="section" title="Error Conditions">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="ErrorConditions"></a>Error Conditions</h3>
</div>
</div>
</div>
<p>The following conditions cause an error</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>An EAttribute or EReference has two different types or different cardinality.</p>
</li>
<li class="listitem">
<p>There are an EAttribute and an EReference with the same name in the same EClass.</p>
</li>
<li class="listitem">
<p>There is a cycle in the type hierarchy.</p>
</li>
<li class="listitem">
<p>An new EAttribute, EReference or supertype is added to an imported type.</p>
</li>
<li class="listitem">
<p>An EClass is added to an imported EPackage.</p>
</li>
<li class="listitem">
<p>An undeclared alias is used. </p>
</li>
<li class="listitem">
<p>An imported metamodel cannot be loaded.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="section" title="Importing existing Meta Models">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="grammarImport"></a>Importing existing Meta Models</h2>
</div>
</div>
</div>
<p>With the import directive in Xtext you can refer to existing Ecore metamodels and reuse the types that are declared in an EPackage. Xtext uses this technique itself to leverage Ecore datatypes.</p>
<div class="literallayout">
<p>
<code class="code">import&nbsp;"http://www.eclipse.org/emf/2002/Ecore"&nbsp;as&nbsp;ecore<br>

</code>
</p>
</div>
<p>Specify an explicit return type to reuse such imported types. Note that this even works for lexer rules.</p>
<div class="literallayout">
<p>
<code class="code">terminal&nbsp;INT&nbsp;returns&nbsp;ecore::EInt&nbsp;:&nbsp;('0'..'9')+;<br>

</code>
</p>
</div>
</div>
<div class="section" title="Grammar Mixins">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="grammarMixins"></a>Grammar Mixins</h2>
</div>
</div>
</div>
<p>Xtext supports the reuse of existing grammars. Grammars that are created via the Xtext wizard use 
				<code class="code">org.eclipse.xtext.common.Terminals</code> by default. 
			</p>
<div class="literallayout">
<p>
<code class="code">
<br>
&nbsp;grammar&nbsp;org.xtext.example.MyDsl&nbsp;with&nbsp;org.eclipse.xtext.common.Terminals<br>
&nbsp;<br>
&nbsp;generate&nbsp;myDsl&nbsp;"http://www.xtext.org/example/MyDsl"<br>
&nbsp;<br>
&nbsp;....<br>

<br>

</code>
</p>
</div>
<p>Mixing in another grammar makes the rules defined in that grammar referable. It is also possible to overwrite rules from the used grammar. </p>
<p>Example :</p>
<div class="literallayout">
<p>
<code class="code">
<br>
&nbsp;grammar&nbsp;my.SuperGrammar<br>
&nbsp;...<br>
&nbsp;RuleA&nbsp;:&nbsp;"a"&nbsp;stuff=RuleB;<br>
&nbsp;RuleB&nbsp;:&nbsp;"{"&nbsp;name=ID&nbsp;"}";<br>

<br>
&nbsp;grammar&nbsp;my.SubGrammar&nbsp;with&nbsp;my.SuperGrammar<br>

<br>
&nbsp;Model&nbsp;:&nbsp;(ruleAs+=RuleA)*;<br>

<br>
&nbsp;//&nbsp;overwrites&nbsp;my.SuperGrammar.RuleB<br>
&nbsp;RuleB&nbsp;:&nbsp;'['&nbsp;name=ID&nbsp;']';<br>

<br>

</code>
</p>
</div>
<p>Note that declared terminal rules always come before any imported / mixed-in terminal rules.</p>
</div>
<div class="section" title="Default tokens">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="Defaulttokens"></a>Default tokens</h2>
</div>
</div>
</div>
<p>Xtext is shipped with a default set of predefined, reasonable and often required terminal rules. This grammar is defined as follows:</p>
<div class="literallayout">
<p>
<code class="code">grammar&nbsp;org.eclipse.xtext.common.Terminals&nbsp;<br>
&nbsp;&nbsp;&nbsp;hidden(WS,&nbsp;ML_COMMENT,&nbsp;SL_COMMENT)<br>

<br>
&nbsp;import&nbsp;"http://www.eclipse.org/emf/2002/Ecore"&nbsp;as&nbsp;ecore<br>

<br>
&nbsp;terminal&nbsp;ID&nbsp;:&nbsp;<br>
&nbsp;&nbsp;&nbsp;'^'?('a'..'z'|'A'..'Z'|'_')&nbsp;('a'..'z'|'A'..'Z'|'_'|'0'..'9')*&nbsp;;<br>
&nbsp;terminal&nbsp;INT&nbsp;returns&nbsp;ecore::EInt:&nbsp;('0'..'9')+&nbsp;;<br>
&nbsp;terminal&nbsp;STRING	:&nbsp;<br>
&nbsp;&nbsp;&nbsp;'"'&nbsp;(&nbsp;'\\'&nbsp;('b'|'t'|'n'|'f'|'r'|'"'|"'"|'\\')&nbsp;|&nbsp;!('\\'|'"')&nbsp;)*&nbsp;'"'&nbsp;|<br>
&nbsp;&nbsp;&nbsp;"'"&nbsp;(&nbsp;'\\'&nbsp;('b'|'t'|'n'|'f'|'r'|'"'|"'"|'\\')&nbsp;|&nbsp;!('\\'|"'")&nbsp;)*&nbsp;"'"<br>
&nbsp;&nbsp;&nbsp;;&nbsp;<br>
&nbsp;terminal&nbsp;ML_COMMENT	:&nbsp;'/*'&nbsp;-&gt;&nbsp;'*/'&nbsp;;<br>
&nbsp;terminal&nbsp;SL_COMMENT&nbsp;	:&nbsp;'//'&nbsp;!('\n'|'\r')*&nbsp;('\r'?&nbsp;'\n')?&nbsp;;<br>

<br>
&nbsp;terminal&nbsp;WS		:&nbsp;('&nbsp;'|'\t'|'\r'|'\n')+&nbsp;;<br>

<br>
&nbsp;terminal&nbsp;ANY_OTHER:	.&nbsp;;<br>

</code>
</p>
</div>
</div>
</div>
<div class="chapter" title="Chapter&nbsp;3.&nbsp;Configuration">
<div class="titlepage">
<div>
<div>
<h2 class="title">
<a name="configuration"></a>Chapter&nbsp;3.&nbsp;Configuration</h2>
</div>
</div>
</div>
<div class="section" title="The Generator">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="generator"></a>The Generator</h2>
</div>
</div>
</div>
<p>Xtext provides lots of generic implementations for you language&rsquo;s
				infrastructure but also uses code generation to generate some of the 
				components. Those generated components are for instance the parser, the 
				serializer, the Ecore model and a couple of convenient base classes for 
				content assist etc.</p>
<p>The generator also contributes to shared project resources such as the 
				plugin.xml, Manifest.MF and the 
				<a class="link" href="#Modules" title="Modules">Guice modules</a>.
			</p>
<p>Xtext&rsquo;s generator leverages the 
				<a class="ulink" href="http://www.eclipse.org/modeling/emft/?project=mwe" target="_new">modeling workflow engine (MWE)</a> from EMFT.
			</p>
<div class="section" title="A short introduction to MWE">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="short_intro_to_mwe"></a>A short introduction to MWE</h3>
</div>
</div>
</div>
<p>The nice thing about MWE is that it just instantiates java classes and the configuration is done through setter and adder methods.
					Given the following Java class :</p>
<div class="literallayout">
<p>
<code class="code">
<br>
&nbsp;&nbsp;package&nbsp;foo;<br>
&nbsp;&nbsp;<br>
&nbsp;&nbsp;public&nbsp;class&nbsp;Person&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;String&nbsp;name;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;setName(String&nbsp;name)&nbsp;{&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.name&nbsp;=&nbsp;name;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;final&nbsp;List&lt;Person&gt;&nbsp;children&nbsp;=&nbsp;new&nbsp;ArrayList&lt;Person&gt;();<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;addChild(Person&nbsp;child)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.children.add(child);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;}<br>
&nbsp;&nbsp;<br>

</code>
</p>
</div>
<p>one can create a family tree like this:</p>
<div class="literallayout">
<p>
<code class="code">
<br>
&nbsp;&nbsp;&lt;x&nbsp;class="foo.Person"&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;name&nbsp;value="Grandpa"/&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;child&nbsp;class="foo.Person"&nbsp;name="Father"&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;child&nbsp;name="Son"/&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/child&gt;<br>
&nbsp;&nbsp;&lt;/x&gt;<br>

<br>

</code>
</p>
</div>
<p>These couple of lines will, when interpreted by MWE, result in an 
					object tree consisting of three instances of foo.Person:

					</p>
<div class="mediaobject">
<img src="images/family_tree.png"></div>
<p>
				
</p>
<p>The root element can have an arbitrary name, with one exception: If the
					name is 
					<code class="code">workflow</code> and no class attribute is provided, it is assumed 
					that an instance of 
					<code class="code">org.eclipse.emf.mwe.internal.core.Workflow</code> shall 
					be instantiated. This instance will be the root of a workflow model used 
					in generator workflow configurations. However, as you can see in the example
					above one can instantiate arbitrary Java object models. This is 
					conceptually very close to the dependency injection and the XML language 
					in the 
					<a class="ulink" href="http://www.springframework.org" target="_new">Spring Framework</a>. 
				</p>
<p>As explained above the 
					<code class="code">x</code> is ignored in this case. The attribute 
					<code class="code">class</code>
					tells MWE which class to use in order to create the object node. That 
					created object is populated according to the XML description: 
					For each XML attribute MWE calls a corresponding setter or adder method 
					passing in the value (There are configurable value 
					converters, but usually Boolean and String is all you need). The same 
					procedure is applied for each child element. In the case of XML elements 
					a single attribute 
					<code class="code">value</code> is used and interpreted as if there was an 
					attribute in the parent element. That is:
				</p>
<div class="literallayout">
<p>
<code class="code">
<br>
&nbsp;&lt;foo&gt;&lt;name&nbsp;value="bar"/&gt;&lt;/foo&gt;<br>

</code>
</p>
</div>
<p>means the same as</p>
<div class="literallayout">
<p>
<code class="code">
<br>
&nbsp;&lt;foo&nbsp;name="bar"/&gt;<br>

</code>
</p>
</div>
<p>Obviously the latter is far more readable and should be preferred. However, 
					as soon as you want to add multiple values to the same &lsquo;adder&rsquo; method you 
					will need to use the first syntax because you cannot define the same 
					attribute twice in XML.</p>
<p>If an element does not have an attribute 
					<code class="code">value</code>, the engine looks for an 
					attribute called 
					<code class="code">class</code>. If it finds one, the class is instantiated by means 
					of the the default constructor (there is no support for factories as of now.). 
					If not, the class is inferred by looking at the argument&rsquo;s type of the current 
					setter method.
				</p>
<p>This is why it is ok to write:</p>
<div class="literallayout">
<p>
<code class="code">
<br>
&nbsp;&lt;child&nbsp;name="Son"/&gt;<br>

</code>
</p>
</div>
<p>The 
					<code class="code">addChild</code> method takes a 
					<code class="code">foo.Person</code> as an argument. As this is a 
					concrete class which has a default constructor it can be instantiated.
				</p>
<p>
					
<span class="bold"><strong>Tip</strong></span>

					<span class="italic">Whenever you are in an *.mwe file and wonder what kind of configuration the underlying component may accept: Just use JDT&rsquo;s open type action (CTRL+Shift+T) open the source file of the class in question, use the outline view (CTRL+O CTRL+O) and type &lsquo;set&rsquo; or &lsquo;add&rsquo; and you will see the available modifiers. Note that we plan to replace the XML syntax with an Xtext-based implementation as soon as possible.</span>
				
</p>
<p>So this is the basic idea of the MWE language. There are of course a couple of additional concepts and features in the language and we also have not yet talked about the runtime workflow model. Please consult the reference documentation (available through Eclipse help) for additional information.</p>
</div>
<div class="section" title="General Architecture">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="GeneralArchitecture"></a>General Architecture </h3>
</div>
</div>
</div>
<p>Now that you know a bit about MWE, you are ready to learn about the concepts and architecture of Xtext&rsquo;s generator. 
					An instance of Xtext&rsquo;s generator is configured with general information about source folders and projects and consists of any number of language configurations. 
					For each language configuration a URI pointing to its grammar file and the file extensions for the DSL must be provided. 
					In addition, a language is configured with a list of 
					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.generator/src/org/eclipse/xtext/generator/IGeneratorFragment.java?root=Modeling_Project&view=co" target="_new">IGeneratorFragment</a>s.
					The whole generator is composed of theses fragments. We have fragments for generating parsers, the serializer, the EMF code, the outline view, etc.

					</p>
<div class="mediaobject">
<img src="images/generator-structure.png"></div>
<p>
				
</p>
<div class="section" title="Generator Fragments">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="GeneratorFragments"></a>Generator Fragments</h4>
</div>
</div>
</div>
<p>Each fragment gets the grammar of the language as an EMF model passed in. A fragment is able to generate code in one of the configured locations and contribute to several shared artifacts. The main interface 
						<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.generator/src/org/eclipse/xtext/generator/IGeneratorFragment.java?root=Modeling_Project&view=co" target="_new">IGeneratorFragment</a> is supported by a convenient abstract base class 
						<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.generator/src/org/eclipse/xtext/generator/AbstractGeneratorFragment.java?root=Modeling_Project&view=co" target="_new">AbstractGeneratorFragment</a>, which by default delegates to an Xpand template with the same qualified name as the class and delegates some of the calls to Xpand template definitions.
					</p>
<p>We suggest to have a look at the fragment we have written for label providers (
						<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.generator/src/org/eclipse/xtext/ui/generator/labeling/LabelProviderFragment.java?root=Modeling_Project&view=co" target="_new">LabelProviderFragment</a>). It is pretty trivial and at the same time uses the most important call backs. In addition, the structure is not cluttered with too much extra noise so that the whole package (as of Xtext 0.7.0) can serve as a template to write your own fragment.
					</p>
</div>
<div class="section" title="Configuration">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="Configuration"></a>Configuration</h4>
</div>
</div>
</div>
<p>As already explained we use MWE from EMFT in order to build, configure and execute this structure of components. 
						In the following we see an exemplary Xtext generator configuration written in MWE configuration code:  </p>
<div class="literallayout">
<p>
<code class="code">
<br>
&lt;workflow&gt;<br>
	&lt;property&nbsp;file="org/xtext/example/GenerateMyDsl.properties"/&gt;<br>
	
<br>
	&lt;property&nbsp;name="runtimeProject"&nbsp;value="../${projectName}"/&gt;<br>
	
<br>
	&lt;bean&nbsp;class="org.eclipse.emf.mwe.utils.StandaloneSetup"<br>
		platformUri="${runtimeProject}/.."/&gt;<br>
	
<br>
	&lt;component&nbsp;class="org.eclipse.emf.mwe.utils.DirectoryCleaner"<br>
		directory="${runtimeProject}/src-gen"/&gt;<br>
	&lt;component&nbsp;class="org.eclipse.emf.mwe.utils.DirectoryCleaner"<br>
		directory="${runtimeProject}.ui/src-gen"/&gt;<br>
	
<br>
	&lt;component&nbsp;class="org.eclipse.xtext.generator.Generator"&gt;<br>
		&lt;pathRtProject&nbsp;value="${runtimeProject}"/&gt;<br>
		&lt;pathUiProject&nbsp;value="${runtimeProject}.ui"/&gt;<br>
		&lt;projectNameRt&nbsp;value="${projectName}"/&gt;<br>
		&lt;projectNameUi&nbsp;value="${projectName}.ui"/&gt;<br>
		
<br>
		&lt;language&nbsp;uri="${grammarURI}"&nbsp;fileExtensions="${file.extensions}"&gt;<br>
			&lt;!--&nbsp;Java&nbsp;API&nbsp;to&nbsp;access&nbsp;grammar&nbsp;elements&nbsp;(required&nbsp;by&nbsp;several&nbsp;other&nbsp;fragments)&nbsp;--&gt;<br>
			&lt;fragment&nbsp;class="org.eclipse.xtext.generator.grammarAccess.GrammarAccessFragment"/&gt;<br>
			
<br>
			&lt;!--&nbsp;a&nbsp;lot&nbsp;more&nbsp;simple&nbsp;fragments&nbsp;--&gt;<br>
			&lt;!--&nbsp;...&nbsp;&nbsp;--&gt;<br>
		
<br>
			&lt;!--&nbsp;a&nbsp;sample&nbsp;fragment&nbsp;with&nbsp;a&nbsp;property&nbsp;--&gt;<br>
			&lt;fragment&nbsp;class="org.eclipse.xtext.generator.validation.JavaValidatorFragment"&gt;<br>
				&lt;composedCheck&nbsp;value="org.eclipse.xtext.validation.ImportUriValidator"/&gt;<br>
			&lt;/fragment&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
			&lt;!--&nbsp;java-based&nbsp;API&nbsp;for&nbsp;content&nbsp;assistance&nbsp;--&gt;<br>
			&lt;fragment&nbsp;class="org.eclipse.xtext.ui.generator.contentAssist.JavaBasedContentAssistFragment"/&gt;<br>
		&lt;/language&gt;<br>
	&lt;/component&gt;<br>
&lt;/workflow&gt;<br>

<br>

</code>
</p>
</div>
<p>Here the root element is a workflow which accepts 
						<span class="italic">bean</span> s and 
						<span class="italic">component</span> s. The 
						<code class="code">&lt;property/&gt;</code> element is a first class concept of MWE&rsquo;s configuration language and essentially acts as a preprocessor, which replaces all occurences of ${propertyName} with the given value. Property declarations can be inlined (
						<code class="code">&lt;property name="foo" value="bar"/&gt;</code>) or by means of a property file import (
						<code class="code">&lt;property file="foo.properties"/&gt;</code>) which is performed before the actual tree is created. In this example we first import a properties file and after that declare a property 
						<code class="code">runtimeProject</code> which already uses a property imported from the file previously. 
					</p>
<p>The method 
						<code class="code">Workflow.setBean()</code> does nothing but provides a means to apply global side-effects, which unfortunately is required by some projects. In this example we do a so called 
						<span class="italic">EMF stand alone setup</span>. This class initializes a bunch of things for a non-Equinox environment that are otherwise configured by means of extension points, e.g. EMF&rsquo;s 
						<code class="code">EPackage.Registry</code>.
					</p>
<p>Following the 
						<code class="code">&lt;bean/&gt;</code> element there are three 
						<code class="code">&lt;component/&gt;</code> elements. The 
						<code class="code">Workflow.addComponent()</code> method awaits instances of 
						<code class="code">IWorkflowComponent</code>, which is the primary concept of MWE&rsquo;s workflow model. Xtext&rsquo;s generator is an instance of 
						<code class="code">IWorkflowComponent</code> and can therefore be used within MWE workflows. 
					</p>
</div>
</div>
<div class="section" title="Standard generator fragments">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="Standardgeneratorfragments"></a>Standard generator fragments</h3>
</div>
</div>
</div>
<p>In the following the most important standard generator fragments are listed. Please refer to the Javadocs for more documentation.</p>
<table id="N1057C">
<tr>
						
<th>Class</th>
						<th>Generated Artifacts</th>
					
</tr>
<tr>
						
<td>XtextAntlrGeneratorFragment</td>
						<td>AntLR grammar, parser, lexer and related services.</td>
					
</tr>
<tr>
						
<td>XtextAntlrUiGeneratorFragment</td>
						<td>Content assist based on AntLR</td>
					
</tr>
<tr>
						
<td>
							<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.generator/src/org/eclipse/xtext/generator/validation/CheckFragment.java?root=Modeling_Project&view=co" target="_new">CheckFragment</a>
						</td>
						<td>Xpand/Check-based model validation</td>
					
</tr>
<tr>
						
<td>
							<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.generator/src/org/eclipse/xtext/generator/validation/JavaValidatorFragment.java?root=Modeling_Project&view=co" target="_new">JavaValidatorFragment</a>
						</td>
						<td>Java-based model validation</td>
					
</tr>
<tr>
						
<td>
							<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.generator/src/org/eclipse/xtext/generator/ecore/EcoreGeneratorFragment.java?root=Modeling_Project&view=co" target="_new">EcoreGeneratorFragment</a>
						</td>
						<td>EMF code for generated models</td>
					
</tr>
<tr>
						
<td>
							<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.generator/src/org/eclipse/xtext/generator/formatting/FormatterFragment.java?root=Modeling_Project&view=co" target="_new">FormatterFragment</a>
						</td>
						<td>Code formatter</td>
					
</tr>
<tr>
						
<td>
							<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.generator/src/org/eclipse/xtext/generator/grammarAccess/GrammarAccessFragment.java?root=Modeling_Project&view=co" target="_new">GrammarAccessFragment</a>
						</td>
						<td>Access to the grammar</td>
					
</tr>
<tr>
						
<td>
							<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.generator/src/org/eclipse/xtext/ui/generator/contentAssist/JavaBasedContentAssistFragment.java?root=Modeling_Project&view=co" target="_new">JavaBasedContentAssistFragment</a>
						</td>
						<td>Java-based content assist</td>
					
</tr>
<tr>
						
<td>
							<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.generator/src/org/eclipse/xtext/generator/scoping/JavaScopingFragment.java?root=Modeling_Project&view=co" target="_new">JavaScopingFragment</a>
						</td>
						<td>Java-based scoping</td>
					
</tr>
<tr>
						
<td>
							<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.generator/src/org/eclipse/xtext/ui/generator/labeling/LabelProviderFragment.java?root=Modeling_Project&view=co" target="_new">LabelProviderFragment</a>
						</td>
						<td>Label provider</td>
					
</tr>
<tr>
						
<td>
							<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.generator/src/org/eclipse/xtext/ui/generator/outline/OutlineNodeAdapterFactoryFragment.java?root=Modeling_Project&view=co" target="_new">OutlineNodeAdapterFactoryFragment</a>
						</td>
						<td>Outline view configuration</td>
					
</tr>
<tr>
						
<td>
							<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.generator/src/org/eclipse/xtext/generator/parser/PackratParserFragment.java?root=Modeling_Project&view=co" target="_new">PackratParserFragment</a>
						</td>
						<td>Packrat parser (experimental)</td>
					
</tr>
<tr>
						
<td>
							<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.generator/src/org/eclipse/xtext/generator/parseTreeConstructor/ParseTreeConstructorFragment.java?root=Modeling_Project&view=co" target="_new">ParseTreeConstructorFragment</a>
						</td>
						<td>Model-to-text serialization</td>
					
</tr>
<tr>
						
<td>
							<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.generator/src/org/eclipse/xtext/generator/resourceFactory/ResourceFactoryFragment.java?root=Modeling_Project&view=co" target="_new">ResourceFactoryFragment</a>
						</td>
						<td>EMF resource factory</td>
					
</tr>
<tr>
						
<td>
							<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.generator/src/org/eclipse/xtext/ui/generator/projectWizard/SimpleProjectWizardFragment.java?root=Modeling_Project&view=co" target="_new">SimpleProjectWizardFragment</a>
						</td>
						<td>New project wizard</td>
					
</tr>
<tr>
						
<td>
							<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.generator/src/org/eclipse/xtext/ui/generator/outline/TransformerFragment.java?root=Modeling_Project&view=co" target="_new">TransformerFragment</a>
						</td>
						<td>Outline view configuration</td>
					
</tr>
</table>
<p>
					
<span class="bold"><strong>Important</strong></span>

					<span class="italic">Due to IP-Problems with the code generator shipped with Antlr 3 we&rsquo;re not allowed to ship this fragment at Eclipse. Therefore you&rsquo;ll have to download it separately from http://download.itemis.com or use the updatesite at 
						<span class="bold"><strong>http://download.itemis.com/updates/</strong></span>.
					</span>
				
</p>
</div>
</div>
<div class="section" title="Dependency Injection in Xtext with Google Guice">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="dependencyInjection"></a>Dependency Injection in Xtext with Google Guice</h2>
</div>
</div>
</div>
<p>Xtext uses Google Guice in order to wire up and configure language infrstructures. This allows for very flexible customization of language infrastructure and at the same time
				makes the different pieces far more testable. </p>
<div class="section" title="Modules">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="Modules"></a>Modules</h3>
</div>
</div>
</div>
<p>The Guice injector configuration is done through the use of modules (also a Guice concept).
					The generator provides two modules when first called, one for runtime ([MyLanguage]RuntimeModule) and one for UI ([MyLanguage]UIModule).
					These modules are initially empty and intended to be manually edited when needed. These are also the modules used directly by the setup methods. 
					By default these modules extend a fully generated module.</p>
<div class="section" title="Generated Modules">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="GeneratedModules"></a>Generated Modules</h4>
</div>
</div>
</div>
<p>The fully generated modules (never touch them!) are called Abstract[MyLanguage]RuntimeModule and Abstract[MyLanguage]UiModule respectively. 
						They contain all components which have been generated specifically for the language at hand.
						Examples are: the generated parsers, serializer or for UI a proposal provider for content assist is generated.
						What goes into these modules depends on how your generator is configured.</p>
</div>
<div class="section" title="Default Modules">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="DefaultModules"></a>Default Modules</h4>
</div>
</div>
</div>
<p>Finally the fully generated modules extend the 
						<code class="code">DefaultRuntimeModule</code>, which contains all the default configuration. The default configuration consists of all components for which we have generic default implementations (interpreting as opposed to generated). 
						Examples are all the components used in linking, the outline view, hyperlinking and navigation. 
					</p>
</div>
<div class="section" title="Changing Configuration">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="ChangingConfiguration"></a>Changing Configuration</h4>
</div>
</div>
</div>
<p>We use the primary modules ([MyLanguage]RuntimeModule and [MyLanguage]UiModule) in order to change the configuration. 
						The class is initially empty and has been generated only to allow for arbitrary customization.</p>
<p>In order to provide a simple and convenient way, in TMF Xtext every module extends AbstractXtextModule. 
						This class allows to write bindings like this:</p>
<div class="literallayout">
<p>
<code class="code">public&nbsp;Class&lt;?&nbsp;extends&nbsp;MyInterface&gt;&nbsp;bind[anyname]()&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;MyInterfaceImpl.class;<br>
&nbsp;}<br>

</code>
</p>
</div>
<p>Such a method will be interpreted as a binding from 
						<code class="code">MyInterface</code> to 
						<code class="code">MyInterfaceImpl</code>. Note that you simply have to override a method from a super class (e.g. from the generated or default module) in order to change the respective binding.
						Although this is a convenient and simple way, you have of course also the full power of Guice, i.e. you can override the Guice method 
						<code class="code">void bind(Binding)</code> and do what every you want.
					</p>
</div>
</div>
</div>
</div>
<div class="chapter" title="Chapter&nbsp;4.&nbsp;Runtime Concepts">
<div class="titlepage">
<div>
<div>
<h2 class="title">
<a name="RuntimeConcepts"></a>Chapter&nbsp;4.&nbsp;Runtime Concepts</h2>
</div>
</div>
</div>
<p>TMF Xtext itself and every language infrastructure developed with TMF Xtext is configured and wired-up using dependency injection (DI).</p>
<p>We use Google Guice as the underlying framework, and haven&rsquo;t built much on top of it as it pretty much does what we need.
			So instead of describing how google guice works, we refer to the website, where additional information can be found: 
			<a class="ulink" href="http://code.google.com/p/google-guice/" target="_new">http://code.google.com/p/google-guice/</a>. 
		</p>
<p>Using DI allows everyone to set up and change all components. This does not mean that everything which gets configured using DI (we use it a lot) is automatically public API. But we don&rsquo;t forbid use of non-public API, as we think you should decide, if you want to rely on stable API only or use things which might be changed (further enhanced ;-)) in future. See 
			<a class="link" href="#">Xtext API Documentation</a>.
		</p>
<div class="section" title="Runtime setup (ISetup)">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="RuntimesetupISetup"></a>Runtime setup (ISetup)</h2>
</div>
</div>
</div>
<p>For each language there is an implementation of 
				<code class="code">ISetup</code> generated. It implements a method called 
				<code class="code">doSetup()</code>, which can be called to do the initialization of the language infrastructure.
			</p>
<p>This class is intended to be used for runtime and unit testing, only.</p>
<p>The setup method returns an Injector, which can further be used to obtain a parser, etc.</p>
<p>The setup method also registers the ResourceFactory and generated EPackage with the respective global registries provided by EMF.</p>
<p>So basically you can just run the setup and start using EMF API to load and store models of your language.</p>
</div>
<div class="section" title="Setup within Eclipse / Equinox">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="SetupwithinEclipseEquinox"></a>Setup within Eclipse / Equinox</h2>
</div>
</div>
</div>
<p>Within Eclipse we have a generated Activator, which creates a guice injector using the modules.
				In addition an IExecutableExtensionFactory is generated for each language, which is used to create ExecutableExtensions.
				This means that everything which is created via extension points is managed by guice as well, i.e. you can declare dependencies and get them injected upon creation. </p>
<p>The only thing you have to do in order to use this factory is to prefix the class with the factory ([MyLanguageName]ExecutableExtensionFactory) name followed by a colon.</p>
<div class="literallayout">
<p>
<code class="code">
<br>
&lt;extension<br>
&nbsp;&nbsp;point="org.eclipse.ui.editors"&gt;<br>
&nbsp;&nbsp;&lt;editor<br>
&nbsp;&nbsp;&nbsp;&nbsp;class="&lt;MyLanguageName&gt;ExecutableExtensionFactory:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;org.eclipse.xtext.ui.core.editor.XtextEditor"<br>
&nbsp;&nbsp;&nbsp;&nbsp;contributorClass=<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"org.eclipse.ui.editors.text.TextEditorActionContributor"<br>
&nbsp;&nbsp;&nbsp;&nbsp;default="true"<br>
&nbsp;&nbsp;&nbsp;&nbsp;extensions="ecoredsl"<br>
&nbsp;&nbsp;&nbsp;&nbsp;id="org.eclipse.xtext.example.EcoreDsl"<br>
&nbsp;&nbsp;&nbsp;&nbsp;name="EcoreDsl&nbsp;Editor"&gt;<br>
&nbsp;&nbsp;&lt;/editor&gt;<br>
&lt;/extension&gt;<br>
&nbsp;&nbsp;<br>
&nbsp;&nbsp;<br>

<br>

</code>
</p>
</div>
</div>
<div class="section" title="Validation">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="validation"></a>Validation</h2>
</div>
</div>
</div>
<p>Validation (a.k.a Static Analysis) is one of the most interesting aspects when developing a programming language. The users of your languages will be grateful
				if they get informative feedback as they type. 
				In Xtext there are basically three different kinds of validation</p>
<div class="section" title="Syntactical Validation">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="syntactical_validation"></a>Syntactical Validation</h3>
</div>
</div>
</div>
<p>The syntactical correctness of any textual input is validated automatically by the parser. The error messages are generated by the underlying parser technology and cannot be customized using a general hook.
					Any syntax errors can be retrieved from the Resource using the common EMF API:</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>
							
<code class="code">org.eclipse.emf.ecore.resource.Resource.getErrors()</code>
						
</p>
</li>
<li class="listitem">
<p>
							
<code class="code">org.eclipse.emf.ecore.resource.Resource.getWarnings()</code>
						
</p>
</li>
</ul>
</div>
</div>
<div class="section" title="Cross-link Validation">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="linking_validation"></a>Cross-link Validation</h3>
</div>
</div>
</div>
<p>Any broken cross-links can be checked generically. As cross-link resolution is done lazily (see linking), any broken links are resolved lazy as well.
					If you want to validate whether all links are valid, you&rsquo;ll have to navigate through the model so that all proxies get resolved. This is done automatically in the editor.</p>
<p>Any unresolvable cross-links will be reported through:</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>
							
<code class="code">org.eclipse.emf.ecore.resource.Resource.getErrors()</code>
						
</p>
</li>
<li class="listitem">
<p>
							
<code class="code">org.eclipse.emf.ecore.resource.Resource.getWarnings()</code>
						
</p>
</li>
</ul>
</div>
</div>
<div class="section" title="Custom Validation">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="custom_validation"></a>Custom Validation</h3>
</div>
</div>
</div>
<p>In addition to the afore mentioned kinds of validations, which are more or less done automatically, you can specify additional constraints specific for your ecore model.
					We leverage existing EMF API (mainly EValidator) and have put some convenience stuff on top. 
					Basically all you need to do is to make sure that an EValidator is registered for your EPackage. The registry for 
					<code class="code">EValidators</code> (
					<code class="code">org.eclipse.emf.ecore.EValidator.Registry.INSTANCE</code>) can only be filled programatically,
					that means that there&rsquo;s no equinox extension point similar to the EPackage- and ResourceFactory registries.
				</p>
<p>For Xtext we provide a generator fragment for the convenient java-based EValidator API. Just add the following fragment to your generator configuration and you&rsquo;re good to go:</p>
<code class="code">&lt;fragment class="org.eclipse.xtext.generator.validation.JavaValidatorFragment"/&gt;</code>
<p>The generator will provide you with two Java classes. An abstract class generated to src-gen/ which extends the library class AbstractDeclarativeValidator. This one just registers the EPackages for which this validator contains constraints.
					The other class is a subclass of that abstract class and is generated to the src/ folder in order to be edited by you. That&rsquo;s where you put the constraints in.</p>
<p>The purpose of the AbstractDeclarativeValidator is to allow you to write constraints in a (the name says it) declarative way. That is instead of writing exhaustive if else constructs or extending the generated EMF switch you just have to add the @Check annotation to any method and it will be invoked automatically when validation takes place.
					Moreover you can state for what type the respective constraints method is, just by declaring a typed parameter. This also lets you avoid any type casts.  
					In addition to the reflective invocation of test methods  the AbstractDeclarative provides a couple of convenience assertions.</p>
<p>All in all this is very similar to how Junit work. Example:</p>
<div class="literallayout">
<p>
<code class="code">
<br>
&nbsp;&nbsp;public&nbsp;class&nbsp;DomainmodelJavaValidator&nbsp;extends&nbsp;AbstractDomainmodelJavaValidator&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;@Check<br>
&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;checkTypeNameStartsWithCapital(Type&nbsp;type)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!Character.isUpperCase(type.getName().charAt(0)))<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;warning("Name&nbsp;should&nbsp;start&nbsp;with&nbsp;a&nbsp;capital",&nbsp;DomainmodelPackage.TYPE__NAME);<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;}<br>

<br>

<br>

</code>
</p>
</div>
</div>
</div>
<div class="section" title="Linking">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="linking"></a>Linking</h2>
</div>
</div>
</div>
<p>The linking feature allows for specification of cross references within an Xtext grammar.
				The following things are needed for the linking:</p>
<div class="orderedlist">
<ol class="orderedlist" type="1">
<li class="listitem">
<p>declaration of a cross link in the grammar (at least in the meta model)</p>
</li>
<li class="listitem">
<p>specification of linking semantics</p>
</li>
</ol>
</div>
<div class="section" title="Declaration of cross links">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="Declarationofcrosslinks"></a>Declaration of cross links</h3>
</div>
</div>
</div>
<p>In the grammar a cross reference is specified using square brackets.</p>
<div class="literallayout">
<p>
<code class="code">CrossReference&nbsp;:<br>
&nbsp;&nbsp;&nbsp;'['&nbsp;ReferencedEClass&nbsp;('|'&nbsp;terminal=AbstractTerminal)?&nbsp;']'<br>

</code>
</p>
</div>
<p>Example:</p>
<div class="literallayout">
<p>
<code class="code">ReferringType&nbsp;:<br>
&nbsp;&nbsp;&nbsp;'ref'&nbsp;referencedObject=[Entity|(ID|STRING)];<br>

</code>
</p>
</div>
<p>The meta model derivation would create an 
					<code class="code">EClass</code> &lsquo;ReferringType&rsquo; with an 
					<code class="code">EReference</code> &lsquo;referencedObject&rsquo; of type &lsquo;Entity&rsquo; (containment=false). The referenced object would be identified either by an ID or a STRING and the surrounding information (see scoping).
				</p>
<p>Example: While parsing a given input string, say</p>
<div class="literallayout">
<p>
<code class="code">ref&nbsp;Entity01<br>

</code>
</p>
</div>
<p>Xtext produces an instance of &lsquo;ReferringType&rsquo;. After this parsing step it enters the linking phase and tries to find an instance of '&lsquo;Entity&rsquo;' using the parsed text &lsquo;Entity01&rsquo;. The input </p>
<div class="literallayout">
<p>
<code class="code">ref&nbsp;"EntityWith&#402;&divide;&lsaquo;"<br>

</code>
</p>
</div>
<p>would work analogously. This is not an ID (umlauts are not allowed), but a STRING (as it is apparent from the quotation marks).</p>
</div>
<div class="section" title="Specification of linking semantics">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="Specificationoflinkingsemantics"></a>Specification of linking semantics</h3>
</div>
</div>
</div>
<p>The default 
					<code class="code">ILinker</code> implementation installs 
					<code class="code">EObject</code> proxies for all crosslinks, which are then resolved on demand.
					The actual cross ref resolution is done in 
					<code class="code">LazyLinkingResource.getEObject(String)</code> and delegates to 
					<code class="code">ILinkingService</code>.
					Although the default linking behavior is appropriate in many cases there might be scenarios where this is not sufficient. For each grammar a linking service can be implemented/configured, which implements the following interface:
				</p>
<div class="literallayout">
<p>
<code class="code">@Stable(since&nbsp;=&nbsp;"0.7.0",&nbsp;subClass&nbsp;=&nbsp;AbstractLinkingService.class)<br>
public&nbsp;interface&nbsp;ILinkingService&nbsp;{<br>

<br>
&nbsp;&nbsp;/**<br>
&nbsp;&nbsp;&nbsp;*&nbsp;Returns&nbsp;all&nbsp;{@link&nbsp;EObject}s&nbsp;referenced&nbsp;by&nbsp;the&nbsp;given&nbsp;link&nbsp;text&nbsp;in&nbsp;the<br>
&nbsp;&nbsp;&nbsp;*&nbsp;given&nbsp;context.&nbsp;But&nbsp;does&nbsp;not&nbsp;set&nbsp;the&nbsp;references&nbsp;or&nbsp;modifies&nbsp;the&nbsp;passed<br>
&nbsp;&nbsp;&nbsp;*&nbsp;information&nbsp;somehow<br>
&nbsp;&nbsp;&nbsp;*/<br>
&nbsp;&nbsp;List&lt;EObject&gt;&nbsp;getLinkedObjects(<br>
&nbsp;&nbsp;&nbsp;&nbsp;EObject&nbsp;context,&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;EReference&nbsp;reference,&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;AbstractNode&nbsp;node)<br>
		throws&nbsp;IllegalNodeException;<br>

<br>
&nbsp;&nbsp;/**<br>
&nbsp;&nbsp;&nbsp;*&nbsp;Returns&nbsp;the&nbsp;textual&nbsp;representation&nbsp;of&nbsp;a&nbsp;given&nbsp;object&nbsp;as&nbsp;it&nbsp;would&nbsp;be<br>
&nbsp;&nbsp;&nbsp;*&nbsp;serialized&nbsp;in&nbsp;the&nbsp;given&nbsp;context.<br>
&nbsp;&nbsp;&nbsp;*&nbsp;<br>
&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;object<br>
&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;reference<br>
&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;context<br>
&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;the&nbsp;text&nbsp;representation.<br>
&nbsp;&nbsp;&nbsp;*/<br>
&nbsp;&nbsp;String&nbsp;getLinkText(<br>
&nbsp;&nbsp;&nbsp;&nbsp;EObject&nbsp;object,&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;EReference&nbsp;reference,&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;EObject&nbsp;context);<br>
}<br>

<br>

</code>
</p>
</div>
<p>The method 
					<code class="code">getLinkedObjects</code> is directly related to this topic whereas 
					<code class="code">getLinkText</code> adresses complementary functionality: it is used for Serialization.
				</p>
<p>A simple implementation of the linking service (
					<code class="code">DefaultLinkingService</code>) is shipped with Xtext and is used for any grammar per default. It uses the default implementation of 
					<code class="code">IScopeProvider</code>. 
				</p>
</div>
<div class="section" title="Default linking semantics">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="Defaultlinkingsemantics"></a>Default linking semantics</h3>
</div>
</div>
</div>
<p>The default implementation for all languages, looks within the current file for an EObject of the respective type (&lsquo;Entity&rsquo;) which has a name attribute set to &lsquo;Entity01&rsquo;. </p>
<p>Given the grammar :</p>
<div class="literallayout">
<p>
<code class="code">Model&nbsp;:&nbsp;(stuff+=(Ref|Entity))*;<br>
&nbsp;Ref&nbsp;:&nbsp;'ref'&nbsp;referencedObject=[Entity|ID]&nbsp;';';<br>
&nbsp;Entity&nbsp;:&nbsp;'entity'&nbsp;name=ID&nbsp;';';<br>

<br>

</code>
</p>
</div>
<p>In the following model :</p>
<div class="literallayout">
<p>
<code class="code">ref&nbsp;Entity01;<br>
&nbsp;entity&nbsp;Entity01;<br>

</code>
</p>
</div>
<p>the 
					<code class="code">ref</code> would be linked to the declared entity (
					<code class="code">entity Entity01;</code>).
				</p>
<div class="section" title="Default Imports">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="DefaultImports"></a>Default Imports</h4>
</div>
</div>
</div>
<p>There is a default implementation for inter-resource referencing, which as well uses convention.
						Each string in a model which is assigned to an EAttribute with the name &lsquo;importURI&rsquo;, will be interpreted as a URI and used to be loaded using the ResourceSet of the current Resource.</p>
<p>For example, given the following grammar :</p>
<div class="literallayout">
<p>
<code class="code">Model&nbsp;:&nbsp;(imports+=Import)*&nbsp;(stuff+=(Ref|Entity))*;<br>
&nbsp;Import&nbsp;:&nbsp;'import'&nbsp;importURI=STRING&nbsp;';';<br>
&nbsp;Ref&nbsp;:&nbsp;'ref'&nbsp;referencedObject=[Entity|ID]&nbsp;';';<br>
&nbsp;Entity&nbsp;:&nbsp;'entity'&nbsp;name=ID&nbsp;';';<br>

<br>

</code>
</p>
</div>
<p>It would be possible to write three files using in that language where the first references the other two, like this:</p>
<div class="literallayout">
<p>
<code class="code">//file&nbsp;model.dsl<br>
&nbsp;import&nbsp;"model1.dsl";<br>
&nbsp;import&nbsp;"model2.dsl";<br>
&nbsp;<br>
&nbsp;ref&nbsp;Foo;<br>
&nbsp;entity&nbsp;Bar;<br>

<br>

</code>
</p>
</div>
<div class="literallayout">
<p>
<code class="code">//file&nbsp;model1.dsl&nbsp;<br>
&nbsp;entity&nbsp;Stuff;<br>

<br>

</code>
</p>
</div>
<div class="literallayout">
<p>
<code class="code">//file&nbsp;model2.dsl<br>
&nbsp;entity&nbsp;Foo;<br>

<br>

</code>
</p>
</div>
<p>The resulting default scope list is as follows:</p>
<div class="literallayout">
<p>
<code class="code">Scope&nbsp;(model.dsl)&nbsp;{<br>
&nbsp;&nbsp;parent&nbsp;:&nbsp;Scope&nbsp;(model1.dsl)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;parent&nbsp;:&nbsp;Scope&nbsp;(model2.dsl)&nbsp;{}<br>
&nbsp;&nbsp;}<br>
&nbsp;}<br>

<br>

</code>
</p>
</div>
<p>So, the outer scope is asked for an Entity named 
						<code class="code">Foo</code>, as it does not contain such a declaration itself its parent is asked and so on.
						The default implementation of 
						<code class="code">IScopeProvider</code> creates this kind of scope chain.
					</p>
</div>
</div>
</div>
<div class="section" title="Scoping">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="scoping"></a>Scoping</h2>
</div>
</div>
</div>
<p>An 
				<code class="code">IScopeProvider</code> is responsible for providing an 
				<code class="code">IScope</code> for a given 
				<code class="code">EObject</code> and 
				<code class="code">EReference</code> (declared or inherited by the object&rsquo;s 
				<code class="code">EClass</code>). The returned 
				<code class="code">IScope</code> should contain all target candidates for the given object and cross reference.
			</p>
<div class="literallayout">
<p>
<code class="code">
<br>
@Stable(since&nbsp;=&nbsp;"0.7.0",&nbsp;subClass&nbsp;=&nbsp;AbstractScopeProvider.class)<br>
public&nbsp;interface&nbsp;IScopeProvider&nbsp;{<br>

<br>
&nbsp;&nbsp;/**<br>
&nbsp;&nbsp;&nbsp;*&nbsp;Returns&nbsp;a&nbsp;scope&nbsp;for&nbsp;the&nbsp;given&nbsp;context.&nbsp;The&nbsp;scope&nbsp;provides&nbsp;access&nbsp;to&nbsp;<br>
&nbsp;&nbsp;&nbsp;*&nbsp;the&nbsp;compatible&nbsp;visible&nbsp;EObjects&nbsp;for&nbsp;a&nbsp;given&nbsp;reference.<br>
&nbsp;&nbsp;&nbsp;*<br>
&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;context&nbsp;the&nbsp;element&nbsp;from&nbsp;which&nbsp;an&nbsp;element&nbsp;shall&nbsp;be&nbsp;referenced<br>
&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;reference&nbsp;the&nbsp;reference&nbsp;to&nbsp;be&nbsp;used&nbsp;to&nbsp;filter&nbsp;the&nbsp;elements.<br>
&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;{@link&nbsp;IScope}&nbsp;representing&nbsp;the&nbsp;inner&nbsp;most&nbsp;{@link&nbsp;IScope}&nbsp;for&nbsp;<br>
&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;passed&nbsp;context&nbsp;and&nbsp;reference.<br>
&nbsp;&nbsp;&nbsp;*/<br>
&nbsp;&nbsp;public&nbsp;IScope&nbsp;getScope(EObject&nbsp;context,&nbsp;EReference&nbsp;reference);<br>

<br>
&nbsp;&nbsp;/**<br>
&nbsp;&nbsp;&nbsp;*&nbsp;Returns&nbsp;a&nbsp;scope&nbsp;for&nbsp;a&nbsp;given&nbsp;context.&nbsp;The&nbsp;scope&nbsp;contains&nbsp;any&nbsp;visible,&nbsp;<br>
&nbsp;&nbsp;&nbsp;*&nbsp;type-compatible&nbsp;element.<br>
&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;context&nbsp;the&nbsp;element&nbsp;from&nbsp;which&nbsp;an&nbsp;element&nbsp;shall&nbsp;be&nbsp;referenced<br>
&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;type&nbsp;the&nbsp;(super)type&nbsp;of&nbsp;the&nbsp;elements.<br>
&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;{@link&nbsp;IScope}&nbsp;representing&nbsp;the&nbsp;inner&nbsp;most&nbsp;{@link&nbsp;IScope}&nbsp;for<br>
&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;passed&nbsp;context&nbsp;and&nbsp;type.<br>
&nbsp;&nbsp;&nbsp;*/<br>
&nbsp;&nbsp;public&nbsp;IScope&nbsp;getScope(EObject&nbsp;context,&nbsp;EClass&nbsp;type);<br>
}<br>

<br>

</code>
</p>
</div>
<p>An 
				<code class="code">IScope</code> represents an element of a linked list of scopes. That means that a scope can be nested within an outer scope.
				For instance Java has multiple kinds of scopes (object scope, type scope, etc.).
			</p>
<p>For Java one would create the scope hierarchy as commented in the following example:</p>
<div class="literallayout">
<p>
<code class="code">
<br>
//&nbsp;file&nbsp;contents&nbsp;scope<br>
import&nbsp;static&nbsp;my.Constants.STATIC;<br>

<br>
public&nbsp;class&nbsp;ScopeExample&nbsp;{&nbsp;//&nbsp;class&nbsp;body&nbsp;scope<br>
&nbsp;&nbsp;private&nbsp;Object&nbsp;field&nbsp;=&nbsp;STATIC;<br>

<br>
&nbsp;&nbsp;private&nbsp;void&nbsp;method(String&nbsp;param)&nbsp;{&nbsp;//&nbsp;method&nbsp;body&nbsp;scope<br>
&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;localVar&nbsp;=&nbsp;"bar";<br>
&nbsp;&nbsp;&nbsp;&nbsp;innerBlock:&nbsp;{&nbsp;//&nbsp;block&nbsp;scope<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;innerScopeVar&nbsp;=&nbsp;"foo";<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Object&nbsp;field&nbsp;=&nbsp;innerScopeVar;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;the&nbsp;scope&nbsp;hierarchy&nbsp;at&nbsp;this&nbsp;point&nbsp;would&nbsp;look&nbsp;like&nbsp;this:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//blockScope{field,innerScopeVar}-&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//methodScope{localVar,param}-&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//classScope{field}-&gt;&nbsp;('field'&nbsp;is&nbsp;overlayed)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//fileScope{STATIC}-&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//classpathScope{'all&nbsp;qualified&nbsp;names&nbsp;of&nbsp;accessible&nbsp;static&nbsp;fields'}&nbsp;-&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//NULLSCOPE{}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;field.add(localVar);<br>
&nbsp;&nbsp;}<br>
}<br>

<br>

</code>
</p>
</div>
<p>In fact the class path scope should also reflect the order of class path entries.
				For instance:</p>
<div class="literallayout">
<p>
<code class="code">classpathScope{stuff&nbsp;from&nbsp;bin/}<br>
-&gt;&nbsp;classpathScope{stuff&nbsp;from&nbsp;foo.jar/}<br>
-&gt;&nbsp;...<br>
-&gt;&nbsp;classpathScope{stuff&nbsp;from&nbsp;JRE&nbsp;System&nbsp;Library}<br>
-&gt;&nbsp;NULLSCOPE{}<br>

</code>
</p>
</div>
<p>Please find the motivation behind this and some additional details in 
				<a class="ulink" href="http://blog.efftinge.de/2009/01/xtext-scopes-and-emf-index.html" target="_new">this blog post</a> .
			</p>
<div class="section" title="Declarative Scope Provider">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="DeclarativeScopeProvider"></a>Declarative Scope Provider</h3>
</div>
</div>
</div>
<p>As always there is an implementation allowing to specify scoping in a declarative way (extend 
					<code class="code">org.eclipse.xtext.scoping.impl.AbstractDeclarativeScopeProvider</code> for this purpose). It looks up methods which have either of the following two signatures:
				</p>
<div class="literallayout">
<p>
<code class="code">IScope&nbsp;scope_&lt;ContextReference&gt;(&lt;ContextType&gt;&nbsp;ctx,&nbsp;EReference&nbsp;ref)<br>

</code>
</p>
</div>
<div class="literallayout">
<p>
<code class="code">IScope&nbsp;scope_&lt;TypeToReturn&gt;(&lt;ContextType&gt;&nbsp;ctx,&nbsp;EClass&nbsp;type)<br>

</code>
</p>
</div>
<p>The former is used when evaluating the scope for a specific cross reference and here 
					<code class="code">&lt;ContextReference&gt;</code> corresponds to the name of this reference (prefixed with the name of the reference&rsquo;s declaring type and separated by an underscore). The 
					<code class="code">ref</code> parameter represents this cross reference.
				</p>
<p>The latter method signature is used when evaluating the scope of a given element type and is applicable to all cross references of that type. Here 
					<code class="code">&lt;TypeToReturn&gt;</code> is the name of that type which also corresponds to the 
					<code class="code">type</code> parameter. 
				</p>
<p>So if you for example have a state machine with a  
					<span class="emphasis"><em>Transition</em></span> object owned by its source 
					<span class="emphasis"><em>State</em></span> and you want to compute all reachable states (i.e. potential target states), the corresponding method could be declared as follows (assuming the cross reference is declared by the 
					<span class="emphasis"><em>Transition</em></span> type and is called 
					<span class="emphasis"><em>target</em></span>):
				</p>
<div class="literallayout">
<p>
<code class="code">IScope&nbsp;scope_Transition_target(Transition&nbsp;this,&nbsp;EReference&nbsp;ref)<br>

</code>
</p>
</div>
<p>If such a method does not exist, the implementation will try to find one for the context object&rsquo;s container. Thus in the example this would match a method with the same name but 
					<span class="emphasis"><em>State</em></span> as the type of the first parameter. It will keep on walking the containment hierarchy until a matching method is found. This container delegation allows to reuse the same scope definition for elements in different places of the containment hierarchy. Also it may make the method easier to implement as the elements comprising the scope are quite often owned or referenced by a container of the context object. In the example the 
					<span class="emphasis"><em>State</em></span> objects could for instance be owned by a containing 
					<span class="emphasis"><em>StateMachine</em></span> object.
				</p>
<p>If no method specific to the cross reference in question was found for any of the objects in the containment hierarchy, the implementation will start looking for methods matching the other signature (with the 
					<span class="emphasis"><em>EClass</em></span> parameter). Again it will first attempt matching the context object. Thus in the example the signature first matched would be:
				</p>
<div class="literallayout">
<p>
<code class="code">IScope&nbsp;scope_State(Transition&nbsp;this,&nbsp;EClass&nbsp;type)<br>

</code>
</p>
</div>
<p>If no such method exists, the implementation will again try to find a method matching the context object&rsquo;s container objects. In the case of the state machine example you might want to declare the scope with available states at the state machine level:</p>
<div class="literallayout">
<p>
<code class="code">IScope&nbsp;scope_State(StateMachine&nbsp;this,&nbsp;EClass&nbsp;type)<br>

</code>
</p>
</div>
<p>This scope can now be used for any cross references of type 
					<span class="emphasis"><em>State</em></span> for context objects owned by the state machine.
				</p>
</div>
</div>
<div class="section" title="Value Converter">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="valueconverter"></a>Value Converter</h2>
</div>
</div>
</div>
<p>Value converters are registered to convert parsed text into a certain data type instance and back.
				The primary hook is called org.eclipse.xtext.conversion.IValueConverterService and the concrete implementation can be registered via the runtime Guice module (TODO reference to framework description).</p>
<div class="section" title="Annotation based value converters">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="Annotationbasedvalueconverters"></a>Annotation based value converters</h3>
</div>
</div>
</div>
<p>The most simple way to register additional value converters is to make use of 
					<code class="code">org.eclipse.xtext.conversion.impl.AbstractAnnotationBasedValueConverterService</code>, which allows to
					declaratively register 
					<code class="code">IValueConverter</code> via annotated methods. 
				</p>
<p>The implementation for the default token grammar looks like </p>
<div class="literallayout">
<p>
<code class="code">public&nbsp;class&nbsp;DefaultTerminalConverters&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;extends&nbsp;AbstractAnnotationBasedValueConverterService&nbsp;{<br>
&nbsp;&nbsp;<br>
&nbsp;&nbsp;private&nbsp;Grammar&nbsp;grammar;<br>
&nbsp;&nbsp;	<br>
&nbsp;&nbsp;@Inject<br>
&nbsp;&nbsp;public&nbsp;void&nbsp;setGrammar(IGrammarAccess&nbsp;grammarAccess)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;this.grammar&nbsp;=&nbsp;grammarAccess.getGrammar();<br>
&nbsp;&nbsp;}<br>
&nbsp;&nbsp;	<br>
&nbsp;&nbsp;protected&nbsp;Grammar&nbsp;getGrammar()&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;grammar;<br>
&nbsp;&nbsp;}<br>

<br>
&nbsp;&nbsp;@ValueConverter(rule&nbsp;=&nbsp;"ID")<br>
&nbsp;&nbsp;public&nbsp;IValueConverter&lt;String&gt;&nbsp;ID()&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;new&nbsp;AbstractNullSafeConverter&lt;String&gt;()&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;protected&nbsp;String&nbsp;internalToValue(String&nbsp;string,&nbsp;AbstractNode&nbsp;node)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;string.startsWith("^")&nbsp;?&nbsp;string.substring(1)&nbsp;:&nbsp;string;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;protected&nbsp;String&nbsp;internalToString(String&nbsp;value)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(GrammarUtil.getAllKeywords(getGrammar()).contains(value))&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;"^"+value;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;value;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;};<br>
&nbsp;&nbsp;}<br>
&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...&nbsp;&nbsp;some&nbsp;other&nbsp;value&nbsp;converter<br>

<br>

</code>
</p>
</div>
<p>If you use the common terminals grammar (
					<code class="code">org.eclipse.xtext.common.Terminals</code>) you should subclass 
					<code class="code">DefaultTerminalConverters</code> and overwrite or add addition value converter by adding the respective methods.
				</p>
<p>Imagine, you would want to add a rule creating BigDecimals:</p>
<div class="literallayout">
<p>
<code class="code">@ValueConverter(rule&nbsp;=&nbsp;"BIG_DECIMAL")<br>
&nbsp;&nbsp;public&nbsp;IValueConverter&lt;String&gt;&nbsp;BIG_DECIMAL()&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;new&nbsp;AbstractToStringConverter&lt;BigDecimal&gt;()&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;protected&nbsp;BigDecimal&nbsp;internalToValue(String&nbsp;string,&nbsp;AbstractNode&nbsp;node)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;BigDecimal.valueOf(string);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;};<br>
&nbsp;&nbsp;}<br>

<br>

</code>
</p>
</div>
</div>
</div>
<div class="section" title="Serialization">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="serialization"></a>Serialization</h2>
</div>
</div>
</div>
<p>Serialization is the process of transforming an EMF model to its textual representation. Thereby, serialization complements parsing and lexing.</p>
<p>In Xtext, the process of serialization is split into three steps:</p>
<div class="orderedlist">
<ol class="orderedlist" type="1">
<li class="listitem">
<p>Matching the model elements with the grammar rules and creating a stream of tokens. This is done by the 
						<a class="link" href="#parsetreeconstructor" title="Parse Tree Constructor">Parse Tree Constructor</a>.
					</p>
</li>
<li class="listitem">
<p>Mixing existing hidden tokens (whitespaces, comments, etc.) into the token stream. This is done by the 
						<a class="link" href="#hiddentokenmerger" title="Hidden Token Merger">Hidden TOken Merger</a>.
					</p>
</li>
<li class="listitem">
<p>Adding needed whitespaces or replacing all whitespaces using a 
						<a class="link" href="#formatting" title="Formatting (Pretty Printing)">Formatter</a>.  
					</p>
</li>
</ol>
</div>
<p>Serialization is invoked when calling 
				<code class="code">XtextResource.save(...)</code>. Furthermore, 
				<code class="code">SerializerUtil</code> provides resource-independent support for serialization.
			</p>
<div class="section" title="The Contract">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="serializationcontract"></a>The Contract</h3>
</div>
</div>
</div>
<p>The contract of serialization is that when a model is serialized to its textual representation and then loaded (parsed) again, the loaded model equals the original model. Please be aware that this does 
					<span class="emphasis"><em>not</em></span> imply, that when loading a textual representation and serializing it again that both textual representations equal each other. For example, this is the case when a default value is used in a textual representation and the assignment is optional. Another example is:
				</p>
<div class="literallayout">
<p>
<code class="code">MyRule:<br>
&nbsp;&nbsp;(xval+=ID&nbsp;|&nbsp;yval+=INT)*;<br>
&nbsp;&nbsp;<br>

</code>
</p>
</div>
<p>
					
<code class="code">MyRule</code> in this example reads 
					<code class="code">ID</code>- and 
					<code class="code">INT</code>-elements which may occur in an arbitrary in the textual representation. However, when serializing the model all 
					<code class="code">ID</code>-elements will be written first and then all 
					<code class="code">INT</code>-elements. If the order is important it can be preserved by storing all elements in the same list &ndash; which may require wrapping the 
					<code class="code">ID</code>- and 
					<code class="code">INT</code>-elements into objects.   
				</p>
</div>
<div class="section" title="Parse Tree Constructor">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="parsetreeconstructor"></a>Parse Tree Constructor</h3>
</div>
</div>
</div>
<p>The Parse Tree Constructor usually doesn&rsquo;t need to be customized since it is automatically derived from the 
					<a class="link" href="#grammarLanguage" title="Chapter&nbsp;2.&nbsp;The Grammar Language">Xtext Grammar</a>. However, it can be a good idea to look into it to understand its error messages and its runtime performance.
				</p>
<p>For serialization to succeed, the Parse Tree Constructor must be able to 
					<span class="emphasis"><em>consume</em></span> every element of the to-be-serialized EMF model. To 
					<span class="emphasis"><em>consume</em></span> means, in this context, to write it to the textual representation of the model. This can turn out to be a not-so-easy to fulfill requirement, since a Grammar usually introduces implicit constraints to the Ecore model. Example:
				</p>
<div class="literallayout">
<p>
<code class="code">MyRule:<br>
&nbsp;&nbsp;(sval+=ID&nbsp;ival+=INT)*;<br>
	
<br>

</code>
</p>
</div>
<p>This example introduces the constraint  
					<code class="code">sval.size() == ival.size()</code>. Models which violate this constraint are valid EMF models, but they can not be serialized. To check whether a model complies with all constraints introduced by the grammar, there is currently only the way to invoke the Parse Tree Constructor. If this changes at some day, there will be news in 
					<a class="ulink" href="https://bugs.eclipse.org/bugs/show_bug.cgi?id=239565" target="_new">bugzilla 239565</a>.
				</p>
<p>For the Parse Tree Constructor, this can lead to the scenarios, that</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>a model element can not be consumed. This can have the following reasons/solutions:</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="circle">
<li class="listitem">
<p>The model element should not be stored in the model.</p>
</li>
<li class="listitem">
<p>The grammar needs an assignment which would consume the model element.</p>
</li>
<li class="listitem">
<p>The 
									<a class="link" href="#transientvalues" title="Transient Values">Transient Value</a> service could be used to indicate that this models element should not be consumed. 
								</p>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>an assignment in the grammar has no corresponding model element. The Parse Tree Constructor considers a model element not to be present if it is 
							<span class="emphasis"><em>unset</em></span> or equals its default value. However, the parse tree constructor may serialize default values if this is required by a grammar constraint to be able to serialize another model element. The following solution may help to solve such a scenario:
						</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="circle">
<li class="listitem">
<p>A model element is missing in the model.</p>
</li>
<li class="listitem">
<p>The assignment in the grammar should be made optional.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<p>To understand error messages and performance issues of the Parse Tree Constructor it is important to know that it implements a backtracking approach. This basically means that the grammar is used to specify the structure of a tree in which one path (from the root node to a leaf node) is a valid serialization of a specific model. The Parse Tree Constructor&rsquo;s task is to find this path &ndash; with the condition, that all model elements are consumed while walking this path. The Parse Tree Constructor&rsquo;s strategy is to take the most promising branch first (the one that would consume the most model elements). If the branch leads to a dead end (for example, if a model element needs to be consumed that is not present in the model), the Parse Tree Constructor goes back the path until a different branch can be taken. This behavior has two consequences:</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>In case of an error, the Parse Tree Constructor has found only dead ends but no leaf. It can not tell which dead end is actually erroneous. Therefore, the error message lists dead ends of the longs paths, a fragment of their serialization and the reason why the path could not be continued at this point. The developer has to judge on his own which reason is the actual error.</p>
</li>
<li class="listitem">
<p> For reasons of performance, it is critical that the Parse Tree Constructor takes the right branch first and detects wrong branches early. One way to archive this is to avoid having many rules which return the same type and which are called from within the same grammar-alternative.   </p>
</li>
</ul>
</div>
</div>
<div class="section" title="Transient Values">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="transientvalues"></a>Transient Values</h3>
</div>
</div>
</div>
<p>Transient Values are values or model elements which are not persisted (written to the textual representation in the serialization phase). If a model contains model elements which can not be serialized with the current grammar, it is critical to mark them transient using the 
					<code class="code">ITransientValueService</code>, or serialization will fail. The default implementation marks all model elements transient, that are 
					<span class="emphasis"><em>unset</em></span> or equal their default value.  
				</p>
</div>
<div class="section" title="Unassigned Text">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="unassignedtext"></a>Unassigned Text</h3>
</div>
</div>
</div>
<p>Unassigned Text are data rule calls or terminal rule calls which do not reside within an association. Example:</p>
<div class="literallayout">
<p>
<code class="code">PluralRule:<br>
&nbsp;&nbsp;'contents:'&nbsp;count=INT&nbsp;Plural;<br>
&nbsp;&nbsp;<br>
terminal&nbsp;Plural:&nbsp;<br>
&nbsp;&nbsp;'item'&nbsp;|&nbsp;'items';<br>
&nbsp;&nbsp;<br>

</code>
</p>
</div>
<p>Valid DSL-Scripts for this example are 
					<code class="code">contents 1 item</code> or 
					<code class="code">contents 5 items</code>. However, it is not stored in the semantic model whether the keyword 
					<code class="code">item</code> or 
					<code class="code">items</code> has been parsed. This is due to the fact that the rule call 
					<code class="code">Plural</code> is unassigned. However, the 
					<a class="link" href="#parsetreeconstructor" title="Parse Tree Constructor">Parse Tree Constructor</a> needs a decision which value to write during serialization. This decision can be be made by implementing the 
					<code class="code">IUnassignedTextSerializer</code>.  
				</p>
</div>
<div class="section" title="Cross Reference Serializer">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="crossreferenceserializer"></a>Cross Reference Serializer</h3>
</div>
</div>
</div>
<p>The Cross Reference Serializer specifies which values are to be writting to the textual representation for cross references. This behavior can be customized by implementing 
					<code class="code">ICrossReferenceSerializer</code>. The default implementation delegates to 
					<code class="code">ILinkingService</code>, which may be the better place for customization.
				</p>
</div>
<div class="section" title="Hidden Token Merger">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="hiddentokenmerger"></a>Hidden Token Merger</h3>
</div>
</div>
</div>
<p>After the 
					<a class="link" href="#parsetreeconstructor" title="Parse Tree Constructor">Parse Tree Constructor</a> has done its job to create a stream of tokens which are to be written to the textual representation, the Hidden Token Merger (
					<code class="code">IHiddenTokenMerger</code>) mixes existing hidden tokens into this token stream. The default implementation uses the hidden tokens (whitespaces, linebreaks, comments) from the node model. The 
					<code class="code">IHiddenTokenMerger</code> is the factory for a 
					<a class="link" href="#tokenstream" title="Token Stream">Token Stream</a> which is fed by the 
					<a class="link" href="#parsetreeconstructor" title="Parse Tree Constructor">Parse Tree Constructor</a> and which writes to another Token Stream.  
				</p>
</div>
<div class="section" title="Token Stream">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="tokenstream"></a>Token Stream</h3>
</div>
</div>
</div>
<p>The 
					<a class="link" href="#parsetreeconstructor" title="Parse Tree Constructor">Parse Tree Constructor</a>, the 
					<a class="link" href="#hiddentokenmerger" title="Hidden Token Merger">Hidden Token Merger</a> and the 
					<a class="link" href="#formatting" title="Formatting (Pretty Printing)">Formatter</a> use Token Streams for their output, and the latter two for their input as well. This makes them chainable. Token Streams can be converted to 
					<code class="code">String</code> using the 
					<code class="code">TokenStringBuffer</code> and to 
					<code class="code">java.io.OutputStream</code> using the 
					<code class="code">TokenOutputStream</code>. Maybe there will be an implementation to reconstruct a node model as well at some point in the future. While providing fast output due to the stream pattern, Token Streams allow easy manipulation of the stream, such as mixing in whitespaces or manipulating them.    
				</p>
<div class="literallayout">
<p>
<code class="code">public&nbsp;interface&nbsp;ITokenStream&nbsp;{<br>
&nbsp;&nbsp;public&nbsp;void&nbsp;close()&nbsp;throws&nbsp;IOException;<br>
&nbsp;&nbsp;public&nbsp;void&nbsp;writeHidden(EObject&nbsp;grammarElement,&nbsp;String&nbsp;value)&nbsp;throws&nbsp;IOException;<br>
&nbsp;&nbsp;public&nbsp;void&nbsp;writeSemantic(EObject&nbsp;grammarElement,&nbsp;String&nbsp;value)&nbsp;throws&nbsp;IOException;<br>
}<br>

<br>
&nbsp;<br>

<br>

</code>
</p>
</div>
</div>
</div>
<div class="section" title="Fragment Provider (referencing Xtext models from other EMF artifacts)">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="fragmentProvider"></a>Fragment Provider (referencing Xtext models from other EMF artifacts)</h2>
</div>
</div>
</div>
<p>Although inter-Xtext linking is not done by URIs, you may want to be able to reference your 
				<code class="code">EObject</code> from non-Xtext models.
				In those cases URIs are used, which are made up of a part identifying the resource. Each 
				<code class="code">EObject</code> contained in a resource can be identified by a so called 
				<span class="emphasis"><em>fragment</em></span>.
			</p>
<p>A fragment is a part of an EMF URI and needs to be unique per resource.</p>
<p>The generic XMI resource shipped with EMF provides a generic path-like computation of fragments. With an XMI or other binary-like serialization it is also common and possible to use UUIDs.</p>
<p>However with a textual concrete syntax we want to be able to compute fragments out of the given information. We don&rsquo;t want to force people to use UUIDs (i.e. synthetic identifiers) or relative generic paths (very fragile), in order to refer to 
				<code class="code">EObjects</code>.
			</p>
<p>Therefore one can contribute a so called 
				<code class="code">IFragmentProvider</code> per language.
			</p>
<div class="literallayout">
<p>
<code class="code">public&nbsp;interface&nbsp;IFragmentProvider&nbsp;extends&nbsp;ILanguageService&nbsp;{<br>
&nbsp;<br>
&nbsp;&nbsp;/**<br>
&nbsp;&nbsp;&nbsp;*&nbsp;Computes&nbsp;the&nbsp;local&nbsp;ID&nbsp;of&nbsp;the&nbsp;given&nbsp;object.&nbsp;<br>
&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;obj<br>
&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;EObject&nbsp;to&nbsp;compute&nbsp;the&nbsp;fragment&nbsp;for<br>
&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;the&nbsp;fragment,&nbsp;which&nbsp;can&nbsp;be&nbsp;an&nbsp;arbitrary&nbsp;string&nbsp;but&nbsp;must&nbsp;be&nbsp;<br>
&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unique&nbsp;within&nbsp;a&nbsp;resource.&nbsp;Return&nbsp;null&nbsp;to&nbsp;use&nbsp;default&nbsp;<br>
&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;implementation<br>
&nbsp;&nbsp;&nbsp;*/<br>
&nbsp;&nbsp;String&nbsp;getFragment(EObject&nbsp;obj);<br>
&nbsp;&nbsp;<br>
&nbsp;&nbsp;/**<br>
&nbsp;&nbsp;&nbsp;*&nbsp;Locates&nbsp;an&nbsp;EObject&nbsp;in&nbsp;a&nbsp;resource&nbsp;by&nbsp;its&nbsp;fragment.&nbsp;<br>
&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;resource<br>
&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;fragment<br>
&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;the&nbsp;EObject&nbsp;<br>
&nbsp;&nbsp;&nbsp;*/<br>
&nbsp;&nbsp;EObject&nbsp;getEObject(Resource&nbsp;resource,&nbsp;String&nbsp;fragment);<br>
&nbsp;}<br>

<br>

</code>
</p>
</div>
<p>Note that the currently available default fragment provider does nothing (i.e. refers to the default behavior of EMF).</p>
</div>
</div>
<div class="chapter" title="Chapter&nbsp;5.&nbsp;IDE concepts">
<div class="titlepage">
<div>
<div>
<h2 class="title">
<a name="IDEconcepts"></a>Chapter&nbsp;5.&nbsp;IDE concepts</h2>
</div>
</div>
</div>
<p>For the following part we will refer to a concrete example grammar in order to explain certain aspect of the UI more clearly. The used example grammar is as follows:</p>
<div class="literallayout">
<p>
<code class="code">grammar&nbsp;org.eclipse.text.documentation.Sample&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;with&nbsp;org.eclipse.xtext.common.Terminals<br>

<br>
generate&nbsp;gen&nbsp;'http://www.eclipse.org/xtext/documentation/Sample'&nbsp;as&nbsp;gen<br>

<br>
Model&nbsp;:<br>
&nbsp;&nbsp;"model"&nbsp;intAttribute=INT&nbsp;(stringDescription=STRING)?&nbsp;"{"&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rules&nbsp;+=&nbsp;AbstractRule)*&nbsp;<br>
&nbsp;&nbsp;"}"&nbsp;<br>
;<br>

<br>
AbstractRule:<br>
&nbsp;&nbsp;RuleA&nbsp;|&nbsp;RuleB<br>
;<br>

<br>
RuleA&nbsp;:<br>
&nbsp;&nbsp;&nbsp;"RuleA"&nbsp;"("&nbsp;name&nbsp;=&nbsp;ID&nbsp;")"&nbsp;;<br>

<br>
RuleB&nbsp;return&nbsp;gen::CustomType:<br>
&nbsp;&nbsp;&nbsp;"RuleB"&nbsp;"("&nbsp;ruleA&nbsp;=&nbsp;[RuleA]&nbsp;")"&nbsp;;<br>

<br>

</code>
</p>
</div>
<p></p>
<div class="section" title="Managing Concurrency">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="concurrency"></a>Managing Concurrency</h2>
</div>
</div>
</div>
<p>text</p>
</div>
<div class="section" title="Label Provider">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="labelProvider"></a>Label Provider</h2>
</div>
</div>
</div>
<p>A nice part of the Eclipse tooling that comes with Xtext is the outline view. It shows the structure of your model as a tree and allows quick navigation to model elements. Thus it helps to get an overview on the current state in the editor at a glance. To make the appearance of the outline more appealing it is very easy possible to provide customization for the label and the image that is used for an element. Actually this customization will be used at various places in your IDE, for example in the window that displays completion proposals when content assist was invoked. (Customizing the structure of the outline is described in a separate 
				<a class="link" href="#outline" title="Outline View">chapter</a>).
			</p>
<p>The LabelProvider is the service which is used to compute the image for model elements of &ndash; as its name suggests &ndash; the label that represents an element. What you basically have to do is to provide an implementation for two methods which read 
				<code class="code">Image getImage(Object)</code> and 
				<code class="code">String getText(Object)</code> respectively. As this tends to be cumbersome due to 
				<code class="code">instanceof</code> and cast orgies, Xtext ships with a reasonable and convenient default implementation.
			</p>
<div class="section" title="DefaultLabelProvider">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="DefaultLabelProvider"></a>DefaultLabelProvider</h3>
</div>
</div>
</div>
<p>The default implementation of the 
					<code class="code">LabelProvider</code> interface utilizes the polymorphic dispatcher idiom to implement an external visitor as the requirements of the LabelProvider are kind of a best match for this pattern. It comes down to the fact that the only thing you need to do is to implement a method that matches a specific signature. It either provides a image filename or the text to be used to represent your model element. Have a look at following example to get a more detailed idea about the 
					<code class="code">DefaultLabelProvider</code>.
				</p>
<div class="literallayout">
<p>
<code class="code">public&nbsp;class&nbsp;SampleLabelProvider&nbsp;extends&nbsp;DefaultLabelProvider&nbsp;{<br>

<br>
&nbsp;&nbsp;String&nbsp;text(RuleA&nbsp;rule)&nbsp;{<br>
		return&nbsp;"Rule:&nbsp;"&nbsp;+&nbsp;rule.getName();<br>
	}<br>
	
<br>
	String&nbsp;image(RuleA&nbsp;rule)&nbsp;{<br>
		return&nbsp;"ruleA.gif";<br>
	}<br>
	
<br>
	String&nbsp;image(RuleB&nbsp;rule)&nbsp;{<br>
		return&nbsp;"ruleB.gif";<br>
	}<br>
	
<br>
}<br>
	
<br>

</code>
</p>
</div>
<p></p>
<p>The declarative implementation of the label itself is pretty straightforward. The image in turn is expected to be found in a resource named 
					<code class="code">icons/&lt;result of image-method&gt;</code> in your plugin. This path is actually configurable by google guice. Have a look at the 
					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.ui.core/src/org/eclipse/xtext/ui/core/PluginImageHelper.java?root=Modeling_Project&view=co" target="_new">PluginImageHelper</a> to learn about the customizing possibilities.
				</p>
<p>What&rsquo;s especially nice about the default implementation is the actual reason for its class name: It provides very reasonable defaults. To compute the label for a certain model element, it will at first have a look for a EAttribute that&rsquo;s called 
					<code class="code">name</code> and try to use this one. If it cannot find a feature like this, it will try to use the first feature, that can be used best as a label. At worst it will return the class name of the model element, which is kind of unlikely to happen.
				</p>
<p>More advanced usage patterns of the 
					<code class="code">DefaultLabelProvider</code> include a dispatching to an error handler called 
					<code class="code">String error_text(Object, Exception)</code> and 
					<code class="code">String error_image(Object, Exception)</code> respectively.  
				</p>
</div>
</div>
<div class="section" title="Content Assist">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="contentAssist"></a>Content Assist</h2>
</div>
</div>
</div>
<p>The Xtext generator, amongst other things, generates the following two content assist (CA) related artifacts:</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>an abstract proposal provider class named 
						<code class="code">'Abstract[Language]ProposalProvider'</code> generated into the 
						<code class="code">src-gen</code> folder within the 
						<code class="code">ui</code> project
					</p>
</li>
<li class="listitem">
<p>a concrete descendent in the 
						<code class="code">src</code>-folder of the 
						<code class="code">ui</code> project 
						<code class="code">ProposalProvider</code>
					
</p>
</li>
</ul>
</div>
<p>First we will investigate the generated 
				<code class="code">Abstract[Language]ProposalProvider</code> with methods that look like this:
			</p>
<div class="section" title="ProposalProvider">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="ProposalProvider"></a>ProposalProvider</h3>
</div>
</div>
</div>
<div class="literallayout">
<p>
<code class="code">public&nbsp;void&nbsp;complete[TypeName]_[FeatureName](<br>
&nbsp;&nbsp;EObject&nbsp;model,&nbsp;<br>
&nbsp;&nbsp;Assignment&nbsp;assignment,&nbsp;<br>
&nbsp;&nbsp;ContentAssistContext&nbsp;context,&nbsp;<br>
&nbsp;&nbsp;ICompletionProposalAcceptor&nbsp;acceptor)&nbsp;{<br>
&nbsp;&nbsp;//&nbsp;clients&nbsp;may&nbsp;override<br>
}<br>

<br>
public&nbsp;void&nbsp;complete_[RuleName](<br>
&nbsp;&nbsp;EObject&nbsp;model,&nbsp;<br>
&nbsp;&nbsp;RuleCall&nbsp;ruleCall,&nbsp;<br>
&nbsp;&nbsp;ContentAssistContext&nbsp;context,&nbsp;<br>
&nbsp;&nbsp;ICompletionProposalAcceptor&nbsp;acceptor)&nbsp;{<br>
&nbsp;&nbsp;//&nbsp;clients&nbsp;may&nbsp;override<br>
}<br>

<br>

</code>
</p>
</div>
<p>The snippet above indicates that the generated ProposalProvider class contains a 
					<code class="code">complete*</code>-method for each assigned feature in the grammar and for each rule. The brackets are placeholders that should give a clue about the naming scheme, that is used to create the various entry points for clients. The generated proposal provider falls back to some default behavior for cross references. Furthermore it inherits the logic that was introduced in reused grammars. 
				</p>
<p>Clients who want to customize the behavior may override the methods from the 
					<code class="code">AbstractProposalProvider</code> or in turn introduce new methods with specialized parameters. The framework dispatches method calls according to the current context to the most concrete implementation, that can be found.
				</p>
<p>It is important to know, that for a given offset in a model file, many possible grammar elements exist. The framework dispatches to the method declarations for any valid element. That means, that a bunch of '&lsquo;complete.*&rsquo;' may be called.</p>
</div>
<div class="section" title="Sample Implementation">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="SampleImplementation"></a>Sample Implementation</h3>
</div>
</div>
</div>
<p>To provide a dummy proposal for the description of a model object, you may introduce a specialization of the generated method and implement it as follows. This will give &lsquo;Description for model #7&rsquo; for a model with the intAttribute '7'</p>
<div class="literallayout">
<p>
<code class="code">public&nbsp;void&nbsp;completeModel_StringDescription&nbsp;(<br>
&nbsp;&nbsp;Model&nbsp;model,&nbsp;<br>
&nbsp;&nbsp;Assignment&nbsp;assignment,&nbsp;<br>
&nbsp;&nbsp;ContentAssistContext&nbsp;context,&nbsp;<br>
&nbsp;&nbsp;ICompletionProposalAcceptor&nbsp;acceptor)&nbsp;{<br>
&nbsp;&nbsp;//&nbsp;call&nbsp;implementation&nbsp;in&nbsp;superclass<br>
&nbsp;&nbsp;super.completeModel_StringDescription(<br>
&nbsp;&nbsp;&nbsp;&nbsp;model,&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;assignment,&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;context,&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;acceptor);<br>

<br>
&nbsp;&nbsp;//&nbsp;compute&nbsp;the&nbsp;plain&nbsp;proposal<br>
&nbsp;&nbsp;String&nbsp;proposal&nbsp;=&nbsp;"Description&nbsp;for&nbsp;model&nbsp;#"&nbsp;+&nbsp;model.getIntAttribute();<br>

<br>
&nbsp;&nbsp;//&nbsp;convert&nbsp;it&nbsp;to&nbsp;a&nbsp;valid&nbsp;STRING-terminal<br>
&nbsp;&nbsp;proposal&nbsp;=&nbsp;getValueConverter().toString(proposal,&nbsp;"STRING");<br>

<br>
&nbsp;&nbsp;//&nbsp;create&nbsp;the&nbsp;completion&nbsp;proposal<br>
&nbsp;&nbsp;//&nbsp;the&nbsp;result&nbsp;may&nbsp;be&nbsp;null&nbsp;as&nbsp;the&nbsp;createCompletionProposal(..)&nbsp;methods&nbsp;<br>
&nbsp;&nbsp;//&nbsp;check&nbsp;for&nbsp;valid&nbsp;prefixes<br>
&nbsp;&nbsp;//&nbsp;and&nbsp;terminal&nbsp;token&nbsp;conflicts<br>
&nbsp;&nbsp;ICompletionProposal&nbsp;completionProposal&nbsp;=&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;createCompletionProposal(proposal,&nbsp;contentAssistContext);<br>

<br>
&nbsp;&nbsp;//&nbsp;register&nbsp;the&nbsp;proposal,&nbsp;the&nbsp;acceptor&nbsp;handles&nbsp;null-values&nbsp;gracefully<br>
&nbsp;&nbsp;acceptor.accept(completionProposal);<br>
}<br>

<br>

</code>
</p>
</div>
</div>
</div>
<div class="section" title="Template Proposals">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="templates"></a>Template Proposals</h2>
</div>
</div>
</div>
<p>Xtext-based editors automatically support code templates. That means that you get the corresponding preference page where users can add and change template proposals. If you want to ship a couple of default templates, you have to put a file under 
				<code class="code">templates/templates.xml</code> containing templates in a format described in the 
				<a class="ulink" href="http://help.eclipse.org/ganymede/topic/org.eclipse.cdt.doc.user/tasks/cdt_t_imp_code_temp.htm" target="_new">eclipse help</a>  .
			</p>
<p>By default Xtext registers ContextTypes for each Rule (
				<code class="code">.[RuleName]</code>) and for each keyword (
				<code class="code">.kw_[keyword]</code>), as long as the keywords are valid identifiers.
			</p>
<p>If you don&rsquo;t like these defaults you&rsquo;ll have to subclass 
				<code class="code">org.eclipse.xtext.ui.common.editor.templates.XtextTemplateContextTypeRegistry</code> and configure it via Guice.
			</p>
<div class="section" title="CrossReference Resolver">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="CrossReferenceResolver"></a>CrossReference Resolver</h3>
</div>
</div>
</div>
<p>Xtext comes with a specific template variable resolver (
					<code class="code">org.eclipse.jface.text.templates.TemplateVariableResolver</code>) called 
					<code class="code">CrossReferenceResolver</code>, which can be used to place cross refs within a template.
				</p>
<p>The syntax is as follows:</p>
<div class="literallayout">
<p>
<code class="code">${someText:CrossReference('MyType.myRef')}<br>

</code>
</p>
</div>
<p>For example the following template:</p>
<div class="literallayout">
<p>
<code class="code">&lt;template&nbsp;name="transition"&nbsp;description="event&nbsp;transition"<br>
&nbsp;&nbsp;&nbsp;&nbsp;id="transition"<br>
&nbsp;&nbsp;&nbsp;&nbsp;context="org.eclipse.xtext.example.FowlerDsl.Transition"&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;enabled="true"<br>
&nbsp;&nbsp;&gt;${event:CrossReference('Transition.event')}&nbsp;=&gt;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;${state:CrossReference('Transition.state')&lt;/<br>
&nbsp;&nbsp;template&gt;<br>

</code>
</p>
</div>
<p>yields the text

					<code class="code">event =&gt; state</code> and allows selecting any events and states using a drop down.
				</p>
</div>
</div>
<div class="section" title="Outline View">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="outline"></a>Outline View</h2>
</div>
</div>
</div>
<p>Xtext provides an outline view to help you navigate your models. By default, it provides a hierarchical view on your model and allows you to sort tree elements alphabetically. Selecting an element in the outline will highlight the correpsonding element in the text editor. Users can choose to synchronize the outline with the editor selection by clicking the 
				<span class="emphasis"><em>Link with Editor</em></span> button.
			</p>
<p>
				
</p>
<div class="mediaobject">
<img src="images/sample_outline.png"></div>
<p>
			
</p>
<p>You can customize various aspects of the outline by providing implementation for its various interfaces. The following sections show how to customize the various aspects of the outline. </p>
<div class="section" title="Influencing the outline structure">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="Influencingtheoutlinestructure"></a>Influencing the outline structure</h3>
</div>
</div>
</div>
<p>In its default implementation, the outline view shows the containment hierarchy of your model. This should be sufficient in most cases. If you want to adjust the structure of the outline, i.e., by omitting a certain kind of node or by introducing additional (artificial / virtual) nodes, you customize the outline by implementing 
					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.ui.common/src/org/eclipse/xtext/ui/common/editor/outline/transformer/ISemanticModelTransformer.java?root=Modeling_Project&view=co" target="_new">ISemanticModelTransformer</a>.
				</p>
<p>The Xtext wizard creates an empty transformer class (
					<code class="code">MyDslTransformer</code>) for your convenience. To transform the semantic model delivered by the Xtext parser, you need to provide transformation methods for each of the meta classes that are of interest:
				</p>
<div class="literallayout">
<p>
<code class="code">
<br>
public&nbsp;class&nbsp;MyDslTransformer&nbsp;extends&nbsp;AbstractDeclarativeSemanticModelTransformer&nbsp;{&nbsp;<br>
&nbsp;&nbsp;/**<br>
&nbsp;&nbsp;&nbsp;*&nbsp;This&nbsp;method&nbsp;will&nbsp;be&nbsp;called&nbsp;by&nbsp;naming&nbsp;convention:<br>
&nbsp;&nbsp;&nbsp;*&nbsp;-&nbsp;method&nbsp;name&nbsp;must&nbsp;be&nbsp;createNode<br>
&nbsp;&nbsp;&nbsp;*&nbsp;-&nbsp;first&nbsp;param:&nbsp;subclass&nbsp;of&nbsp;EObject<br>
&nbsp;&nbsp;&nbsp;*&nbsp;-&nbsp;second&nbsp;param:&nbsp;ContentOutlineNode&nbsp;<br>
&nbsp;&nbsp;&nbsp;*/<br>
&nbsp;&nbsp;public&nbsp;ContentOutlineNode&nbsp;createNode(Attribute&nbsp;semanticNode,&nbsp;ContentOutlineNode&nbsp;parentNode)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;ContentOutlineNode&nbsp;node&nbsp;=&nbsp;super.newOutlineNode(semanticNode,&nbsp;parentNode);<br>
&nbsp;&nbsp;&nbsp;&nbsp;node.setLabel("special&nbsp;"&nbsp;+&nbsp;node.getLabel());<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;node;<br>
&nbsp;&nbsp;}<br>
&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;public&nbsp;ContentOutlineNode&nbsp;createNode(Property&nbsp;semanticNode,&nbsp;ContentOutlineNode&nbsp;parentNode)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;ContentOutlineNode&nbsp;node&nbsp;=&nbsp;super.newOutlineNode(semanticNode,&nbsp;parentNode);<br>
&nbsp;&nbsp;&nbsp;&nbsp;node.setLabel("pimped&nbsp;"&nbsp;+&nbsp;node.getLabel());<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;node;<br>
&nbsp;&nbsp;}<br>

<br>
/**<br>
&nbsp;*&nbsp;This&nbsp;method&nbsp;will&nbsp;be&nbsp;called&nbsp;by&nbsp;naming&nbsp;convention:<br>
&nbsp;*&nbsp;-&nbsp;method&nbsp;name&nbsp;must&nbsp;be&nbsp;getChildren<br>
&nbsp;*&nbsp;-&nbsp;first&nbsp;param:&nbsp;subclass&nbsp;of&nbsp;EObject<br>
&nbsp;*/<br>
&nbsp;&nbsp;public&nbsp;List&lt;EObject&gt;&nbsp;getChildren(Attribute&nbsp;attribute)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;attribute.eContents();<br>
&nbsp;&nbsp;}<br>

<br>
&nbsp;&nbsp;public&nbsp;List&lt;EObject&gt;&nbsp;getChildren(Property&nbsp;property)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;NO_CHILDREN;<br>
&nbsp;&nbsp;}<br>
&nbsp;}<br>
&nbsp;<br>

<br>

</code>
</p>
</div>
<p>To make sure Xtext picks up your new outline transformer, you have to register your implementation with your UI module: </p>
<div class="literallayout">
<p>
<code class="code">
<br>
public&nbsp;class&nbsp;MyDslUiModule&nbsp;extends&nbsp;AbstractXtextUiModule&nbsp;{<br>

<br>
&nbsp;&nbsp;@Override<br>
&nbsp;&nbsp;public&nbsp;Class&lt;?&nbsp;extends&nbsp;ISemanticModelTransformer&gt;&nbsp;bindISemanticModelTransformer()&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;MyDslTransformer.class;<br>
&nbsp;&nbsp;}<br>
&nbsp;&nbsp;...<br>
}<br>

<br>

<br>

</code>
</p>
</div>
</div>
<div class="section" title="Filtering">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="Filtering"></a>Filtering</h3>
</div>
</div>
</div>
<p>Often, you want to allow users to filter the contents of the outline to make it easier to concentrate on the relevant aspects of the model. To add filtering capabilities to your outline, you need to add 
					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.ui.common/src/org/eclipse/xtext/ui/common/editor/outline/actions/AbstractFilterAction.java?root=Modeling_Project&view=co" target="_new">AbstractFilterAction</a>s to the outline. Actions can be contributed by implementing and registering a 
					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.ui.common/src/org/eclipse/xtext/ui/common/editor/outline/actions/DeclarativeActionBarContributor.java?root=Modeling_Project&view=co" target="_new">DeclarativeActionBarContributor</a>.
				</p>
<p>To register a 
					<code class="code">DeclarativeActionBarContributor</code>, add the following lines to your 
					<code class="code">MyDslUiModule</code> class:
				</p>
<div class="literallayout">
<p>
<code class="code">
<br>
/**<br>
&nbsp;*&nbsp;Use&nbsp;this&nbsp;class&nbsp;to&nbsp;register&nbsp;components&nbsp;to&nbsp;be&nbsp;used&nbsp;within&nbsp;the&nbsp;IDE.<br>
&nbsp;*/<br>
public&nbsp;class&nbsp;MyDslUiModule&nbsp;extends&nbsp;org.xtext.example.AbstractMyDslUiModule&nbsp;{<br>

<br>
&nbsp;&nbsp;...<br>

<br>
&nbsp;&nbsp;@Override<br>
&nbsp;&nbsp;public&nbsp;Class&lt;?&nbsp;extends&nbsp;IActionBarContributor&gt;&nbsp;bindIActionBarContributor()&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;MyDslActionBarContributor.class;<br>
&nbsp;&nbsp;}<br>
}<br>

<br>

</code>
</p>
</div>
<p>The action bar contributor will look like this:</p>
<div class="literallayout">
<p>
<code class="code">
<br>
public&nbsp;class&nbsp;MyDslActionBarContributor&nbsp;extends&nbsp;DeclarativeActionBarContributor&nbsp;{<br>
&nbsp;&nbsp;public&nbsp;Action&nbsp;addFilterParserRulesToolbarAction(XtextContentOutlinePage&nbsp;page)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;new&nbsp;FilterFooAction(page);<br>
&nbsp;&nbsp;}<br>
}<br>

<br>

</code>
</p>
</div>
<p>Filter actions must extend 
					<code class="code">AbstractFilterAction</code> (this ensures that the action toggle state is handled correctly):
				</p>
<div class="literallayout">
<p>
<code class="code">
<br>
import&nbsp;org.eclipse.jface.viewers.ViewerFilter;<br>
import&nbsp;org.eclipse.xtext.ui.common.editor.outline.XtextContentOutlinePage;<br>
import&nbsp;org.eclipse.xtext.ui.common.editor.outline.actions.AbstractFilterAction;<br>
import&nbsp;org.eclipse.xtext.xtext.ui.Activator;<br>

<br>
public&nbsp;class&nbsp;FilterFooAction&nbsp;extends&nbsp;AbstractFilterAction&nbsp;{<br>

<br>
&nbsp;&nbsp;public&nbsp;FilterFooAction(XtextContentOutlinePage&nbsp;outlinePage)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;super("Filter&nbsp;Foo",&nbsp;outlinePage);<br>
&nbsp;&nbsp;&nbsp;&nbsp;setToolTipText("Show&nbsp;/&nbsp;hide&nbsp;foo");<br>
&nbsp;&nbsp;&nbsp;&nbsp;setDescription("Show&nbsp;/&nbsp;hide&nbsp;foo");<br>
&nbsp;&nbsp;&nbsp;&nbsp;setImageDescriptor(Activator.getImageDescriptor("icons/fltr_foo.gif"));<br>
&nbsp;&nbsp;&nbsp;&nbsp;setDisabledImageDescriptor(Activator.getImageDescriptor("icons/fltr_foo.gif"));<br>
&nbsp;&nbsp;}<br>

<br>
&nbsp;&nbsp;@Override<br>
&nbsp;&nbsp;protected&nbsp;String&nbsp;getToggleId()&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;"FilterFooAction.isChecked";<br>
&nbsp;&nbsp;}<br>
	
<br>
&nbsp;&nbsp;@Override<br>
&nbsp;&nbsp;protected&nbsp;ViewerFilter&nbsp;createFilter()&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;new&nbsp;FooOutlineFilter();<br>
&nbsp;&nbsp;}<br>

<br>
}<br>

<br>

</code>
</p>
</div>
<p>The filtering itself will be performed by 
					<code class="code">FooOutlineFilter</code>:
				</p>
<div class="literallayout">
<p>
<code class="code">
<br>
import&nbsp;org.eclipse.emf.ecore.EClass;<br>
import&nbsp;org.eclipse.jface.viewers.Viewer;<br>
import&nbsp;org.eclipse.jface.viewers.ViewerFilter;<br>
import&nbsp;org.eclipse.xtext.XtextPackage;<br>
import&nbsp;org.eclipse.xtext.ui.common.editor.outline.ContentOutlineNode;<br>

<br>
public&nbsp;class&nbsp;FooOutlineFilter&nbsp;extends&nbsp;ViewerFilter&nbsp;{<br>

<br>
&nbsp;&nbsp;@Override<br>
&nbsp;&nbsp;public&nbsp;boolean&nbsp;select(Viewer&nbsp;viewer,&nbsp;Object&nbsp;parentElement,&nbsp;Object&nbsp;element)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;((parentElement&nbsp;!=&nbsp;null)&nbsp;&amp;&amp;&nbsp;(parentElement&nbsp;instanceof&nbsp;ContentOutlineNode))&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ContentOutlineNode&nbsp;parentNode&nbsp;=&nbsp;(ContentOutlineNode)&nbsp;parentElement;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EClass&nbsp;clazz&nbsp;=&nbsp;parentNode.getClazz();<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(clazz.equals(MyDslPackage.Literals.ATTRIBUTE))&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;false;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;true;<br>
&nbsp;&nbsp;}<br>

<br>
}<br>

<br>

<br>

</code>
</p>
</div>
</div>
<div class="section" title="Context menus">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="Contextmenus"></a>Context menus</h3>
</div>
</div>
</div>
<p>(stay tuned)</p>
</div>
<div class="section" title="Sorting">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="Sorting"></a>Sorting</h3>
</div>
</div>
</div>
<p>(stay tuned)</p>
</div>
</div>
<div class="section" title="Navigation and Hyperlinking">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="navigation"></a>Navigation and Hyperlinking</h2>
</div>
</div>
</div>
<p>text</p>
</div>
<div class="section" title="Formatting (Pretty Printing)">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="formatting"></a>Formatting (Pretty Printing)</h2>
</div>
</div>
</div>
<p>A formatter can be implemented via the 
				<code class="code">IFormatter</code> service. Technically speaking, a formatter is a 
				<a class="link" href="#tokenstream" title="Token Stream">Token Stream</a> which inserts/removes/modifies hidden tokens (whitespaces, linebreaks, comments).
			</p>
<p>The formatter is invoked during the 
				<a class="link" href="#serialization" title="Serialization">serialization phase</a> and when the user triggers formatting in the editor (for example, using the CTRL+SHIFT+F shortcut).
			</p>
<p>Xtext ships with two formatters:</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>The 
						<code class="code">OneWhitespaceFormatter</code> simply writes one whitespace between all tokens.
					</p>
</li>
<li class="listitem">
<p>The 
						<code class="code">AbstractDeclarativeFormatter</code> allows advanced configuration using a 
						<code class="code">FormattingConfig</code>. Both are explained in the 
						<a class="link" href="#declarativeformatter" title="Declarative Formatter">next chapter</a>.
					</p>
</li>
</ul>
</div>
<div class="section" title="Declarative Formatter">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="declarativeformatter"></a>Declarative Formatter   </h3>
</div>
</div>
</div>
<p>A declarative formatter can be implemented by sub-classing 
					<code class="code">AbstractDeclarativeFormatter</code>, as shown in the following example:
				</p>
<div class="literallayout">
<p>
<code class="code">
<br>
public&nbsp;class&nbsp;ExampleFormatter&nbsp;extends&nbsp;AbstractDeclarativeFormatter&nbsp;{<br>

<br>
&nbsp;&nbsp;@Override<br>
&nbsp;&nbsp;protected&nbsp;void&nbsp;configureFormatting(FormattingConfig&nbsp;c)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;ExampleLanguageGrammarAccess&nbsp;f&nbsp;=&nbsp;(ExampleLanguageGrammarAccess)&nbsp;getGrammarAccess();<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;c.setAutoLinewrap(120);<br>

<br>
&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Line<br>
&nbsp;&nbsp;&nbsp;&nbsp;c.setLinewrap(2).after(f.getLineAccess().getSemicolonKeyword_1());<br>
&nbsp;&nbsp;&nbsp;&nbsp;c.setNoSpace().before(f.getLineAccess().getSemicolonKeyword_1());<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;TestIndentation<br>
&nbsp;&nbsp;&nbsp;&nbsp;c.setIndentation(f.getTestIndentationAccess().getLeftCurlyBracketKeyword_1(),<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;f.getTestIndentationAccess().getRightCurlyBracketKeyword_3());<br>
&nbsp;&nbsp;&nbsp;&nbsp;c.setLinewrap().after(f.getTestIndentationAccess().getLeftCurlyBracketKeyword_1());<br>
&nbsp;&nbsp;&nbsp;&nbsp;c.setLinewrap().after(f.getTestIndentationAccess().getRightCurlyBracketKeyword_3());<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Param<br>
&nbsp;&nbsp;&nbsp;&nbsp;c.setNoLinewrap().around(f.getParamAccess().getColonKeyword_1());<br>
&nbsp;&nbsp;&nbsp;&nbsp;c.setNoSpace().around(f.getParamAccess().getColonKeyword_1());<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;comments<br>
&nbsp;&nbsp;&nbsp;&nbsp;c.setNoLinewrap().before(f.getSL_COMMENTRule());<br>
&nbsp;&nbsp;}<br>
}<br>

<br>

</code>
</p>
</div>
<p>The formatter has to implement the method 
					<code class="code">configureFormatting(...)</code> which is supposed to declaratively set up a 
					<code class="code">FormattingConfig</code>.
				</p>
<p>The 
					<code class="code">FormattingConfig</code> consist general settings and a set of rules:
				</p>
<div class="section" title="General FormattingConfig Settings">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="GeneralFormattingConfigSettings"></a>General FormattingConfig Settings</h4>
</div>
</div>
</div>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>
								
<code class="code">setAutoLinewrap(int)</code>  defines the amount of characters after which a linebreak should be dynamically inserted between two tokens. The rule 
								<code class="code">setNoLinewrap()</code> can be used to suppress this behavior locally. The default is 80.
							</p>
</li>
<li class="listitem">
<p>
								
<code class="code">setIndentationSpace(String)</code> defines the string which is used for a single degree of indentation. The default is two whitespaces.
							</p>
</li>
<li class="listitem">
<p>
								
<code class="code">setWhitespaceRule(AbstractRule)</code> defines the grammar rule which is used to match whitespaces. This is needed by the formatter to identify whitespaces and to insert whitespaces. The default is the rule named 
								<code class="code">WS</code>.
							</p>
</li>
<li class="listitem">
<p>
								
<code class="code">setIndentation(startele, endele)</code> increases the level of indentation when 
								<code class="code">startele</code> is matched and decreases the level when 
								<code class="code">endele</code> is matched. The matching of elements happens in the same way as it does for formatting rules.
							</p>
</li>
</ul>
</div>
</div>
<div class="section" title="FormattingConfig Rules">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="FormattingConfigRules"></a>FormattingConfig Rules</h4>
</div>
</div>
</div>
<p>Per default, the 
						<a class="link" href="#declarativeformatter" title="Declarative Formatter">Declarative Formatter</a> inserts one whitespace between two tokens. Rules can be used to specify a different behavior. They consist of two parts: 
						<span class="emphasis"><em>When</em></span> to apply the rule and 
						<span class="emphasis"><em>what</em></span> to do.
					</p>
<p>To understand 
						<span class="emphasis"><em>when</em></span> a rule is applied think of a stream of tokens whereas each token is associated with the corresponding grammar element. The rules are matched against these grammar elements. The following matching constructs exist.
					</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>
								
<code class="code">after(ele)</code>: The rule is executed after the grammar element 
								<code class="code">ele</code> has been matched. For example, if your grammar uses the keyword &ldquo;;&rdquo; to end lines, this can instruct the formatter to insert a linebreak after the semicolon.  
							</p>
</li>
<li class="listitem">
<p>
								
<code class="code">before(ele)</code>: The rule is executed before the matched element. For example, if your grammar contains lists which separate its values with keyword &ldquo;,&rdquo;, you this can instruct the formatter to suppress the whitespace before the comma.
							</p>
</li>
<li class="listitem">
<p>
								
<code class="code">around(ele)</code>: This is the same as 
								<code class="code">before(ele)</code> combined with  
								<code class="code">after(ele)</code>.  
							</p>
</li>
<li class="listitem">
<p>
								
<code class="code">between(ele1, ele2)</code>: This matches if 
								<code class="code">ele2</code> directly follows 
								<code class="code">ele1</code>. There may be no other elements in between.
							</p>
</li>
<li class="listitem">
<p>
								
<code class="code">bounds(ele1, ele2)</code>: This is the same as 
								<code class="code">before(ele1)</code> combined with  
								<code class="code">after(ele2)</code>.
							</p>
</li>
<li class="listitem">
<p>
								
<code class="code">range(ele1, ele2)</code>: The rule is enabled when 
								<code class="code">ele1</code> is matched, and disabled when 
								<code class="code">ele2</code> is matched. Thereby, the rule is active for the complete region which is surrounded by 
								<code class="code">ele1</code> and 
								<code class="code">ele2</code>. 
							</p>
</li>
</ul>
</div>
<p>The parameter 
						<code class="code">ele</code> can be a grammar&rsquo;s 
						<code class="code">AbstractElement</code> or a grammar&rsquo;s 
						<code class="code">AbstractRule</code>. However, only elements which represent one token in the textual representation can be matched. This are:
					</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>Terminal rules for comments.</p>
</li>
<li class="listitem">
<p>Keywords, Associations, Terminal RuleCalls, Datatype RuleCalls.</p>
</li>
</ul>
</div>
<p>After having explained how rules can be activated, this is what they can do:</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>
								
<code class="code">setLinewrap()</code>: Inserts a linebreak at this position.
							</p>
</li>
<li class="listitem">
<p>
								
<code class="code">setLinewrap(int)</code>: Inserts the specified number of linebreak at this position.
							</p>
</li>
<li class="listitem">
<p>
								
<code class="code">setNoLinewrap()</code>: Suppresses automatic line wrap, which may occur when the line&rsquo;s length exceeds the defined limit.
							</p>
</li>
<li class="listitem">
<p>
								
<code class="code">setNoSpace()</code>: Suppresses the whitespace between tokens at this position. Be aware that between some tokens a whitespace is required to maintain a valid concrete syntax. 
							</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="chapter" title="Chapter&nbsp;6.&nbsp;From oAW to TMF">
<div class="titlepage">
<div>
<div>
<h2 class="title">
<a name="from_oaw_to_tmf"></a>Chapter&nbsp;6.&nbsp;From oAW to TMF</h2>
</div>
</div>
</div>
<p>TMF Xtext is a complete rewrite of the Xtext framework previously released with openArchitectureWare 4.3.1 (oAW). We refer to the version from oAW as oAW Xtext whereas the current Xtext version that is hosted at Eclipse.org will be called TMF Xtext to avoid confusion.
			oAW Xtext has been around for about 2 years before TMF Xtext was released in June 2009 and has been used by many people to develop little languages and corresponding Eclipse-based IDE support.</p>
<p>TMF Xtext has been improved in many aspects compared to the former version. While it integrates far better into EMF, it offers new fundamental features as well. The overhauled architecture leads to better performance when working with large models and since the whole framework is wired via dependency injection it is highly customizable. 
			Last not least a test coverage of more than 2.000 unit tests provide confidence in the overall quality of TMF Xtext. We have been using the framework in production environments since one of the earlier milestones.</p>
<p>In this document we want to share the experience we made when migrating existing Xtext projects. The document describes the differences between oAW Xtext and TMF Xtext and is intended to be used as a guide to migrate from oAW Xtext to TMF Xtext.
			For people already familiar with the concepts of oAW Xtext it should also serve as a shortcut to learn TMF Xtext.  </p>
<div class="section" title="Why a rewrite?">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="why_rewrite"></a>Why a rewrite?</h2>
</div>
</div>
</div>
<p>The first thing you might wonder about is why we decided to reimplement the framework from scratch as opposed to use the existing code base and enhance it further on. 
				We decided so because we had learned a lot of lessons from oAW Xtext. Although we wanted to stick with many proven concepts 
				we found the implementation was lacking a solid foundation (the author of these lines is the original author of that non-solid code btw. :-)). The first version of oAW Xtext was basically a proof of concept which was so well received that it had been extended with all kinds of features (some were good, some were bad). Unfortunately code quality, clean and orthogonal concepts and test coverage did not receive the necessary focus.</p>
<p>In addition to this aspects of quality, oAW Xtext suffers from some severe performance problems. The extensive and naive use of Xtend (see next section) prevented many users to use oAW Xtext for growing real-world models.</p>
</div>
<div class="section" title="Migration overview">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="migration_overview"></a>Migration overview</h2>
</div>
</div>
</div>
<p>Although a couple of things have changed we tried to keep good ideas and left many things unchanged. At the same time we wanted to clean up poor concepts and solve the main problems we and you had with oAW Xtext.
				From a bird&rsquo;s eye view if you want to migrate an existing oAW Xtext project to TMF Xtext, you mainly just need to rename the old grammar from *.xtxt to *.xtext and add two lines to the beginning of that document (see below for details). You might also have to change a few keywords, but all in all this is pretty easy and we&rsquo;ve migrated a couple of oAW Xtext projects this way without problems.
				The other aspect where lots of code might have been written for is validation. In oAW Xtext we used Xpand&rsquo;s Check language to define constraints on the meta model. Even though this has been one major reason for the lack of scalability in Xtext we decided to keep the Check language as an option for compatibility reasons (see 
				<a class="link" href="#differences_validation" title="Differences in Validation">'Differences in Validation'</a>). Therefore, you do not need to translate your existing checks to a different language. Even better, you can overcome some performance issues by leveraging the newly introduced hooks to control the time of validation (while you type, on save, or on triggering an explicit action). 
				Anyway, if you want to provide a slick user experience validation should run fast while you type. Therefore, we strongly encourage you to implement validation using our declarative Java approach (TODO: ref).
			</p>
<p>We&rsquo;ve developed and reviewed a lot of oAW Xtext projects and saw that most of the work was done in the grammar and in the validation view point. 
				Other aspects such as outline view, label provider or content assist have been customized too, but they usually do not contain complicated Xtend code.
				In some projects the exception was linking and content assist which in oAW Xtext usually forces one to write a lot of duplicated code. While working on this we came up with a new concept called &ldquo;scopes&rdquo; that not only streamlines implementation in terms of redundancy. Scopes also increase the overall performance of Xtext.
				But since the concept of scopes was not carved out in oAW Xtext one usually implemented a cluttered and duplicated poor copy through linking and content assist. For obvious reasons, we didn&rsquo;t manage to come up with a good compatibility layer.
				So this is where most of the migration effort will go into if implemented customized linking. But we think the notion of scopes is such a valuable addition that it is worth the refactoring. Also, when looking at existing oAW Xtext projects we found that most projects either didn&rsquo;t change the default linking that much or they came up with their own linking framework anyway.</p>
<p>However, if we have completely misunderstood the situation and your oAW Xtext project cannot be migrated in a reasonable amount of time, please tell us. We want to help you!</p>
</div>
<div class="section" title="Where are the Xtend-based APIs?">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="Xtend_based_apis"></a>Where are the Xtend-based APIs?</h2>
</div>
</div>
</div>
<p>One of the nice things with oAW Xtext was the use of Xtend to allow customizing different aspects of the generated language infrastructure.
				Xtend is a part of the template language Xpand, which is shipped with oAW (and now is included in M2T Xpand). It provides a nicer expression syntax than Java.
				Especially the existence of higher-order functions for collections is extremely handy when working with models.
				In addition to the nice syntax, it provides dynamic polymorphic dispatch, which means that declaring e.g. label computation for a meta model is very convenient and type safe at the same time.
				In Java one usually has to write instanceof and cast orgies. </p>
<div class="section" title="Xtend is hard to debug">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="Xtend_is_hard_to_debug"></a>Xtend is hard to debug</h3>
</div>
</div>
</div>
<p>While the aforementioned features allow the convenient specification of label and icon providers, outline views, content assist and linking, Xtend is interpreted and therefore hard to debug. Because of that Xpand is shipped with a special debugger facility. Unfortunately, this debugger cannot be used in the context of Xtext since it implies that the Xtend functions have to be called from a workflow. This is not and cannot be the case for Xtext Editors.
					As a result one has to debug his way through the interpreter, which is hard and inconvenient (even for us, who have written that interpreter).</p>
</div>
<div class="section" title="Xtend is slow">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="Xtend_is_slow"></a>Xtend is slow</h3>
</div>
</div>
</div>
<p>But the problematic debugging in the context of Xtext was not the main reason why there are no Xtend-based APIs beside Check in TMF Xtext. The main reason is that Xtend is too slow to be evaluated &ldquo;inside&rdquo; the editor again and again while you type. 
					While Xtend&rsquo;s performance is sufficient when run in a code generator, it is just too slow to be executed on keystroke (or 500ms after the last keystroke, which is when the reconciler reparses, links and validates the model). Xtend is relatively slow, because it supports polymorphic dispatch (the cool feature mentioned above), which means that for each invocation it matches at runtime which function is the best match and it has to do so on each call. Also Xtend supports a pluggable typesystem, where you can adapt to other existing type systems such as JavaBeans or Ecore. This is very powerful and flexible but introduces another indirection layer. Last but not least the code is interpreted and not compiled. The price we pay for all these nice features is reduced performance.</p>
<p>In addition to these scalability problems we have designed some core APIs (e.g. scopes) around the idea of Iterables, which allows for lazy resolution of elements. As Xtend does not know the concept of Iterators you would have to work with lists all the time. Copying collections over and over again is far more expensive than chaining Iterables through filters and transformers like we do with Google Collections in TMF Xtext.</p>
</div>
<div class="section" title="Convenient Java">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="Convenient_Java"></a>Convenient Java</h3>
</div>
</div>
</div>
<p>To summarize the dilemma we had to find a way to allow for convenient, scalable and debuggable APIs. Ultimately we wanted to provide neat DSLs for every view point, which provide all these things. However, we had to prioritize our efforts with the available resources in mind. 
					As a result we found ways and means to tweak Java as good as possible to allow for relatively convenient, high performing implementations. </p>
<p>Java is fast and can easily be debugged but ranks behind Xtend regarding convenience. We address this with different approaches to make Java development in the context of Xtext as comfortable as possible.</p>
<p>Most of the APIs in TMF Xtext use polymorphic dispatching, which mimics the behavior known from Xtend. Another valuable feature of Xtend while working with oAW Xtext is static type checking while working with the inferred Ecore model whereas in Java the work with dynamic Ecore classes was rather cumbersome. Since TMF Xtext generates static Ecore classes per default you get static typing in Java as well. Additionally, the use of 
					<a class="ulink" href="http://code.google.com/p/google-collections" target="_new">Google Collections</a> reduces the pain when navigating over your model to extract information. 
				</p>
<p>With these techniques an ILabelProvider that handles your own EClasses 
					<code class="code">Property</code> and 
					<code class="code">Entity</code> can be written like this:
				</p>
<div class="literallayout">
<p>
<code class="code">
<br>
public&nbsp;class&nbsp;DomainModelLabelProvider&nbsp;extends&nbsp;DefaultLabelProvider&nbsp;{<br>

<br>
&nbsp;&nbsp;String&nbsp;label(Entity&nbsp;e)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;e.getName();<br>
&nbsp;&nbsp;}<br>

<br>
&nbsp;&nbsp;String&nbsp;image(Property&nbsp;p)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;p.isMultiValue()&nbsp;?&nbsp;"complexProperty.gif":&nbsp;"simpleProperty.gif";<br>
&nbsp;&nbsp;}<br>

<br>
&nbsp;&nbsp;String&nbsp;image(Entity&nbsp;e)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;"entity.gif";<br>
&nbsp;&nbsp;}<br>

<br>
}<br>
&nbsp;&nbsp;<br>

</code>
</p>
</div>
<p>As you can see this is very similar to the way one describes labels and icons in oAW Xtext, but has the advantage that it is easier to test and to debug, faster and can be used everywhere an ILabelProvider is expected in Eclipse.</p>
</div>
<div class="section" title="Conclusion">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="conclusion"></a>Conclusion</h3>
</div>
</div>
</div>
<p>Just to get it right, Xtend is a very powerful language and we still use it for its main purpose: code generation and model transformation. The whole generator in TMF Xtext is written in Xpand and Xtend and its performance is at least in our experience sufficient for that use case. Actually we were able to increase the runtime performance of Xpand by about 60% for the Galileo release of M2T Xpand. But still, live execution in the IDE and on typing is very critical and one has to think about every millisecond in this area. </p>
<p>As an alternative to the Java APIs we also considered other JVM languages. We like static typing and think it is especially important when processing typed models (which evolve heavily). That&rsquo;s why Groovy or JRuby were no alternatives. Using Scala would have been a very good match, but we didn&rsquo;t want to require knowledge of Scala so we didn&rsquo;t use it and stuck to Java. </p>
</div>
</div>
<div class="section" title="Differences">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="differences"></a>Differences</h2>
</div>
</div>
</div>
<p>In this section differences between oAW Xtext and TMF Xtext are outlined and explained. We&rsquo;ll start from the APIs such as the grammar language and the validation and finish with the different hooks for customizing linking and several UI aspects, such as outline view and content assist. We&rsquo;ll also try to map some of the oAW Xtext concepts to their counterparts in TMF Xtext.</p>
<div class="section" title="Differences in the grammar language">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="differenced_grammar_language"></a>Differences in the grammar language</h3>
</div>
</div>
</div>
<p>When looking at a TMF Xtext grammar the first time it looks like one has to provide additional information which was not necessary in oAW Xtext. In oAW Xtext *.xtxt files started with the first production rule where in TMF Xtext one has to declare the name of the language followed by declaration of one or more used/generated meta models:</p>
<p>TMF Xtext heading information</p>
<div class="literallayout">
<p>
<code class="code">
<br>
&nbsp;&nbsp;grammar&nbsp;my.namespace.Language&nbsp;with&nbsp;org.eclipse.xtext.common.Terminals<br>
&nbsp;&nbsp;generate&nbsp;myDsl&nbsp;"http://www.namespace.my/2009/MyDSL"<br>
&nbsp;<br>
&nbsp;&nbsp;FirstRule&nbsp;:&nbsp;...<br>

<br>

</code>
</p>
</div>
<p>In oAW Xtext this information was provided through the generator (actually it is contained in the *.properties file) but we found that these things are very important for a complete description of a grammar. Therefore we made that information becoming a part of the grammar language in order to have self-describing grammars and allow for sophisticated static analysis, etc.. </p>
<p>Apart from the first two lines the grammar languages of both versions are more or less compatible. The syntax for all the different EBNF concepts (alternatives, groups, cardinalities) is similar.
					Also assignments are syntactically and semantically identical in both versions. 
					However in TMF Xtext some concepts have been generalized and improved:</p>
<div class="section" title="String rules become Datatype rules">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="differences_datatype_rules"></a>String rules become Datatype rules</h4>
</div>
</div>
</div>
<p>The very handy String rules are still present in TMF Xtext but we generalized them so that you don&rsquo;t need to write the &lsquo;String&rsquo; keyword in front of them and at the same time these rules can not only produce EStrings but (as the name suggests) any kind of EDatatype. Every parser rule that does neither include assignments nor calls any that does returns an EDataType containing the consumed data. Per default this is an EString but you can now simply create a parser rule returning other EDatatype as well (see TODO-REF).</p>
<div class="literallayout">
<p>
<code class="code">
<br>
&nbsp;&nbsp;Float&nbsp;returns&nbsp;ecore::EDouble&nbsp;:&nbsp;INT&nbsp;('.'&nbsp;INT)?;<br>

</code>
</p>
</div>
</div>
<div class="section" title="Enum rules">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="differences_enum_rules"></a>Enum rules</h4>
</div>
</div>
</div>
<p>Enum rules have not changed significantly. The keyword has changed to be all lower case (&lsquo;enum&rsquo; instead of &lsquo;Enum&rsquo;).
						Also the right-hand side of the assignment is now optional. That is in oAW Xtext:</p>
<div class="literallayout">
<p>
<code class="code">
<br>
&nbsp;&nbsp;Enum&nbsp;MyEnum&nbsp;:&nbsp;foo='foo'&nbsp;|&nbsp;bar='bar';<br>
&nbsp;&nbsp;<br>

</code>
</p>
</div>
<p>becomes</p>
<div class="literallayout">
<p>
<code class="code">
<br>
&nbsp;&nbsp;enum&nbsp;MyEnum&nbsp;:&nbsp;foo='foo'&nbsp;|&nbsp;bar='bar';<br>
&nbsp;&nbsp;&nbsp;<br>

</code>
</p>
</div>
<p>and because the name of the literal equals the literal value one can omit the right-hand side in this case and write:</p>
<div class="literallayout">
<p>
<code class="code">
<br>
&nbsp;&nbsp;enum&nbsp;MyEnum&nbsp;:&nbsp;foo&nbsp;|&nbsp;bar;<br>

<br>

</code>
</p>
</div>
</div>
<div class="section" title="Native rules">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="differences_native_rules"></a>Native rules</h4>
</div>
</div>
</div>
<p>Another improvement is that we could replace the blackbox native rules with full-blown EBNF syntax. 
						That is native rules become terminal rules and are no longer written as a string literal containing ANTLR syntax.</p>
<p>Example :</p>
<div class="literallayout">
<p>
<code class="code">
<br>
&nbsp;&nbsp;Native&nbsp;FOO&nbsp;:&nbsp;"'f'&nbsp;'o'&nbsp;'o'";<br>

</code>
</p>
</div>
<p>becomes</p>
<div class="literallayout">
<p>
<code class="code">
<br>
&nbsp;&nbsp;terminal&nbsp;FOO&nbsp;:&nbsp;'f'&nbsp;'o'&nbsp;'o';<br>

</code>
</p>
</div>
<p>See the reference documentation for all the different expressions possible in terminal rules (TODO-REF).</p>
</div>
<div class="section" title="No URI terminal rule anymore">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="differences_no_URI_token"></a>No URI terminal rule anymore</h4>
</div>
</div>
</div>
<p>We decided to remove the URI terminal. The only reason for the existence was to mark the model somehow so that the framework knows what information to use in order to load referenced models. Instead we decided to solve this similar to how we imply other defaults: by convention.</p>
<p>So instead of using a special token which is syntactically a STRING token, the default import mechanism now looks for EAttributes of type EString with the name &lsquo;importURI&rsquo;.
						That is if you&rsquo;ve used the URI token like this:</p>
<div class="literallayout">
<p>
<code class="code">
<br>
&nbsp;&nbsp;Import&nbsp;:&nbsp;'import'&nbsp;myReference=URI;<br>

</code>
</p>
</div>
<p>you&rsquo;ll have to rewrite it that way</p>
<div class="literallayout">
<p>
<code class="code">
<br>
&nbsp;&nbsp;Import&nbsp;:&nbsp;'import'&nbsp;importURI=STRING;<br>

</code>
</p>
</div>
<p>Although this changes your meta model, one usually never used this reference explicitly as it was only there to be used by the default import mechanism. So we assume and hope that changing the reference is not a big deal for you. </p>
</div>
<div class="section" title="Return types">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="differences_return_types"></a>Return types</h4>
</div>
</div>
</div>
<p>The syntax to explicitly declare the return type of a rule has changed. In oAW Xtext (where this was marked as &lsquo;experimental&rsquo;) the syntax was:</p>
<div class="literallayout">
<p>
<code class="code">
<br>
&nbsp;&nbsp;MyRule&nbsp;[MyType]&nbsp;:&nbsp;foo=ID;&nbsp;&nbsp;<br>

</code>
</p>
</div>
<p>in TMF Xtext we have a keyword for this :</p>
<div class="literallayout">
<p>
<code class="code">
<br>
&nbsp;&nbsp;MyRule&nbsp;returns&nbsp;MyType&nbsp;:&nbsp;foo=ID;<br>

</code>
</p>
</div>
<p>This is a bit more verbose, but at the same time more readable. And as you don&rsquo;t have to write the return type in most situations, it&rsquo;s good to have a more explicit, readable syntax.</p>
</div>
</div>
<div class="section" title="Differences in Validation">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="differences_validation"></a>Differences in Validation</h3>
</div>
</div>
</div>
<p>TMF Xtext still supports implementing validation using Xpand&rsquo;s Check. However it is no longer using the EMF meta model (typesystem) but now uses the so called JavaBeansMetamodel. This means that the types in Check and Xtend correspond to Java types. This requires minor changes (namely the namespaces to be imported are now the qualified name of the generated Java classes). 
					Example: If your Check file looked like this in oAW Xtext :</p>
<div class="literallayout">
<p>
<code class="code">
<br>
&nbsp;&nbsp;import&nbsp;myMetamodel;<br>
&nbsp;&nbsp;context&nbsp;Type&nbsp;ERROR&nbsp;"foo"&nbsp;:&nbsp;name!=null;&nbsp;&nbsp;&nbsp;<br>

</code>
</p>
</div>
<p>it becomes something like the following in TMF Xtext :</p>
<div class="literallayout">
<p>
<code class="code">
<br>
&nbsp;&nbsp;import&nbsp;my::pack::to::myMetaModel;<br>
&nbsp;&nbsp;context&nbsp;Type&nbsp;ERROR&nbsp;"foo"&nbsp;:&nbsp;name!=null;<br>

</code>
</p>
</div>
<p>Where 
					<code class="code">my::pack::to::myMetaModel</code> refers to the package the generated EClasses are in. In other words there&rsquo;s a Java class 
					<code class="code">my.pack.to.myMetaModel.Type</code>.
					We changed this in order to allow use of any Java API from within Check and Xtend.
				</p>
</div>
<div class="section" title="Differences in Linking">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="differences_linking"></a>Differences in Linking</h3>
</div>
</div>
</div>
<p>The linking has been completely redesigned. In oAW Xtext linking was done in a very naive way: To find an element one queries a list of all &lsquo;visible&rsquo; EObjects, then filters out what is not needed and tries to find a match by comparing the text written for the crosslink with the value returned by the 
					<code class="code">id()</code> extension. As a side-effect of 
					<code class="code">link_feature()</code> the reference is set.
				</p>
<p>The code about selecting and filtering 
					<code class="code">allElements()</code> usually has been duplicated in the corresponding content assist function, so that linking and content assist are semantically in sync. If you&rsquo;re good (we usually were not) you externalized that piece of code and reused the same extension in content assist and linking. 
				</p>
<p>To put it bluntly this approach could be summarized in two steps:</p>
<div class="orderedlist">
<ol class="orderedlist" type="1">
<li class="listitem">
<p>Give me the whole universe including every unregarded object in the uncharted backwaters of the unfashionable end of the western spiral arm of the galaxy and squeeze it into an Arraylist </p>
</li>
<li class="listitem">
<p>From this, select the one I need</p>
</li>
</ol>
</div>
<p>This was not only very expensive but also lacks an important abstraction: the notion of scopes.</p>
<div class="section" title="The idea of scopes">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="differences_linking_sopes"></a>The idea of scopes</h4>
</div>
</div>
</div>
<p>In TMF Xtext we&rsquo;ve introduced scopes and scope providers that are responsible for creating scopes. A scope is basically a set of name-&gt;value pairs. Scopes are implemented upon Iterables and are nested to build a hierarchy. With scopes we declare &ldquo;visible&rdquo; objects in a lazy and cost-saving way where the linker only navigates as far as necessary to find matching objects. The content assist reuses this set of visible objects to offer only reachable objects. </p>
<p>When the linking has to be customized scoping is where most of the semantics typically goes into. By implementing an 
						<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/scoping/IScopeProvider.java?root=Modeling_Project&view=co" target="_new">IScopeProvider</a> for your language linking and content assist will automatically be kept in sync since both use the scope provider.
					</p>
<p>The provided default implementation is semantically mostly identical to how the default linking worked in oAW Xtext: </p>
<div class="orderedlist">
<ol class="orderedlist" type="1">
<li class="listitem">
<p>Elements which have an attribute &lsquo;name&rsquo; will be made visible by their name</p>
</li>
<li class="listitem">
<p>Referenced resources will be put on the (outer) scope by using the &lsquo;importURI&rsquo;- naming convention and will only be loaded if necessary</p>
</li>
<li class="listitem">
<p>The available elements are filtered by the expected type (i.e. the type of the reference to be linked)</p>
</li>
</ol>
</div>
</div>
<div class="section" title="Migration">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="differences_linking_migration"></a>Migration</h4>
</div>
</div>
</div>
<p>We expect the migration of linking to be very simple if you&rsquo;ve not changed the default semantics that much. We&rsquo;ve already migrated a couple of projects and it wasn&rsquo;t too hard to do so.
						If you have changed linking (and also content assist) a lot, you&rsquo;ll have to translate the semantics to the IScopeProvider concept. This might be a bit of work, but it is worth the effort as this will clean up your code base and better separate concerns.</p>
</div>
</div>
<div class="section" title="Differences in UI customizing">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="differences_ui"></a>Differences in UI customizing</h3>
</div>
</div>
</div>
<p>In oAW Xtext several UI services such as content assist, outline view or the label provider have been customized using Xtend. In TMF Xtext there is no Xtend API for these aspects. Extensive model computations for the content assist is most probably not necessary anymore- it reuses scopes. And since we provide a declarative Java API that mimics the polymorphic dispatch and relies on static Ecore classes you will gain nearly the same expressiveness as before while increasing maintainability and performance.</p>
<p>Beside the API change in favor of Java we have to mention that in TMF Xtext the outline view does not support multiple view points so far. This is just because we didn&rsquo;t manage to get this included. We don&rsquo;t think that view points are a bad idea in general, but we decided that other things were more important.</p>
</div>
</div>
<div class="section" title="New Features">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="NewFeatures"></a>New Features</h2>
</div>
</div>
</div>
<p>This section provides an overview of new possibilities with TMF Xtext compared to oAW Xtext. Please note that this list is neither complete nor does it explain every aspect in detail to keep this document tight.</p>
<div class="section" title="Dependency Injection with Google Guice">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="DependencyInjectionwithGoogleGuice"></a>Dependency Injection with Google Guice</h3>
</div>
</div>
</div>
<p>Beyond the mentioned architectural overhaul that carve out separate concerns in a meaningful way these different classes of TMF Xtext are wired using 
					<a class="ulink" href="http://code.google.com/p/google-guice" target="_new">Google Guice</a>  and can easily replaced by or combined with your own implementation. We could have foreseen some common needs for adaption but with this mechanism you can virtually change every aspect of Xtext without duplicating an unmanageable amount of code.
				</p>
</div>
<div class="section" title="Improvements on Grammar Level">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="ImprovementsonGrammarLevel"></a>Improvements on Grammar Level</h3>
</div>
</div>
</div>
<p>The Xtext grammar language introduces some new features, too. Read the chapter 
					<a class="link" href="#grammarLanguage" title="Chapter&nbsp;2.&nbsp;The Grammar Language">grammar language</a> to understand the details about all the improvements that have been implemented.
				</p>
<p>
					
<a class="link" href="#grammarMixins" title="Grammar Mixins">Grammar mixins</a> allow you to extend existing languages and change their concrete and abstract syntax. However the abstract syntax (i.e. the Ecore model) can only be extended. This allows you to reuse existing validations, code generators, interpreters or other code which has been written against those types.
				</p>
<p>In oAW Xtext common terminals like ID, INT, STRING, ML_COMMENT, SL_SOMMENT and WS (whitespace) were hard coded into the grammar language and couldn&rsquo;t be removed and hardly overridden. In TMF Xtext these terminals are imported through the newly introduced grammar mixin mechanism from the shipped grammar 
					<code class="code">org.eclipse.xtext.common.Terminals</code> per default. This means that they are still there but reside in a libraries now. You don&rsquo;t have to use them and you can come up with your own set of reusable rules. 
				</p>
<p>
					
<a class="link" href="#grammarImport" title="Importing existing Meta Models">Reusing existing Ecore models</a> in oAW Xtext didn&rsquo;t work well and we communicated this by flagging this feature as &lsquo;experimental&rsquo;. In TMF Xtext importing existing Ecore models is fully supported. Moreover, it is possible to import a couple of different EPackages and generate some at the same time, so that the generated Ecore models extend or refer to the existing Ecore models.
				</p>
<p>The grammar language gained one new concept that is of great value when writing left-factored grammars (e.g. expressions). With actions one can do minor AST rewritings within a rule to overcome degenerated ASTs. You will find an 
					<a class="link" href="#grammarActions" title="Tree Rewrite Actions">in-depth explanation of actions</a> in the dedicated chapter in the reference documentation.
				</p>
</div>
<div class="section" title="Fine-grained control for validation">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="Finegrainedcontrolforvalidation"></a>Fine-grained control for validation</h3>
</div>
</div>
</div>
<p>In order to make more expensive validations possible without slowing down the editor, TMF Xtext supports three different validation hooks.  </p>
<div class="orderedlist">
<ol class="orderedlist" type="1">
<li class="listitem">
<p>FAST constraints are triggered by the reconciler (i.e. 500 ms after the last keystroke) and on save.</p>
</li>
<li class="listitem">
<p>NORMAL constraints are executed on save only.</p>
</li>
<li class="listitem">
<p>EXPENSIVE constraints are executed through an action which is available through the context menu.</p>
</li>
</ol>
</div>
<p>Please note that when using Xtext models for code generation the checks of all three categories will be performed. </p>
<p>Beside this it is now possible to add information about the feature which is validated.</p>
<div class="literallayout">
<p>
<code class="code">
<br>
&nbsp;&nbsp;context&nbsp;Entity#name&nbsp;ERROR&nbsp;"Name&nbsp;should&nbsp;start&nbsp;with&nbsp;a&nbsp;capital&nbsp;"+this.name+"."&nbsp;:<br>
&nbsp;&nbsp;&nbsp;&nbsp;this.name.toFirstUpper()&nbsp;==&nbsp;this.name;<br>

</code>
</p>
</div>
<p>If you add the name of a feature prepended by a hash (&lsquo;#&rsquo;) in Check, the editor will only mark the value of the feature (name), not the whole object (Entity). Both concepts, control over validation time as well as pointing to a specific feature, complement one another in Check and Java based validation.</p>
</div>
</div>
<div class="section" title="Migration Support">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="MigrationSupport"></a>Migration Support</h2>
</div>
</div>
</div>
<p>In this document we tried to explain why we decided to change some aspects of Xtext&rsquo;s architecture. We consider most changes as minor but when it comes to scopes you will face a conceptual enhancement that did not exist in oAW Xtext. We tried to explain why it is not easily possible to come up with an adapter for scoping.</p>
<p>That said you might not have the time to do the migration and wished to have advice for migrating, especially from oAW linking to TMF linking. You&rsquo;re welcome to ask any questions in the newsgroup and we&rsquo;ll try to help you as much as possible in order to get your projects migrated. Also, if you don&rsquo;t want to do the migration yourself we (itemis AG) can do the work for you or help you with that. </p>
</div>
</div>
<div class="chapter" title="Chapter&nbsp;7.&nbsp;The Antlr IP issue (or which parser to use?)">
<div class="titlepage">
<div>
<div>
<h2 class="title">
<a name="antlr_ip_issue"></a>Chapter&nbsp;7.&nbsp;The Antlr IP issue (or which parser to use?)</h2>
</div>
</div>
</div>
<p>In order to be able to parse models written in your language, Xtext needs to provide a special parser for it.
			The parser is generated from the language grammar. </p>
<p>Currently it is recommended to use the 
			<a class="ulink" href="http://www.antlr.org" target="_new">Antlr-based</a> parser.
			Antlr is a very sophisticated parser generator framework based on a so called LL(*) algorithm.
			It is fast, simple and at the same time has some very nice and sophisticated features. Especially its 
			support for error recovery is much better than what other parser generators provide.
		</p>
<p>Antlr comes in two parts: the runtime and the generator.
			Both are shipped under the BSD license and have a clean intellectual property history. 
			However the generator is still implemented in an older version of Antlr (v 2.x), where it was not possible for the Eclipse Foundation 
			to be sure where exactly every line of code orginally comes from. Therefore Antlr v 2.x didn&rsquo;t get the needed approvement.
			Eclipse has a strict IP policy, which makes sure that everything provided by Eclipse can be consumed under the termns of the Eclipse Public Licence.
			The details are described in 
			<a class="ulink" href="http://www.eclipse.org/org/documents/Eclipse_IP_Policy.pdf" target="_new">this document</a>.
		</p>
<p>Unfortunately as the generator of Antlr V3 needs Antlr V2 it is as well not yet IP approved.
			That is why we are not allowed to ship Xtext with the Antlr generator (the runtime is IP approved), but have to provide it separately via updatesite at:</p>
<p>*
			<a class="ulink" href="http://download.itemis.com/updates/milestones" target="_new">http://download.itemis.com/updates/milestones</a>
		
</p>
<p>
			
<span class="bold"><strong>IMPORTANT</strong></span>

			<span class="italic">Although If you use the non-IP approved Antlr generator, you can still ship any languages and the IDEs you&rsquo;ve developed with Xtext without any worrying, because the 
				<span class="bold"><strong>Antlr runtime is IP approved</strong></span>
			</span>
		
</p>
<div class="section" title="What if I don&rsquo;t want to use non IP-approved code">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="WhatifIdontwanttousenonIPapprovedcode"></a>What if I don&rsquo;t want to use non IP-approved code</h2>
</div>
</div>
</div>
<p>If you, against all recommendations, need to stick to a fully IP approved generator, you can use the parser generator we&rsquo;ve developed.
				But be warned, although it&rsquo;s fully functional and equally fast, it does not have any error recovery.
				This makes the editing experience in the editor more or less unacceptable.</p>
</div>
</div>
</div>
</body>
</html>
